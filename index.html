<!DOCTYPE html>

<html class=" responsive" lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="theme-color" content="#171a21">
  <title>Trade offer with Ella &lt;3</title>
  <link rel="shortcut icon" href="https://steamcommunity.com/favicon.ico" type="image/x-icon">
  <style>
    .btn_green_white_innerfade {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #D2E885 !important;

      background: #a4d007;
      background: -webkit-linear-gradient(top, #a4d007 5%, #536904 95%);
      background: linear-gradient(to bottom, #a4d007 5%, #536904 95%);
    }

    .btn_green_white_innerfade>span {
      border-radius: 2px;
      display: block;


      background: #799905;
      background: -webkit-linear-gradient(top, #799905 5%, #536904 95%);
      background: linear-gradient(to bottom, #799905 5%, #536904 95%);
    }

    .btn_green_white_innerfade:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover {
      text-decoration: none !important;
      color: #fff !important;

      background: #b6d908;
      background: -webkit-linear-gradient(top, #b6d908 5%, #80a006 95%);
      background: linear-gradient(to bottom, #b6d908 5%, #80a006 95%);
    }

    .btn_green_white_innerfade:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover>span {
      background: #a1bf07;
      background: -webkit-linear-gradient(top, #a1bf07 5%, #80a006 95%);
      background: linear-gradient(to bottom, #a1bf07 5%, #80a006 95%);
    }

    .btn_blue_white_innerfade {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #fff !important;

      background: #aaceff;
      background: -webkit-linear-gradient(top, #aaceff 5%, #3c6091 95%);
      background: linear-gradient(to bottom, #aaceff 5%, #3c6091 95%);
    }

    .btn_blue_white_innerfade>span {
      border-radius: 2px;
      display: block;


      background: #82a6d7;
      background: -webkit-linear-gradient(top, #82a6d7 5%, #3c6091 95%);
      background: linear-gradient(to bottom, #82a6d7 5%, #3c6091 95%);
    }

    .btn_blue_white_innerfade:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover {
      text-decoration: none !important;
      color: #fff !important;

      background: #bbd8ff;
      background: -webkit-linear-gradient(top, #bbd8ff 5%, #4873a7 95%);
      background: linear-gradient(to bottom, #bbd8ff 5%, #4873a7 95%);
    }

    .btn_blue_white_innerfade:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover>span {
      background: #9ab7de;
      background: -webkit-linear-gradient(top, #9ab7de 5%, #4873a7 95%);
      background: linear-gradient(to bottom, #9ab7de 5%, #4873a7 95%);
    }

    .btn_darkblue_white_innerfade {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #A4D7F5 !important;

      background: rgba(47, 137, 188, 1);
      background: -webkit-linear-gradient(top, rgba(47, 137, 188, 1) 5%, rgba(23, 67, 92, 1) 95%);
      background: linear-gradient(to bottom, rgba(47, 137, 188, 1) 5%, rgba(23, 67, 92, 1) 95%);
    }

    .btn_darkblue_white_innerfade>span {
      border-radius: 2px;
      display: block;


      background: rgba(33, 101, 138, 1);
      background: -webkit-linear-gradient(top, rgba(33, 101, 138, 1) 5%, rgba(23, 67, 92, 1) 95%);
      background: linear-gradient(to bottom, rgba(33, 101, 138, 1) 5%, rgba(23, 67, 92, 1) 95%);
    }

    .btn_darkblue_white_innerfade:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover {
      text-decoration: none !important;
      color: #ffffff !important;

      background: rgba(102, 192, 244, 1);
      background: -webkit-linear-gradient(top, rgba(102, 192, 244, 1) 5%, rgba(47, 137, 188, 1) 95%);
      background: linear-gradient(to bottom, rgba(102, 192, 244, 1) 5%, rgba(47, 137, 188, 1) 95%);
    }

    .btn_darkblue_white_innerfade:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover>span {
      background: transparent;
    }

    .btn_darkblue_white_innerfade.btn_active,
    btn_darkblue_white_innerfade.active {
      text-decoration: none !important;
      color: #323b49 !important;

      background: #fff !important;
    }

    .btn_darkblue_white_innerfade.btn_active>span,
    btn_darkblue_white_innerfade.active>span {
      background: #989b9e;
      background: -webkit-linear-gradient(top, #989b9e 5%, #aeb1b5 95%);
      background: linear-gradient(to bottom, #989b9e 5%, #aeb1b5 95%);
    }

    .btn_darkred_white_innerfade {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #F5D7A4 !important;

      background: rgba(188, 47, 47, 1);
      background: -webkit-linear-gradient(top, rgba(188, 47, 47, 1) 5%, rgba(92, 37, 23, 1) 95%);
      background: linear-gradient(to bottom, rgba(188, 47, 47, 1) 5%, rgba(92, 37, 23, 1) 95%);
    }

    .btn_darkred_white_innerfade>span {
      border-radius: 2px;
      display: block;


      background: rgba(138, 51, 33, 1);
      background: -webkit-linear-gradient(top, rgba(138, 51, 33, 1) 5%, rgba(92, 37, 23, 1) 95%);
      background: linear-gradient(to bottom, rgba(138, 51, 33, 1) 5%, rgba(92, 37, 23, 1) 95%);
    }

    .btn_darkred_white_innerfade:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover {
      text-decoration: none !important;
      color: #ffffff !important;

      background: rgba(244, 92, 102, 1);
      background: -webkit-linear-gradient(top, rgba(244, 92, 102, 1) 5%, rgba(188, 67, 47, 1) 95%);
      background: linear-gradient(to bottom, rgba(244, 92, 102, 1) 5%, rgba(188, 67, 47, 1) 95%);
    }

    .btn_darkred_white_innerfade:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover>span {
      background: transparent;
    }

    .btn_darkred_white_innerfade.btn_active,
    btn_darkred_white_innerfade.active {
      text-decoration: none !important;
      color: #493b32 !important;

      background: #fff !important;
    }

    .btn_darkred_white_innerfade.btn_active>span,
    btn_darkred_white_innerfade.active>span {
      background: #9e9b98;
      background: -webkit-linear-gradient(top, #9e9b98 5%, #b5b1ae 95%);
      background: linear-gradient(to bottom, #9e9b98 5%, #b5b1ae 95%);
    }

    .btn_grey_white_innerfade {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #fff !important;

      background: #acb5bd;
      background: -webkit-linear-gradient(top, #acb5bd 5%, #414a52 95%);
      background: linear-gradient(to bottom, #acb5bd 5%, #414a52 95%);
    }

    .btn_grey_white_innerfade>span {
      border-radius: 2px;
      display: block;


      background: #778088;
      background: -webkit-linear-gradient(top, #778088 5%, #414a52 95%);
      background: linear-gradient(to bottom, #778088 5%, #414a52 95%);
    }

    .btn_grey_white_innerfade:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover {
      text-decoration: none !important;
      color: #fff !important;

      background: #cfd8e0;
      background: -webkit-linear-gradient(top, #cfd8e0 5%, #565f67 95%);
      background: linear-gradient(to bottom, #cfd8e0 5%, #565f67 95%);
    }

    .btn_grey_white_innerfade:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover>span {
      background: #99a2aa;
      background: -webkit-linear-gradient(top, #99a2aa 5%, #565f67 95%);
      background: linear-gradient(to bottom, #99a2aa 5%, #565f67 95%);
    }

    .btn_grey_grey {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #ebebeb !important;

      background: rgba(0, 0, 0, 0.4);
    }

    .btn_grey_grey>span {
      border-radius: 2px;
      display: block;


      background: transparent;
    }

    .btn_grey_grey:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover {
      text-decoration: none !important;
      color: #000 !important;

      background: #7bb7e3;
    }

    .btn_grey_grey:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover>span {
      background: transparent;
    }

    .btn_grey_grey_outer_bevel {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #ebebeb !important;

      background: #000;
    }

    .btn_grey_grey_outer_bevel>span {
      border-radius: 2px;
      display: block;


      background: #2B2B2B;
      background: -webkit-linear-gradient(top, #2B2B2B 5%, #202020 95%);
      background: linear-gradient(to bottom, #2B2B2B 5%, #202020 95%);
    }

    .btn_grey_grey_outer_bevel:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover {
      text-decoration: none !important;
      color: #ebebeb !important;

      background: #57749e;
      background: -webkit-linear-gradient(top, #57749e 5%, #364963 95%);
      background: linear-gradient(to bottom, #57749e 5%, #364963 95%);
    }

    .btn_grey_grey_outer_bevel:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover>span {
      background: #445b7c;
      background: -webkit-linear-gradient(top, #445b7c 5%, #364963 95%);
      background: linear-gradient(to bottom, #445b7c 5%, #364963 95%);
    }


    .btn_grey_grey_outer_bevel:not(:hover)>span {
      box-shadow: inset 0 1px 1px #434343;
    }

    .btn_grey_black {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #67c1f5 !important;

      background: rgba(0, 0, 0, 0.5);
    }

    .btn_grey_black>span {
      border-radius: 2px;
      display: block;


      background: transparent;
    }

    .btn_grey_black:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover {
      text-decoration: none !important;
      color: #fff !important;

      background: rgba(102, 192, 244, 0.4);
    }

    .btn_grey_black:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover>span {
      background: transparent;
    }

    .btn_grey_black.btn_active,
    btn_grey_black.active {
      text-decoration: none !important;
      color: #fff !important;

      background: rgba(102, 192, 244, 0.2);
      ;
    }

    .btn_grey_black.btn_active>span,
    btn_grey_black.active>span {
      background: transparent;
    }

    .btn_black {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #ebebeb !important;

      background: #000;
    }

    .btn_black>span {
      border-radius: 2px;
      display: block;


      background: transparent;
    }

    .btn_black:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover {
      text-decoration: none !important;
      color: #000 !important;

      background: #97C0E3;
    }

    .btn_black:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover>span {
      background: transparent;
    }

    .btnv6_blue_hoverfade {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #67c1f5 !important;

      background: rgba(103, 193, 245, 0.2);
    }

    .btnv6_blue_hoverfade>span {
      border-radius: 2px;
      display: block;


      background: transparent;
    }

    .btnv6_blue_hoverfade:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover {
      text-decoration: none !important;
      color: #fff !important;

      background: #417a9b;
      background: -webkit-linear-gradient(150deg, #417a9b 5%, #67c1f5 95%);
      background: linear-gradient(-60deg, #417a9b 5%, #67c1f5 95%);
    }

    .btnv6_blue_hoverfade:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover>span {
      background: transparent;
    }

    .btnv6_blue_hoverfade.btn_active,
    btnv6_blue_hoverfade.active {
      text-decoration: none !important;
      color: #fff !important;

      background: rgba(103, 193, 245, 0.6);
      ;
    }

    .btnv6_blue_hoverfade.btn_active>span,
    btnv6_blue_hoverfade.active>span {
      background: transparent;
    }

    .btnv6_lightblue_blue {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #2B5066 !important;

      background: rgba(193, 228, 249, 1);
      background: -webkit-linear-gradient(top, rgba(193, 228, 249, 1) 5%, rgba(148, 183, 202, 1) 95%);
      background: linear-gradient(to bottom, rgba(193, 228, 249, 1) 5%, rgba(148, 183, 202, 1) 95%);
    }

    .btnv6_lightblue_blue>span {
      border-radius: 2px;
      display: block;


      background: transparent;
      text-shadow: 1px 1px 0px rgba(255, 255, 255, 0.1);
    }

    .btnv6_lightblue_blue:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover {
      text-decoration: none !important;
      color: #ffffff !important;

      background: rgba(102, 192, 244, 1);
      background: -webkit-linear-gradient(top, rgba(102, 192, 244, 1) 5%, rgba(47, 137, 188, 1) 95%);
      background: linear-gradient(to bottom, rgba(102, 192, 244, 1) 5%, rgba(47, 137, 188, 1) 95%);
    }

    .btnv6_lightblue_blue:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover>span {
      background: transparent;
    }

    .btnv6_blue_blue_innerfade {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #A4D7F5 !important;

      background: rgba(47, 137, 188, 1);
      background: -webkit-linear-gradient(top, rgba(47, 137, 188, 1) 5%, rgba(23, 67, 92, 1) 95%);
      background: linear-gradient(to bottom, rgba(47, 137, 188, 1) 5%, rgba(23, 67, 92, 1) 95%);
    }

    .btnv6_blue_blue_innerfade>span {
      border-radius: 2px;
      display: block;


      background: transparent;
      text-shadow: -1px -1px 0px rgba(0, 0, 0, 0.1);
    }

    .btnv6_blue_blue_innerfade:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover {
      text-decoration: none !important;
      color: #ffffff !important;

      background: rgba(102, 192, 244, 1);
      background: -webkit-linear-gradient(top, rgba(102, 192, 244, 1) 5%, rgba(47, 137, 188, 1) 95%);
      background: linear-gradient(to bottom, rgba(102, 192, 244, 1) 5%, rgba(47, 137, 188, 1) 95%);
    }

    .btnv6_blue_blue_innerfade:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover>span {
      background: transparent;
    }

    .btnv6_green_white_innerfade {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #D2E885 !important;

      background: rgba(121, 153, 5, 1);
      background: -webkit-linear-gradient(top, rgba(121, 153, 5, 1) 5%, rgba(83, 105, 4, 1) 95%);
      background: linear-gradient(to bottom, rgba(121, 153, 5, 1) 5%, rgba(83, 105, 4, 1) 95%);
    }

    .btnv6_green_white_innerfade>span {
      border-radius: 2px;
      display: block;


      background: transparent;
      text-shadow: -1px -1px 0px rgba(0, 0, 0, 0.1);
    }

    .btnv6_green_white_innerfade:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover {
      text-decoration: none !important;
      color: #ffffff !important;

      background: rgba(164, 208, 7, 1);
      background: -webkit-linear-gradient(top, rgba(164, 208, 7, 1) 5%, rgba(107, 135, 5, 1) 95%);
      background: linear-gradient(to bottom, rgba(164, 208, 7, 1) 5%, rgba(107, 135, 5, 1) 95%);
    }

    .btnv6_green_white_innerfade:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover>span {
      background: transparent;
    }

    .btnv6_grey_black {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #66c0f4 !important;

      background: #212c3d;
    }

    .btnv6_grey_black>span {
      border-radius: 2px;
      display: block;


      background: transparent;
    }

    .btnv6_grey_black:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover {
      text-decoration: none !important;
      color: #fff !important;

      background: #66c0f4;
    }

    .btnv6_grey_black:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover>span {
      background: transparent;
    }

    .btnv6_grey_black.btn_active,
    btnv6_grey_black.active {
      text-decoration: none !important;
      color: #fff !important;

      background: rgba(103, 193, 245, 0.4);
      ;
    }

    .btnv6_grey_black.btn_active>span,
    btnv6_grey_black.active>span {
      background: transparent;
    }

    .btnv6_white_transparent {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #fff !important;

      background: transparent;
    }

    .btnv6_white_transparent>span {
      border-radius: 2px;
      display: block;


      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.4);
      border-radius: 2px;
    }

    .btnv6_white_transparent:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover {
      text-decoration: none !important;
      color: #fff !important;

      background: transparent;
    }

    .btnv6_white_transparent:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover>span {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 1);
      border-radius: 2px;
    }

    .btn_teal {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #A4D7F5 !important;

      background: rgba(62, 133, 154, 1);
      background: -webkit-linear-gradient(top, rgba(62, 133, 154, 1) 5%, rgba(30, 73, 85, 1) 95%);
      background: linear-gradient(to bottom, rgba(62, 133, 154, 1) 5%, rgba(30, 73, 85, 1) 95%);
    }

    .btn_teal>span {
      border-radius: 2px;
      display: block;


      background: rgba(33, 101, 138, 1);
      background: -webkit-linear-gradient(top, rgba(33, 101, 138, 1) 5%, rgba(23, 67, 92, 1) 95%);
      background: linear-gradient(to bottom, rgba(33, 101, 138, 1) 5%, rgba(23, 67, 92, 1) 95%);
    }

    .btn_teal:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover {
      text-decoration: none !important;
      color: #ffffff !important;

      background: rgba(92, 163, 184, 1);
      background: -webkit-linear-gradient(top, rgba(92, 163, 184, 1) 5%, rgba(60, 103, 115, 1) 95%);
      background: linear-gradient(to bottom, rgba(92, 163, 184, 1) 5%, rgba(60, 103, 115, 1) 95%);
    }

    .btn_teal:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover>span {
      background: transparent;
    }

    .btn_teal.btn_active,
    btn_teal.active {
      text-decoration: none !important;
      color: #323b49 !important;

      background: #fff !important;
    }

    .btn_teal.btn_active>span,
    btn_teal.active>span {
      background: rgba(72, 143, 164, 1);
      background: -webkit-linear-gradient(top, rgba(72, 143, 164, 1) 5%, rgba(40, 83, 95, 1) 95%);
      background: linear-gradient(to bottom, rgba(72, 143, 164, 1) 5%, rgba(40, 83, 95, 1) 95%);
    }

    .btn_royal_blue {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #A4D7F5 !important;

      background: rgba(79, 78, 181, 1);
      background: -webkit-linear-gradient(top, rgba(79, 78, 181, 1) 5%, rgba(49, 48, 151, 1) 95%);
      background: linear-gradient(to bottom, rgba(79, 78, 181, 1) 5%, rgba(49, 48, 151, 1) 95%);
    }

    .btn_royal_blue>span {
      border-radius: 2px;
      display: block;


      background: rgba(33, 101, 138, 1);
      background: -webkit-linear-gradient(top, rgba(33, 101, 138, 1) 5%, rgba(23, 67, 92, 1) 95%);
      background: linear-gradient(to bottom, rgba(33, 101, 138, 1) 5%, rgba(23, 67, 92, 1) 95%);
    }

    .btn_royal_blue:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover {
      text-decoration: none !important;
      color: #ffffff !important;

      background: rgba(109, 108, 211, 1);
      background: -webkit-linear-gradient(top, rgba(109, 108, 211, 1) 5%, rgba(79, 78, 181, 1) 95%);
      background: linear-gradient(to bottom, rgba(109, 108, 211, 1) 5%, rgba(79, 78, 181, 1) 95%);
    }

    .btn_royal_blue:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover>span {
      background: transparent;
    }

    .btn_royal_blue.btn_active,
    btn_royal_blue.active {
      text-decoration: none !important;
      color: #323b49 !important;

      background: #fff !important;
    }

    .btn_royal_blue.btn_active>span,
    btn_royal_blue.active>span {
      background: rgba(72, 143, 164, 1);
      background: -webkit-linear-gradient(top, rgba(72, 143, 164, 1) 5%, rgba(40, 83, 95, 1) 95%);
      background: linear-gradient(to bottom, rgba(72, 143, 164, 1) 5%, rgba(40, 83, 95, 1) 95%);
    }

    .btn_plum {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #A4D7F5 !important;

      background: rgba(111, 35, 74, 1);
      background: -webkit-linear-gradient(top, rgba(111, 35, 74, 1) 5%, rgba(81, 5, 44, 1) 95%);
      background: linear-gradient(to bottom, rgba(111, 35, 74, 1) 5%, rgba(81, 5, 44, 1) 95%);
    }

    .btn_plum>span {
      border-radius: 2px;
      display: block;


      background: rgba(33, 101, 138, 1);
      background: -webkit-linear-gradient(top, rgba(33, 101, 138, 1) 5%, rgba(23, 67, 92, 1) 95%);
      background: linear-gradient(to bottom, rgba(33, 101, 138, 1) 5%, rgba(23, 67, 92, 1) 95%);
    }

    .btn_plum:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover {
      text-decoration: none !important;
      color: #ffffff !important;

      background: rgba(151, 75, 114, 1);
      background: -webkit-linear-gradient(top, rgba(151, 75, 114, 1) 5%, rgba(121, 45, 84, 1) 95%);
      background: linear-gradient(to bottom, rgba(151, 75, 114, 1) 5%, rgba(121, 45, 84, 1) 95%);
    }

    .btn_plum:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover>span {
      background: transparent;
    }

    .btn_plum.btn_active,
    btn_plum.active {
      text-decoration: none !important;
      color: #323b49 !important;

      background: #fff !important;
    }

    .btn_plum.btn_active>span,
    btn_plum.active>span {
      background: rgba(72, 143, 164, 1);
      background: -webkit-linear-gradient(top, rgba(72, 143, 164, 1) 5%, rgba(40, 83, 95, 1) 95%);
      background: linear-gradient(to bottom, rgba(72, 143, 164, 1) 5%, rgba(40, 83, 95, 1) 95%);
    }

    .btn_green_steamui {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #d2efa9;
      !important;

      background: transparent;
      text-shadow: 1px 1px 0px rgba(0, 0, 0, 0.3);
    }

    .btn_green_steamui>span {
      border-radius: 2px;
      display: block;


      background: #6fa720;
      background: -webkit-linear-gradient(top, #6fa720 5%, #588a1b 95%);
      background: linear-gradient(to bottom, #6fa720 5%, #588a1b 95%);
      background: linear-gradient(to right, #75b022 5%, #588a1b 95%);
    }

    .btn_green_steamui:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover {
      text-decoration: none !important;
      color: #fff;
      !important;

      background: transparent;
    }

    .btn_green_steamui:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover>span {
      background: #8ed629;
      background: -webkit-linear-gradient(top, #8ed629 5%, #6aa621 95%);
      background: linear-gradient(to bottom, #8ed629 5%, #6aa621 95%);
      background: linear-gradient(to right, #8ed629 5%, #6aa621 95%);
    }

    .btn_green_steamui.btn_active,
    btn_green_steamui.active {
      text-decoration: none !important;
      color: #fff;
      !important;

      background: transparent;
    }

    .btn_green_steamui.btn_active>span,
    btn_green_steamui.active>span {
      background: #8ed629;
      background: -webkit-linear-gradient(top, #8ed629 5%, #6aa621 95%);
      background: linear-gradient(to bottom, #8ed629 5%, #6aa621 95%);
      background: linear-gradient(to right, #8ed629 5%, #6aa621 95%);
    }

    .btn_grey_steamui {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #dfe3e6;
      !important;

      background: transparent;
    }

    .btn_grey_steamui>span {
      border-radius: 2px;
      display: block;


      background: #75b022;
      background: -webkit-linear-gradient(top, #75b022 5%, #588a1b 95%);
      background: linear-gradient(to bottom, #75b022 5%, #588a1b 95%);
      background: linear-gradient(to right, #32363f 5%, #32363f 95%);
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
      transition: all 0.2s ease-out;
    }

    .btn_grey_steamui:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover {
      text-decoration: none !important;
      color: #fff;
      !important;

      background: transparent;
    }

    .btn_grey_steamui:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover>span {
      background: #8ed629;
      background: -webkit-linear-gradient(top, #8ed629 5%, #6aa621 95%);
      background: linear-gradient(to bottom, #8ed629 5%, #6aa621 95%);
      background: linear-gradient(to right, #464d58 5%, #464d58 95%);
      box-shadow: 2px 2px 15px rgba(0, 0, 0, 0.5);
    }

    .btn_blue_steamui {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #c3e1f8;
      !important;

      background: transparent;
      text-shadow: 1px 1px 0px rgba(0, 0, 0, 0.3);
    }

    .btn_blue_steamui>span {
      border-radius: 2px;
      display: block;


      background: #75b022;
      background: -webkit-linear-gradient(top, #75b022 5%, #588a1b 95%);
      background: linear-gradient(to bottom, #75b022 5%, #588a1b 95%);
      background: linear-gradient(to right, #47bfff 5%, #1a44c2 60%);
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
      background-position: 25%;
      background-size: 330% 100%;
    }

    .btn_blue_steamui:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover {
      text-decoration: none !important;
      color: #fff;
      !important;

      background: transparent;
    }

    .btn_blue_steamui:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover>span {
      background: #8ed629;
      background: -webkit-linear-gradient(top, #8ed629 5%, #6aa621 95%);
      background: linear-gradient(to bottom, #8ed629 5%, #6aa621 95%);
      background: linear-gradient(to right, #47bfff 5%, #1a44c2 60%);
      box-shadow: 2px 2px 15px rgba(0, 0, 0, 0.5);
      background-position: 0%;
      background-size: 330% 100%;
    }


    /* This class must be applied to anything you want to use buttons in to enable hover states. */
    .btn_hover {}

    .inner_bevel {
      -moz-box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.75) inset, -2px -2px 5px rgba(150, 150, 150, 1) inset;
      -webkit-box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.75) inset, -2px -2px 5px rgba(150, 150, 150, 1) inset;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.75) inset, -2px -2px 5px rgba(150, 150, 150, 1) inset;
    }

    /* fix for mozilla <button> elements */
    button::-moz-focus-inner {
      padding: 0;
      border: none;
    }

    /* Borders */
    .btn_border_2px {
      border-radius: 4px;
      border: 2px solid #172030;
    }

    .btn_border_2px>span {
      border-radius: 3px;
    }

    .btnv6_border_2px {
      border-radius: 4px;
      border: 2px solid #17202f;
    }

    .btnv6_border_2px>span {
      border-radius: 3px;
    }

    /* Sizing */
    .btn_large>span,
    input.btn_large {
      padding: 0 15px;
      font-size: 16px;
      line-height: 40px;
    }

    .btn_medium_tall>span,
    input.btn_medium_tall {
      padding: 0 15px;
      font-size: 15px;
      line-height: 36px;
    }

    .btn_medium>span,
    input.btn_medium {
      padding: 0 15px;
      font-size: 15px;
      line-height: 30px;
    }

    .btn_medium .ico16 {
      margin: 7px 0;
      vertical-align: top;
    }

    .btn_medium_thin>span,
    input.btn_medium_thin {
      padding: 0 5px;
      font-size: 15px;
      line-height: 30px;
    }

    .btn_medium_wide>span,
    input.btn_medium_wide {
      padding: 0 24px;
      font-size: 15px;
      line-height: 30px;
    }

    .btn_small>span,
    input.btn_small {
      padding: 0 15px;
      font-size: 12px;
      line-height: 20px;
    }

    .btn_small_thin>span,
    input.btn_small_thin {
      padding: 0 5px;
      font-size: 12px;
      line-height: 20px;
    }

    .btn_small_tall>span,
    input.btn_small_tall {
      padding: 0 15px;
      font-size: 12px;
      line-height: 24px;
    }

    .btn_small_wide>span,
    input.btn_small_wide {
      padding: 0 24px;
      font-size: 12px;
      line-height: 20px;
    }

    .btn_tiny>span,
    input.btn_tiny {
      padding: 0 7px;
      font-size: 11px;
      line-height: 17px;
    }

    /* Misc effects */
    .btn_uppercase>span {
      text-transform: uppercase;
    }

    /* Icons */

    /* 18x18 */
    .ico18 {
      display: inline-block;
      width: 18px;
      height: 18px;
      margin: 0 0px;
      background: url(https://community.cloudflare.steamstatic.com/public/shared/images/buttons/icons_18.png?v=3);
      vertical-align: text-top;
    }


    .ico18.thumb_down {
      background-position: -18px 0px;
    }

    .ico_hover:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover .ico18.thumb_down {
      background-position: -90px 0px;
    }

    .btn_active .ico18.thumb_down,
    .active .ico18.thumb_down {
      background-position: -54px 0px;
    }

    .ico18.thumb_up {
      background-position: 0px 0px;
    }

    .ico_hover:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover .ico18.thumb_up {
      background-position: -72px 0px;
    }

    .btn_active .ico18.thumb_up,
    .active .ico18.thumb_up {
      background-position: -36px 0px;
    }

    .ico18.accepted_and_voted {
      background-position: 0px -18px;
    }



    /* 16x16 */
    .ico16 {
      display: inline-block;
      width: 16px;
      height: 16px;
      background: url(https://community.cloudflare.steamstatic.com/public/shared/images/buttons/icons_16.png?v=5);
      vertical-align: text-top;
    }


    .ico16.comment {
      background-position: 0px 0px;
    }

    .ico_hover:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover .ico16.comment {
      background-position: -16px 0px;
    }


    .ico16.thumb_down {
      background-position: -32px 0px;
    }

    .ico_hover:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover .ico16.thumb_down {
      background-position: -48px 0px;
    }

    .btn_active .ico16.thumb_down,
    .active .ico16.thumb_down {
      background-position: -64px 0px;
    }

    .ico16.thumb_up {
      background-position: -80px 0px;
    }

    .ico_hover:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover .ico16.thumb_up {
      background-position: -112px 0px;
    }

    .btn_active .ico16.thumb_up,
    .active .ico16.thumb_up {
      background-position: -96px 0px;
    }

    .ico16.thumb_downv6 {
      background-position: -64px -16px;
    }

    .ico_hover:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover .ico16.thumb_downv6 {
      background-position: -80px -16px;
    }

    .btn_active .ico16.thumb_downv6,
    .active .ico16.thumb_downv6 {
      background-position: -96px -16px;
    }

    .ico16.thumb_upv6 {
      background-position: -112px -16px;
    }

    .ico_hover:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover .ico16.thumb_upv6 {
      background-position: -144px -16px;
    }

    .btn_active .ico16.thumb_upv6,
    .active .ico16.thumb_upv6 {
      background-position: -128px -16px;
    }

    .ico16.arrow_up {
      background-position: 0px -16px;
    }

    .ico_hover:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover .ico16.arrow_up {
      background-position: -16px -16px;
    }


    .ico16.arrow_down {
      background-position: -48px -16px;
    }

    .ico_hover:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover .ico16.arrow_down {
      background-position: -32px -16px;
    }


    .ico16.report {
      background-position: -128px 0px;
    }

    .ico_hover:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover .ico16.report {
      background-position: -144px 0px;
    }

    .btn_active .ico16.report,
    .active .ico16.report {
      background-position: -160px 0px;
    }

    .ico16.reportv6 {
      background-position: -256px 0px;
    }

    .ico_hover:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover .ico16.reportv6 {
      background-position: -272px 0px;
    }

    .btn_active .ico16.reportv6,
    .active .ico16.reportv6 {
      background-position: -288px 0px;
    }

    .ico16.arrow_next {
      background-position: -176px 0px;
    }



    .ico16.checkbox {
      background-position: -192px 0px;
    }



    .ico16.bucketnew {
      background-position: -208px 0px;
    }



    .ico16.bucketqueue {
      background-position: -224px 0px;
    }



    .ico16.bucketrefresh {
      background-position: -240px 0px;
    }



    .ico16.bucketfollow {
      background-position: -176px -16px;
    }



    .ico16.bucketfavorite {
      background-position: -192px -16px;
    }



    .ico16.funny {
      background-position: -208px -16px;
    }

    .ico_hover:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover .ico16.funny {
      background-position: -224px -16px;
    }

    .btn_active .ico16.funny,
    .active .ico16.funny {
      background-position: -224px -16px;
    }

    .ico16.bluearrow_down {
      background-position: -304px 0px;
    }

    .ico_hover:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover .ico16.bluearrow_down {
      background-position: -304px -16px;
    }

    .btn_active .ico16.bluearrow_down,
    .active .ico16.bluearrow_down {
      background-position: -304px -16px;
    }

    /* Arrows are the only icons I've not fully replaced yet. If you need to use them, please convert to the new icon code */

    .btn_details_arrow {
      display: inline-block;
      width: 15px;
      height: 16px;
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/buttons/icon_double_arrows.png');
      vertical-align: middle;
    }

    .btn_details_arrow.up {
      background-position: 0px 0px;
    }

    .btn_details:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover .btn_details_arrow.up {
      background-position: -15px 0px;
    }

    .btn_details_arrow.down {
      background-position: 15px 0px;
    }

    .btn_details:not(.btn_disabled):not(:disabled):not(.btn_active):not(.active):hover .btn_details_arrow.down {
      background-position: 30px 0px;
    }

    .btn_disabled,
    button:disabled {
      opacity: 0.45;
      cursor: default;
    }

    .btn_disabled:hover,
    button:disabled:hover {
      text-decoration: none;
    }

    .packageTagsArrow {
      display: inline-block;
      width: 15px;
      height: 16px;
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/buttons/icon_double_arrows.png');
    }

    .packageTagsArrow.Expand {
      background-position: 18px 1px;
    }

    .packageTagsArrow.Collapse {
      background-position: 3px 1px;
    }

    :root {
      /* System greys */
      --gpSystemLightestGrey: #DCDEDF;
      --gpSystemLighterGrey: #B8BCBF;
      --gpSystemLightGrey: #8B929A;
      --gpSystemGrey: #67707B;
      --gpSystemDarkGrey: #3D4450;
      --gpSystemDarkerGrey: #23262E;
      --gpSystemDarkestGrey: #0E141B;

      /* Store blue greys */
      --gpStoreLightestGrey: #CCD8E3;
      --gpStoreLighterGrey: #A7BACC;
      --gpStoreLightGrey: #7C8EA3;
      --gpStoreGrey: #4e697d;
      --gpStoreDarkGrey: #2A475E;
      --gpStoreDarkerGrey: #1B2838;
      --gpStoreDarkestGrey: #000F18;

      /* Gradients */
      --gpGradient-StoreBackground: linear-gradient(180deg, var(--gpStoreDarkGrey) 0%, var(--gpStoreDarkerGrey) 80%);
      --gpGradient-LibraryBackground: radial-gradient(farthest-corner at 40px 40px, #3D4450 0%, #23262E 80%);

      /* Colours */
      --gpColor-Blue: #1A9FFF;
      --gpColor-BlueHi: #00BBFF;
      --gpColor-Green: #5ba32b;
      --gpColor-GreenHi: #59BF40;
      --gpColor-Orange: #E35E1C;
      --gpColor-Red: #D94126;
      --gpColor-RedHi: #EE563B;
      --gpColor-DustyBlue: #417a9b;
      --gpColor-LightBlue: #B3DFFF;
      --gpColor-Yellow: #FFC82C;
      --gpColor-ChalkyBlue: #66C0F4;

      /* Backgrounds */
      --gpBackground-LightSofter: #6998bb24;
      --gpBackground-LightSoft: #3b5a7280;
      --gpBackground-LightMedium: #678BA670;
      --gpBackground-LightHard: #93B8D480;
      --gpBackground-LightHarder: #aacce6a6;

      --gpBackground-DarkSofter: #0e141b33;
      --gpBackground-DarkSoft: #0e141b66;
      --gpBackground-DarkMedium: #0e141b99;
      --gpBackground-DarkHard: #0e141bcc;

      --gpBackground-Neutral-LightSofter: rgba(235, 246, 255, 0.10);
      --gpBackground-Neutral-LightSoft: rgba(235, 246, 255, 0.20);
      --gpBackground-Neutral-LightMedium: rgba(235, 246, 255, 0.30);
      --gpBackground-Neutral-LightHard: rgba(235, 246, 255, 0.40);
      --gpBackground-Neutral-LightHarder: rgba(235, 246, 255, 0.50);


      /* Corners */
      --gpCorner-Small: 1px;
      --gpCorner-Medium: 2px;
      --gpCorner-Large: 3px;

      /* Spacing */
      --gpSpace-Gutter: 24px;
      --gpSpace-Gap: 12px;

      /* Fixed widths */
      --gpNavWidth: 240px;
      --gpPaymentsNavWidth: 340px;
      --gpDselectWidth: 340px;
      --gpSidePanelWidth: 340px;
      --gpGiftingPanelWidth: 280px;
      --gpCommunityRightPanelWidth: 320px;
      --gpVerticalResponsivePadding-Small: calc((100vw - 854px) / 60);
      --gpVerticalResponsivePadding-Medium: calc((100vw - 854px) / 20);
      --gpVerticalResponsivePadding-Large: calc((100vw - 854px) / 12);

      /* Game capsule widths */
      --screen-width: 100vw;
      --gpWidth-6colcap: calc((var(--screen-width) - (5 * var(--gpSpace-Gap)) - (2 * var(--gpSpace-Gutter))) / 6);
      --gpWidth-5colcap: calc((var(--screen-width) - (4 * var(--gpSpace-Gap)) - (2 * var(--gpSpace-Gutter))) / 5);
      --gpWidth-4colcap: calc((var(--screen-width) - (3 * var(--gpSpace-Gap)) - (2 * var(--gpSpace-Gutter))) / 4);
      --gpWidth-3colcap: calc((var(--screen-width) - (2 * var(--gpSpace-Gap)) - (2 * var(--gpSpace-Gutter))) / 3);
      --gpWidth-2colcap: calc((var(--screen-width) - (1 * var(--gpSpace-Gap)) - (2 * var(--gpSpace-Gutter))) / 2);
      --gpWidth-1colcap: calc((var(--screen-width) - (2 * var(--gpSpace-Gutter))));

      /* Fixed heights */
      --gpStoreMenuHeight: 58px;

      /* Surfaces */
      --gpShadow-Small: 0px 2px 2px 0px #0000003D;
      --gpShadow-Medium: 0px 3px 6px 0px #0000003D;
      --gpShadow-Large: 0px 12px 16px 0px #0000003D;
      --gpShadow-XLarge: 0px 24px 32px 0px #0000003D;

      /* Type styles */
      --gpText-HeadingLarge: normal 700 26px/1.4 "Motiva Sans", Arial, Sans-serif;
      --gpText-HeadingMedium: normal 700 22px/1.4 "Motiva Sans", Arial, Sans-serif;
      --gpText-HeadingSmall: normal 700 18px/1.4 "Motiva Sans", Arial, Sans-serif;
      --gpText-BodyLarge: normal 400 16px/1.4 "Motiva Sans", Arial, Sans-serif;
      --gpText-BodyMedium: normal 400 14px/1.4 "Motiva Sans", Arial, Sans-serif;
      --gpText-BodySmall: normal 400 12px/1.4 "Motiva Sans", Arial, Sans-serif;
    }

    @media screen and (min-width: 1280px) {
      :root {
        --gpSpace-Gutter: calc(24px + 2vw);
      }
    }


    /* Avatars */
    .playerAvatar,
    .friend_block_holder .friend_block_avatar,
    .friend_activity .friend_block_avatar {
      width: 34px;
      height: 34px;
      position: relative;
      border-radius: 0;
      padding: 1px;

    }

    /* Offline State */
    .playerAvatar.offline,
    .friend_block_holder.friend_status_offline .friend_block_avatar,
    .friend_activity.friend_status_offline .friend_block_avatar,
    .appHubIconHolder.offline,
    .avatar_block_status_offline,
    .appHubIconHolder.ignored {

      background: -webkit-linear-gradient(top, rgba(106, 106, 106, 1) 5%, rgba(85, 85, 85, 1) 95%);
      background: linear-gradient(to bottom, rgba(106, 106, 106, 1) 5%, rgba(85, 85, 85, 1) 95%);
      /* IE <= 9 doesn't support rounded corners and gradient.  The gradient isn't too noticable so just disable the filter in IE9 */
      filter: none;
    }

    .playerAvatar.offline img,
    .friend_status_offline .friend_block_avatar img,
    .appHubIconHolder.offline img,
    .avatar_block_status_offline img {
      background: -webkit-linear-gradient(top, #515151 5%, #474747 95%);
      background: linear-gradient(to bottom, #515151 5%, #474747 95%);
    }

    /* Online State */
    .playerAvatar.online,
    .friend_block_holder.friend_status_online .friend_block_avatar,
    .friend_activity.friend_status_online .friend_block_avatar,
    .appHubIconHolder.online,
    .avatar_block_status_online {
      background-color: #57cbde;

      background: -webkit-linear-gradient(top, rgba(83, 164, 196, 1) 5%, rgba(69, 128, 151, 1) 95%);
      background: linear-gradient(to bottom, rgba(83, 164, 196, 1) 5%, rgba(69, 128, 151, 1) 95%);
      /* IE <= 9 doesn't support rounded corners and gradient.  The gradient isn't too noticable so just disable the filter in IE9 */
      filter: none;
    }

    .playerAvatar.online img,
    .friend_status_online .friend_block_avatar img,
    .appHubIconHolder.online img,
    .avatar_block_status_online img {
      background: -webkit-linear-gradient(top, #41778f 5%, #3d697b 95%);
      background: linear-gradient(to bottom, #41778f 5%, #3d697b 95%);
    }

    /* In-Game State */
    .playerAvatar.in-game,
    .friend_block_holder.friend_status_in-game .friend_block_avatar,
    .friend_activity.friend_status_in-game .friend_block_avatar,
    .appHubIconHolder.in-game,
    .avatar_block_status_in-game {
      background-color: #90ba3c;

      background: -webkit-linear-gradient(top, rgba(143, 185, 59, 1) 5%, rgba(110, 140, 49, 1) 95%);
      background: linear-gradient(to bottom, rgba(143, 185, 59, 1) 5%, rgba(110, 140, 49, 1) 95%);
      /* IE <= 9 doesn't support rounded corners and gradient.  The gradient isn't too noticable so just disable the filter in IE9 */
      filter: none;
    }

    .playerAvatar.in-game img,
    .friend_status_in-game .friend_block_avatar img,
    .appHubIconHolder.in-game img,
    .avatar_block_status_in-game img {
      background: -webkit-linear-gradient(top, #66812e 5%, #59702b 95%);
      background: linear-gradient(to bottom, #66812e 5%, #59702b 95%);
    }


    /* Golden State */
    .playerAvatar.golden,
    .friend_block_holder.friend_status_golden .friend_block_avatar,
    .friend_activity.friend_status_golden .friend_block_avatar,
    .appHubIconHolder.golden,
    .avatar_block_status_golden {
      background-color: #e4ca63;

      background: -webkit-linear-gradient(305deg, #d5bf6a 10%, #ffe2a9 40%, #ba995c 52%, #ba995c 61%, #d5bf6a 85%);
      background: linear-gradient(145deg, #d5bf6a 10%, #ffe2a9 40%, #ba995c 52%, #ba995c 61%, #d5bf6a 85%);
    }

    /*
.playerAvatar.golden img,
.friend_status_golden .friend_block_avatar img,
.appHubIconHolder.golden img,
.avatar_block_status_golden img {
	background-color: #e4ca63
	background: -webkit-linear-gradient( 305deg, #d5bf6a 10%,#ffe2a9 40%,#ba995c 52%,#ba995c 61%,#d5bf6a 85%);
	background: linear-gradient( 145deg, #d5bf6a 10%,#ffe2a9 40%,#ba995c 52%,#ba995c 61%,#d5bf6a 85%);
}
*/

    .playerAvatar.ignored {}

    .playerAvatar img,
    .friend_block_holder .friend_block_avatar img,
    .friend_activity .friend_block_avatar img {
      width: 32px;
      height: 32px;
      padding: 1px;
      border-radius: 0;
      border: none;
    }

    .playerAvatar .profile_avatar_frame {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 1;
      pointer-events: none;
    }

    .playerAvatar .profile_avatar_frame>img {
      transform: scale(1.23);
      width: 32px;
      height: 32px;
      background: none;
    }

    .playerAvatar.medium {
      width: 66px;
      height: 66px;
    }

    .playerAvatar.medium img {
      width: 64px;
      height: 64px;
    }

    .playerAvatar.medium .profile_avatar_frame>img {
      width: 64px;
      height: 64px;
      transform: scale(1.225);
    }


    .playerAvatar.full {
      width: 186px;
      height: 186px;
    }

    .playerAvatar.full img {
      width: 184px;
      height: 184px;
    }

    .playerAvatar.tiny {
      width: 24px;
      height: 24px;
    }

    .playerAvatar.tiny img {
      width: 22px;
      height: 22px;
    }

    .playerAvatar_friendindicator {
      position: absolute;
      left: 26px;
      top: 23px;
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/friendindicator_small.png');
      width: 20px;
      height: 20px;
      z-index: 2;

      cursor: pointer;
    }

    .persona,
    a.persona,
    .persona a,
    .friend_status_offline,
    .friend_status_offline div,
    .friend_status_offline a {
      color: #898989;
    }

    .persona.online,
    a.persona.online,
    .persona.online a,
    .friend_status_online,
    .friend_status_online div,
    .friend_status_online a {
      color: #57cbde;
    }

    .persona.in-game,
    a.persona.in-game,
    .persona.in-game a,
    .friend_status_in-game,
    .friend_status_in-game div,
    .friend_status_in-game a {
      color: #90ba3c;
    }

    .persona.golden,
    a.persona.golden,
    .persona.golden a,
    .friend_status_golden,
    .friend_status_golden div,
    .friend_status_golden a {
      color: #e4ca63;
    }

    .border_color_offline {
      border-color: #898989;
    }

    .border_color_online {
      border-color: #57cbde;
    }

    .border_color_in-game {
      border-color: #90ba3c;
    }

    .border_color_golden {
      border-color: #e4ca64;
    }

    .miniprofile_hover {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 5000;
      font-family: "Motiva Sans", sans-serif;
    }

    .miniprofile_hover_inner.shadow_content {
      margin: 11px;
    }

    .miniprofile_container {
      display: flex;
      flex-direction: column;

      position: relative;
      overflow: hidden;

      width: 328px;
      font-family: "Motiva Sans", Sans-serif;
      font-weight: normal;
      /* normal */

    }

    .miniprofile_playersection {
      position: relative;
      display: flex;
      flex-direction: row;

      z-index: 1;
      height: 62px;
      padding: 16px;
    }

    .miniprofile_playersection .playersection_avatar {
      width: 90px;
      height: 90px;
      background: none;
      border-bottom-width: 2px;
      border-bottom-style: solid;
    }

    .miniprofile_playersection .playersection_avatar img {
      width: 90px;
      height: 90px;
      box-sizing: border-box;
      background: none;
    }

    .miniprofile_playersection .playersection_avatar_frame {
      position: absolute;
      z-index: 1;
      width: 107px;
      height: 107px;
      top: 8px;
      left: 8px;
      pointer-events: none;
    }

    .miniprofile_playersection .playersection_avatar_frame>img {
      width: 100%;
      height: 100%;
      background: none;
    }

    .miniprofile_playersection .player_content {
      display: flex;
      flex-direction: column;
      justify-content: center;

      padding-left: 16px;

      text-shadow: 1px 1px 4px #000;
    }

    .miniprofile_playersection .player_content .persona {
      font-size: 20px;
    }

    .miniprofile_playersection .player_content .persona,
    .miniprofile_playersection .player_content .secondaryname {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      width: 200px;
    }

    .miniprofile_playersection .player_content .friend_status_offline {
      font-size: 10px;
    }

    .miniprofile_gamesection {
      display: flex;
      flex-direction: row;
      position: relative;

      min-height: 64px;
    }

    .miniprofile_gamesection .game_logo {
      width: 90px;
      height: 34px;
      top: 18px;
      left: 16px;
      position: absolute;
    }

    .miniprofile_gamesection .miniprofile_game_details {
      display: flex;
      flex-direction: column;

      padding: 8px 8px 8px 122px;
      font-size: 14px;

      align-self: center;
    }

    .miniprofile_gamesection .miniprofile_game_details .game_state,
    .miniprofile_gamesection .miniprofile_game_details .rich_presence {
      font-size: 12px;
      color: rgb(98, 129, 59);
    }

    .miniprofile_gamesection .miniprofile_game_details .miniprofile_game_name {
      color: #90ba3c;
    }

    .miniprofile_detailssection {
      display: flex;
      flex-direction: column;

      padding: 16px 16px 8px 16px;
    }

    .miniprofile_detailssection.not_in_game {
      padding-top: 24px;
    }

    .miniprofile_featuredcontainer {
      display: flex;
      flex-direction: row;

      height: 34px;
      padding-left: 16px;
      margin-bottom: 8px;
    }

    .miniprofile_featuredcontainer .badge_icon {
      width: 34px;
      height: 34px;
      position: relative;
    }

    .miniprofile_featuredcontainer .description {
      margin-left: 12px;
      margin-top: auto;
      margin-bottom: auto;
      font-size: 14px;
      overflow: hidden;
      white-space: nowrap;

      font-family: "Motiva Sans", Arial, Helvetica, sans-serif;
    }

    .miniprofile_featuredcontainer .description .name {
      overflow: hidden;
      text-overflow: ellipsis;
      color: #b1b1b1;
    }

    .miniprofile_featuredcontainer .description .xp {
      font-size: 12px;
      color: #6b6a6a;
    }

    .miniprofile_featuredcontainer .friendPlayerLevel {
      margin-top: 0;
    }

    .miniprofile_playtimesection {
      border: none;
      min-height: 57px;
      box-sizing: border-box;
      padding: 2px;
      display: flex;
      flex-direction: row;
      align-items: center;
      background: radial-gradient(circle at top left, rgba(81, 148, 255, 0.5) 0%, rgba(0, 39, 112, 0.075) 100%), linear-gradient(to bottom, rgba(58, 148, 184, 0.637) 0%, rgba(106, 201, 239, 0.15) 1px, rgba(19, 100, 133, 0.1) 25%, rgba(106, 201, 239, 0.0) 50%);
    }

    .miniprofile_playtimesection .gamelogo {
      width: 120px;
      height: 55px;
      margin-right: 12px;
      box-shadow: 0 0 2px black;
    }

    .miniprofile_playtimesection .playtimecontent {
      color: rgba(181, 255, 255, 0.5);
      font-size: 13px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .miniprofile_playtimesection .playtimecontent div:nth-child(2) {
      margin-top: 4px;
    }

    .miniprofile_playtimesection .playtimecontent .timeplayed {
      color: rgb(181, 255, 255);
    }

    .miniprofile_playtimesection.forcurrentgame {
      padding: 0px;
      align-items: initial;
      min-height: 0px;
      background: transparent;
    }

    .miniprofile_background {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      overflow: hidden;
      z-index: -3;
      background: radial-gradient(ellipse farthest-corner at 20% 30%, rgb(76, 80, 91) 0%, rgb(52, 55, 63) 50%, rgb(40, 44, 50) 100%);

    }

    .miniprofile_backgroundblur {
      width: 380px;
      height: 380px;
      filter: blur(10px) saturate(2);
      position: absolute;
      left: -60px;
      top: -60px;
      opacity: 0.4;
      -webkit-mask: radial-gradient(ellipse farthest-corner at 150px 150px, rgba(0, 0, 0, 1) 0%, rgba(0, 0, 0, 0.6) 20%, rgba(0, 0, 0, 0.3) 34%, rgba(0, 0, 0, 0) 64%);
      mask: radial-gradient(ellipse farthest-corner at 150px 150px, rgba(0, 0, 0, 1) 0%, rgba(0, 0, 0, 0.6) 20%, rgba(0, 0, 0, 0.3) 34%, rgba(0, 0, 0, 0) 64%);
      mix-blend-mode: screen;
    }

    .miniprofile_backdropblur {
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
    }

    .miniprofile_backdrop {
      background: linear-gradient(to bottom, rgba(24, 26, 30, .7) 5%, rgba(24, 26, 30, .4) 95%);
    }

    .miniprofile_content {
      width: 302px;
      border-radius: 3px;

      color: #828282;
      font-size: 14px;

      position: relative;
    }

    .miniprofile_nameplatecontainer {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;

      z-index: -1;
    }

    .miniprofile_nameplate {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: top right;
    }

    /*
 * GENERIC POPUP
 */

    .pulldown {
      padding-left: 5px;
      padding-right: 18px;
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/popups/btn_arrow_down_padded.png');
      background-position: right center;
      background-repeat: no-repeat;

      cursor: pointer;
    }

    body.v6 .pulldown {
      margin-right: 5px;
    }

    span.popup_menu_pulldown_indicator {
      display: inline-block;
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/popups/btn_arrow_down.png');
      vertical-align: middle;
      width: 9px;
      height: 4px;
    }

    #admin_drop {
      border-radius: 2px;
      border: none;
      padding: 1px;
      display: inline-block;
      cursor: pointer;
      text-decoration: none !important;
      color: #67c1f5 !important;
      background: rgba(103, 193, 245, 0.2)
    }

    #admin_drop:hover {
      text-decoration: none !important;
      color: #fff !important;
      background: #417a9b;
      background: -webkit-linear-gradient(150deg, #417a9b 5%, #67c1f5 95%);
      background: linear-gradient(-60deg, #417a9b 5%, #67c1f5 95%);
    }

    #admin_drop span {
      padding: 0 22px 0 15px;
      margin-right: 8px;
      font-size: 15px;
      line-height: 30px;
    }


    .popup_block_new {
      z-index: 200;
      position: absolute;
      box-shadow: 0 0 12px #000000;
    }

    .popup_block_new.popup_block_hidden_until_visible {
      opacity: 1.0;
      transition: opacity 200ms;
    }

    .popup_block_new.popup_block_hidden_until_visible:not(.visible) {
      opacity: 0;
      pointer-events: none;
    }

    @media screen and (max-width: 910px) {

      html.responsive .popup_block_new.responsive_slidedown {
        position: static;
        box-shadow: none;
      }

    }

    html.responsive.rn_mobile_app .popup_block_new.responsive_slidedown {
      position: static;
      box-shadow: none;
    }

    .popup_block_new .popup_body {
      border: 1px solid #3D4450;

      position: relative;

      background-color: #3D4450;

    }

    body.v6 .popup_block_new .popup_body.popup_menu {
      padding: 0px 0px;
    }

    .popup_menu a.popup_menu_item {
      display: block;
    }

    .popup_menu .popup_menu_item {
      padding: 5px 12px;
      color: #dcdedf;
      text-transform: none;
      font-family: Motiva Sans, Arial, Helvectica, Verdana, sans-serif;
      font-size: 12px;
      font-weight: normal;
      line-height: normal;
      text-align: left;
      cursor: pointer;
    }


    #genre_flyout .popup_menu .popup_menu_item {
      font-size: 13px;
      padding: 5px 14px;
    }

    @media screen and (max-width: 910px) {
      html.responsive .popup_menu .popup_menu_item {
        font-size: 14px;
        line-height: 18px;
      }

    }

    html.responsive.touch .popup_menu .popup_menu_item {
      font-size: 14px;
      line-height: 18px;
    }

    .popup_menu a.popup_menu_item {
      text-decoration: none;
    }

    .popup_menu span.popup_menu_item {
      cursor: default;
    }

    .popup_menu .popup_menu_item:hover,
    .popup_menu .popup_menu_item.focus {
      color: #171d25;
      text-decoration: none;
      background: #dcdedf;
    }


    .popup_menu_subheader {
      color: #9e9995;
      font-size: 11px;
      padding: 2px 12px 3px 12px;
      cursor: default;
    }

    .popup_menu_item,
    .popup_menu_subheader {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .popup_menu_hint {
      float: right;
      margin-left: 8px;
    }

    .popup_menu_subarea {
      color: #9e9995;
      font-size: 11px;
      background-color: #3b3938;
      margin: 8px 12px;
      padding: 8px;
      text-align: center;
    }

    .popup_menu_subarea_inner {
      margin: 0 auto;
      width: 138px;
    }


    .popup_menu .hr {
      height: 1px;
      background-color: #82807c;
      margin: 10px 12px 0 12px;
    }



    .friendPlayerLevel {
      display: inline-block;
      font-size: 16px;
      border-radius: 16px;
      border: solid white 2px;
      height: 28px;
      width: 28px;
      line-height: 28px;
      text-align: center;

      cursor: default;
    }


    .friendPlayerLevel .friendPlayerLevelNum {
      color: #e5e5e5;
    }

    .friendPlayerLevel.lvl_0 {
      border-color: #9b9b9b;
    }

    .friendPlayerLevel.lvl_10 {
      border-color: #c02942;
    }

    .friendPlayerLevel.lvl_20 {
      border-color: #d95b43;
    }

    .friendPlayerLevel.lvl_30 {
      border-color: #fecc23;
    }

    .friendPlayerLevel.lvl_40 {
      border-color: #467a3c;
    }

    .friendPlayerLevel.lvl_50 {
      border-color: #4e8ddb;
    }

    .friendPlayerLevel.lvl_60 {
      border-color: #7652c9;
    }

    .friendPlayerLevel.lvl_70 {
      border-color: #c252c9;
    }

    .friendPlayerLevel.lvl_80 {
      border-color: #542437;
    }

    .friendPlayerLevel.lvl_90 {
      border-color: #997c52;
    }

    .friendPlayerLevel.lvl_100,
    .friendPlayerLevel.lvl_200,
    .friendPlayerLevel.lvl_300,
    .friendPlayerLevel.lvl_400,
    .friendPlayerLevel.lvl_500,
    .friendPlayerLevel.lvl_600,
    .friendPlayerLevel.lvl_700,
    .friendPlayerLevel.lvl_800,
    .friendPlayerLevel.lvl_900,
    .friendPlayerLevel.lvl_1000,
    .friendPlayerLevel.lvl_1100,
    .friendPlayerLevel.lvl_1200,
    .friendPlayerLevel.lvl_1300,
    .friendPlayerLevel.lvl_1400,
    .friendPlayerLevel.lvl_1500,
    .friendPlayerLevel.lvl_1600,
    .friendPlayerLevel.lvl_1700,
    .friendPlayerLevel.lvl_1800,
    .friendPlayerLevel.lvl_1900,
    .friendPlayerLevel.lvl_2000,
    .friendPlayerLevel.lvl_2100,
    .friendPlayerLevel.lvl_2200,
    .friendPlayerLevel.lvl_2300,
    .friendPlayerLevel.lvl_2400,
    .friendPlayerLevel.lvl_2500,
    .friendPlayerLevel.lvl_2600,
    .friendPlayerLevel.lvl_2700,
    .friendPlayerLevel.lvl_2800,
    .friendPlayerLevel.lvl_2900,
    .friendPlayerLevel.lvl_3000,
    .friendPlayerLevel.lvl_3100,
    .friendPlayerLevel.lvl_3200,
    .friendPlayerLevel.lvl_3300,
    .friendPlayerLevel.lvl_3400,
    .friendPlayerLevel.lvl_3500,
    .friendPlayerLevel.lvl_3600,
    .friendPlayerLevel.lvl_3700,
    .friendPlayerLevel.lvl_3800,
    .friendPlayerLevel.lvl_3900,
    .friendPlayerLevel.lvl_4000,
    .friendPlayerLevel.lvl_4100,
    .friendPlayerLevel.lvl_4200,
    .friendPlayerLevel.lvl_4300,
    .friendPlayerLevel.lvl_4400,
    .friendPlayerLevel.lvl_4500,
    .friendPlayerLevel.lvl_4600,
    .friendPlayerLevel.lvl_4700,
    .friendPlayerLevel.lvl_4800,
    .friendPlayerLevel.lvl_4900,
    .friendPlayerLevel.lvl_5000,
    .friendPlayerLevel.lvl_5100,
    .friendPlayerLevel.lvl_5200 {
      border: none;
      border-radius: 0;
      background-repeat: no-repeat;
      background-position: 0 0;

      font-size: 14px;

      height: 32px;
      width: 32px;
      line-height: 32px;
      text-shadow: 1px 1px #1a1a1a;
    }

    .friendPlayerLevel.lvl_100 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_hexagons.png');
    }

    .friendPlayerLevel.lvl_200 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_shields.png');
    }

    .friendPlayerLevel.lvl_300 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_books.png');
    }

    .friendPlayerLevel.lvl_400 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_chevrons.png');
    }

    .friendPlayerLevel.lvl_500 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_circle2.png');
    }

    .friendPlayerLevel.lvl_600 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_angle.png');
    }

    .friendPlayerLevel.lvl_700 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_flag.png');
    }

    .friendPlayerLevel.lvl_800 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_wings.png');
    }

    .friendPlayerLevel.lvl_900 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_arrows.png');
    }

    .friendPlayerLevel.lvl_1000 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_crystals.png');
    }

    .friendPlayerLevel.lvl_1100 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_space.png');
    }

    .friendPlayerLevel.lvl_1200 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_waterelement.png');
    }

    .friendPlayerLevel.lvl_1300 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_fireelement.png');
    }

    .friendPlayerLevel.lvl_1400 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_earthelement.png');
    }

    .friendPlayerLevel.lvl_1500 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_airelement_1-2.png');
    }

    .friendPlayerLevel.lvl_1600 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_airelement_3-4.png');
    }

    .friendPlayerLevel.lvl_1700 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_airelement_5-6.png');
    }

    .friendPlayerLevel.lvl_1800 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_airelement_7-8.png');
    }

    .friendPlayerLevel.lvl_1900 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_airelement_9-10.png');
    }

    .friendPlayerLevel.lvl_2000 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_geo_1-2.png?v=2');
    }

    .friendPlayerLevel.lvl_2100 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_geo_3-4.png?v=2');
    }

    .friendPlayerLevel.lvl_2200 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_geo_5-6.png?v=2');
    }

    .friendPlayerLevel.lvl_2300 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_geo_7-8.png?v=2');
    }

    .friendPlayerLevel.lvl_2400 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_geo_9-10.png?v=2');
    }

    .friendPlayerLevel.lvl_2500 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_mandala_1-2.png?v=2');
    }

    .friendPlayerLevel.lvl_2600 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_mandala_3-4.png?v=2');
    }

    .friendPlayerLevel.lvl_2700 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_mandala_5-6.png?v=2');
    }

    .friendPlayerLevel.lvl_2800 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_mandala_7-8.png?v=2');
    }

    .friendPlayerLevel.lvl_2900 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_mandala_9-10.png?v=2');
    }

    .friendPlayerLevel.lvl_3000 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_spiro_1-2.png?v=2');
    }

    .friendPlayerLevel.lvl_3100 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_spiro_3-4.png?v=2');
    }

    .friendPlayerLevel.lvl_3200 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_spiro_5-6.png?v=2');
    }

    .friendPlayerLevel.lvl_3300 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_spiro_7-8.png?v=2');
    }

    .friendPlayerLevel.lvl_3400 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_spiro_9-10.png?v=2');
    }

    .friendPlayerLevel.lvl_3500 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_patterns_1-2.png?v=2');
    }

    .friendPlayerLevel.lvl_3600 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_patterns_3-4.png?v=2');
    }

    .friendPlayerLevel.lvl_3700 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_patterns_5-6.png?v=2');
    }

    .friendPlayerLevel.lvl_3800 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_patterns_7-8.png?v=2');
    }

    .friendPlayerLevel.lvl_3900 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_patterns_9-10.png?v=2');
    }

    .friendPlayerLevel.lvl_4000 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_shapes_1.png?v=2');
    }

    .friendPlayerLevel.lvl_4100 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_shapes_2.png?v=2');
    }

    .friendPlayerLevel.lvl_4200 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_shapes_3.png?v=2');
    }

    .friendPlayerLevel.lvl_4300 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_shapes_4.png?v=2');
    }

    .friendPlayerLevel.lvl_4400 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_shapes_5.png?v=2');
    }

    .friendPlayerLevel.lvl_4500 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_grunge_1.png?v=2');
    }

    .friendPlayerLevel.lvl_4600 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_grunge_2.png?v=2');
    }

    .friendPlayerLevel.lvl_4700 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_grunge_3.png?v=2');
    }

    .friendPlayerLevel.lvl_4800 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_grunge_4.png?v=2');
    }

    .friendPlayerLevel.lvl_4900 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_grunge_5.png?v=2');
    }

    .friendPlayerLevel.lvl_5000 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_halftone_1.png?v=2');
    }

    .friendPlayerLevel.lvl_5100 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_halftone_2.png?v=2');
    }

    .friendPlayerLevel.lvl_5200 {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/community/levels_halftone_3.png?v=2');
    }

    .friendPlayerLevel.lvl_plus_10 {
      background-position: 0 -32px;
    }

    .friendPlayerLevel.lvl_plus_20 {
      background-position: 0 -64px;
    }

    .friendPlayerLevel.lvl_plus_30 {
      background-position: 0 -96px;
    }

    .friendPlayerLevel.lvl_plus_40 {
      background-position: 0 -128px;
    }

    .friendPlayerLevel.lvl_plus_50 {
      background-position: 0 -160px;
    }

    .friendPlayerLevel.lvl_plus_60 {
      background-position: 0 -192px;
    }

    .friendPlayerLevel.lvl_plus_70 {
      background-position: 0 -224px;
    }

    .friendPlayerLevel.lvl_plus_80 {
      background-position: 0 -256px;
    }

    .friendPlayerLevel.lvl_plus_90 {
      background-position: 0 -288px;
    }



    .newmodal {
      font-family: "Motiva Sans", Sans-serif;
      font-weight: normal;
      /* normal */

      position: absolute;

      max-width: 900px;
      /* our page width */
      min-width: 500px;

      background: radial-gradient(circle at top left, rgba(74, 81, 92, 0.4) 0%, rgba(75, 81, 92, 0) 60%), #25282e;
    }

    .newmodal_background {
      position: fixed;
      z-index: 900;
      background: #000000;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
    }

    .newmodal_header .title_text {
      padding: 32px 32px 0px 32px;
      display: block;
    }

    .newmodal_header .subtitle_text {
      font-family: "Motiva Sans", Sans-serif;
      font-weight: 200;
      /* thin */

      font-size: 19px;
      text-transform: none;
      line-height: 20px;
      letter-spacing: 0px;
      padding: 0px 32px 0px 32px;
      display: block;
    }

    .modal_top_bar {
      width: 100%;
      height: 1px;
      background: linear-gradient(to right, #00ccff, #3366ff);
    }

    .newmodal_header {
      padding: 0px 0px 0px 0px;
      text-align: left;
      font-size: 22px;
      font-weight: 700;
      color: #ffffff;
      letter-spacing: unset;
      text-transform: unset;
      flex-shrink: 0;
    }

    @media screen and (max-width: 910px) {
      html.responsive .newmodal_header .title_text {
        padding: 32px 15px 0px 15px;
      }

      html.responsive .newmodal_content {

        max-width: 646px;
        min-width: 280px;
      }
    }

    .newmodal_close {
      background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjVBREZBRDlBNzdCNzExRTI5ODAzRUE3MDU0Mzk5MjM5IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjVBREZBRDlCNzdCNzExRTI5ODAzRUE3MDU0Mzk5MjM5Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NUFERkFEOTg3N0I3MTFFMjk4MDNFQTcwNTQzOTkyMzkiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NUFERkFEOTk3N0I3MTFFMjk4MDNFQTcwNTQzOTkyMzkiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4iulRzAAABPElEQVR42mI8cuQIAyWABUqbAXEylH0fiDtwqI8FYhsoewEQH4cZcBaI64DYG8p/AVWADDyAeD4QMwPxJiA+BRJkgkr+BeJoIL4D5U8DYi0kzepAvAKq+TJU7V9kA0DgIxD7Q2lOIF4NpfmBeAuUfg3EPkD8BaaJCc2Z14A4EcoGuWAC1NkqQPwLqvkRsgYmLAG1HoiboOw0IA6EshNh/iZkAAjUA/FBJP5KIF6GTSEuAwygUQsDflAxogwQAuJ10AAExcpNKHsjEIsSMoAZGl2K0EALBeIIKFsOKSpxGtACxK5Qdi4QX4DiAqiYExB34TIgBIgrkAJtFpLcdKgYCBQBcRRMghGamUBxfhKIeaB+NkFOLFAAkjsDTZXfgdgK5DpYXvBGiqYpWDQzQMVAYZKDlDcuMFKanQECDAAqw0LA+GRiqAAAAABJRU5ErkJggg== );
      background-repeat: no-repeat;
      background-position: center right;
      cursor: pointer;
      float: right;
      margin-top: 9px;
      margin-right: 9px;
      height: 16px;
      width: 16px;

      opacity: 0.7;
    }

    /* for labelling the close button with text, used on market */
    .newmodal_close.with_label {
      padding-right: 24px;
      width: auto;
      color: #ffffff;
      line-height: 16px;
      font-size: 12px;
    }

    .newmodal_close:hover {
      opacity: 1;
    }

    #ShareModal {
      width: 290px;
    }

    .newmodal_content_border {
      padding: 0 1px 1px 1px;
      display: flex;
    }

    .newmodal_content {

      width: 100%;
      overflow: auto;
      word-wrap: break-word;

      padding: 32px;

      font-size: 14px;
      color: #acb2b8;

      position: relative;
    }

    .newmodal_content_innerbg {
      background-color: rgba(59, 63, 72, 0.5);
      padding: 8px;

      color: #8f8f8f;
    }

    .newmodal_buttons {
      text-align: right;
    }

    .newmodal_buttons .btn_medium {
      margin-left: 12px;
      margin-top: 12px;
    }

    .newmodal_prompt_description {
      font-size: 14px;
      margin-bottom: 8px;
    }

    .newmodal_prompt_input {}

    .newmodal_prompt_input input[type=text] {
      width: 100%;
    }

    .newmodal_prompt_textarea {
      height: 396px;
    }

    .newmodal_prompt_with_textarea {
      display: inline-block;
      padding-top: 1px;
      padding-bottom: 1px;
      width: 500px;
    }

    .gray_bevel input,
    .gray_bevel textarea {
      border: none;
      outline: none;
      background-color: rgba(0, 0, 0, 0.2);
      border: 1px solid #000;
      box-shadow: 1px 1px 0 0 rgba(91, 132, 181, 0.2);
      font-size: 13px;
      color: #BFBFBF;
    }

    .gray_bevel input:-moz-read-only,
    .gray_bevel textarea:-moz-read-only {
      background: transparent;
      border: transparent;
      box-shadow: none;
      color: #919191;
    }

    .gray_bevel input:read-only,
    .gray_bevel textarea:read-only {
      background: transparent;
      border: transparent;
      box-shadow: none;
      color: #919191;
    }

    .gray_bevel.fullwidth {
      display: block;
    }

    .gray_bevel.fullwidth.for_text_input input,
    .gray_bevel.fullwidth textarea {
      /* narrow a bit to account for padding in the text area */
      width: calc(100% - 8px);
    }

    input.gray_bevel {
      height: 20px;
    }

    textarea.gray_bevel,
    .gray_bevel textarea {
      resize: none;
    }

    select.gray_bevel {
      background-color: #565658;
      border-radius: 3px;
      border: 1px solid #262627;
      box-shadow: 1px 1px 0px #39393a;
      color: #BFBFBF;

      margin-bottom: 6px;
      outline: none;

      padding: 0px;
      line-height: 27px;
      height: 27px;
      font-size: 14px;
    }

    select.blueish {
      background-color: rgba(255, 255, 255, 0.7);
      color: #000;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 3px;
      box-shadow: 1px 1px 0px #000;
    }

    .waiting_dialog_container {
      line-height: 32px;
    }

    .waiting_dialog_centered {
      display: flex;
      justify-content: center;
    }

    .waiting_dialog_throbber {
      width: 32px;
      height: 32px;
      background: url('https://community.cloudflare.steamstatic.com/public/images/login/throbber.gif') center center no-repeat;
      margin-right: 5px;
      float: left;
    }

    .emoticon_hover {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1200;
    }

    .emoticon_hover_content {
      padding: 6px 10px 6px 6px;
      background-color: #3b3938;
      border: 1px solid #797979;

      margin: 12px;
      box-shadow: 0 0 12px #000000;
      white-space: nowrap;
    }

    .emoticon_hover_content.client {
      margin: 0;
      box-shadow: none;
      display: inline-block;
    }

    .emoticon_hover_content_inner {
      position: relative;
      min-height: 54px;
      padding-left: 62px;
      font-size: 13px;
    }

    .emoticon_hover_content_inner img.emoticon_large {
      position: absolute;
      left: 0;
      top: 0;
    }

    .emoticon_hover_title {
      padding-top: 8px;
      color: #898989;
    }

    .emoticon_hover_desc {
      color: #686868;
    }

    .emoticon_hover_arrow {
      width: 13px;
      height: 26px;
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/popups/hover_arrow_both.gif');
      background-repeat: no-repeat;

      position: absolute;
      top: 26px;
    }

    .emoticon_hover_arrow.left {
      background-position: left top;

      left: 0;
    }

    .emoticon_hover_arrow.right {
      background-position: right top;

      right: 0;
    }



    /*
 * HEADER
 */

    /* apply 16px padding to the sides of all the page-wide divs to prevent content
	from touching the sides on small resolutions */
    div#footer,
    div#global_header,
    div#store_header,
    div#main,
    div.page_area {
      padding-left: 16px;
      padding-right: 16px;
    }

    div.page_content {
      width: 940px;
      margin: 0px auto;
    }


    div#global_header {
      background: #171d25;
      background-position: center top;
      min-width: 940px;

      font-family: "Motiva Sans", Sans-serif;
      font-weight: normal;
      /* normal */

      font-size: 14px;
    }

    .partner_events div#global_header {
      position: relative;
      z-index: 151;
    }

    div#global_header .content {
      background: #171d25;
      position: relative;
      width: 940px;
      height: 104px;
      margin: 0px auto;

      z-index: 402;
    }

    div#global_actions {
      position: absolute;
      right: 0px;
      top: 6px;

      height: 21px;
      line-height: 21px;

      color: #b8b6b4;
      font-size: 11px;

      z-index: 401;
    }

    div#global_actions a.global_action_link {
      padding: 0 4px;
    }

    div#global_actions a.global_action_link,
    div.admin_actions a.global_action_link {
      color: #b8b6b4;
    }

    div#global_actions .global_action_link:hover,
    div.admin_actions .global_action_link:hover {
      text-decoration: none;
      color: #ffffff;
    }

    div.admin_actions {
      position: absolute;
      right: 0;
      bottom: 4px;
      text-align: right;
      color: #b8b6b4;
      font-size: 11px
    }

    div#global_actions #global_action_menu {
      line-height: 24px;
      vertical-align: top;
      display: inline-block;
    }

    #global_action_menu>* {
      vertical-align: top;
    }

    div#global_actions .user_avatar {
      display: inline-block;
      margin-left: 3px;
    }

    div#global_header div.logo {
      float: left;
      padding-top: 30px;
      margin-right: 40px;
      width: 176px;
      height: 44px;
    }

    div#global_header .menuitem {
      display: block;
      position: relative;

      padding-top: 45px;
      padding-left: 7px;
      padding-right: 7px;
      padding-bottom: 7px;
      line-height: 16px;

      float: left;
      font-size: 14px;
      color: #dcdedf;
      text-transform: uppercase;
      font-size: 16px;
      font-family: "Motiva Sans", "Twemoji", "Noto Sans", Helvetica, sans-serif;
      font-weight: 500;
      text-transform: uppercase;
    }

    div#global_header .menuitem.active,
    div#global_header .menuitem:hover {
      color: #ffffff;
      text-decoration: none;
    }

    div#global_header .menuitem.active {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/header/globalheader_highlight.png');
      background-repeat: repeat-x;
    }

    div#global_header .activebg {
      display: none;
    }

    #header_wallet_balance {
      display: inline-block;
    }

    #header_wallet_ctn {
      text-align: right;
      padding-right: 15px;
      line-height: normal;
    }

    #account_pulldown {
      display: inline-block;
      padding-left: 4px;
      line-height: 25px;
    }

    #account_language_pulldown {
      display: block;
    }

    #language_pulldown.focus,
    #account_pulldown.focus {
      color: #ffffff;
    }

    #account_dropdown>.popup_body {
      width: fit-content;
      max-width: 250px;
    }

    #account_dropdown>.popup_body.popup_menu .popup_menu_item {
      padding: 8px 18px;
      font-size: 13px;
    }

    #account_dropdown>.popup_body.popup_menu .popup_menu_item .account_name {
      color: #4cb4ff;
    }


    .header_installsteam_btn {
      display: inline-block;
      position: relative;
      height: 21px;
      line-height: 24px;
      margin-right: 3px;
    }

    .header_installsteam_btn_green .header_installsteam_btn_leftcap,
    .header_installsteam_btn_green .header_installsteam_btn_rightcap,
    .header_installsteam_btn_green .header_installsteam_btn_content {
      background-color: #5c7e10;

      &:hover {
        background-color: #6c9018;
        transition-property: background;
        transition-duration: 250ms;
        cursor: pointer;
      }
    }

    .header_installsteam_btn_gray .header_installsteam_btn_leftcap,
    .header_installsteam_btn_gray .header_installsteam_btn_rightcap,
    .header_installsteam_btn_gray .header_installsteam_btn_content {
      background-color: rgba(103, 112, 123, 0.2);

      &:hover {
        background-color: #3D4450;
        transition-property: background;
        transition-duration: 250ms;
        cursor: pointer;
      }
    }

    .header_installsteam_btn_content {
      display: inline-block;
      padding-left: 35px;
      padding-right: 9px;
      background-position: 10px 5px;

      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/header/btn_header_installsteam_download.png?v=1');
      background-repeat: no-repeat;
      text-decoration: none;
      color: #e5e4dc;
      font-weight: normal;
    }

    .header_installsteam_btn_content:hover {
      text-decoration: none;
      color: #ffffff;
    }

    .global_header_toggle_button {
      display: inline-block;
      line-height: 24px;
      margin: 0 3px 0 8px;
      cursor: pointer;
      /* background-color: #262625; */
    }

    .global_header_toggle_button:hover,
    .global_header_toggle_button.focus {
      /* background-color: #575451; */
    }

    /* make sure we override any global a styles on the site */
    .global_header_toggle_button,
    a.global_header_toggle_button,
    a.global_header_toggle_button:hover {
      color: #ffffff;
      font-weight: normal;
      font-size: 12px;
      font-family: "Motiva Sans", Sans-serif;
      font-weight: bold;
      /* bold */

    }

    .global_header_toggle_button.green,
    .global_header_toggle_button.has_notifications {
      background-color: #5c7e10;
    }

    .global_header_toggle_button.green:hover,
    .global_header_toggle_button.green.focus,
    .global_header_toggle_button.has_notifications:hover,
    .global_header_toggle_button.has_notifications.focus {
      background-color: #7ea64b;
    }

    .global_header_toggle_button.red {
      background-color: #9a3130;
    }

    .global_header_toggle_button.red:hover,
    .global_header_toggle_button.red.focus {
      background-color: #d75a5a;
    }

    .global_header_toggle_button.yellow {
      background-color: #bb9d2f;
    }

    .global_header_toggle_button.yellow:hover,
    .global_header_toggle_button.yellow.focus {
      background-color: #c1a643;
    }

    .global_header_account_alert {
      font-weight: bold;
      padding: 0 54px;
    }

    a.global_header_account_alert:hover {
      color: #ffffff;
    }


    div#global_header .menuitem_new {
      position: absolute;
      top: 27px;
      font-size: 11px;
      color: #85b0df
    }

    div#global_header .submenuitem {
      text-decoration: none;
      text-transform: none;
      font-size: 12px;
      color: #dcdedf;
      padding-right: 15px;
      padding-left: 15px;
    }

    div#global_header .submenuitem span.new {
      color: white;
      background: #c37f00;
      padding: 1px 3px;
      font-size: 10px;
      border-radius: 2px;
      text-shadow: none;
      text-transform: uppercase;
    }

    div#global_header .submenuitem.active,
    div#global_header .submenuitem:hover {
      text-decoration: none;
      background: #dcdedf;
      color: #171a21;
    }

    div#global_header .submenuitem.moderator {
      color: #ca5029;
    }

    div#global_header .submenuitem.active.moderator,
    div#global_header .submenuitem.moderator:hover {
      color: #ca5029;
    }

    .community_sub_nav {
      position: absolute;
      left: 7px;
      top: 65px;
      width: 650px;
      font-size: 14px;
    }

    .menuitem.username {
      max-width: 250px;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
    }

    #global_header .supernav_container {
      position: absolute;
      left: 200px
    }

    .supernav_content {
      background: #3D4450;
      box-shadow: 3px 3px 5px -3px #000;
      text-align: left;
      z-index: 500;
    }

    .supernav_content a.submenuitem {
      display: block;
      padding: 6px 0;
      text-transform: uppercase;
      font-size: 12px;
    }

    .supernav_content a.submenuitem:hover {
      color: #4897cf;
      text-decoration: none;
    }

    .supernav {
      &::after {
        content: "";
        display: block;
        width: 100%;
        height: 2.5px;
        margin-top: 2px;
      }
    }

    div#global_header .menuitem.supernav_active {
      color: #1a9fff;

      &::after {
        content: "";
        display: block;
        width: 100%;
        height: 2.5px;
        background: #1a9fff;
        border-radius: 3px;
        animation: slide 0.1s;
        margin-top: 2px;
      }
    }

    @keyframes slide {
      from {
        transform: scaleX(0);
      }

      to {
        transform: scaleX(1);
      }
    }

    /* -------------- paging controls -------------*/
    .pagebtn,
    a.pagebtn {
      display: inline-block;
      line-height: 24px;
      background-color: rgba(103, 193, 245, 0.2);
      border: 1px transparent;
      border-radius: 3px;
      cursor: pointer;
      padding: 0px 16px;
      color: #66c0f4;
    }

    .pagebtn:not(.disabled):hover,
    a.pagebtn:not(.disabled):hover {
      background-color: #66c0f4;
      border-color: #66c0f4;
      color: #fff;
      text-decoration: none;
    }

    .pagebtn.disabled,
    .pagebtn.disabled:hover,
    a.pagebtn.disabled,
    a.pagebtn.disabled:hover {
      cursor: default;
      opacity: 0.2;
    }

    a.pagelink:hover {
      text-decoration: underline;
      color: #ffffff;
    }


    /* steam inbox */


    /* notification box */

    #header_notification_area {
      display: inline-block;
    }

    .header_notification_btn {
      padding: 0 8px;
    }

    .header_notification_btn.has_notifications .header_notification_envelope {
      margin-left: 4px;
    }

    .header_notification_btn.no_notifications .notification_count {
      display: none;
    }

    .header_notification_btn.has_notifications {}

    #header_notification_dropdown .popup_menu {
      padding: 2px;
    }

    #header_notification_dropdown .popup_menu_item {
      line-height: 36px;
      padding: 0px 8px 0px 8px;
      background-repeat: no-repeat;
      background-position: left center;
      color: #bfbfbf;
    }

    #header_notification_dropdown .popup_menu_item:hover {
      color: #ffffff;
      background-color: #373d44;
    }

    #header_notification_dropdown .popup_menu_item.active_inbox_item {
      color: #70ba24;
    }

    .header_notification_btn.header_notification_bell {
      display: block;
      width: 46px;
      height: 24px;
      padding: 0px;
      margin: 0px;
      background: url('https://community.cloudflare.steamstatic.com/public/shared/images/header/notification_bell.png') no-repeat #3D4450;
      background-position: center;
      background-size: 14px;
    }

    .notification_ctn.hide_when_empty:not(.active_inbox_item) {
      display: none;
    }

    .header_notification_dropdown_seperator {
      height: 1px;
      background-color: #262a31;
    }

    .notification_icon {
      display: inline-block;
      width: 16px;
      height: 16px;
      vertical-align: middle;
      background-repeat: no-repeat;
      background-position: center;
      margin-right: 16px;
      position: relative;
      top: -2px;

      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/header/inbox_icons_sprite.png');
    }

    .header_notification_comments .notification_icon {
      background-position: 0 0;
    }

    .header_notification_items .notification_icon {
      background-position: 0 -16px;
    }

    .header_notification_invites .notification_icon {
      background-position: 0 -32px;
    }

    .header_notification_gifts .notification_icon {
      background-position: 0 -48px;
    }

    .header_notification_offlinemessages .notification_icon {
      background-position: 0 -64px;
    }

    /* these are shown conditionally so not a big deal that they aren't in the sprite */
    .header_notification_tradeoffers .notification_icon {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/header/inbox_tradeoffers.png');
    }

    .header_notification_asyncgame .notification_icon {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/header/inbox_async_game.png');
    }

    .header_notification_asyncgameinvite .notification_icon {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/header/inbox_async_game_invite.png');
    }

    /* re-uses comment icon */
    .header_notification_moderatormessage .notification_icon,
    .header_notification_helprequestreply .notification_icon {
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/header/inbox_moderator_message.png');
    }

    .header_parental_btn {
      padding: 0 12px;
      width: 23px;
      background-position: center;
      background-repeat: no-repeat;
      cursor: pointer;
    }

    .header_parental_btn.passwordless {
      cursor: default;
    }

    .header_parental_btn.partial {
      background-color: rgba(103, 112, 123, 0.2);
      background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAUCAYAAACAl21KAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDkuMS1jMDAxIDc5LmE4ZDQ3NTM0OSwgMjAyMy8wMy8yMy0xMzowNTo0NSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDI0LjcgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjk2ODQ3OEQ2NEQyQzExRUU4QzBFQkY2RTE2Q0U4QUVBIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjk2ODQ3OEQ3NEQyQzExRUU4QzBFQkY2RTE2Q0U4QUVBIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTY4NDc4RDQ0RDJDMTFFRThDMEVCRjZFMTZDRThBRUEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTY4NDc4RDU0RDJDMTFFRThDMEVCRjZFMTZDRThBRUEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6qk34BAAABnklEQVR42tyUTStEYRTH586MFHlLMaHU2CiUNGJFYyFZSXaUhWahyIKNT2BjQXZsp4mUJAs1NVEWKC/5AsyCyB4L7vid6dzpNHNjMyu3fj1v53+e55zzPNfJ5XKBcnzBQJm+sjkK28H61k6Mph+ycLqymHgvWq+iGYUmuGD9vuREGLXRjEMEBiHus/EI9IHYTqBp8QutFUIg2XchimHIbCT9TrMeVE2Jo0f4MuMXjv7tDbT/atIhtk8ljjAUo124k/zAkU9oB3CuNkk0z96C89s9Ipxemk3dcAnhzZ9VQySVGIYO2EP0QLsBQ2qyDTHsorSTmooz7N4KoWnFZqALqjXp8lWaTe1cPXTDNNqIzZHcnVrtS6w9GOTDgWu4hXnmHFnTqgXU4YANrc7LmTpq1AJcSTgmfEfFrjlpg3XkmtNI9VI4cRGO0Z/S9X3m0swl6c9Cs9V6oVWYE6XlaSBYoH8Ic5CAE+aW9dlk1LagzZcfg7ju8AHH0A5S6pqiS/upSc5q5cJ6cTO+90gf75rZ1V7gVYSXxRrn//7YfgQYAHJdjG35zInfAAAAAElFTkSuQmCC');
    }

    .header_parental_btn.partial.password:hover {
      background-color: #3D4450;
    }

    .header_parental_btn.full {
      background-color: rgb(92, 126, 16);
      background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAUCAYAAACAl21KAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDkuMS1jMDAxIDc5LmE4ZDQ3NTM0OSwgMjAyMy8wMy8yMy0xMzowNTo0NSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDI0LjcgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjQ5QzIxNDIwNEU2RTExRUVBQ0Y0QjY1NzI2NTE3RUVEIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjQ5QzIxNDIxNEU2RTExRUVBQ0Y0QjY1NzI2NTE3RUVEIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NDlDMjE0MUU0RTZFMTFFRUFDRjRCNjU3MjY1MTdFRUQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NDlDMjE0MUY0RTZFMTFFRUFDRjRCNjU3MjY1MTdFRUQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4ACHYVAAABY0lEQVR42tzUzytEURTA8XkTCwshWRIWFhMjDalJiZQSC+UfkKzsLC3ewspCjZpsJSspOyW7mdSwMGSyUooslKWi/Ly+t87lzJ3Hamzc+kz3nHPf6b1735vAGBOrxojHqjT+rNE09rGC5oj1jchgD1NlFbtHIokH8z2yquasqfoTelxN31Ea9SoeQa2K7XxMxXVyTcWjFfCi4iO8qtjO8yp+xokLAu/4JzCDS2Tx6O1RAxbRii3kovYoSgqHov+3tTroxg7uMCC5Y7W5Z5KzDW+wjYTfaBC36qIhyZ+rXElywyp3jV7daNOUjwziSKOIU5nbPV311m7YHjWyVW3eprbbg5CTTKm8zXV4azvtj2v0oQpFzOIdk/K22/kuDjAnzfpk/Zs+tYK61VHJLZnKEUptXOXstV/v0TKSuMcCunDxw/eZwBXW0YISQvdoYcSLl5NH8j/yJvkC5nUh+L9/bJ8CDACBt6K3eAQ3DQAAAABJRU5ErkJggg==');
    }

    .header_parental_btn.full.password:hover {
      background-color: rgb(126, 166, 75);
    }

    /* dynamic links */
    .dynamiclink_box {
      position: relative;
      font-family: Helvetica, Arial, sans-serif;
      background: -webkit-linear-gradient(30deg, rgba(87, 92, 104, 0.3) 5%, rgba(255, 255, 255, 0.05) 95%);
      background: linear-gradient(60deg, rgba(87, 92, 104, 0.3) 5%, rgba(255, 255, 255, 0.05) 95%);
      border-radius: 6px;
      padding: 8px;
      margin: 10px 0px 10px 0px;

      cursor: pointer;
      overflow: hidden;
    }

    a.dynamiclink_box {
      display: block;
      text-decoration: none !important;
    }

    .dynamiclink_box.noPopup {
      cursor: default;
    }

    .dynamiclink_box.newspost .dynamiclink_description {
      padding-top: 10px;
    }

    .dynamiclink_box:hover {
      border-color: #97C0E3;
    }

    img.dynamiclink_preview {
      float: left;
      margin-right: 14px;
      max-height: 88px;
      max-width: 75%;
    }

    .dynamiclink_content {
      font-family: "Motiva Sans", Sans-serif;
      font-weight: 300;
      /* light */

      color: rgb(192, 192, 192);
      text-shadow: 0 0 16px rgb(0, 0, 0);
      font-size: 13px;
      line-height: normal;
      text-align: left;
      display: flow-root;
    }

    .dynamiclink_name {
      font-size: 15px;
      color: #aad8ec;
      font-family: "Motiva Sans", Sans-serif;
      font-weight: 300;
      /* light */

      border-bottom: 1px dotted rgba(109, 207, 246, .6);
      padding-bottom: 0px;
      display: inline-block;
      margin-bottom: 6px;
    }

    .dynamiclink_name .dynamiclink_type {
      color: #c6d4df;
    }

    .dynamiclink_type {
      color: #c6d4df;
    }

    .dynamiclink_type a {
      color: #c6d4df;
      text-decoration: underline;
    }

    .dynamiclink_type a:hover {
      color: #ffffff;
      text-decoration: underline;
    }

    .dynamiclink_author {
      min-height: 16px;
      font-size: 12px;
      color: #95a6b2;
      margin-bottom: 4px;
    }

    .dynamiclink_author a {
      color: #c6d4df;
      text-decoration: underline;
    }

    .dynamiclink_author a:hover {
      color: #ffffff;
      text-decoration: underline;
    }

    .dynamiclink_author span {
      color: #809fb7;
    }

    .dynamiclink_author img.app_icon {
      vertical-align: top;
      padding-right: 5px;
      height: 16px;
    }

    .dynamiclink_url {
      margin-top: 8px;
    }

    .dynamiclink_url a {
      color: #ffffff;
      text-decoration: none;
    }

    .dynamiclink_url a:hover {
      color: #7bb7e3;
      text-decoration: underline;
    }

    .dynamiclink_url a,
    .dynamiclink_authorname {
      color: #ffffff;
    }

    .dynamiclink_app {
      min-height: 16px;
      font-size: 12px;
      color: #95a6b2;
      margin-bottom: 4px;
    }

    .dynamiclink_app a {
      color: #c6d4df;
    }

    .dynamiclink_app a:hover {
      color: #ffffff;
      text-decoration: underline;
    }

    .dynamiclink_app span {
      color: #809fb7;
    }

    .dynamiclink_app img.app_icon {
      vertical-align: top;
      padding-right: 5px;
      height: 16px;
    }

    .dynamiclink_youtubeviewvideoembedded {
      position: relative;
      padding-bottom: 56.25%;
      /* 16:9 */
      padding-top: 25px;
      height: 0;
    }

    .dynamiclink_sketchfabmodelembedded {
      position: relative;
      padding-bottom: 56.25%;
      /* 16:9 */
      padding-top: 25px;
      height: 0;
    }

    .dynamiclink_youtubeviewvideoembedded iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .dynamiclink_youtubeviews {
      padding-top: 4px;
      padding-bottom: 4px;
      color: #bfbfbf;
    }

    .dynamiclink_sketchfabmodelembedded {
      position: relative;
      padding-bottom: 56.25%;
      /* 16:9 */
      padding-top: 25px;
      height: 0;
    }

    .dynamiclink_sketchfabmodelembedded iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    img.dynamiclink_sketchfab_play_overlay_image {
      position: absolute;
      left: 83px;
      margin-left: -25px;
      top: 50%;
      margin-top: -25px;
      width: 50px;
      height: 50px;
    }

    .dynamiclink_pointsshopitem {}

    .dynamiclink_pointsshopitem .dynamiclink_itemtype {
      padding-bottom: 2px;
    }

    /* blur capsule images for games with adult content if the user has opted out of seeing them*/
    .app_has_adult_content {
      overflow: hidden;
    }

    .app_has_adult_content img.game_capsule {
      filter: blur(30px);
    }

    /* ugc with adult content */
    .ugc.has_adult_content {
      overflow: hidden;
    }

    .ugc.has_adult_content img,
    .ugc.has_adult_content div.imgWallItem {
      filter: blur(30px);
    }

    .ugc.banned.has_adult_content img,
    .ugc.banned.has_adult_content.profile_media_item {
      box-shadow: inset 0px 0px 1px 1px #ff0000;
    }

    .ugc.has_adult_content.internet_explorer {
      background-color: black;
    }

    .ugc.has_adult_content.internet_explorer img {
      opacity: 0;
      filter: none;
    }

    .ugc.has_adult_content.internet_explorer div.imgWallItem {
      filter: none;
      opacity: 0.05;
    }

    .ugc.has_adult_content .workshopItemDetails,
    .ugc.has_adult_content .myguide_showcase_item {
      opacity: 0.25;
    }

    .ugc.has_adult_content.ugc_show_warning_image::after {
      content: "";
      background: url(https://community.cloudflare.steamstatic.com/public/shared/images/ico/icon_content_warning.png ) center center no-repeat;
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
    }

    .ugc.has_adult_content.dynamiclink_box::after {
      width: 88px;
    }

    .ugc .ugc_warning {
      display: none;
    }

    .ugc.has_adult_content .ugc_warning {
      display: block;
      position: absolute;
      width: 100%;
      top: 0;
      left: 0;
      font-size: 0.75em;
      vertical-align: top;
      text-align: center;
      color: #ffffff;
      background-color: rgba(0, 0, 0, 0.25);
      padding-top: 10px;
      padding-bottom: 10px;
    }

    .ugc.has_adult_content .ugc_warning:hover {
      color: #ffffff;
    }

    .ugc.has_adult_content .ugc_warning.large {
      font-size: 1.25em;
      top: 12%;
    }

    .ugc.has_adult_content .ugc_warning .ugc_inline_option {
      display: inline-block;
      text-decoration: underline;
    }

    .ugc.has_adult_content .ugc_warning .ugc_inline_option:hover {
      color: #66C0F4;
    }

    .ugc.has_adult_content .ugc_warning .ugc_warning_image {
      background: url(https://community.cloudflare.steamstatic.com/public/shared/images/ico/icon_content_warning.png ) center center no-repeat;
      width: 100%;
      height: 36px;
      pointer-events: none;
    }

    /* ugc_options defines the per-ugc preferences dropdown */
    .ugc_options {
      display: block;
      position: absolute;

      top: 0px;
      right: -5px;
      cursor: pointer;
      opacity: 0;
      padding: 5px 5px 0 0;
      transition: opacity 0.2s, right 0.2s;
      z-index: 5;
    }

    .ugc_options>div {
      width: 15px;
      height: 15px;

      background-color: rgba(54, 97, 125, 1);
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/v6/icon_expand.png');
      background-position: 4px 4px;
      border-radius: 3px;
      background-repeat: no-repeat;
      box-shadow: 0 0 3px #000;
    }

    .ugc_options:hover>div {
      background-color: #67c1f5;
      color: #fff;
      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/v6/icon_expand_white.png');
    }

    *:hover>.ugc_options,
    .ugc_hover.ugc_options {
      opacity: 1;
      right: 0px;
    }

    .ugc_options_tooltip {
      background: -webkit-linear-gradient(top, #e3eaef 5%, #c7d5e0 95%);
      background: linear-gradient(to bottom, #e3eaef 5%, #c7d5e0 95%);
      padding: 2px 8px;
      color: #fff;
      border-radius: 3px;
      box-shadow: 0 0 3px #000;
    }

    .ugc_options_tooltip>.option {
      margin: 5px 0;
      display: block;
      cursor: pointer;
      background-color: rgba(0, 0, 0, 0.1);
      border-radius: 2px;
      padding: 4px 8px;
      line-height: normal;
      font-size: 11px;
      color: #407898;
    }

    .ugc_options_tooltip>.option:hover {
      color: #ffffff;
      background-color: #67c1f5;
    }

    .jsTooltip {
      background-color: #c2c2c2;
      padding: 5px;
      border-radius: 2px;
      box-shadow: 0 0 3px #000;
      max-width: 225px;
      color: #3d3d3f;
      font-size: 11px;
      text-align: left;
    }

    .Tooltip_mark {
      font-size: 11px;
    }

    /* early access tag on reviews*/
    .early_access_review {
      background-color: #4d6c8b;
      border: 1px solid #779abc;
      text-transform: uppercase;
      font-family: arial;
      font-size: 11px;
      color: #9ac7f3;
      padding: 1px 4px 0px 4px;
      margin-bottom: 10px;
      margin-right: 4px;
      display: inline-block;
      cursor: default;
      line-height: 13px;
    }

    /* pre release tag on reviews*/
    .pre_release_review {
      background-color: #8b734d;
      border: 1px solid #bca177;
      text-transform: uppercase;
      font-family: arial;
      font-size: 11px;
      color: #dabb8a;
      padding: 1px 4px 0px 4px;
      margin-bottom: 10px;
      display: inline-block;
      cursor: default;
      line-height: 13px;
    }

    /* shared bbcode styles */

    span.bb_spoiler {
      color: #000000;
      background-color: #000000;

      padding: 0px 8px;
    }

    span.bb_spoiler:hover {
      color: #ffffff;
    }

    span.bb_spoiler>span {
      visibility: hidden;
    }

    span.bb_spoiler:hover>span {
      visibility: visible;
    }

    blockquote.bb_blockquote,
    .bb_wysiwyg blockquote {
      border: 1px solid #56707f;
      border-radius: 3px;
      padding: 12px;
      margin: 8px;

      font-size: 92%;
      display: table;
      word-break: break-word;
    }

    .forumtopic_answer .answer_quote blockquote.bb_blockquote,
    .bb_wysiwyg blockquote {
      border: 1px solid #457592;
    }

    blockquote.bb_blockquote.with_author {}

    div.bb_quoteauthor {
      font-size: 92%;
      font-style: italic;
    }

    div.bb_h1,
    .bb_wysiwyg h1 {
      font-size: 20px;
      line-height: 23px;
      color: #5aa9d6;
      font-weight: normal;
      margin-bottom: 10px;
      clear: both;
    }

    div.bb_h2,
    .bb_wysiwyg h2 {
      color: #5aa9d6;
      margin-bottom: 6px;
      margin-top: 8px;
      font-size: 18px;
      line-height: 21px;
      font-weight: 400;
      clear: both;
    }

    div.bb_h3,
    .bb_wysiwyg h3 {
      color: #5aa9d6;
      margin-bottom: 6px;
      margin-top: 8px;
      font-size: 16px;
      line-height: 19px;
      font-weight: 300;
      clear: both;
    }

    .ModernBBStyles .DialogBodyText .tagexample {
      color: #cfd2d3;
      font-size: 14px;
    }

    .ModernBBStyles div.bb_h1 {
      font-size: 32px;
      line-height: 33px;
      font-weight: 500;
      color: #ffffff;
    }

    .ModernBBStyles div.bb_h2 {
      font-size: 26px;
      line-height: 29px;
      font-weight: 400;
      color: #ffffff;
    }

    .ModernBBStyles div.bb_h3 {
      font-size: 19px;
      line-height: 22px;
      font-weight: 300;
      color: #ffffff;
    }

    .ModernBBStyles a.bb_link {
      color: #80bcd2;
    }


    span.bb_strike {
      text-decoration: line-through;
    }

    div.bb_pullquote {
      font-size: 18px;
      font-weight: 600;
    }

    span.bb_link_host {
      font-size: 10px;
      color: #7e8391;
      padding: 4px;
      top: -1px;
    }

    div.bb_code,
    .bb_wysiwyg pre {
      border: 1px solid #535354;
      border-radius: 3px;
      padding: 12px;
      margin: 8px;

      font-size: 11px;
      font-family: Consolas, monospace;
      white-space: pre;
      white-space: pre-wrap;
      overflow-x: auto;
    }

    span.bb_removedlink {
      color: #56707f;
      font-weight: normal;
      font-size: 80%;
    }

    div.bb_table {
      display: table;
      font-size: 12px;
    }

    div.bb_table div.bb_table_th {
      display: table-cell;
      font-weight: bold;
      border: 1px solid #4d4d4d;
      padding: 4px;
    }

    div.bb_table div.bb_table_th img.sharedFilePreviewImage {
      margin: 0px;
    }

    div.bb_table div.bb_table_tr {
      display: table-row;
    }

    div.bb_table div.bb_table_td {
      display: table-cell;
      vertical-align: middle;
      border: 1px solid #4d4d4d;
      padding: 4px;
    }

    div.bb_table div.bb_table_td img.sharedFilePreviewImage {
      margin: 0px;
    }

    video.bb_video {
      width: 100%;
    }

    .bb_ul>li {
      list-style-position: outside;
    }

    /* V6 */

    body.v6 .store_nav .popup_block_new .popup_body,
    body.v6 #footer_nav .popup_block_new .popup_body {
      border: none;
      position: relative;
      background: #417A9B;
    }

    body.v6 .store_nav .popup_menu_subheader,
    body.v6 #footer_nav .popup_menu_subheader {
      color: #13242e;
    }

    body.v6 .store_nav .popup_menu .hr,
    body.v6 #footer_nav .popup_menu .hr {
      background-color: #33627d;
      margin: 5px 0px 5px 0px;
    }

    /*
 * DYNAMIC STORE - ownership styling
 */

    .ds_flag {
      position: absolute;
      left: 0;
      top: 14px;
      font-size: 10px;
      color: #111111;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.9);

      height: 18px;
      line-height: 19px;
      padding: 0 0 0 18px;
      white-space: nowrap;
      z-index: 5;
    }

    .store_main_capsule .ds_flag {
      top: 42px;
    }

    .broadcast_capsule .ds_flag {
      top: 28px;
    }

    .ds_flag.ds_owned_flag {
      background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUNDNzBFNTUyMUM0MTFFNDk1REVFODRBNUU5RjA2MUYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUNDNzBFNTYyMUM0MTFFNDk1REVFODRBNUU5RjA2MUYiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5Q0M3MEU1MzIxQzQxMUU0OTVERUU4NEE1RTlGMDYxRiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5Q0M3MEU1NDIxQzQxMUU0OTVERUU4NEE1RTlGMDYxRiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pv3vUKAAAAAlSURBVHjaYvz//z8DsYARpFhISAivjnfv3jGSp3jUGeQ4AyDAADZHNe2nyOBrAAAAAElFTkSuQmCC') no-repeat 4px 4px #4F95BD;
    }

    .ds_flag.ds_wishlist_flag {
      background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QTM3OEVDNTUyMUM0MTFFNDgxN0ZEN0MzNjYzNzcxOTYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QTM3OEVDNTYyMUM0MTFFNDgxN0ZEN0MzNjYzNzcxOTYiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpBMzc4RUM1MzIxQzQxMUU0ODE3RkQ3QzM2NjM3NzE5NiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBMzc4RUM1NDIxQzQxMUU0ODE3RkQ3QzM2NjM3NzE5NiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Ps9jzFQAAACPSURBVHjaYvz//z+DkJDQdQYGhpsMCMAKxMZAHPXu3bt9cFGQYkFBwQ0gGoaBfAEgzgfibUDsBxNnYsAOfgKxJBBvAeIZMEEWZBVA52xA5gOdUAEUc8NQDBTkBEoGMOAByCYLAjUsRzM5AKtioMQzIEW0ydjcHIBTMSE3M0Ij5RKQfQ6HGiOgIXogBkCAAQDGVT+0v+n6EQAAAABJRU5ErkJggg==') no-repeat 4px 4px #d3deea;
    }

    .ds_flag.ds_incart_flag {
      background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAABi8KSDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QTc2NkExNDUyMUM0MTFFNDlBMDZDN0ZDMTM1QUM0QzYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QTc2NkExNDYyMUM0MTFFNDlBMDZDN0ZDMTM1QUM0QzYiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpBNzY2QTE0MzIxQzQxMUU0OUEwNkM3RkMxMzVBQzRDNiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBNzY2QTE0NDIxQzQxMUU0OUEwNkM3RkMxMzVBQzRDNiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pmidn20AAADOSURBVHjajM+9DgFBEMDx9dUJuYtESaHRKEhoVHqPoeJFdBLvoFNpJER0RENEobhCRCkXXxXF+Y/MyTYSk/wys5O5vdmI4zgDY0wVfVzN73hFgiAwruu2ORQxRRMjHWhgpnU3rsUKZWysLFHQOoFTOCyNGvJwNUtktC5hG5WO7/sv0hkLeJzngnqv+Yn1Z2cJ9u6RKvIQ3PTmJB5IoxW3XrvUfY9W76J5yB88e3iCOsbYaS+GTviRPZzFHSluOehq8nt5V07O353/ibcAAwA8yD/9PofkFwAAAABJRU5ErkJggg==') no-repeat 4px 4px #A3CF06;
    }

    .ds_flag.ds_ignored_flag {
      background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAAEV95QVAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6N0NBQzI5M0RBQkU4MTFFODkwMjRCQUUxMEY4RjAzOTkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6N0NBQzI5M0VBQkU4MTFFODkwMjRCQUUxMEY4RjAzOTkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo3Q0FDMjkzQkFCRTgxMUU4OTAyNEJBRTEwRjhGMDM5OSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo3Q0FDMjkzQ0FCRTgxMUU4OTAyNEJBRTEwRjhGMDM5OSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PhYgdgsAAAC0SURBVHjaYmBAA1MAAghEbAQzAQIIxloAxDwAAQTiRAHx9v///zMwARmOQPwSJAriPAHiDBAHIIBgypBBPUgLCGxHk+AASQAEEDOUA5IMgxp3GawNTXUUI5DgBuKpUIHfQCwGNgdN5XaYR2ASYKMAAgzZh/VoujigYiA5BmTnohvNgKYJHBwsQMYvIAbRS2CBhQS+QEPnF3II1eMxGSQXBTKZEdn/QByLZAobEC8G4mUwNwMAaHAvah1OMXkAAAAASUVORK5CYII=') no-repeat 4px 4px #bfbfbf;
    }

    .ds_flag.ds_excluded_by_preferences_flag {
      left: 0;
      right: 0;
      background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAKCAYAAAEV95QVAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OEQ4MTk4RThBQkU4MTFFOEE4QzlBQ0YwQzQ0RThBMUEiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OEQ4MTk4RTlBQkU4MTFFOEE4QzlBQ0YwQzQ0RThBMUEiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4RDgxOThFNkFCRTgxMUU4QThDOUFDRjBDNDRFOEExQSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4RDgxOThFN0FCRTgxMUU4QThDOUFDRjBDNDRFOEExQSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PkmScEMAAADKSURBVHjaYmBAA1MAAghEbAQzAQIIxvoPYgAEEAhFAfH2////M7AAGcuAWA4mUw/EHCAZgACCKTOCSsSAJGES26ECFVBDwToAAogZqhIkGQbETEB8mRFq5l0gXgI1TgNmWQWSmzaCVHIA8XcgrgTiR0AcC/MIB5LzGAACDNmH9UiSDFB2Pcz3yM7lgDr5P9RemN1RULntMMUbkUyDKYJpggcmSDHIfyuh1oG89RiIGaH4MVSsHqoGLIgc+iCf/YLy2YB4MTQiwG4GAMb1Ppm6hYCeAAAAAElFTkSuQmCC') no-repeat 4px 4px #bfbfbf;
    }

    .ds_collapse_flag.ds_flagged .ds_flag {
      overflow: hidden;
      max-width: 0;
      transition: all 0.5s;
      -webkit-transition: all 0.5s;
    }

    .ds_collapse_flag.ds_collapse_flag_tiny.ds_flagged .ds_flag {
      padding-left: 4px;
    }

    .ds_collapse_flag.ds_flagged:hover .ds_flag {
      max-width: 120px;
    }

    .ds_collapse_flag.ds_flagged:hover .ds_flag.ds_excluded_by_preferences_flag {
      max-width: none;
      padding-right: 4px;
    }

    .ds_collapse_flag_tiny.ds_flagged:hover .ds_flag {
      padding-left: 18px;
    }

    .ds_flagged.ds_excluded_by_preferences {}

    /* Scrollbar CSS. Move this to somewhere common before checking in thankx */

    .v_scrollbar {
      background-color: rgba(0, 0, 0, 0.2);
      border-radius: 2px;
    }

    .v_scrollbar_target div.animating {
      transition: left 0.3s, top 0.3s;
    }

    .v_scrollbar>.handle {
      background: #3d6c8d;
      /* Old browsers */
      background: -moz-linear-gradient(-45deg, #3d6c8d 0%, #2e5470 100%);
      /* FF3.6+ */
      background: -webkit-gradient(linear, left top, right bottom, color-stop(0%, #3d6c8d), color-stop(100%, #2e5470));
      /* Chrome,Safari4+ */
      background: -webkit-linear-gradient(-45deg, #3d6c8d 0%, #2e5470 100%);
      /* Chrome10+,Safari5.1+ */
      background: -o-linear-gradient(-45deg, #3d6c8d 0%, #2e5470 100%);
      /* Opera 11.10+ */
      background: -ms-linear-gradient(-45deg, #3d6c8d 0%, #2e5470 100%);
      /* IE10+ */
      background: linear-gradient(135deg, #3d6c8d 0%, #2e5470 100%);
      /* W3C */
      filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#3d6c8d', endColorstr='#2e5470', GradientType=1);
      /* IE6-9 fallback on horizontal gradient */
      border-radius: 2px;
    }

    .v_scrollbar.horizontal {
      height: 14px;
    }

    .v_scrollbar.vertical {
      width: 14px;
    }

    .v_scrollbar.vertical>.handle {

      height: 24px;
      width: 14px;
    }

    .v_scrollbar.horizontal>.handle {

      height: 14px;
      width: 24px;
    }


    .LoadingWrapper {
      position: relative;
      margin: auto auto;
      vertical-align: middle;
    }

    .LoadingWrapper .LoadingThrobber {
      margin: 0px auto 40px auto;
      width: 62px;
      height: 62px;
    }

    .LoadingWrapper .LoadingText {
      color: #60acde;
      font-size: 22px;
      text-align: center;
    }

    @keyframes loading_throbber_bar {
      0% {
        transform: scale(1.0, 0.6);
        background-color: #67c1f5;
      }

      30% {
        transform: scale(1.0, 1.0);
        background-color: #67c1f5;
      }

      55% {
        transform: scale(1.0, 0.6);
        background-color: #67c1f5;
      }

      100% {
        transform: scale(1.0, 0.6);
        background-color: #67c1f5;
      }
    }


    @-webkit-keyframes loading_throbber_bar {
      0% {
        -webkit-transform: scale(1.0, 0.7);
        background-color: #67c1f5;
      }

      30% {
        -webkit-transform: scale(1.0, 1.0);
        background-color: #67c1f5;
      }

      55% {
        -webkit-transform: scale(1.0, 0.7);
        background-color: #67c1f5;
      }

      100% {
        -webkit-transform: scale(1.0, 0.7);
        background-color: #67c1f5;
      }
    }

    .LoadingWrapper .LoadingThrobber .Bar {
      -webkit-animation: test 2s infinite;
      float: left;
      margin-right: 6px;
      width: 12px;
      height: 68px;
      background-color: #67c1f5;

      animation: loading_throbber_bar 1s ease-in-out infinite;
      -webkit-animation: loading_throbber_bar 1s ease-in-out infinite;
    }

    .LoadingWrapper .LoadingThrobber .Bar1 {}

    .LoadingWrapper .LoadingThrobber .Bar2 {
      animation-delay: 0.16s;
      -webkit-animation-delay: 0.16s;
    }

    .LoadingWrapper .LoadingThrobber .Bar3 {
      animation-delay: 0.32s;
      -webkit-animation-delay: 0.32s;
    }

    .content_descriptors_examples_desc {
      font-size: 18px;
      padding-bottom: 20px;
    }

    .content_descriptors_example_app {
      padding-bottom: 20px;
      display: flex;
      align-items: center;
    }

    .content_descriptors_example_app .app_logo {
      width: 120px;
      height: 45px;
    }

    .content_descriptors_example_app .app_name {
      margin-left: 20px;
    }

    .shared_game_rating {
      color: #c6d4df;
      font-size: 12px;
    }

    .shared_game_rating .game_rating_agency {
      margin-top: 8px;
    }

    .shared_game_rating .game_rating_required_age {
      font-family: "Motiva Sans", Sans-serif;
      font-weight: normal;
      /* normal */

      text-transform: uppercase;
      margin-bottom: 5px;
      font-size: 14px;
      color: white;
    }

    .shared_game_rating .game_rating_title {
      font-family: "Motiva Sans", Sans-serif;
      font-weight: normal;
      /* normal */

      margin-bottom: 5px;
      font-size: 14px;
      color: white;
    }

    .shared_game_rating .game_rating_title .game_rating_banned {
      color: red;
    }

    .shared_game_rating .game_rating_details {
      display: flex;
    }

    .shared_game_rating .game_rating_icon {
      margin-right: 10px;
    }

    .shared_game_rating p.descriptorText {
      margin: 0;

      font-size: 11px !important;
      color: #c6d4df !important;
      text-transform: uppercase;
      line-height: 14px;
    }

    /* community awards hover */
    .reaction_award_hover {
      font-family: "Motiva Sans", sans-serif;
      width: 150px;
      background: #DADEE0;
    }

    .community_tooltip.reaction_award_hover,
    .store_tooltip.reaction_award_hover {
      padding: 0px;
    }

    .reaction_award_hover .reaction_award_icon {
      background-color: #474C52;
      border-radius: 3px 3px 0 0;
      padding-top: 5px;
      text-align: center;
    }

    .reaction_award_hover .reaction_award_icon>img {
      height: 100px;
    }

    .reaction_award_hover .reaction_award_info {
      padding: 10px;
      text-align: center;
    }

    .reaction_award_hover .reaction_award_name {
      font-weight: bold;
      font-size: 12px;
      color: #0A212E;
    }

    .reaction_award_hover .reaction_award_desc {
      padding-top: 5px;
      font-size: 10px;
      color: #0A212E;
    }

    .reaction_award_hover .reaction_award_points {
      padding-top: 5px;
      font-size: 10px;
      color: #737678;
    }

    /* community awards */
    .community_award_btn_icon {
      vertical-align: middle;
      margin-right: 5px;
    }

    .community_award_ctn {
      display: flex;
      flex-wrap: wrap;
    }

    .community_award {
      position: relative;
      background-color: rgba(0, 0, 0, 0.2);
      border-radius: 3px;
      padding: 0px 3px 0px 3px;
      margin: 0 1px;
      line-height: 28px;
      height: 28px;
      cursor: pointer;
    }

    .community_award:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }

    .community_award_icon {
      height: 20px;
      vertical-align: middle;
    }

    .community_award_count {
      color: #66c0f4;
      font-size: 13px;
      vertical-align: middle;
      font-weight: bold;
    }

    .community_award_count.hidden {
      display: none;
    }

    .community_tooltip.community_award_tooltip {
      background: #141c27;
      color: #7cc5fb;
    }

    /* hover */
    .community_award_ctn_hover {
      display: inline-block;
    }

    .community_award_ctn_hover .community_award {
      display: inline-block;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 5px;
      padding: 3px;
      margin: 1px;
      line-height: unset;
      height: unset;
    }

    .community_award_ctn_hover .community_award .community_award_icon {
      width: 16px;
      height: 16px;
      vertical-align: middle;
    }

    .community_award_ctn_hover .community_award .community_award_count {
      color: #66c0f4;
      font-size: 12px;
      vertical-align: middle;
      font-weight: bold;
      padding: 0;
    }

    .community_award_ctn_hover .community_award .community_award_count.hidden {
      display: none;
    }

    @media screen and (max-width: 910px) {
      html.responsive .newmodal {
        min-width: 0;
      }

      /* workaround for ios safari, having the background be position: fixed introduces display glitches */
      html.responsive .newmodal_background {
        position: absolute;
      }

    }

    html.responsive.touch .newmodal {
      min-width: 0;
    }

    /* workaround for ios safari, having the background be position: fixed introduces display glitches */
    html.responsive.touch .newmodal_background {
      position: absolute;
    }

    @media screen and (max-width: 910px) {

      html.responsive .newmodal {
        min-width: 500px;
      }


    }

    html.responsive.tablet .newmodal {
      min-width: 500px;
    }



    @media screen and (max-width: 910px) {
      html.responsive .newmodal_content {
        padding: 15px;
      }
    }


    /* China Desktop Footer */

    body.v6 #footer.china_footer {
      padding: 16px 16px 60px 16px;
    }

    body.v6 #footer_spacer.china_spacer {
      height: 360px;
    }

    .china_footer_content a,
    #footer .china_footer_content a {
      color: #8F8E93;
    }

    .china_footer_content a:hover,
    #footer .china_footer_content a:hover {
      color: #FFFFFF;
    }

    .china_footer_navlinks {
      user-select: none;
      margin-left: 50px;
    }

    .china_footer_content {
      max-width: calc(910px - 16px);
      margin: 0px auto;
      padding-top: 16px;
      color: #8F8E93;
      font-family: "Motiva Sans", Sans-serif;
      font-weight: normal;
      /* normal */

    }

    .china_footer_row {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .china_pw_logo {
      margin-right: 10px;
    }

    .china_steam_logo {
      width: 142px;
      height: 44px;
    }

    .china_footer_line {
      height: 1px;
      background: #24272C;
      margin: 20px 0;
    }

    .china_footer_social_box {
      display: flex;
      align-items: center;
    }

    .china_footer_social_box:first-of-type {
      margin-right: 20px;
    }

    .china_footer_social_box.tooltip {
      cursor: default;
      user-select: none;
    }

    .china_footer_socials_ctn {
      display: flex;
    }

    .china_footer_legal_ctn {
      margin-top: 20px;
    }

    .china_footer_logos img {
      width: 96px;
      vertical-align: top;
    }

    .gpnav:focus {
      outline: 4px solid blue;
      box-shadow: 0 0 2px inset #0000ff;
    }


    /* For Date pickers shared between projects */

    .rdt .rdtPicker {
      background: #576070;
      border: 1px solid #646f82;
      box-shadow: 0 1px 10px rgba(0, 0, 0, 0.8);
    }

    .rdt .rdtPicker th {
      border-bottom: transparent;
    }

    .rdt .rdtPicker td {
      color: white;
    }

    /* days that show from the previous or subsequent calendar month (eg when a month does not start on a Sunday) */
    .rdt .rdtPicker td.rdtNew,
    .rdt .rdtPicker td.rdtOld {}

    .rdt .rdtPicker td.rdtDisabled,
    .rdt .rdtPicker td.rdtDisabled:hover {
      color: #333333;
    }

    .rdt .rdtPicker td.rdtDay:hover,
    .rdt .rdtPicker td.rdtMonth:hover,
    .rdt .rdtPicker td.rdtYear:hover {
      color: black;
    }

    .rdt .rdtPicker td .rdtCounter .rdtBtn:hover {
      color: black;
    }

    .rdt .rdtPicker th.rdtSwitch {
      color: white;
      font-size: 13px;
    }

    .rdt .rdtPicker th.rdtSwitch:hover {
      color: black;
    }

    .rdt .rdtPicker th.dow {
      background: #474f5c;
      color: #9aa3b1;
    }



    /* for dynamic store items */
    html.responsive .ds_steam_deck_compat {
      display: block;
      position: absolute;
      pointer-events: none;
      top: 4px;
      right: 4px;
      z-index: 15;
      width: 44px;
      height: 24px;
      border-radius: 24px;
      opacity: 0;
      background-color: var(--gpBackground-DarkMedium);
      backdrop-filter: blur(24px);
      transition: opacity 0.1s ease;
    }

    html.responsive .gpfocus .ds_steam_deck_compat {
      transition: opacity 0.2s ease 0.1s;
      opacity: 1;

    }

    .ds_steam_deck_compat.verified {
      background: url('https://community.cloudflare.steamstatic.com/public/shared/images/ico/ico-deck-logo.svg') 3px no-repeat, url('https://community.cloudflare.steamstatic.com/public/shared/images/ico/ico-deck-verified.svg') 22px no-repeat;
    }

    .ds_steam_deck_compat.playable {
      background: url('https://community.cloudflare.steamstatic.com/public/shared/images/ico/ico-deck-logo.svg') 3px no-repeat, url('https://community.cloudflare.steamstatic.com/public/shared/images/ico/ico-deck-playable.svg') 22px no-repeat;
    }

    .ds_steam_deck_compat.unsupported {
      background: url('https://community.cloudflare.steamstatic.com/public/shared/images/ico/ico-deck-logo.svg') 3px no-repeat, url('https://community.cloudflare.steamstatic.com/public/shared/images/ico/ico-deck-unsupported.svg') 22px no-repeat;
    }

    .ds_steam_deck_compat.unknown {
      background: url('https://community.cloudflare.steamstatic.com/public/shared/images/ico/ico-deck-logo.svg') 3px no-repeat, url('https://community.cloudflare.steamstatic.com/public/shared/images/ico/ico-deck-unknown.svg') 22px no-repeat;
    }

    /* global inline */
    .steam_deck_compat {
      display: none;
      pointer-events: none;
      width: 40px;
      height: 20px;
      background: url('https://community.cloudflare.steamstatic.com/public/shared/images/ico/ico-deck-logo.svg') left no-repeat;
      background-size: 20px 20px;
    }

    .steam_deck_compat.verified {
      display: inline-block;
      background: url('https://community.cloudflare.steamstatic.com/public/shared/images/ico/ico-deck-logo.svg') left no-repeat, url('https://community.cloudflare.steamstatic.com/public/shared/images/ico/ico-deck-verified.svg') right no-repeat;
    }

    .steam_deck_compat.playable {
      display: inline-block;
      background: url('https://community.cloudflare.steamstatic.com/public/shared/images/ico/ico-deck-logo.svg') left no-repeat, url('https://community.cloudflare.steamstatic.com/public/shared/images/ico/ico-deck-playable.svg') right no-repeat;
    }

    .steam_deck_compat.unsupported {
      display: inline-block;
      background: url('https://community.cloudflare.steamstatic.com/public/shared/images/ico/ico-deck-logo.svg') left no-repeat, url('https://community.cloudflare.steamstatic.com/public/shared/images/ico/ico-deck-unsupported.svg') right no-repeat;
    }

    .steam_deck_compat.unknown {
      display: inline-block;
      background: url('https://community.cloudflare.steamstatic.com/public/shared/images/ico/ico-deck-logo.svg') left no-repeat, url('https://community.cloudflare.steamstatic.com/public/shared/images/ico/ico-deck-unknown.svg') right no-repeat;
    }

    .private_app_indicator {
      height: 1.25em;
      width: 1.25em;
      vertical-align: middle;
      display: inline-block;
    }

    .private_app_indicator svg line,
    .private_app_indicator svg path {
      stroke: rgb(110, 141, 80);
    }

    html {
      height: 100%;
    }

    body {
      background: #1b2838;

      text-align: left;

      color: #8F98A0;
      font-size: 14px;

      margin: 0;
      padding: 0;
    }

    body.flat_page {
      position: relative;
      min-height: 100%;
    }

    body.flat_page.black {
      background: #000000;
    }

    body.flat_page.no_bg {
      background: none;
    }

    body.flat_page.blue {
      color: #636363;
    }

    /* this makes the footer appear at the bottom of the window on short pages */
    body.flat_page .responsive_page_frame {
      position: static;
    }

    body.standard_page {
      min-width: 958px;
    }

    body,
    textarea {
      font-family: Arial, Helvetica, Verdana, sans-serif;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      margin: 0px;
    }

    .pagecontent {
      padding-bottom: 128px;
    }

    .pagecontent.in_client,
    .pagecontent.no_header {
      background-position: center top;
    }

    body.flat_page.blue .pagecontent {
      background: none;
    }

    @media screen and (max-width: 910px) {
      html.responsive .pagecontent {
        padding-bottom: 0;
      }

    }

    html.responsive.touch .pagecontent {
      padding-bottom: 0;
    }

    .pagecontent.no_footerpad {
      padding-bottom: 0;
    }

    .maincontent {
      width: 948px;
      margin: 0 auto;
    }

    .ellipsis {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    a,
    .whiteLink {
      color: #ebebeb;
      text-decoration: none;
      cursor: pointer;
    }


    a.hoverunderline:hover {
      text-decoration: underline;
    }

    a.underlinedLink,
    span.underlinedLink {
      color: #ebebeb;
      text-decoration: underline;
      cursor: pointer;
    }

    a.whiteLink:hover,
    .whiteLink:hover,
    a.linkStandard:hover,
    a.linkTitle:hover,
    a.underlinedLink:hover,
    span.underlinedLink:hover {
      color: #66C0F4;
      text-decoration: none;
      cursor: pointer;
    }

    form {
      margin: 0;
      padding: 0;
    }

    input[type=text],
    input[type=password],
    input[type=number],
    select {
      color: #909090;
      background-color: rgba(0, 0, 0, 0.2);
      border: 1px solid #000;
      /* should set this on individual styles we know look good with it */
      /* box-shadow: 1px 1px 0 0 rgba( 91, 132, 181, 0.2 ); */
      border-radius: 3px;
    }



    #footer {
      position: relative;
      text-align: left;
      width: auto;
      font-size: 12px;
      color: #8F98A0;
      border: 0;
      margin: 0;
      padding: 32px 0;
      background-color: rgba(0, 0, 0, 0.4);
    }

    div#footer.compact {
      position: sticky;
      bottom: 0;
      left: 0;
      width: fit-content;
      padding: 0;
      background: none;
      z-index: 3;
    }

    div#footer.compact .footer_content {
      width: calc((100vw - 948px)/2);
    }

    div#footer.compact .footer_content #footerText {
      padding: 0 0 24px 12px;
      line-height: 16px;
      color: #537793;
    }

    div#footer.compact .footer_content #footerText a {
      display: inline-block;
      margin-right: 12px;
      margin-bottom: 7px;
      color: #799AB4;
    }

    div#footer.compact .footer_content #footerText a:hover {
      color: white;
    }

    div#footer.compact .footer_content #footerText .link_ssa,
    div#footer.compact .footer_content #footerText .copyright {
      display: block;
    }

    @media screen and (max-width: 1400px) {
      html.responsive div#footer.compact {
        height: 32px;
      }

      html.responsive div#footer.compact .footer_content {
        width: 32px;
        height: 32px;
        padding-top: 4px;
        background: black;
        overflow: hidden;
        white-space: nowrap;
        display: inline-block;
        transition: width 0.5s ease;
      }

      html.responsive div#footer.compact .footer_content:hover {
        width: 100%;
      }

      html.responsive div#footer.compact .footer_content .copyIcon {
        display: inline-block !important;
        font-size: 20px;
        margin-right: 8px;
        margin-left: 4px;
      }

      html.responsive div#footer.compact .footer_content #footerText {
        padding: 4px;
        display: flex;
        flex-direction: row;
      }

      html.responsive div#footer.compact .footer_content #footerText .link_ssa,
      html.responsive div#footer.compact .footer_content #footerText .copyright,
      html.responsive div#footer.compact .footer_content #footerText a {
        display: inline-block;
      }

    }


    body.flat_page #footer,
    body.headerless_page #footer {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 0;
      margin: 0;
      padding-top: 16px;
      background: transparent;
    }

    body.flat_page #footer {
      background-color: #000000;
    }

    body.flat_page.blue #footer {
      background: none;
    }

    body #footer .responsive_optin_link {
      display: none;
    }

    body.flat_page #footer_spacer,
    body.headerless_page #footer_spacer {
      height: 78px;
      padding-top: 16px;
      clear: both;
    }

    body.flat_page #footer_spacer.steam_china_footer_spacer,
    body.flat_page #footer_spacer.steam_china_footer_spacer {
      height: 227px;
    }


    #footer .footer_content {
      position: relative;
      width: 958px;
      margin: 0 auto;
    }

    #footer a {
      color: #C6D4DF;
      text-decoration: none;
    }

    #footer a:hover {
      color: #ffffff;
    }

    #footerText {
      padding: 2px 0 0 123px;
      line-height: 14px;
      display: block;
      color: #8F98A0;
    }

    #footerLogo {
      position: absolute;
      left: 16px;
      top: 4px;
    }


    .friendBlock {
      height: 36px;
      padding: 4px 0 4px 4px;
      margin-bottom: 4px;
      font-size: 11px;
      line-height: 13px;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;

      position: relative;

      background-color: rgba(84, 133, 183, 0.2);
    }

    a.friendBlock {
      display: block;
    }

    .friendBlockLinkOverlay {
      position: absolute;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;

      z-index: 2;
    }

    .friendBlock a.friendBlockInnerLink {
      position: relative;
      z-index: 3;
      color: #ffffff;
    }

    .friendBlock:hover {
      cursor: pointer;
      background-color: rgba(117, 204, 255, 0.3);
    }

    .friendBlock .playerAvatar {
      float: left;
      margin-right: 7px;
    }

    .friendBlock .friendBlockContent {
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }

    .friendBlock .friend_join_game_link {
      text-decoration: underline;
    }

    .friendBlock .friend_join_game_link:hover {
      color: white;
    }

    .friendBlock .blockedText {
      color: red;
      font-weight: bold;
    }

    .friendBlockStatusIcon {
      float: right;
      height: 40px;
      line-height: 40px;
      padding: 0 7px;
    }

    .friendBlockStatusIcon img {
      vertical-align: middle;
    }


    .friendBlock .friendPlayerLevel {
      float: right;
      margin: 4px 4px 0 0;
    }

    .responsive_friendblocks_ctn {
      max-width: 898px;
      margin: 0 auto;
    }

    @media screen and (max-width: 910px) {

      html.responsive .responsive_friendblocks .friendBlock,
      html.responsive .responsive_friendblocks .friendBlock:nth-child(3n) {
        margin-right: 0.8%;
      }
    }

    @media screen and (max-width: 910px) and (min-width: 601px) {

      html.responsive .responsive_friendblocks .friendBlock {
        width: 32%;
      }

      html.responsive .responsive_friendblocks .friendBlock:nth-child(3n) {
        margin-right: 0;
      }
    }

    @media screen and (max-width: 600px) and (min-width: 401px) {
      html.responsive .responsive_friendblocks .friendBlock {
        width: 48%;
      }

      html.responsive .responsive_friendblocks .friendBlock:nth-child(2n) {
        margin-right: 0;
      }
    }

    @media screen and (max-width: 400px) {
      html.responsive .responsive_friendblocks .friendBlock {
        width: auto;
        float: none;
      }
    }

    @media screen and (max-width: 500px) {

      html.responsive .commentthread_paging.has_view_all_link .pagebtn,
      html.responsive .commentthread_paging.has_view_all_link .commentthread_pagelinks,
      html.responsive .commentthread_paging.has_view_all_link .commentthread_pagedropdown {
        display: none;
      }
    }


    @media screen and (max-width: 910px) {

      html.responsive .commentthread_pagelinks {
        display: none;
      }

      html.responsive .commentthread_pagedropdown {
        display: inline;
      }

      html.responsive .commentthread_comment_author .community_ban_action {
        display: none;
      }

      html.responsive .commentthread_comment_author .actionlink:not(.community_ban_action) {
        visibility: visible;
      }

    }

    html.responsive.touch .commentthread_pagelinks {
      display: none;
    }

    html.responsive.touch .commentthread_pagedropdown {
      display: inline;
    }

    html.responsive.touch .commentthread_comment_author .community_ban_action {
      display: none;
    }

    html.responsive.touch .commentthread_comment_author .actionlink:not(.community_ban_action) {
      visibility: visible;
    }

    /* used to display the " - public" next to a group name */
    .pubGroup {
      font-size: 11px;
      color: #d05f29;
      font-weight: bold;
    }

    body.flat_page>.perf_timing_area .perf_timing_link,
    body.headerless_page>.perf_timing_area .perf_timing_link {
      position: absolute;
      left: 15px;
      bottom: 15px;
    }

    .perf_timing_area {
      display: block;
      text-align: center;
      margin-bottom: 14px;
    }

    .perf_timing_data {
      position: relative;
      background-color: #000000;
      margin: 0px auto 48px auto;
      padding: 8px;
      text-align: left;
      width: 936px;
      font-size: 14px;
    }

    .nowrap {
      white-space: nowrap;
      overflow: hidden;
    }

    /* note that the old gameLogoHolder_default style does nothing now */

    .gameLogo {
      width: 184px;
      height: 69px;
      border: 0;
      padding: 4px;
      margin: 0;
      background: rgba(0, 0, 0, 0.5);
    }

    .gameLogo img {
      border: 0;
      width: 184px;
      height: 69px;
    }


    /* ---------------- comment threads -------------*/
    .commentthread_header,
    .commentthread_footer {
      font-size: 14px;
      line-height: 24px;
      margin-bottom: 1px;
      padding-bottom: 15px;
      padding-top: 10px;
    }

    .commentthread_header {
      border-bottom: 1px solid #363f4c;
    }

    .commentthread_footer {
      border-top: 1px solid #363f4c;
    }

    .commentthread_header .commentthread_count {
      background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAMVJREFUeNqkk80RgjAQhb84FmAJ6UDtADohHWgFlqB2QAfaAZy44oE7KYEO9LJxdpxl5Oedwmb3y+Tl4ZquBygAz39FoNSFLXAFTkzXHjinD9d0/Zv5cmmxYZmydOWlAIAW8GsAO6BYA1jlwUsDnjOHazHxm4MgAcmAg9H8e/IdeGjAIMHIgEo1BwHohHrp8RpgKchprbhtaQBKy8RSfLkIJBqDN+AIRCc/U3pXrx1W9Ur5UwO59YyDMZzq+cje5ByMQj4DAOFqLALaHDbcAAAAAElFTkSuQmCC );
      background-repeat: no-repeat;
      background-position: 0 4px;
      padding-left: 24px;
      overflow: hidden;
    }

    .commentthread_count_label {
      margin-right: 8px;
    }

    .commentthread_subscribe_ctn {
      display: inline-block;
      white-space: nowrap;
      font-size: 12px;
      cursor: pointer;
    }

    .commentthread_subscribe_hint {
      font-size: 10px;
      line-height: 12px;
      vertical-align: text-top;
      cursor: default;
    }

    .commentthread_subscribe_hint .commentthread_subscribe_hint_q {
      color: #66c0f4;
    }

    .commentthread_subscribe_checkbox {
      display: inline-block;
      position: relative;
      height: 12px;
      width: 12px;
      vertical-align: middle;

      border: 1px solid #385377;
      border-top-color: #070a0f;
      border-left-color: #070a0f;

      border-top-right-radius: 1px;
      border-bottom-left-radius: 1px;

      background: rgba(0, 0, 0, 0.2);
    }

    .commentthread_subscribe_check {
      position: absolute;
      display: none;
      top: -1px;
      left: -1px;
      right: -1px;
      bottom: -1px;

      background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAASJJREFUeNpi/P//PwMlgIVcjcGLD70H0UzkaA6cv/cpkBIgywC/mdvOMLGwSsHMIskA145FM1m5eIxB7B+Pnz9YG2t3gGgDrArbi/mkFdJA7J+fPxzYWhWuSLQXlF0CfSUMLOtB7H9/fj87NaW+ESaHYoBJelWaXdWkBnQDdMIzehiZmHhB7Du71pS8unb+AFYD5G08ZopqGtQ7Nc3uZWRkBPvVa9K6TSwcnGog9uvrFxovL5++HFkPI3JC8p+98yayYhANMhBEf3//ZvP2/OBGoPqzOA1AN+T/v3+fQU7/8+P7reP9FenITsfqBRAAKQRpAJsO1Awy5MrKGSXYNGN1AQwELTzwCWTA83NHS471V/biiiFGSjMTEwOFgGIDAAIMAKHJfj735eNRAAAAAElFTkSuQmCC') no-repeat center;
    }

    .commentthread_subscribe_ctn.checked .commentthread_subscribe_check {
      display: block;
    }

    .commentthread_subscribe_ctn.waiting .commentthread_subscribe_check {
      display: block;
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/login/throbber.gif');
      background-size: contain;
    }

    .commentthread_paging {
      float: right;
    }

    .commentthread_pagelink {
      cursor: pointer;
      color: #ffffff;
    }

    .commentthread_pagelinks {
      margin: 0 8px;
    }

    .commentthread_pagedropdown {
      display: none;
    }

    /* fix some bad workshop.css styles */
    .commentthread_pagedropdown select {
      width: auto;
    }

    .commentthread_pagelink:hover {
      text-decoration: underline;
    }

    .commentthread_pagelink.active {
      cursor: default;
      color: #939393;
    }

    .commentthread_pagelink.active:hover {
      text-decoration: none;
    }

    .commentthread_entry {
      min-height: 44px;
      background-color: rgba(0, 0, 0, 0.2);
      position: relative;

      padding: 8px;
    }

    .commentthread_allcommentslink {
      margin-right: 12px;
    }

    a.commentthread_allcommentslink:hover {
      text-decoration: underline;
    }

    .commentthread_user_avatar {
      float: left;
      margin-right: 8px;
    }

    .commentthread_entry_quotebox_quote {
      position: absolute;
      left: 50px;
      top: 13px;
      width: 17px;
      height: 18px;
    }

    .commentthread_entry_quotebox {
      border: none;
      padding: 4px 6px 4px 6px;
      font-size: 12px;
      background-color: rgba(0, 0, 0, 0.4);
      border-radius: 4px;
      border-left: 1px solid #000;
      border-top: 1px solid #000;
      border-right: 1px solid #354357;
      border-bottom: 1px solid #354357;
      overflow: hidden;
    }

    .commentthread_textarea {
      resize: none;
      outline: none;
      background-color: transparent;
      border: none;
      width: 100%;
      overflow: hidden;
      color: #BFBFBF;
    }

    .commentthread_entry_submitlink {
      text-align: right;
      padding-top: 5px;
    }

    .commentthread_entry_submitlink .emoticon_button {
      margin-right: 8px;
    }

    .commentthread_entry_autosubscribe {
      padding-bottom: 8px;
    }

    .commentthread_entry_error {
      color: #ff0000;
    }

    .commentthread_textarea::-webkit-input-placeholder {
      font-style: italic;
      color: #515152;
    }

    .commentthread_textarea:-moz-placeholder {
      font-style: italic;
      color: #515152;
    }

    .commentthread_comment_container {
      margin-top: 19px;
    }

    .commentthread_comment {
      position: relative;
      padding-bottom: 8px;
      padding-top: 8px;
      margin-bottom: 8px;
      min-height: 40px;
      padding-left: 58px;

      /* The descendant comment text element has overflow set, but a chrome bug allows some unicode characters to spill out of that.  overflow at this level seems to stop it */
      overflow: hidden;
    }

    .commentthread_comment.highlighted {
      border: 3px solid red;
      background-color: rgba(255, 255, 255, 0.1);
    }

    .detailBox .commentthread_comment:not(.hidden_post):hover,
    .group_comments .commentthread_comment:not(.hidden_post):hover,
    .profile_comment_area .commentthread_comment:not(.hidden_post):hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .valve_links {
      margin: 15px 0 0 0;
      display: block;
    }

    .commentthread_comment.commentthread_newcomment {}

    .commentthread_comment_avatar {
      position: absolute;
      left: 5px;
      top: 8px;
    }

    .commentthread_valve_icon {
      vertical-align: middle;
      margin-left: 5px;
      width: 59px;
      height: 16px;
    }

    .commentthread_comment_author {
      margin-bottom: 2px;
      line-height: 16px;
    }

    .commentthread_comment_author a {
      font-size: 14px;
    }

    .commentthread_comment_author a.actionlink {
      color: #B0AEAC;
      font-size: 11px;
      visibility: hidden;
    }

    .commentthread_comment_author a.actionlink:hover {
      text-decoration: underline;
    }

    .commentthread_comment_author .commentthread_comment_actions {
      float: right;
      margin-right: 8px;
    }

    .commentthread_comment_author .commentthread_comment_actions a.actionlink {
      margin-left: 10px;
    }

    .commentthread_comment:hover .commentthread_comment_author a.actionlink {
      visibility: visible;
    }

    .commentthread_comment:hover .commentthread_comment_author a.actionlink img {
      height: 16px;
    }

    .commentthread_comment_timestamp {
      font-size: 11px;
      color: #56707f;
      margin-left: 4px;
    }

    .commentthread_comment_text {
      font-size: 13px;
      color: #acb2b8;
      word-wrap: break-word;
      overflow-y: auto;
      max-height: 400px;
      line-height: 18px;
    }

    .commentthread_comment_text a {
      color: #c6d4df;
      text-decoration: underline;
    }

    .commentthread_comment_text a:hover {
      color: #EBEBEB;
      text-decoration: underline;
    }

    .commentthread_comment_text .content_check_warning,
    .commentthread_comment_text .needs_content_check {
      opacity: 0.5;
      font-style: italic;
    }

    .commentthread_comment_text .content_check_moderator {
      margin-top: 5px;
      color: #c38a4c;
      font-style: italic;
    }

    .commentthread_comment_text .failed_content {
      color: #acb2b8;
      padding: 5px;
      margin-top: 5px;
      background: rgba(21, 31, 44, 0.7);
      border: 1px solid #c38a4c;
      display: flex;
    }

    .commentthread_comment_text .failed_content .actual_content {
      max-width: 75%;
    }

    .commentthread_comment_text .failed_content .content_check_controls {
      margin-left: auto;
    }

    .commentthread_comment_text .failed_content .content_check_controls>a {
      text-decoration: none;
    }

    .commentthread_comment_friendindicator {
      position: absolute;
      left: 33px;
      top: 24px;
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/skin_1/comment_friendindicator_small.png');
      width: 20px;
      height: 20px;
      z-index: 2;

      cursor: pointer;
    }

    .commentthread_edit_buttons {
      text-align: right;
    }

    .commentthread_workshop_authorbadge {
      color: #e9d528;
    }

    .commentthread_workshop_publishedfilesbadge {
      display: inline-block;
      padding: 0 6px;
      border-radius: 3px;
      line-height: 22px;
      margin: 0 4px;
      background-color: #425979;
    }

    .commentthread_steamworks_developerbadge {
      display: inline-block;
      padding: 0 6px;
      border-radius: 3px;
      line-height: 22px;
      margin: 0 4px;
      background-color: #AC966A;
    }

    .commentthread_prepopulate_prompt {
      margin-bottom: 8px;
      color: #67c1f5;
    }


    .comment_hidden_border {
      border: 1px dotted #4c5f76;
    }

    .comment_hidden_content {
      display: flex;
      flex: 1 100%;
      justify-content: space-between;
      padding: 10px;
      color: #4c5f76;
    }

    .comment_hidden_action {
      text-decoration: underline;
    }

    .comment_hidden_action:hover {
      color: #ffffff;
      cursor: pointer;
    }

    .commentthread_comment_reports img {
      vertical-align: text-top;
    }

    .edit_content_descriptors {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .edit_content_descriptors .content_descriptor {}

    .edit_content_descriptors .content_descriptor .content_descriptor_name {
      display: inline-block;
    }

    .edit_content_descriptors .content_descriptor .content_descriptor_desc {
      color: #97a0ab;
      margin-left: 24px;
      font-size: 12px;
    }

    /** Styles for modal popup */

    .modal_top_band {
      background-color: #37516d;
      width: 548px;
      height: 25px;
      margin-bottom: 1px;
    }

    .modal_close {
      float: right;
      width: 9px;
      height: 9px;
      margin-right: 9px;
      margin-top: 7px;
      line-height: 9px;
      cursor: pointer;
    }

    .modal_box {
      background: -webkit-linear-gradient(top, rgba(102, 192, 244, 1) 5%, rgba(47, 137, 188, 1) 95%);
      background: linear-gradient(to bottom, rgba(102, 192, 244, 1) 5%, rgba(47, 137, 188, 1) 95%);
      padding: 3px;
      width: 542px;

      font-size: 12px;
      color: #ffffff;
      text-align: left;
    }

    .modal_box .modal_box_ctn {
      width: 502px;
      background-color: #1a2635;
      padding: 20px;
    }

    .modal_box #forum_movetopic_modal_content #forum_movetopic_form {
      background: transparent;
    }

    .modal_box h1,
    .modal_box h5 {
      font-weight: normal;
    }

    .modal_box h2 {
      color: #c6d4df;
      font-family: "Motiva Sans", Sans-serif;
      font-weight: 300;
      /* light */

      font-size: 22px;
      margin-bottom: 10px;
    }

    .modal_low_block {
      background-color: #171717;
      padding: 20px 20px 0px 20px;
      height: 54px;
      padding-top: 24px;
      color: #b0aeac;
    }


    .modal_steam_ico {
      float: left;
      padding-right: 18px;
      margin-top: -4px;
    }



    #modalBG {
      position: fixed;
      z-index: 900;
      background-color: #000000;
      filter: alpha(opacity=60);
      opacity: 0.8;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
    }

    .modal_frame {
      width: 508px;
      position: absolute;
      z-index: 1000;
      background-color: #000000;
    }


    /* big gray buttons for the modal */
    .gray_square_button {
      height: 34px;
      line-height: 34px;
      color: #e5e2df;
      font-size: 14px;
      padding: 0 2px;
      margin: 0 8px;

      border: none;

      position: relative;
      display: inline-block;

      cursor: pointer;
    }

    a.gray_square_button:hover {
      text-decoration: none;
      color: #e5e2df;
    }

    .modal_box .gray_square_button {
      margin-left: 0;
      margin-right: 16px;
    }

    .gray_square_button .left,
    .gray_square_button .right,
    .gray_square_button .button_label {
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/gray_square_button.png');
    }

    .gray_square_button .left,
    .gray_square_button .right {
      background-repeat: no-repeat;
      position: absolute;
      top: 0;
      height: 34px;
      width: 2px;
    }

    .gray_square_button .left {
      background-position: 0 0;
      left: 0;
    }

    .gray_square_button .right {
      background-position: -2px 0;
      right: 0;
    }

    .gray_square_button .button_label {
      background-repeat: repeat-x;
      background-position: 0 -34px;
      padding: 0 32px;
      text-align: left;
    }

    .modal_box .gray_square_button .button_label {
      min-width: 62px;
    }

    .gray_square_button.active .left {
      background-position: 0 -68px;
    }

    .gray_square_button.active .right {
      background-position: -2px -68px;
    }

    .gray_square_button.active .button_label {
      background-position: 0 -102px;
    }

    button.gray_square_button::-moz-focus-inner {
      padding: 0;
      border: none;
    }


    /* not logged in modal dialog */

    .notLoggedInText {
      font-size: 20px;
      padding-bottom: 20px;
      padding-top: 0;
      text-align: center;
    }

    .notLoggedInButtons {
      display: block;
      margin: 0 auto;
      text-align: center;
    }

    .notLoggedInButtons>a {
      margin-right: 5px;
    }


    /* new input styles */

    input.gray_bevel:-moz-placeholder,
    textarea.gray_bevel:-moz-placeholder,
    .gray_bevel textarea:-moz-placeholder,
    .gray_bevel input:-moz-placeholder {
      font-style: italic;
      color: #7c7c7c;
    }

    input.gray_bevel::-webkit-input-placeholder,
    textarea.gray_bevel::-webkit-input-placeholder,
    .gray_bevel textarea::-webkit-input-placeholder,
    .gray_bevel input::-webkit-input-placeholder {
      font-style: italic;
      color: #7c7c7c;
    }

    input.gray_bevel,
    textarea.gray_bevel,
    .gray_bevel,
    .commentthread_comment_edit_textarea_ctn {
      background-color: rgba(0, 0, 0, 0.2);
      border-radius: 3px;
      border: 1px solid #000;
      box-shadow: 1px 1px 0 0 rgba(91, 132, 181, 0.2);
      color: #C6D4DF;

      margin-bottom: 6px;
      outline: none;


      padding: 4px 6px;
    }

    .gray_bevel.for_text_input {
      display: inline-block;
      padding-bottom: 1px;
      height: 25px;
    }

    .gray_bevel input {
      line-height: 21px;
      height: 21px;
    }

    .newmodal_prompt_textarea {
      height: 396px;
    }

    .newmodal_prompt_with_textarea {
      display: inline-block;
      padding-top: 1px;
      padding-bottom: 1px;
      width: 500px;
    }

    .gray_bevel input,
    .gray_bevel textarea {
      border: none;
      outline: none;
      box-shadow: none;
      background-color: transparent;
      font-size: 13px;
      color: #C6D4DF;
    }

    .gray_bevel.fullwidth {
      display: block;
    }

    .gray_bevel.fullwidth.for_text_input input,
    .gray_bevel.fullwidth textarea {
      width: 100%;
    }

    input.gray_bevel {
      height: 20px;
    }

    textarea.gray_bevel,
    .gray_bevel textarea {
      resize: none;
    }

    select.gray_bevel {
      background-color: #212f43;
      border-radius: 3px;
      border: 1px solid rgba(91, 132, 181, 0.2);
      box-shadow: 1px 1px 0px #000000;
      color: #BFBFBF;

      margin-bottom: 6px;
      outline: none;

      padding: 0px;
      line-height: 27px;
      height: 27px;
      font-size: 14px;
    }


    /* sharing published files*/
    #SharePopup {
      min-width: 550px;
      background-color: rgba(59, 63, 72, 0.5);
      border-radius: 3px;
      padding: 10px;
      text-align: left;
    }

    .share_controls_steam,
    .share_controls_steam a {

      width: 328px;
      height: 50px;
      margin-right: 15px;
      font-size: 16px;
      font-family: Arial;
      text-align: center;
      line-height: 50px;
      text-decoration: none;
      background-image: url('https://community.cloudflare.steamstatic.com/public/images//sharedfiles/share_status_off.jpg');
    }

    .share_controls_steam:hover,
    .share_controls_steam:hover a {
      background-image: url('https://community.cloudflare.steamstatic.com/public/images//sharedfiles/share_status_on.jpg');
      text-decoration: none;
    }

    .share_controls_other {
      display: flex;
    }

    .share_controls_divider {
      background-color: #161616;
      border-bottom: 1px solid #4c4c4c;
      height: 1px;
      margin-top: 15px;
      margin-bottom: 10px;
    }

    .share_controls_page_link {
      padding-top: 5px;
      line-height: 26px;
      height: 26px;
      font-size: 12px;
      color: #8f8f8f;
    }

    .share_ctn {
      display: flex;
    }

    .shareItemLink {
      padding-left: 5px;
    }

    .shareItemLink .btn_medium {
      height: 48px;
    }

    .shareItemLink .btn_medium>span {
      padding: 8px 10px 0px 10px;
    }

    .shareItemLink .btn_medium>span>img {
      height: 32px;
      width: 32px;
    }

    .share_controls_page_link form {
      display: inline-block;
    }

    .share_controls_page_link input {
      top: 0px;
      padding: 5px;
      min-width: 500px;
      background-color: rgba(0, 0, 0, 0.2);
      box-shadow: 1px 1px 0 0 rgba(91, 132, 181, 0.2);
      border: 1px solid #000;
      border-radius: 3px;
      color: #C6D4DF;
    }

    #ShareOnSteamDialog {
      min-height: 290px;
      width: 560px;
    }


    .migrated_profile_page_old .pagecontent {
      padding-bottom: 0;
    }

    .migrated_profile_page_old #BG_bottom,
    .migrated_profile_page_old #BG_top {
      margin: 0 auto;
    }

    .emoticon_button {
      display: inline-block;

      height: 36px;
      width: 36px;

      background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoyMzAyRkRGRkFGMjNFMjExQTExQ0E1RUVDNzk3QzRFRiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozMzgxRUQ1QjYwOTMxMUU1OUQzNzkwMUIxQjA3MDExNSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozMzgxRUQ1QTYwOTMxMUU1OUQzNzkwMUIxQjA3MDExNSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IFdpbmRvd3MiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDRDU0MzUwNDM0NUVFNTExOTQ4NEY2QkZCMzgwMjBBMyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoyMzAyRkRGRkFGMjNFMjExQTExQ0E1RUVDNzk3QzRFRiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pkg7SNkAAAKgSURBVHjatFftcdswDGV5HsAjqBM0mSDKBFUmqDVBkt/+EefO/m1nAqkTxJnA6gRRJrA6QdkJWjL36HtFKeorxh3Osk2BjwAeAH5ar9dqgKTQK6tzqxf43VitrTZW36zu8dwpy+VSzXqsc5vdWb3Fc9ualL5vrVZWH/EZlS4QbvMHsXkDwz9pgwR6RWC819yae3hqEAi36bM4XWn1KWaM3s0APoGNA4CUoRd04DcX51cC4E7y2WreA4DPj5LeMQBWIEydILwHEnx36K/7JllAHJhLAn8HjYI4EAB3ip2aLg0OUlPSZm0gVkS51viNFCOAFJzsmrL7Fs/7D/JACEhOYd9KEJ6GvPAcUqN2OFn40GuilAIFjUhUx5Q/eGmIOJu/rB4pzApeNgTkHURG8SkDdPUGvg0E4StsIhLRIOQnmxpVTlHtl5lt6P8h8kOEgeXF5+Jms0lmRMmXFnpdYk01EMSKTixB7NnbM6qMdYTnzYREjP33Hm4tYiVFxnOMXEQo29o7FGXuEWX8CPemPTf2jCuIXasxrXyP7E3hkQcou9O0DD4h1+9iIAxRKVRqUwGmy81y8++gvgmE+gSixgZfWgxVxAw/0s0jIGoa90wkXB5ExSAyNK6u+l8FaKZGVNMTaM2FY0DiTZWvHoAddI3GyZqRpXmMJKJXnSj6RLQ8tzcK2UM0Na6GJp/5mQDwIR994mpCdU/U254BANv9p25oUZx2hLj4YAAHGpxuYoMuz5YLlOypockEgP+m91DvyAlIhr6xGMmCZzqIHHZVVwPLaRb0F5cj7gxJj5P79RnlwHVba5/1GEq21De2UD9jOKO/UfLnAXob0H815UJciyaWUd2PVdgGm5eR/tEbhGxiOd22Fc2nDW7pjajAveSvAAMANCO6us8cVJgAAAAASUVORK5CYII=');
      background-repeat: no-repeat;
      background-size: 100% 100%;

      cursor: pointer;
    }

    .emoticon_button:hover,
    .emoticon_button.focus {
      background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoyMzAyRkRGRkFGMjNFMjExQTExQ0E1RUVDNzk3QzRFRiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoxQjU1MUI0MDYwOTMxMUU1OTUyMjlCQ0MwQTgyRDc5MCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoxQjU1MUIzRjYwOTMxMUU1OTUyMjlCQ0MwQTgyRDc5MCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IFdpbmRvd3MiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDRDU0MzUwNDM0NUVFNTExOTQ4NEY2QkZCMzgwMjBBMyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoyMzAyRkRGRkFGMjNFMjExQTExQ0E1RUVDNzk3QzRFRiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pp+wFVoAAAI+SURBVHjavFiBcYMwDHS4DOARvEHZIGSCskEZgU5QOkGuE9BOQDtB2glIJ4BOAJ2AyncyJ1Tj2AlEd3+kYMvvty3J3QzDIAIsQewAEhDj+x5wArSAb8A7/vYzTeIMJKAAdEOYHQGJh3+xOaNEDnjCWRvTM/wE/OBTm0LsUClqus0jKhWkhMSZUCsBsadyGaAhfTt8Z+1jexkzB5qM8pHVgowt48GHhGQE8gsHp9ATqF0+eQfaOFuAAJ0c9Z3OkSgWVsBFpMO/JyQUWbtqBQJ0v9GNPiFR2hiuBKq4MiQkUaFwSBi6R1L027Cj/W88c4wmzAgSdlRDSNA4wydnlNcERYRRTpDYL1h07Mn3EPsiv3nfj0mkJYwLxzlPrtiIc1F2PK5i7uzeAGavFRGRqLdIquVKxXUWz7wfx4scnTNAA6jwWVgy5JxJJF8Cap0nsb/VdCo3uXxPUrNxVDkGPs2ol8y03bP2R2z7vMUPEqXncu2x4QM+lYfMfPA3wKuF8Ohriw31AHczjj6JQqakkw4SJ1Lu9Y7lUqN/zPFj4LgRaICUEQscibiN3U9UQ2YNz2wrQvGaxXzIyYdkZRJHnrFtZV29YjrPbIUTT73DissSkxReu2rMw0pEKIGOlwy2DiUhUi2wNCkjEPvcOziR7sLKW+EkBhcBFwleC5pglntchFI2CbMH4kvvojo0HyxBrEXoYPOLIV9a2umw/eLKoL63clNrlgE3c6OaXOJW7vofhSD1aYu3dHNjb0Mc/gkwADlAbL3OpPROAAAAAElFTkSuQmCC');
    }

    .emoticon_button.small {
      height: 22px;
      width: 22px;
      vertical-align: middle;
    }

    .emoticon_popup_ctn {
      position: absolute;
    }

    .emoticon_popup {
      background-color: #3b3938;
      padding: 8px;
      box-shadow: 0 0 12px #000000;
    }

    .emoticon_popup_content {
      max-height: 96px;
      max-width: 352px;
      overflow-y: auto;
    }

    .large .emoticon_popup_content {
      max-height: 200px;
      max-width: 352px;
    }

    .large .emoticon_popup_content .emoticon_option {
      width: 60px;
      height: 60px;
      margin: 10px;
    }

    img.emoticon {
      vertical-align: text-bottom;
      height: 18px;
      width: 18px;
    }

    .emoticon_popup_content .emoticon_option {
      width: 28px;
      margin: 2px;

      text-align: center;

      line-height: 18px;
      height: 18px;
      padding: 5px 0;

      float: left;
    }

    .emoticon_popup_content .emoticon_option:hover {
      background-color: #201f1d;
      cursor: pointer;
    }


    .economyitem_hover {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1200;
    }

    .economyitem_hover_content {
      width: 350px;
      margin: 12px;
      box-shadow: 0 0 12px #000000;
    }

    .tooltip_hint {
      cursor: default;
      font-size: 12px;
      font-style: normal;
      color: #686868;
    }

    .community_tooltip {
      background: #c2c2c2;
      color: #3d3d3f;
      font-size: 11px;
      border-radius: 3px;
      padding: 5px;
      max-width: 225px;
      white-space: normal;
      box-shadow: 0 0 3px #000000;
    }

    /* formatting help dialog */
    .tagrow {
      margin-bottom: 8px;
      padding: 0 4px 4px 4px;
      position: relative;
      font-size: 12px;
      border-bottom: 1px solid #444;
      user-select: text;
    }

    .tagrow.tagrow_header {
      background-color: #1E1E1F;
      color: #626467;
      padding-bottom: 0px;
      line-height: 18px;
      border-bottom: none;
    }

    .tagrow .tag {
      color: #cccccc;
    }

    .tagrow .tagexample ul {
      list-style-position: outside;
    }

    .tagsyntax {
      float: left;
      width: 57%;
      margin-right: 3%;
    }

    .tagexample {
      float: left;
      width: 38%;
    }

    .tagexample a {
      text-decoration: underline;
    }

    .tagexample a:hover {
      color: #ffffff;
    }


    @media screen and (max-width: 910px) {
      html.responsive .maincontent {
        width: auto;
        margin-left: 1%;
        margin-right: 1%;
      }

      html.responsive .emoticon_popup_ctn {
        position: fixed;
        left: 5px;
        right: 5px;
        bottom: 5px;
        overflow-y: auto;
        z-index: 20;
        height: 176px;
        max-height: 40%;
      }

      html.responsive .emoticon_popup_content {
        max-width: none;
        max-height: none;
      }

      /* 16px font size prevents iphone from zooming */
      html.responsive .gray_bevel input,
      html.responsive .gray_bevel textarea {
        font-size: 16px;
      }

      html.responsive .responsive_tab_ctn.sharedfiles_responsive_tab .responsive_tab_control {
        display: block;
        text-align: center;
        background: #0d121a;
        border: 1px solid #66C0F4;
        border-image: linear-gradient(#66C0F4, #417B9c);
        border-image-slice: 1;
      }

      html.responsive .responsive_tab_ctn.sharedfiles_responsive_tab .responsive_tab_control select {
        width: 98%;
        -webkit-appearance: none;
        background-image: url('https://community.cloudflare.steamstatic.com/public/images/mobile/dropdown_30.png');
        background-repeat: no-repeat;
        background-position: right 5px;
        background-size: 15px;
        background-color: #0d121a;
      }
    }


    @media screen and (max-width: 910px) {
      html.responsive textarea.commentthread_textarea {
        font-size: 16px;
      }

    }

    html.responsive.touch textarea.commentthread_textarea {
      font-size: 16px;
    }

    /* styles that hide things on non-migrated pages */
    .responsive_menu_only {
      display: none;
    }

    .nonresponsive_hidden {
      display: none;
    }


    #tabs_baseline {
      clear: left;
    }

    .responsive_tab_baseline {
      background-color: #417B9C;
      max-width: 958px;
      height: 5px;
    }

    .responsive_tab_ctn.sharedfiles_responsive_tab {
      text-align: center;
    }

    .responsive_tab_ctn.sharedfiles_responsive_tab .responsive_tab_control {
      display: inline-block;
      padding: 6px 8px;
      font-size: 16px;
      color: #ffffff;

      background: #57749e;
      /* Old browsers */
      background: -webkit-linear-gradient(top, #66C0F4 5%, #417B9C 95%);
      background: linear-gradient(to bottom, #66C0F4 5%, #417B9C 95%);
    }

    @media screen and (max-width: 480px) {
      html.responsive .responsive_tab_ctn.sharedfiles_responsive_tab .responsive_tab_control {
        display: block;
        text-align: center;
        background: #0d121a;
        border: 1px solid #66C0F4;
        border-image: linear-gradient(#66C0F4, #417B9c);
        border-image-slice: 1;
      }

      html.responsive .responsive_tab_ctn.sharedfiles_responsive_tab .responsive_tab_control select {
        width: 98%;
        -webkit-appearance: none;
        background-image: url('https://community.cloudflare.steamstatic.com/public/images/mobile/dropdown_30.png');
        background-repeat: no-repeat;
        background-position: right 5px;
        background-size: 15px;
        background-color: #0d121a;
      }

      html.responsive div.responsive_tab_baseline,
      html.responsive div.responsive_tab_baseline.nonresponsive_hidden {
        display: none;
      }
    }

    img.badge_icon {
      width: 80px;
      height: 80px;
    }

    img.badge_icon.small {
      width: 54px;
      height: 54px;
    }

    .player_nickname_hint {
      color: #61696d;
      font-size: 18px;
      line-height: 16px;
    }



    body {
      background-image: url(https://community.cloudflare.steamstatic.com/public/images/economy/noheader_content.png );
      background-repeat: repeat-x;
      background-color: #000000;
      text-align: left;
    }

    body.headerless_page {
      position: relative;
    }

    .pagecontent {
      width: 958px;
      margin: 0 auto;
      background: none;
      padding-bottom: 0;
    }

    #headerrow {
      height: 88px;
      padding-top: 32px;
    }

    #headerlogo {
      float: right;
    }

    #mainContent {
      margin: 0px auto;
    }

    .black_square_btn,
    .black_square_btn .cap.left,
    .black_square_btn .cap.right {
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/tradereceipt_button.png');
      height: 26px;
    }

    .black_square_btn {
      background-repeat: repeat-x;
      background-position: center bottom;
      position: relative;
      display: inline-block;
      padding: 0px 12px;
      line-height: 26px;
      font-size: 12px;
      color: #c9c9c9;
      cursor: pointer;

      margin: 0px 20px;
    }

    .black_square_btn .cap.left,
    .black_square_btn .cap.right {
      position: absolute;
      top: 0px;
      width: 3px;
      background-repeat: no-repeat;
    }

    .black_square_btn .cap.left {
      background-position: left top;
      left: 0px;
    }

    .black_square_btn .cap.right {
      background-position: right top;
      right: 0px;
    }

    #error_page_bg {
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/skin_1/headerless_error_bg.png');
      width: 940px;
      height: 482px;
      margin: 0px auto 24px auto;
    }

    .error_page_content {
      text-align: center;
      color: #c4c4c4;
      padding: 112px 211px 0px 211px;

    }

    #error_page_bg h3 {
      font-size: 18px;
    }

    #error_page_bg h2 {
      font-size: 23px;
    }

    #error_msg {
      display: inline-block;
      background-color: #1d1d1d;
      padding: 15px 24px;
      font-size: 18px;
      margin-top: 54px;
    }

    .error_page_links {
      text-align: center;
    }

    .popup_page {
      width: 500px;
      margin: 0px auto;
    }

    .popup_page.buttons {
      text-align: right;
      margin-top: 12px;
      margin-bottom: 48px;
    }

    .popup_page_content {
      margin-top: 24px;

      background-color: #262626;
      border: 1px solid #4D4B49;
      padding: 16px;
    }

    .popup_page_content h2 {
      font-size: 24px;
      font-weight: bold;
      color: #ffffff;
    }

    .selectableNone {
      user-select: none;
      -moz-user-select: none;
      -webkit-user-select: none;
    }

    .selectableText:hover {
      user-select: text;
      -moz-user-select: text;
      -webkit-user-select: text;
    }

    .ellipsis {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    h2 {
      color: #c6c6c6;
      font-size: 22px;
      font-weight: normal;
      margin-bottom: 10px;
    }



    .itemHolder {
      position: relative;
      width: 98px;
      height: 98px;
      background-color: #333333;
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/trade_itemholder.png');
      background-repeat: no-repeat;
      background-position: center top;
      float: left;
      margin-right: 6px;
      margin-bottom: 6px;
    }

    .itemHolder.disabled {
      background-position: 0 -98px;
    }

    .itemHolder.consumed_item {
      opacity: 0.5;
      pointer-events: none;
      cursor: default;
    }

    .item_currency_amount,
    .item_currency_name {
      position: absolute;
      left: 0;
      right: 0;
      top: 65%;

      text-align: center;
      font-size: 18px;

      overflow: hidden;
      text-overflow: ellipsis;
    }

    .item_currency_name {
      display: none;
    }

    .item.in_drag .item_currency_name {
      display: block;
    }

    .item.in_drag .item_currency_amount {
      display: none;
    }

    .item.unknownItem {
      text-align: center;
    }

    .item img:not(.item_throbber) {
      width: 96px;
    }

    .item.unknownItem img {
      margin-top: 32px;
    }

    .trade_item_box .item,
    .market_dialog_contents .item {
      border: 1px solid #3a3a3a;
      background-color: #292929;
      width: 96px;
      height: 96px;
    }

    html.responsive .trade_item_box.dynamicSizing .item,
    html.responsive .market_dialog_contents.dynamicSizing .item {
      width: auto;
      height: 98%;
      height: calc(100% - 2px);
    }

    html.responsive .trade_item_box.dynamicSizing .slot_inner {
      height: 100%;
    }

    html.responsive .dynamicSizing .item img:not(.item_throbber) {
      width: 100%;
      display: block;
    }

    html.responsive .dynamicSizing .inventory_ctn .inventory_page {
      float: none;
      height: auto;
    }

    html.responsive .dynamicSizing .inventory_ctn {
      width: 100%;
      height: auto;
    }

    .trade_area .item .item_image {}



    a.inventory_item_link {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: block;
      z-index: 2;
    }

    a.inventory_item_link:focus {
      outline: 0 none;
    }


    .trade_item_box {
      background-color: #000000;
      border: 1px solid #2c2c2d;
      padding: 6px 0 0 6px;
    }

    .trade_item_box.dynamicSizing {
      padding: 0;
    }



    /* steam gift styles */

    .item_actions,
    .item_owner_actions {}

    .item_actions .btn_small,
    .item_owner_actions .btn_small {
      margin-right: 12px;
      margin-bottom: 16px;
    }

    a.item_action {
      display: inline-block;
      border: 1px solid #99938d;
      border-radius: 3px;
      -moz-border-radius: 3px;

      color: #e5e2df;

      height: 22px;
      line-height: 22px;

      font-size: 11px;
      padding: 0 19px;

      margin-right: 22px;
      margin-bottom: 13px;
      background-repeat: repeat-x;

      background-color: #5c5957;
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/item_action_btn.png');
      background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAWCAIAAACOpGH9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAClJREFUeNpiyExLZvr//z8G/vcPRP8D0/+A9H8o/e8fMhuhBk0/QIABALdaQAnvsp4ZAAAAAElFTkSuQmCC');
    }

    a.item_action:hover {
      text-decoration: none;
      color: #ffffff;
    }



    .economy_popup_msg {
      position: relative;

      background-color: #5c7e10;
      border-radius: 3px;
      -moz-border-radius: 3px;

      font-size: 11px;
      color: #cccccc;

      padding: 7px 28px 7px 8px;

      margin-bottom: 10px;
    }

    #mainContents .economy_popup_msg {
      margin-right: 17px;
    }

    .economy_popup_msg.trade_welcome_msg {
      font-size: 12px;
      color: #ffffff;
      margin-top: 4px;
      margin-bottom: 4px;
    }

    .economy_popup_msg b {
      color: #abce4e;
      font-weight: normal;
    }

    .welcome_dismiss {
      position: absolute;
      top: 5px;
      right: 5px;
      background-color: #446501;
      width: 18px;
      height: 16px;

      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/economy_welcome_dismiss.png');

      cursor: pointer;
    }






    #hover {
      position: absolute;
      z-index: 200;
    }

    #hover .shadow_content {
      margin: 12px;
    }

    #hover .hover_box {
      background-color: #242424;
    }

    #hover a {
      font-size: 12px;
      color: inherit;
    }

    #trade_hover {
      width: 500px;
    }

    .item_desc_content {
      position: relative;
      padding: 22px 0 22px 218px;
      min-height: 192px;

      background-color: #1d1d1d;
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/trade_hover_background.png');
      background-repeat: no-repeat;
      background-position: center top;

      overflow: hidden;
    }

    .item_desc_descriptors a,
    .item_desc_descriptors a:hover {
      font-size: inherit;
    }

    .item_desc_icon {
      position: absolute;
      left: 8px;
      top: 8px;
      right: 8px;
    }

    .item_desc_icon_center {
      height: 192px;
      display: table-cell;
      vertical-align: middle;
      text-align: center;
    }

    .item_desc_content .item_desc_description {
      color: #b4b4b4;
      font-size: 14px;
      padding-right: 8px;
    }

    .item_desc_content .item_desc_description .descriptor.accessories_desc {
      padding-top: 8px;
    }

    .item_desc_descriptors {
      margin-bottom: 16px;
    }

    .item_market_actions {
      background-color: #181818;
    }

    .hover_item_name {
      font-size: 24px;
      font-weight: normal;
      margin-bottom: 5px;
      font-family: "Motiva Sans", Sans-serif;
      font-weight: 300;
      /* light */

    }

    .hover_item_name_small {
      font-size: 12px;
    }

    .hover_item_name_conversion {
      color: #767676;
    }

    .fraud_warning {
      color: #bd4847;
    }

    .fraud_warning_sub_text {
      color: #767676;
    }

    .fraud_warning .fraud_warning_msg {
      text-align: left;
    }

    .fraud_warning .fraud_warning_msg:not(:last-child) {
      margin-bottom: 9px;
    }

    .item_desc_content .fraud_warning {
      margin-bottom: 9px;
    }

    .item_desc_game_info {
      position: relative;
      padding-left: 36px;
      color: #767676;
      min-height: 32px;
      margin-bottom: 16px;
    }

    .item_desc_game_info .item_desc_game_icon {
      position: absolute;
      left: 0;
      top: 0;
    }

    .item_desc_game_info .item_desc_game_icon>img {
      border-radius: 3px;
    }



    /* inventory paging */


    #inventroy_displaycontrols {
      margin-bottom: 8px;
    }

    #inventory_pagecontrols {
      text-align: center;
      line-height: 22px;
      float: right;
    }

    #inventory_pagecontrols .pagecontrol_element {
      float: right;
    }

    .pagecontrol_element.pagecounts {
      padding: 0 14px;
    }

    .filter_right_controls {
      float: right;
      width: 200px;
    }

    .filter_tag_button_ctn {
      white-space: nowrap;
      padding-top: 4px;
    }

    .filter_ctn.inventory_filters .filter_tag_button_ctn {
      float: left;
      padding-top: 5px;
    }

    .filter_control_ctn {
      position: relative;
      float: left;
    }

    #filter_clear_btn {
      position: absolute;
      right: 4px;
      top: 7px;
      width: 16px;
      height: 16px;
      background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAVdJREFUeNqM009EBGEYx/GZbSwRe4qI/lw6bDZLW4eUKFJEl05Rx9KpxJ4iukWXutQhkTp26hDpkFJERFqW6LpEpxgiou/Lb3j2Nat9+Bzmmfd95n3ed96wVCoFKdGCIvKI8YZq2sDIe+7ANhbQ5r2rYReH+EmSGTNgHK9YTpnsohN7uNeH6goUcIH24P8YxjVabYFT5Mygy5SJN2bp7oNbSYFpbVgS+5jFuskdYworJrfmWo1UwIbbwDMV+kI/yuq7bMa5FkZdgV6vgNuHW63iRLketeCPzWd05n64U+gzz9125224Au9e7hdLOMIQ5nGHSbVko+oKXHnJHe3BhJZ9jlU8epv4jYdIBZ4xqBcbOq5NZJU7QBcWvdOKQ92Fgv6wXNBcvGDErSL5kSqYw2cTk58woxbq7oLbqAH9NHHKxJp+rjF8JMmwwXXOqq2iilUaXec/AQYATLo/RECYZloAAAAASUVORK5CYII= );

      background-repeat: no-repeat;
      z-index: 12;
      cursor: pointer;
    }

    #filter_control {
      width: 200px;
    }

    .filter_ctn.inventory_filters #filter_control {
      width: 416px;
      border-radius: 3px;
      border: 1px solid rgba(0, 0, 0, 0.3);
      box-shadow: 1px 1px 0px rgba(255, 255, 255, 0.2);
      padding-bottom: 1px;
      background-color: rgba(0, 0, 0, 0.2);
    }

    .filter_ctn {
      margin-bottom: 12px;
    }

    input.filter_search_box {
      padding: 4px 4px;
      color: #828282;
      font-size: 12px;
      outline: none;
      border: 1px solid;
      border-color: #292929;
      background-color: #101010;
      font-family: "Motiva Sans", Sans-serif;
      font-weight: 300;
      /* light */

      border-radius: 0px;
    }

    input.filter_search_box::-webkit-input-placeholder {
      color: #555555;
      font-style: italic;
    }

    input.filter_search_box:-moz-placeholder {
      color: #555555;
      font-style: italic;
    }

    .filter_tag_options {
      border: 1px solid #292929;
      padding: 12px;
      padding-bottom: 0;
    }

    .filter_tag_show {
      line-height: 32px
    }

    .filter_tag_container {}

    #filter_control.filtered,
    #inventories.filtered,
    .filter_tag_options.filtered {
      border: 1px solid #4d729a;
    }

    .filter_tag_options.filter_collapsed {
      display: none;
    }

    .econ_tag_count {
      font-size: 71.4%;
    }

    .econ_tag_filter_collapsable_tags_showlink {
      padding-left: 8px;
      line-height: 19px;
    }


    /* Steam gift styles */
    .item_desc_content.app753.context1 .item_desc_descriptors {
      color: #767676;
      font-size: 12px;
    }

    .not_tradable_msg {
      font-size: 14px;
      color: #B4B4B4;
      margin-bottom: 3px;
    }

    .not_tradable_note {
      font-size: 11px;
    }

    .not_tradable_note a,
    .not_tradable_note a:visited {
      color: #767676;
      text-decoration: underline;
    }

    .not_tradable_note a:hover {
      color: #ffffff;
    }

    .inventory_iteminfo {
      border: 2px solid #3A3A3A;
    }

    .inventory_iteminfo .item_desc_content {
      padding: 238px 11px 11px 11px;
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/inventory_hover_background.png')
    }

    /* Overrides for launcher specific trade UI */
    body.compact_trading_ui .item_desc_content {
      padding: 11px;
      background-image: none;
    }

    body.compact_trading_ui .item_desc_icon {
      display: none;
    }

    body.compact_trading_ui .appselect {
      display: none;
    }

    #iteminfo0,
    #iteminfo1 {
      width: 346px;
      top: 0px;
      left: 0px;
    }

    #iteminfo0 .item_desc_content,
    #iteminfo1 .item_desc_content {
      min-height: 207px;
      /* this + computed height of .item_market_actions should equal 261 */
    }

    @media screen and (max-height: 639px) {

      .economy_item_popup #iteminfo0 .item_desc_content,
      .economy_item_popup #iteminfo1 .item_desc_content {
        min-height: 0;
      }
    }

    .item_market_actions {
      padding: 11px;
      min-height: 32px;
    }

    #iteminfo_clienthover {
      width: 350px;
    }

    .economy_item_popup #iteminfo_clienthover {
      width: auto;
    }

    .hover_arrow_left,
    .hover_arrow_right {
      position: absolute;
      top: 48px;

      border-top: 15px solid transparent;
      border-bottom: 15px solid transparent;
      width: 0;
      height: 0;
    }

    .hover_arrow_left {
      border-right: 14px solid #3A3A3A;
      left: 0;
    }

    .hover_arrow_right {
      border-left: 14px solid #3A3A3A;
      right: 0;
    }

    .hover_arrow_inner {
      position: absolute;
      top: -12px;
      background-repeat: no-repeat;
      width: 13px;
      height: 25px;
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/item_hover_arrow.png');
    }

    .hover_arrow_left .hover_arrow_inner {
      left: 2px;
      background-position: left top;
    }

    .hover_arrow_right .hover_arrow_inner {
      right: 2px;
      background-position: right top;
    }

    #market_buynow_dialog_contents {
      min-width: 800px;
    }

    #market_buynow_dialog_paymentinfo_bottomactions {
      margin-top: 20px;
    }

    .market_dialog_topwarning {
      border: 1px solid #4C4C4C;
      color: white;

      padding: 12px;
      margin-bottom: 14px;
    }

    .market_dialog_topinfo {
      color: white;
      padding: 12px 0;
    }

    .market_dialog_topinfo a {
      text-decoration: underline;
    }

    .market_dialog_contents {
      border: 1px solid #4C4C4C;
      padding: 25px;
    }

    #market_sell_dialog_background {
      position: absolute;
      z-index: -1;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;

      background-image: radial-gradient(90px 110px, circle closest-corner, #333, #1D1D1D);
      background-image: -moz-radial-gradient(90px 110px, circle closest-corner, #333, #1D1D1D);
      background-image: -webkit-radial-gradient(90px 110px, circle closest-corner, #333, #1D1D1D);
    }

    .market_dialog_title_cancel {
      float: right;
      font-size: 12px;
      cursor: pointer;
    }

    .market_dialog_title_cancel_X {
      position: relative;
      top: -1px;

      margin-left: 10px;
      color: #C4C4C4;
      font-size: 14pt;
      font-weight: bold;

      vertical-align: middle;
    }

    a.market_dialog_title_cancel:hover {
      text-decoration: none;
      color: #ffffff;
    }

    a.market_dialog_title_cancel:hover .market_dialog_title_cancel_X {
      text-decoration: none;
      color: #ffffff;
    }

    .market_dialog_content {
      padding: 11px 0px 11px 0px;
    }

    .market_sell_dialog_input_area {
      position: relative;
      text-align: center;
    }

    #market_sell_dialog_input_boxes {}

    .market_sell_dialog_input_group {
      white-space: nowrap;
    }

    .market_sell_dialog_input_multiline {
      display: inline-block;
      text-align: left;
      vertical-align: top;
    }

    #market_sell_dialog_error {
      margin-top: 12px;
    }

    .market_dialog_content_dark {
      background: #262626;
    }

    .market_dialog_content_darker {
      background: #1D1D1D;
    }

    .market_dialog_content_spacer {
      height: 13px;
    }

    .market_dialog_content_separator {
      height: 1px;
      background: #1D1D1D;
      border-bottom: 1px solid #3B3B3B;
    }

    .market_modal_dialog .market_listing_table {
      border: none;
      padding: 0;
    }

    .market_sell_dialog_field_label {
      color: #FFFFFF;
    }

    .market_input_spacer {
      display: inline-block;
      width: 50px;
    }

    input.market_dialog_input {
      top: 0;
      height: 1.5em;
    }

    input.market_dialog_input:focus {
      border-color: #85BC3C;
    }

    @media screen and (max-width: 910px) {
      html.responsive input.market_dialog_input {
        /* so iOS doesn't zoom */
        font-size: 16px;
      }

      html.responsive #market_sell_dialog_confirm_buttons .market_dialog_bottom_buttons {
        margin-top: 16px;
        margin-bottom: 16px;
      }

      html.responsive #marker_sell_dialog_terms {
        line-height: 16px;
      }

      html.responsive #marker_sell_dialog_terms input[type=checkbox] {
        float: left;
        margin: 0 6px 0 0;
      }

      html.responsive #marker_sell_dialog_terms label {
        overflow: hidden;
        display: block;
      }

      html.responsive .economy_item_hoverable {
        cursor: pointer;
      }

    }

    html.responsive.touch input.market_dialog_input {
      /* so iOS doesn't zoom */
      font-size: 16px;
    }

    html.responsive.touch #market_sell_dialog_confirm_buttons .market_dialog_bottom_buttons {
      margin-top: 16px;
      margin-bottom: 16px;
    }

    html.responsive.touch #marker_sell_dialog_terms {
      line-height: 16px;
    }

    html.responsive.touch #marker_sell_dialog_terms input[type=checkbox] {
      float: left;
      margin: 0 6px 0 0;
    }

    html.responsive.touch #marker_sell_dialog_terms label {
      overflow: hidden;
      display: block;
    }

    html.responsive.touch .economy_item_hoverable {
      cursor: pointer;
    }

    .market_dialog_bottom_buttons {
      margin-top: 33px;
    }

    .market_dialog_bottom_buttons>a {
      float: right;
      margin: 0 0 10px 10px;
      min-width: 100px;
      text-align: center;
    }

    #market_sell_quantity_input {
      padding: 0 0.5em;
      width: 3em;
    }

    #market_sell_quantity_available {
      color: #898989;
    }

    #market_sell_currency_input,
    #market_sell_buyercurrency_input {
      margin-bottom: 4px;
      padding: 0 0.5em;
      width: 7em;
    }

    #market_price_includesfees {
      display: inline-block;
      vertical-align: text-top;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    #market_sell_dialog_confirm_buttons .market_dialog_bottom_buttons {
      position: relative;
      min-height: 32px;
    }

    #market_sell_dialog_buyback_details_wrapper {
      float: left;
      margin-top: 8px;
    }

    #market_sell_dialog_buyback {
      margin-bottom: -2px;
      color: #799905;
    }

    #market_sell_dialog_buyback input[type=text] {
      color: #799905;
      border-color: #799905;
      padding-left: 2px;
    }

    .market_item_action_buyback_at_price {
      color: #799905;
      margin-bottom: 12px;
    }

    #market_buyback_warning {
      color: #799905;
      border-color: #799905;
      border-style: solid;
      border-width: 1px;
      padding: 20px;
      text-align: center;
      width: calc(100% - 40px);
    }

    #market_buyback_warning a {}

    #market_sell_buyback_until {
      color: #8f98a0;
      text-align: left;
      padding-top: 10px;
      clear: both;
    }

    #market_sell_dialog_accept,
    #market_sell_dialog_buyback_buttons {
      float: right;
      margin: 0.4em 0 0 1em;
      white-space: nowrap;
      overflow: hidden;
    }

    #market_sell_dialog_declinebuyback {
      padding-right: 4px;
    }

    #market_sell_dialog_buyback_buttons {
      padding-top: 4px;
    }

    #market_sell_dialog_buyback {
      width: 650px;
    }

    #market_sell_buyback_details b {
      color: #ffffff;
    }

    #market_sell_dialog_throbber {
      position: absolute;
      bottom: -2px;
      right: 34px;
    }

    #marker_sell_dialog_terms {
      float: left;
      text-align: left;
    }

    #market_sell_quantity_available {
      margin-right: 26px;
    }

    #market_removelisting_dialog_accept {
      margin: 0 0.5em 0.5em 0;
    }

    .item_market_action_button {
      display: inline-block;
      font-size: 12px;
    }

    .item_market_action_button_left {
      background-position: left top;
    }

    .item_market_action_button_contents {
      float: left;
      height: 24px;
      line-height: 24px;
      padding: 0 4px;
      min-width: 53px;
      text-align: center;
      background-repeat: repeat-x;
      background-position: left bottom;
    }

    a.item_market_action_button {
      text-decoration: none
    }

    .item_market_action_button_right {
      background-position: right center;
    }

    .item_market_action_button_edge {
      float: left;
      width: 3px;
      height: 24px;
    }

    .item_market_action_button_blue>span {
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/btn_blue_small.png');
    }

    .item_market_action_button_blue:hover>span,
    .item_market_action_button_blue .item_market_action_button_preload {
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/btn_blue_small_hover.png');
    }

    .item_market_action_button_green>span {
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/btn_green_small.png');
    }

    .item_market_action_button_green:hover>span,
    .item_market_action_button_green .item_market_action_button_preload {
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/btn_green_small_hover.png');
    }

    .item_market_action_button_edit>span {
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/transparentpixel.png');
    }

    .item_market_action_button_edit:hover>span,
    .item_market_action_button_edit .item_market_action_button_preload {
      background-color: #2B475E;
    }

    .item_market_action_button_edit {
      height: 30px;
      line-height: 30px;
    }

    .item_market_action_button_edit .item_market_action_button_contents {
      height: 30px;
      line-height: 30px;
    }

    .item_market_action_button_edit .item_market_action_button_edge {
      width: 5px;
      height: 30px;
    }

    .game_button {
      display: inline-block;
      font-size: 12px;
      height: 34px;
      line-height: 34px;
      margin-top: 10px;
    }

    .game_button_left {
      background-position: left top;
    }

    .game_button_contents {
      float: left;
      height: 34px;
      line-height: 34px;
      width: 237px;
      background-repeat: repeat-x;
      background-position: left bottom;
      position: relative;
    }

    .game_button_game_icon>img {
      position: absolute;
      left: 3px;
      top: 3px;

      width: 32px;
      height: 32px;
      overflow: hidden;
    }

    .game_button_game_name {
      display: inline-block;
      padding-left: 42px;

      max-width: 195px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    a.game_button {
      text-decoration: none
    }

    .game_button_right {
      background-position: right center;
    }

    .game_button_edge {
      float: left;
      width: 3px;
      height: 34px;
    }

    .game_button>span {
      background: rgba(0, 0, 0, 0) linear-gradient(to bottom, rgba(49, 54, 58, 1), rgba(43, 46, 52, 1)) repeat scroll 0 0;
      border: 1px solid transparent;
      border-image: linear-gradient(to bottom, #3a4043 0%, #25282d 100%);
      border-image-slice: 1;
      padding: 2px;
    }

    .game_button:hover>span,
    .game_button .game_button_preload {
      background: #2b475e;
    }

    .market_dialog_iteminfo .item_desc_game_info .item_desc_game_icon {
      position: inherit;
      float: left;
      margin-right: 0.525em;
    }

    .market_headertip_container {
      padding: 20px 20px;
      background-color: #292929;
    }

    .market_headertip_container:nth-child(3) {
      padding-top: 0px;
    }

    .market_headertip_container_warning {
      background-color: #2B2E34;
      margin-top: 20px;
      border: 1px solid #632929;
    }

    .market_headertip {
      padding: 5px;
      border: 1px solid #AEAEAE;
      color: white;
    }

    .market_restrictions img {
      float: left;
      margin-right: 5px;

      width: 38px;
      height: 38px;
    }

    .market_headertip_text {
      padding-top: 4px;
    }

    #market_headertip_itemsold_itemname {
      font-weight: bold;
    }

    .market_hover_tip {
      background-color: #3F3F3F;
      color: #D6D6D6;
      position: absolute;
      z-index: 100;
      border: 1px solid #747474;

      width: 288px;
      padding: 12px;

      box-shadow: 4px 4px 3px black;
      -moz-box-shadow: 4px 4px 3px black;
      -webkit-box-shadow: 4px 4px 5px black;
    }

    #market_timecanuse {
      color: #84BD3A;
    }

    .jqplot-highlighter-tooltip {
      background: #303030;
      border-radius: 2px;
      box-shadow: 2px 2px 10px #000000;
      color: white;
      padding: 5px;
    }

    .jqplot-highlighter-tooltip:after {
      top: 100%;
      left: 50%;
      border: solid transparent;
      content: " ";
      height: 0;
      width: 0;
      position: absolute;
      pointer-events: none;
      border-color: rgba(48, 48, 48, 0);
      border-top-color: #303030;
      border-width: 10px;
      margin-left: -10px;
    }

    .jqplot-yaxis {
      text-align: right;
      right: 0 !important;
      width: 60px !important;
    }

    .jqplot-yaxis-tick {
      min-width: 92%;
    }

    .jqplot-xaxis {
      overflow: hidden;
    }

    .priceHistoryTime {
      display: none;
    }

    .jqplot-highlighter-tooltip .priceHistoryTime {
      display: inline;
    }

    .zoom_controls .zoomopt {
      display: inline-block;
      padding: 0 5px;
    }

    .pricehistory_zoom_controls {
      float: right;
      margin-right: 45px;
    }

    .pricehistory_notavailable_info {
      height: 50px;
      padding: 50px 0;
      font-size: 200%;
      text-align: center;
    }

    .tradeoffer .btn_report {
      margin-top: -8px;
      float: right;
    }

    .trade_scam_report_label {
      margin-bottom: 4px;
    }

    .slot_app_fraudwarning {
      position: absolute;
      left: 1px;
      top: 1px;
      width: 16px;
      height: 16px;

      background-image: url('https://community.cloudflare.steamstatic.com/public/images/sharedfiles/icons/icon_warning.png');
      background-position: 0px 0px;
      background-repeat: no-repeat;
    }

    .fraud_warning_image {
      padding-right: 5px;
    }

    .fraud_warning_box {
      border: 1px solid #393939;
      padding: 5px;
      background-color: #1d1d1d;
    }


    #goo_exchange_dialog {
      position: absolute;
      background: #383635 bottom no-repeat url('https://community.cloudflare.steamstatic.com/public/images/economy/trade_currency_dialog.png?v=3');
      border: 1px solid black;
      width: 436px;
      height: 318px;
      z-index: 1000;

      font-size: 18px;
      color: #ffffff;
      font-weight: bold;
      text-align: center;
    }

    .goo_exchange_dialog_corner {
      position: absolute;
      right: -1px;
      bottom: -1px;
      background: right bottom no-repeat url('https://community.cloudflare.steamstatic.com/public/images/economy/trade_currency_dialog_corner.png?v=1');
      width: 174px;
      height: 153px;
    }

    .goo_exchange_dialog_title {
      position: absolute;
      top: 27px;
      left: 0;
      width: 434px;
    }

    .goo_exchange_dialog_info {
      position: absolute;
      top: 42px;
      left: 0;
      width: 418px;

      padding: 0 8px;
      font-size: 12px;
      font-weight: normal;
      color: #767676;
    }

    .goo_exchange_dialog_input_area {
      background: no-repeat url('https://community.cloudflare.steamstatic.com/public/images/economy/trade_currency_entry_background.png?v=1');
      width: 136px;
      height: 54px;
      padding-left: 54px;
      text-align: left;
    }

    #goo_exchange_dialog_input_area {
      position: absolute;
      left: 123px;
      top: 69px;
    }

    #goo_exchange_dialog_input_icon_area {
      position: absolute;
      left: 4px;
      top: 6px;
      width: 42px;
      height: 42px;
    }

    .goo_exchange_dialog_input_area input {
      background-color: transparent;
      border: none;
      font-size: 24px;
      font-weight: bold;
      padding: 2px 0 0;
      margin: 0;
      line-height: 44px;
      height: 44px;
      width: 130px;
      outline: none;
    }

    .goo_exchange_dialog_error {
      width: 434px;
      line-height: 32px;
      color: #ff0000;
      font-weight: normal;
      font-size: 14px;
    }

    #goo_exchange_dialog_error {
      position: absolute;
      top: 118px;
      left: 0;
    }

    #goo_exchange_dialog_remaining {
      position: absolute;
      top: 227px;
      left: 0;

      width: 434px;
      line-height: 42px;
    }

    #goo_exchange_dialog_remaining img {
      vertical-align: middle;
    }

    .goo_exchange_dialog_footer {
      position: absolute;
      bottom: 0;
      left: 9px;

      width: 416px;
      text-align: right;
    }

    .goo_exchange_dialog_footer a.item_action {
      margin-right: 0;
      margin-left: 5px;
      text-align: left;
      padding: 0 5px;
      width: 82px;
    }

    .goo_exchange_slider_ctn {
      padding-top: 20px;
      width: 381px;
    }

    #goo_exchange_slider_ctn {
      position: absolute;
      top: 146px;
      left: 28px;
    }

    .trade_wallet #goo_exchange_slider_ctn {
      top: 216px;
    }

    .goo_exchange_slider_count {
      position: absolute;
      top: 0;
      height: 20px;
      line-height: 20px;
      color: #b7b7b7;

      font-size: 15px;
      font-weight: bold;
      text-align: center;

      width: 104px;
    }

    .goo_exchange_slider_ctn .slider {
      position: relative;
      height: 42px;
    }

    .goo_exchange_slider_ctn .slider_background,
    .goo_exchange_slider_ctn .slider_progress {
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/slider_background.png');
      background-position: left top;
      background-repeat: no-repeat;
      position: absolute;
      left: 12px;
      top: 20px;

      height: 9px;
      width: 357px;
    }

    .goo_exchange_slider_ctn .slider_progress {
      background-position: -357px 0;
    }

    .goo_exchange_slider_ctn .slider .handle {
      position: absolute;
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/slider_handle.png');
      background-position: left top;
      background-repeat: no-repeat;
      width: 24px;
      height: 35px;
      top: 5px;
    }

    .goo_exchange_slider_ctn .slider .handle.active {
      background-position: right;
    }


    .economy_item_popup {
      position: relative;
      height: 96%;
      height: calc(100% - 16px);
      max-width: 346px;
      margin: 0 auto;
    }

    .economy_item_popup_dismiss {
      position: absolute;
      right: -12px;
      top: -15px;
      height: 30px;
      width: 30px;
      border: 3px solid #cccccc;
      color: #cccccc;
      text-align: center;
      line-height: 30px;
      background: #000000;
      border-radius: 20px;
      font-size: 20px;

      cursor: pointer;
    }

    .economy_item_popup_only {
      display: none;
    }

    .economy_item_popup .economy_item_popup_only {
      display: block;
    }

    html.responsive .newmodal.economy_modal_ctn {
      overflow: visible;
    }

    .item_desc_addtotrade_ctn {}

    .item_desc_addtotrade,
    .item_desc_addtotrade>span {
      display: block;
      width: auto;
    }

    .item_desc_addtotrade>span {
      line-height: 40px;
      text-align: center;
      font-size: 20px;
    }

    .economy_item_popup #iteminfo0,
    .economy_item_popup #iteminfo1 {
      max-width: 95%;
      max-width: calc(100% - 4px);
    }

    .escrow_explanation {
      max-width: 600px;
      font-size: 14px;
    }

    .escrow_explanation_q {
      color: #5aa9d6;
      padding-bottom: 10px;
      font-size: 16px;
    }

    .escrow_explanation_a {
      padding-bottom: 30px;
    }

    .escrow_explanation_a a {
      text-decoration: underline;
    }

    @media screen and (max-width: 650px) {
      html.responsive .market_sell_dialog_input_area {
        text-align: left;
      }
    }

    .sendgift_area {
      max-width: 380px;
      margin: 0 auto;
      text-align: center;
    }

    .sendgift_item {
      max-width: 354px;
      margin: 24px auto;
      padding: 0 10px;
      text-align: left;
    }

    .sendgift_area h2 {
      font-size: 32px;
    }

    .sendgift_recipient {
      line-height: 32px;
      font-size: 18px;
      display: inline-block;
    }

    .sendgift_recipient>* {
      vertical-align: middle;
    }

    .sendgift_recipient .playerAvatar {
      display: inline-block;
      margin-right: 8px;
    }

    .sendgift_description {
      text-align: center;
      font-size: 24px;
    }

    .sendgift_actions {
      margin-top: 12px;
    }

    .inventory_loading_indicator {
      opacity: 0;
      transition: opacity 0.5s;
    }

    body.inventory_loading .inventory_loading_indicator {
      opacity: 1.0;
    }

    .app_tags_container .inventory_loading_indicator {
      text-align: center;
      padding: 40px 0;
    }


    .inventory_load_error {
      margin: 12px;
      padding: 12px;
      background-color: #2B2E34;
      margin-top: 20px;
      border: 1px solid #632929;
    }

    .inventory_load_error_header {
      display: flex;
      align-items: center;
    }

    .inventory_load_error_header .message {
      padding: 0 8px;
    }


    @media screen and (max-width: 910px) {

      html.responsive .inventory_load_error_header {
        flex-wrap: wrap;
      }

      html.responsive .inventory_load_error_header .message {
        flex: 1;
        min-width: 75%;
      }
    }

    .pagecontent {
      width: 936px;
    }

    body.tutorial_mode .pagecontent {
      width: 932px;
    }

    #mainContent {
      margin-top: 6px;
      min-height: 24px;
      /* Firefox likes to take the footer margin and put it at the top of the page because of our floats and clear:both. This prevents that from having an effect. */
    }

    .nickname_block {
      color: #828282;
    }

    .trade_box {
      position: relative;
      background-color: #1d1d1d;
      width: 458px;
    }

    .trade_box_contents {
      padding: 19px 16px;
      border: 1px solid #494949;
    }

    .trade_box.trade_box_withbg>.trade_box_contents {
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/trade_tradebox_headerbg.png');
      background-position: -1px 0;
      background-repeat: no-repeat;
      /*border-top: 1px solid #000000;*/
      -moz-border-radius-topleft: 3px;
      -moz-border-radius-topright: 3px;
      border-top-left-radius: 3px;
      border-top-right-radius: 3px;
    }

    .trade_box_bgheader {
      position: absolute;
      top: 1px;
      left: 1px;
      right: 1px;
      height: 34px;

      background: -webkit-linear-gradient(top, #4E4E4E 5%, #1D1D1D 95%);
      background: linear-gradient(to bottom, #4E4E4E 5%, #1D1D1D 95%);
    }

    .trade_box_bgheader.active {
      background: -webkit-linear-gradient(top, #34445D 5%, #1D1D1D 95%);
      background: linear-gradient(to bottom, #34445D 5%, #1D1D1D 95%);
    }

    .trade_box#inventory_box.ready>.trade_box_contents {
      background-image: none;
      border-top: 1px solid #333333;
      -moz-border-radius-topleft: 0;
      -moz-border-radius-topright: 0;
      border-top-left-radius: 0;
      border-top-right-radius: 0;
    }

    .item_description_hover {
      text-align: center;
      font-size: 16px;
    }

    .econ_tag_filter_category {
      float: left;
      margin-right: 18px;
      margin-bottom: 12px;
    }

    .econ_tag_filter_category_label {
      font-size: 14px;
    }

    .filter_tag_options.filter_expanded {
      display: block;
    }

    .trade_escrow_header {
      background-color: #a6801b;
      padding: 12px;
      margin-bottom: 10px;
      font-size: 14px;
      line-height: 20px;
      color: #ffffff;
    }

    .trade_escrow_header .trade_hold_time {
      font-size: 20px;
      font-weight: bold;
      padding-bottom: 5px;
    }

    .trade_escrow_header a {
      text-decoration: underline;
    }

    #trade_escrow_notice_near_button {
      background-color: #a6801b;
      padding: 5px;
      margin-bottom: 15px;
      font-size: 14px;
      line-height: 20px;
      color: #ffffff;
    }

    /* trade partner header */
    .trade_partner_header {
      background-color: #324056;
      padding: 12px;
      margin-bottom: 10px;
      font-size: 13px;
    }

    .trade_partner_headline {
      color: #63b7e7;
      font-size: 18px;
      padding-bottom: 5px;
    }

    .trade_partner_headline_sub {
      color: white;
    }

    .trade_partner_recently_changed_name {
      color: #bf6160;
      font-size: 13px;
    }

    .trade_partner_info_block {
      color: #63b7e7;
      background-color: rgba(0, 0, 0, 0.25);
      float: left;
      padding: 5px;
      margin-right: 5px;
      margin-bottom: 10px;
      min-height: 35px;
    }

    .trade_partner_inline_hack {
      display: inline-block;
    }

    .trade_partner_info_text {
      white-space: nowrap;
    }

    .trade_partner_info_block.limited {
      position: relative;
      right: 0px;
      margin-right: 0px;
    }

    .trade_partner_info_block.group {
      margin-top: 5px;
      position: relative;
      width: 898px;
    }

    .trade_partner_limited {
      color: #d5d476;
    }

    .trade_partner_limited_desc {
      min-width: 400px;
    }

    .trade_partner_icon {
      float: left;
      margin-right: 5px;
      padding-top: 3px;
      padding-bottom: 5px;
      height: 25px;
    }

    .trade_partner_icon.years_of_service {
      padding-top: 5px;
      margin-right: 10px;
    }

    .trade_partner_icon.group {
      padding-top: 5px;
    }

    .trade_partner_icon img {
      height: 25px;
    }

    .trade_partner_not_friends_for_long {
      color: #bf6160;
    }

    .trade_partner_not_friends {
      color: #bf6160;
    }

    .trade_partner_steam_level {
      padding-top: 2px;
      float: left;
      margin-right: 10px;
    }

    .trade_partner_member_since {
      min-width: 400px;
    }

    .trade_partner_member_since.warning {
      color: #d5d476;
    }

    /* other */

    .trade_area {}

    .trade_area .trade_left {
      width: 458px;
      float: left;
    }

    .trade_area .trade_right {
      float: right;
    }

    .trade_box#inventory_box>.trade_box_contents {
      margin-bottom: 20px;
      position: relative;
    }

    #inventories {
      position: relative;
      margin-bottom: 8px;
      height: 416px;
      width: 416px;
    }

    #inventory_box.ready .inventory_disabled {
      display: block;
    }

    #trade_yours.ready .inventory_disabled {
      display: block;
    }

    #inventories #dropmsg,
    .inventory_disabled {
      position: absolute;
      display: none;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/transparentbg.png');
      z-index: 10;
    }

    .inventorymsg_content {
      font-size: 20px;
      text-align: center;
      padding: 116px 40px 0;
    }

    #inventories.readyForDrop #dropmsg {
      display: block;
    }

    #trade_inventory_unavailable {
      font-size: 24px;
      text-align: center;
      background-color: #000000;
    }

    #trade_inventory_message_not_allowed_alerts {
      font-size: 16px;
    }

    #pagebtn_next,
    #pagebtn_previous {
      line-height: 20px;
    }

    .trade_area .inventory_ctn {
      position: relative;
      width: 416px;
      height: 416px;
    }

    .trade_area .inventory_ctn .inventory_page {
      float: left;
      width: 416px;
      height: 416px;
    }

    .trade_box.ready>.trade_box_contents {
      border-color: #333333;
    }

    .trade_offer.ready .itemHolder {
      background-position: 0 -98px;
    }

    .trade_area .item.hover {
      background-position: -1px -197px;
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/trade_itemholder.png');
      background-repeat: no-repeat;
    }


    #your_slots .item a.inventory_item_link,
    #inventories .item a.inventory_item_link {
      cursor: pointer;
      cursor: grab;
      cursor: -moz-grab;
    }

    .trade_offer.ready #your_slots .item a.inventory_item_link,
    .trade_offer.ready #their_slots .item a.inventory_item_link {
      cursor: default;
    }

    .trade_offer.readyForDrop .itemHolder.nextTarget {
      background-position: 0 -294px;
    }

    h2 {
      font-family: "Motiva Sans", Sans-serif;
      font-weight: 200;
      /* thin */

    }

    .offerheader {
      margin-bottom: 12px;
      color: #595959;
    }

    .offerheader h2 {
      margin-bottom: 0;
      word-wrap: break-word;
    }

    .offerheader .offericon {
      float: left;
      margin-right: 12px;
    }

    .trade_area .your_items,
    .trade_area .their_items {
      margin-bottom: 20px;
    }

    .your_items .trade_item_box,
    .their_items .trade_item_box {
      position: relative;
      margin-bottom: 12px;
    }

    .slot_applogo {
      position: absolute;
      z-index: 20;
      right: 1px;
      bottom: 1px;
      width: 16px;
      height: 16px;
      pointer-events: none;
      /* click/hover go through to item */
    }

    .slot_applogo_img {
      width: 16px;
      height: 16px;
    }

    .slot_actionmenu_button {
      position: absolute;
      z-index: 21;
      right: 1px;
      bottom: 1px;
      width: 16px;
      height: 16px;

      background-image: url('https://community.cloudflare.steamstatic.com/public/images/skin_1/info_btn.png');
      background-position: left top;
      background-repeat: no-repeat;
    }

    .slot_actionmenu_button:hover {
      background-position: left bottom;
    }

    .slot_actionmenu_button {
      display: none;
    }

    .itemHolder:hover .slot_applogo {
      display: none;
    }

    .itemHolder:not(.in_touch):hover .slot_actionmenu_button {
      display: block;
    }

    .readystate {
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/trade_readystates.png');
      background-repeat: no-repeat;
      width: 424px;
      height: 28px;
      line-height: 26px;
      font-size: 14px;
      max-width: 100%;
    }

    .readystate.short {
      display: inline-block;
      width: 226px;
      border-top-right-radius: 3px;
      border-bottom-right-radius: 3px;
      margin-bottom: 8px;
    }

    #modify_trade_offer_opts {
      display: inline-block;
      vertical-align: top;
    }

    .modify_trade_offer_or {
      display: inline-block;
      line-height: 28px;
      width: 48px;
      text-align: center;
    }

    .readystate.modify_trade_offer {
      display: inline-block;
      border-radius: 3px;
      background-position: -32px 0;
      width: 136px;
      cursor: pointer;
      vertical-align: middle;
    }

    .readystate.modify_trade_offer.disabled {
      opacity: 0.4;
      cursor: default;
    }

    .readystate.modify_trade_offer .content {
      text-align: center;
      color: #bbbbbb;
    }

    .readystate .content {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .readystate#them_notready .content,
    .readystate#them_ready .content,
    .readystate#you_cantready .content {
      padding-left: 12px;
    }

    .readystate#you_notready .content,
    .readystate#you_ready .content {
      padding-left: 34px;
    }

    .readystate#you_notready {
      background-position: 0 0;
      color: #bbbbbb;
      cursor: pointer;
    }

    .readystate#you_ready {
      background-position: 0 -28px;
      color: #ffffff;
      cursor: pointer;
    }

    .readystate#them_notready,
    .readystate#you_cantready {
      background-position: 0 -56px;
      color: #7f7f7f;
    }

    .readystate#them_ready {
      background-position: 0 -84px;
      color: #ffffff;
    }

    #notready_tradechanged_message {
      color: #bd4847;
    }

    #trade_theirs {
      position: relative;
    }

    #trade_theirs_timeout {
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      background-color: rgba(29, 29, 29, 0.7);
      z-index: 100;
      text-align: center;

      padding-top: 120px;
    }

    #trade_theirs_timeout h2 {
      margin-top: 10px;
    }




    /* app/context selecting dropdown */

    div.appselect {
      height: 40px;

      border: 1px solid #707070;
      position: relative;

      cursor: default;

      margin-bottom: 22px;
    }

    div.appselect_options,
    div.appselect {
      width: 414px;
      line-height: 40px;
      color: #8a8a8a;
      font-size: 12px;
      background-color: #000000;
      border-left: 1px solid #707070;
      border-right: 1px solid #707070;
    }

    div.appselect #appselect_arrow {
      position: absolute;
      right: 0;
      top: 0;
      width: 17px;
      height: 40px;
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/trade_appselect_arrow.png');
      background-repeat: no-repeat;
      background-position: top center;
    }

    div.appselect.focus #appselect_arrow {
      background-position: bottom;
    }

    div.appselect div.option,
    div.appselect_options div.option {
      padding: 4px;
      height: 32px;
      line-height: 32px;
      cursor: pointer;

      white-space: nowrap;
    }

    div.appselect_options div.option {
      border-bottom: 1px solid #707070;
    }

    div.appselect_options div.option.has_submenu {
      background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAICAYAAADeM14FAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAADdJREFUeNpiOHr40H8gYIBhJgYgOHbk8H8GKGCCMWCCcAGYIIoAhgorG1tGJmQOXAWMAwIAAQYA3yQYT7cmV9YAAAAASUVORK5CYII= );
      background-repeat: no-repeat;
      background-position: 98% 50%;
    }

    .appselect_flyout.popup_block .popup_body {
      border-bottom: none;
      min-width: 240px;
    }

    .popup_block .appselect_options.popup_body {
      border-bottom: none;
    }

    div.appselect_options div.option:hover {}

    div.appselect div.option img,
    div.appselect_options div.option img {
      vertical-align: middle;
    }

    .trade_box.log>.trade_box_contents {
      padding: 0;
      width: 454px;

    }

    div.log_bg {
      background-color: #141414;
      background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAC0CAIAAAAM1Qt9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAMNJREFUeNrs2kEOwjAQQ9FJlOuAuP/hOsCatSUGXg9gVfb/SRddj/utMs+pWqnotVLRu2LPq5CORY8sJDfjiVX97roGvnWs6iQhQ+G7rh5YyN6xQronFlITlTk9Er6RN3p0xonKiP6YMfjN17qeP2P0AkMI0c1IdIQQXTTREYIQM5rRjPMLQQhCEIIQhCAEIWYkOkKIbkYzzp8RIQj5RULMSHSEEN2MzhBnCELM+AeE+JOZ6EQnuq6JTnSi6/o7op8CDAAicmEvDizxNAAAAABJRU5ErkJggg==');
      background-repeat: repeat-x;
      background-position: top center;
      padding: 3px;

    }

    #log {
      height: 160px;
      overflow: auto;
      overflow-x: hidden;
      overflow-y: auto;
      padding: 11px;
      word-wrap: break-word;
    }

    .tradeoffer_log_ctn #log {
      height: auto;
      max-height: 160px;
      padding: 0;
      margin-bottom: 12px;
    }

    #log .logevent {
      color: #989797;
      font-size: 13px;
      line-height: 18px;
    }

    #log .logevent .item {
      font-weight: normal;
      color: #c6c6c6;
    }

    #log .logevent .timestamp {
      font-weight: normal;
      color: #595959;
      font-size: 11px;
    }

    #log .logevent .warning {
      color: #ff0000;
    }

    .playerchatname {
      color: #8bb9e0;
    }

    .log_chat_entry_area {
      background-color: #363636;
      padding: 8px 6px;
      border-top: 1px solid #2d2b2a;
    }

    table.chat_entry_table {
      width: 100%;
      border-collapse: collapse;
      border-spacing: 0;
    }

    td.chat_entry_cell {
      width: 99%;
      padding-right: 8px;
    }

    td.chat_entry_cell div {
      border: 1px solid #4d4b48;
      background-color: #1d1d1d;
      border-radius: 3px;
      -moz-border-radius: 3px;
      padding: 2px 6px 2px 2px;
      height: 36px;
    }

    .log_chat_entry_area textarea {
      background-color: #1d1d1d;
      border-color: #4d4b48;
      color: #909090;
      resize: none;
      outline: none;
      height: 34px;
      width: 100%;
    }

    textarea#chat_text_entry {
      border: none;
    }

    textarea#trade_offer_note {
      padding: 4px;
      border-radius: 3px;
      width: calc(100% - 10px)
    }

    .included_trade_offer_note_header .tooltip_hint {
      float: right;
      padding-top: 11px;
    }

    div.included_trade_offer_note {
      color: #909090;
      font-size: 14px;
    }

    div.included_trade_offer_note_ctn {
      position: relative;
      padding-left: 58px;
      min-height: 40px;
    }

    .quote {
      padding: 13px 13px;
      border: 1px solid #3c3d3e;
      color: #d6d7d8;
      font-size: 14px;
      font-style: italic;
      line-height: 19px;
      border-radius: 5px;
      -moz-border-radius: 5px;
      margin-bottom: 5px;
      background-color: #262626;
    }

    .quote_arrow {
      position: absolute;
      width: 17px;
      height: 18px;
      background-repeat: no-repeat;
      background-image: url(https://community.cloudflare.steamstatic.com/public/images/skin_1/quotearrow_graybg_flipped.png);
    }

    .included_trade_offer_note_ctn .included_trade_offer_note_sender {
      position: absolute;
      left: 0;
      top: 0;
    }

    .included_trade_offer_note_ctn .quote_arrow {
      left: 42px;
      top: 12px;
    }


    td.chat_send_btn_cell {
      white-space: nowrap;
      width: 1%;
    }

    div#chat_send_btn {
      white-space: nowrap;
      font-size: 11px;

      border: 1px solid #4c4a47;
      border-radius: 3px;
      -moz-border-radius: 3px;

      padding: 0 16px;
      cursor: default;
      height: 40px;
      line-height: 40px;

      text-transform: uppercase;
    }

    div#chat_send_btn.active {
      border: 1px solid #99938d;
      color: #e5e2df;

      background-repeat: repeat-x;

      background-color: #4c4a48;
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/item_action_btn.png');
      background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAWCAIAAACOpGH9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAClJREFUeNpiyExLZvr//z8G/vcPRP8D0/+A9H8o/e8fMhuhBk0/QIABALdaQAnvsp4ZAAAAAElFTkSuQmCC');
    }

    .currency_in_trade_descriptor {
      font-size: 24px;
      margin-top: 16px;
    }

    #trade_confirm_throbber {
      height: 50px;
      margin: 0 54px 12px 54px;
      text-align: center;
    }

    .trade_confirmbtn .cap,
    .trade_confirmbtn {
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/trade_bigbutton.png');
      height: 50px;
    }

    .trade_confirm_box {
      text-align: center;

      color: #7f7f7f;
      font-size: 14px;

      padding-bottom: 13px;
    }

    .trade_confirmbtn {
      margin: 0 auto 12px auto;
      display: inline-block;
      position: relative;
      height: 50px;
      line-height: 50px;
      font-size: 24px;
      color: #7f7f7f;
      background-repeat: repeat-x;
      background-position: 0 -50px;
      padding: 0 50px;
      cursor: default;

      max-width: 248px;

    }

    .trade_confirmbtn .cap {
      position: absolute;
      width: 5px;
      height: 50px;
      top: 0;
      background-repeat: no-repeat;
    }

    .trade_confirmbtn .cap.left {
      left: 0;
      background-position: 0 0;
    }

    .trade_confirmbtn .cap.right {
      right: 0;
      background-position: -5px 0;
    }

    .trade_confirmbtn.active .cap.left {
      background-position: -10px 0;
    }

    .trade_confirmbtn.active .cap.right {
      background-position: -15px 0;
    }

    .trade_confirmbtn.active {
      background-position: 0 -100px;
      color: #ffffff;
      cursor: pointer;
    }

    #trade_confirm_message {
      padding: 0 45px;
    }


    .received_items_header {
      text-align: center;
      margin-bottom: 32px;
    }

    .received_items_header h1 {
      font-size: 26px;
      color: #ffffff;
      font-weight: normal;
    }

    .received_items_header h3 {
      font-size: 18px;
      color: #a4a4a4;
      font-weight: normal;
    }

    .received_items {}

    .recieved_item {
      width: 500px;
      margin: 0 auto 12px auto;
    }

    .receipt_buttons {
      text-align: center;
      padding-top: 22px;
    }

    .trade_rule {
      background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAbQAAAAZCAIAAADWo0yVAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAIVJREFUeNrs3LENgCAQQFHPuAZDsP9unCZEgnEC5b2CQEJ1xS8oiFLKBsDTbgQA4gggjgDiCCCOAOIIII4A4gggjgDiCPBpcclMgwAWzN+8iVvfH7XWcQNgHTnpx9baWMPHEwBv3hwBxBFAHAHEEUAcAcQRQBwBxBFAHAHEEUAcAX7nFGAAc9kfZ4qJQtgAAAAASUVORK5CYII= );
      height: 25px;
      background-position: center;
      background-repeat: no-repeat;
      margin: 6px 0;
    }

    .trade_rule.trade_rule_swap {
      background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAbQAAAAZCAIAAADWo0yVAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAvJJREFUeNrsnd2OqjAURv0jqKDRB/AhfP/X8c7EBBSEgDr70AzhFPDATDsDOWtdkFIJkAJfv80udXo4HCYANnFd13GcLMvSNDW+c8/z4jh+vV60M5hlQROAPVYF8/n8drtZUsb1ei37D8OQ1gbEEcZwYy0W2+1WZEvKSZLc73cbhlSUURVEJaMootkBcYRBs1wuN5uNKj8eD7GNNsS3PIQgKpnnuQ1zCv8tM5oA7CmjIIbO+AvB6XQqh5BltVJqRDFpf0AcYQTKKLbRhptr1MFGxQRAHOH30UJdIY5j40fxPM913Y4nAIA4wu/j+75Wk2WZ2UOUSZg3G4h6ci0AcYQB2UbHcao1eZ5LWG3VmTYi6tlmLQEQR/hpVquVVmNWGXu9UiQ5AwY649PpxNcFY6FNGsr6eqEsa0tFW/mfm2lLQbONyjmqW8tIkqSX3skRJca/XC5KoNVpvD5pK7f9pO2hXK0W2iqrSL2cGI/bAB+oxpt8cTweSfCNiDcPWOODWn9oG5e9Vuv7nM1mary3dudJvREtEFvaN1IWsd7tdlEUtfUN3Vfb+pjGHutNB6auHffwoJ4mrS98Pp/lcnE+n2kj+CZ1ZXzvofpyL6jWqA8Htc3CMGQcOBgLq2kC+AKiTdU4WhxifRs134SmcVbFy+xbTkAcAXoTx/F+v28zjKWdrG5gaVaeqkvN85xLA6YgWw1fVCKJYbtHzeLpgiAweePWvCoBNSCOMAjEpnWcUaKvknYKeWqZ6yRJuCiAOMIg6DgXmWio2YD3zzCLv8UxK+CKAOIIQ0GE770qiXoa93T1YT02ZkUDxBHgWwRB0JYmFt20IVva1zjX65VUDCCOMDjaXikaT8IoHMepxtRJAVcBEEcYIvXkjI0kzOTzC+tqNC22kfYHGzDOEcwg9k0MXRnwGk/CKHzfV2MnxZaKLJKEAcQRRoAIopq4zEYSZlJMMy6IG5X983esgDjCmAiCwPM8S/+oJbIrbjFNU2QRfoAPAQYAm1Tmij+S9agAAAAASUVORK5CYII= );
    }

    .trade_rule.maketrade {
      margin-top: 17px;
      margin-bottom: 22px;

    }

    .cancelbtn_ctn {
      text-align: center;
    }

    .cancelbtn {
      display: inline-block;
      background-repeat: no-repeat;
      background-position: left top;
      height: 21px;
      line-height: 21px;
      margin-top: 12px;
      font-size: 14px;
      cursor: pointer;
      color: #EBEBEB;
    }

    .cancelbtn:hover {
      color: white;
      text-decoration: underline;
    }

    .tutorial_arrow_ctn {
      position: relative;
    }

    .tutorial_arrow {
      position: absolute;
      height: 36px;
      z-index: 5;
    }

    .tutorial_arrow .content {
      background-position: bottom;
      background-repeat: repeat-x;
      padding-bottom: 5px;
      height: 31px;
      line-height: 31px;

      font-weight: bold;
      font-size: 11px;
      color: #ffffff;
      padding-left: 5px;
      padding-right: 5px;

      white-space: nowrap;
      cursor: default;
    }

    .tutorial_arrow .leftcap,
    .tutorial_arrow .rightcap {
      position: absolute;
      top: 0;
      height: 36px;
      background-repeat: no-repeat;
    }

    .tutorial_arrow.right {
      padding-left: 5px;
      padding-right: 16px;
    }

    .tutorial_arrow.right .leftcap {
      left: 0;
      width: 5px;
      background-position: 0 0;
    }

    .tutorial_arrow.right .rightcap {
      right: 0;
      width: 16px;
      background-position: -26px 0;
    }



    .tutorial_arrow.left {
      padding-right: 5px;
      padding-left: 16px;
    }

    .tutorial_arrow.left .leftcap {
      left: 0;
      width: 16px;
      background-position: -10px 0;
    }

    .tutorial_arrow.left .rightcap {
      right: 0;
      width: 5px;
      background-position: -5px 0;
    }


    .tutorial_arrow .leftcap,
    .tutorial_arrow .rightcap,
    .tutorial_arrow .content {
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/trade_tutorial_arrow.png');
    }

    #tutorial_arrow_step1 {
      right: 410px;
      top: 5px;
    }

    #tutorial_arrow_step2 {
      right: 407px;
      top: -8px;
    }

    #tutorial_arrow_step3 {
      left: 400px;
      top: -2px;
    }

    #tutorial_arrow_step4 {
      left: 380px;
      top: 55px;
    }

    #tutorial_arrow_ctn_2.activeArrow {
      padding-left: 18px;
    }



    .trade_offer_tutorial#tutorial_arrow_step1 {
      right: 443px;
      top: 23px;
    }

    .trade_offer_tutorial#tutorial_arrow_step2 {
      right: -50px;
      top: 23px;
    }

    .trade_offer_tutorial#tutorial_arrow_step3 {
      left: -52px;
      top: 35px;
    }

    .trade_offer_tutorial#tutorial_arrow_step4 {
      left: 400px;
      top: -2px;
    }

    .trade_offer_tutorial#tutorial_arrow_step5 {
      left: 380px;
      top: 55px;
    }


    #trade_currency_dialog {
      width: 436px;
      max-width: 100%;

      font-size: 18px;
      color: #ffffff;
      font-weight: bold;
      text-align: center;
    }

    .trade_wallet#trade_currency_dialog {
      height: 388px;
    }

    #trade_currency_dialog_conversion {
      position: absolute;
      background: #383635 bottom no-repeat url('https://community.cloudflare.steamstatic.com/public/images/economy/trade_currency_dialog.png?v=3');
      border: 1px solid black;
      width: 436px;
      height: 418px;
      z-index: 1000;

      font-size: 18px;
      color: #ffffff;
      font-weight: bold;
      text-align: center;
    }

    .trade_currency_dialog_corner {
      position: absolute;
      right: -1px;
      bottom: -1px;
      background: right bottom no-repeat url('https://community.cloudflare.steamstatic.com/public/images/economy/trade_currency_dialog_corner.png?v=1');
      width: 174px;
      height: 153px;
    }

    .trade_currency_dialog_title {
      margin-bottom: 24px;
    }

    .trade_wallet #trade_currency_dialog_title {
      display: none;
    }

    #trade_currency_dialog_title_wallet {
      display: none;
    }

    .trade_wallet #trade_currency_dialog_title_wallet {
      display: block;
    }

    #trade_currency_dialog_conversion_title {
      top: 12px;
    }

    .trade_currency_dialog_info {
      padding: 0 8px;
      font-size: 12px;
      font-weight: normal;
      color: #767676;
    }

    .currency_dialog_input_area {
      background: no-repeat url('https://community.cloudflare.steamstatic.com/public/images/economy/trade_currency_entry_background.png?v=1');
      width: 136px;
      height: 54px;
      padding-left: 54px;
      text-align: left;
      margin: 0 auto 24px auto;
    }

    .currency_dialog_input_area_short {
      background: no-repeat url('https://community.cloudflare.steamstatic.com/public/images/economy/trade_currency_entry_short_background.png?v=1');
      padding-left: 6px;
    }

    #trade_currency_dialog_input_area {
      position: relative;
    }

    #trade_currency_dialog_conversion_input_area_you {
      position: relative;
    }

    #trade_currency_dialog_conversion_equals_sign {
      width: 36px;
      line-height: 54px;
      text-align: center;
      vertical-align: middle;
      font-size: 24px;
    }

    #trade_currency_dialog_conversion_input_area_them {
      position: absolute;
      left: 232px;
      top: 129px;
    }

    #trade_currency_dialog_input_icon_area {
      position: absolute;
      left: 4px;
      top: 6px;
      width: 42px;
      height: 42px;
    }

    .currency_dialog_input_area input {
      background-color: transparent;
      border: none;
      font-size: 24px;
      font-weight: bold;
      padding: 2px 0 0;
      margin: 0;
      line-height: 44px;
      height: 44px;
      width: 130px;
      outline: none;
    }

    .trade_currency_dialog_error {
      width: 434px;
      line-height: 32px;
      color: #ff0000;
      font-weight: normal;
      font-size: 14px;
    }

    #trade_currency_dialog_error {
      position: absolute;
      top: 118px;
      left: 0;
    }

    #trade_currency_dialog_conversion_error {
      position: absolute;
      top: 178px;
      left: 0;
    }

    .trade_currency_fee_information {
      width: 434px;
      line-height: 1.5em;
      font-weight: normal;
      font-size: 20px;
      text-align: center;
    }

    #trade_currency_fee_information {
      position: absolute;
      top: 150px;
      left: 0;
      display: none;
    }

    #trade_currency_conversion_fee_information {
      position: absolute;
      top: 210px;
      left: 0;
    }

    .trade_wallet #trade_currency_fee_information {
      display: block;
    }

    .trade_currency_fee_information_lines {
      display: inline-block;
      text-align: left;
      white-space: nowrap;
    }

    .trade_currency_fee_total {
      font-weight: bold;
      padding-left: 0.6em;
    }

    .trade_currency_dialog_remaining {
      line-height: 42px;
      margin-bottom: 18px;
    }

    .trade_wallet #trade_currency_dialog_remaining {
      top: 297px;
      font-size: 14px;
    }

    #trade_currency_dialog_conversion_remaining {
      position: absolute;
      top: 327px;
      left: 0;

      font-size: 14px;
    }

    #trade_currency_dialog_remaining img {
      vertical-align: middle;
    }

    .trade_wallet #trade_currency_dialog_symbol2 {
      display: none;
    }

    #trade_currency_dialog_fundsavailable_wallet {
      display: none;
    }

    .trade_wallet #trade_currency_dialog_fundsavailable_wallet {
      display: inline;
    }

    .trade_wallet #trade_currency_dialog_fundsavailable {
      display: none;
    }

    .trade_currency_dialog_footer {
      position: absolute;
      bottom: 12px;
      left: 9px;

      width: 416px;
      text-align: right;
    }

    .trade_currency_dialog_footer a.item_action {
      margin-right: 0;
      margin-left: 5px;
      text-align: left;
      padding: 0 5px;
      width: 82px;
    }

    .trade_currency_slider_ctn {
      padding-top: 20px;
    }

    #trade_currency_slider_ctn {
      position: relative;
    }

    .trade_wallet #trade_currency_slider_ctn {
      top: 216px;
    }

    #trade_currency_conversion_slider_ctn {
      position: absolute;
      top: 276px;
      left: 28px;
    }

    .trade_currency_slider_count {
      position: absolute;
      top: 0;
      line-height: 20px;
      color: #b7b7b7;

      font-size: 15px;
      font-weight: bold;
      text-align: center;
    }

    .trade_currency_slider_ctn .slider {
      position: relative;
      height: 42px;
    }

    .trade_currency_slider_ctn .slider_background {
      position: absolute;
      top: 20px;
      left: 12px;
      right: 12px;
      height: 4px;
      background: #3b3938;
      border: 1px solid #222327;
      border-radius: 3px;
      overflow: hidden;
    }

    .trade_currency_slider_ctn .slider_background .slider_progress {
      background: #496784;
      position: absolute;
      left: 0;
      top: 0;
      height: 4px;
    }

    .trade_currency_slider_ctn .slider_progress {
      background-position: -357px 0;
    }

    .trade_currency_slider_ctn .slider .handle {
      position: absolute;
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/economy/slider_handle.png');
      background-position: left top;
      background-repeat: no-repeat;
      width: 24px;
      height: 35px;
      top: 5px;
    }

    .trade_currency_slider_ctn .slider .handle.active {
      background-position: right;
    }

    #trade_currency_dialog_warning {
      position: absolute;
      background: #383635 bottom no-repeat url('https://community.cloudflare.steamstatic.com/public/images/economy/trade_currency_dialog.png?v=3');
      border: 1px solid black;
      width: 436px;
      height: 164px;
      z-index: 1000;

      font-size: 18px;
      color: #ffffff;
      font-weight: bold;
      text-align: center;
    }

    #trade_currency_dialog_warning_title {
      top: 12px;
    }

    #trade_currency_dialog_warning_contents {
      position: absolute;
      top: 52px;
      left: 0;
      width: 418px;

      padding: 0 8px;
      font-size: 12px;
      font-weight: normal;
      color: #CCCCCC;
    }

    .trade_box .itemHolder {
      margin-right: 5.2px;
      /* 6px causes premature wrapping when zooming the page */
    }

    .inventory_user_tabs {
      font-family: "Motiva Sans", Sans-serif;
      font-weight: 200;
      /* thin */

      font-size: 20px;
      background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41Ljg3O4BdAAAADUlEQVQYV2Pw8PD4DwADjAHYmbnDeAAAAABJRU5ErkJggg==) repeat-x bottom;
    }

    .inventory_user_tab_gap {
      width: 18px;
      height: 56px;
      border-bottom: none;
    }

    .inventory_user_tab_gap>div {
      line-height: 55px;
      height: 55px;
      border-bottom: 1px solid #484848;
    }

    .inventory_user_tab,
    a.inventory_user_tab {
      float: left;
      line-height: 55px;
      height: 55px;
      width: 218px;

      border: 1px solid #484848;
      border-bottom: none;

      background-color: #1D1D1D;
      background: -webkit-linear-gradient(top, #4E4E4E 5%, #1D1D1D 95%);
      background: linear-gradient(to bottom, #4E4E4E 5%, #1D1D1D 95%);

      text-decoration: none;
      border-radius: 2px;
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
      -moz-border-radius: 2px;
      -moz-border-radius-bottomleft: 0;
      -moz-border-radius-bottomright: 0;
    }

    .inventory_user_tab>div {
      padding: 0 12px;
      line-height: 54px;
      height: 54px;
      border-bottom: 1px solid #484848;
    }

    .inventory_user_tab.active {
      background: -webkit-linear-gradient(top, #34445D 5%, #1D1D1D 95%);
      background: linear-gradient(to bottom, #34445D 5%, #1D1D1D 95%);
    }

    .inventory_user_tab.active>div {
      border-bottom: none;
    }

    .trade_warning_bold {
      color: #ffffff;
    }

    .trade_warn_dialog_content {
      max-width: 450px;
    }

    .trade_warning_item_type {
      font-style: italic;
      color: #767676;
    }

    #trade_confirm_captchaentry {
      margin-bottom: 8px;
    }

    .captcha_img_ctn {
      float: left;
      width: 206px;
      text-align: center;
      margin-right: 8px;
    }

    img#trade_confirm_captcha {
      width: 206px;
      height: 40px;
    }

    .captcha_entry_ctn {
      text-align: left;
      padding-top: 4px;
      display: inline-block;
      margin-bottom: 12px;
    }

    #trade_captcha_refresh {
      cursor: pointer;
    }

    #captcha_entry {
      position: static;
      top: 0;

      font-size: 24px;
      line-height: 38px;
      width: 90px;
      color: #ffffff;
      padding: 0 16px;
    }

    .your_inventory_active .their_inventory_only {
      display: none;
    }

    .their_inventory_active .your_inventory_only {
      display: none;
    }

    html.responsive .trade_area,
    html.responsive .trade_left,
    html.responsive .trade_right {
      position: relative;
    }

    html.responsive .responsive_fixonscroll_ctn div.appselect {
      margin: 0 auto;
    }

    .responsive_trade_prompt {
      font-size: 22px;
      margin: 4px auto;
      line-height: 36px;
      color: #c6c6c6;
      padding: 6px 12px;
      font-family: "Motiva Sans", Sans-serif;
      font-weight: 200;
      /* thin */

    }

    .responsive_trade_prompt .playerAvatar {
      display: inline-block;
      vertical-align: middle;
      margin-right: 4px;
    }

    .responsivetrade_backtooffer_ctn {
      position: fixed;
      padding: 8px;
      bottom: 0;
      right: 0;
      background: #171a21;
      box-shadow: -1px -1px 6px 0 #000000;
      z-index: 20;
    }

    .trade_nonresponsive_hidden {
      display: none;
    }

    @media screen and (max-width: 600px) {
      html.responsive .trade_partner_info_block {
        float: none;
        margin-right: 0;
      }

      html.responsive .trade_partner_info_block.group {
        width: auto;
      }

      html.responsive .trade_partner_inline_hack {
        display: block;
      }

      html.responsive .trade_partner_info_text {
        display: inline;
        white-space: normal;
      }

      html.responsive .trade_partner_info_text~.trade_partner_info_text {
        white-space: nowrap;
      }

      html.responsive .trade_partner_member_since {
        min-width: 0;
      }


      html.responsive .pagecontent {
        max-width: 936px;
        width: auto;
        padding: 0 1%;
      }

      html.responsive .trade_area .trade_left,
      html.responsive .trade_area .trade_right {
        width: auto;
        float: none;
      }

      html.responsive .trade_box {
        width: auto;
      }

      html.responsive #inventories {
        width: auto;
        height: auto;
        min-height: 416px;
      }

      html.responsive .trade_box_contents {
        padding: 4px 1%;
      }

      html.responsive .trade_slot:not(.has_item) {}

      html.responsive .trade_responsive_hidden {
        display: none;
      }

      html.responsive .trade_nonresponsive_hidden {
        display: block;
      }

      html.responsive .responsive_trade_fixedcontents {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: #171a21;
        box-shadow: 0 2px 4px 0 #000000;
        z-index: 15;
      }

      html.responsive .responsive_trade_fixedcontents_spacer {
        height: 129px;
      }

      html.responsive input.filter_search_box {
        font-size: 16px;
      }

      html.responsive .trade_offer:not(.ready) .trade_slot:not(.has_item) .slot_inner {
        background: url('https://community.cloudflare.steamstatic.com/public/images/economy/trade_slot_additem.png') no-repeat;
        background-size: 100% 100%;
      }
    }

    @media screen and (max-width: 480px) {

      html.responsive .filter_right_controls,
      html.responsive .filter_control_ctn {
        float: none;
        width: auto;
      }

      html.responsive #filter_control {
        width: calc(100% - 8px - 2px);
      }
    }

    @media screen and (min-width: 480px) {
      html.responsive .responsive_trade_fixedcontents .responsive_tab_control select {
        min-width: 400px;
      }
    }

    .tradeoffer_limited_nomessage {
      font-size: 12px;
    }

    .responsive_page_frame {
      position: relative;
    }

    body.movescrolltocontent .responsive_page_frame {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      overflow: auto;
    }

    body.overflow_hidden,
    body.overflow_hidden .responsive_page_frame {
      overflow: hidden;
      position: relative;
    }

    html.responsive {
      height: 100%;
    }

    html.responsive body {
      min-height: 100%;
      height: auto;
      position: relative;
    }

    html.responsive body.movescrolltocontent {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
    }

    .responsive_page_content {}

    .partner_events .responsive_page_content {
      height: 100vh;
    }

    .responsive_page_menu_ctn {
      position: fixed;
      top: 0;
      bottom: 0;
      overflow: hidden;

      background: black;

      z-index: 30;
      width: 280px;
    }

    .responsive_page_frame:not(.in_menu_drag) .responsive_page_menu_ctn {
      transition: left 0.5s, right 0.5s;
    }

    .responsive_page_menu_ctn.mainmenu {
      left: -280px;
    }

    .responsive_page_menu_ctn.localmenu {
      right: -280px;
    }

    .responsive_page_frame.mainmenu_active .responsive_page_menu_ctn.mainmenu,
    .responsive_page_frame.localmenu_active .responsive_page_menu_ctn.localmenu {
      box-shadow: 0 0 7px 0 rgba(0, 0, 0, 0.75);
    }

    .responsive_page_frame.mainmenu_active .responsive_page_menu_ctn.mainmenu {
      left: 0;
    }

    .responsive_page_frame.localmenu_active .responsive_page_menu_ctn.localmenu {
      right: 0;
    }

    .responsive_page_content_overlay {
      visibility: hidden;
      opacity: 0;
      background: rgba(0, 0, 0, 0.4);
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      z-index: 25;
      /* on top of page and header */

      transition: visibility 0.5s, opacity 0.5s;
    }

    .responsive_page_frame.mainmenu_active .responsive_page_content_overlay,
    .responsive_page_frame.localmenu_active .responsive_page_content_overlay {
      visibility: visible;
      opacity: 1.0;
      transition: visibility 0s, opacity 0.5s;
    }

    .responsive_page_menu {
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      overflow: hidden;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .mainmenu_contents {
      background: #171a21;
      font-size: 22px;
      position: relative;
      min-height: 100%;
    }

    .mainmenu_contents_items {

      font-family: "Motiva Sans", Sans-serif;
      font-weight: 200;
      /* thin */

    }

    .responsive_page_menu_ctn.localmenu .responsive_page_menu {
      background: #171a21;
    }

    .responsive_page_menu_ctn.localmenu .localmenu_subarea {
      background: #192533;
      border-radius: 3px;
      padding: 10px;
      color: #bdbdbd;
      margin-bottom: 16px;
    }

    .responsive_page_menu_ctn.localmenu .localmenu_subarea .subheader {
      font-size: 1.2em;
      margin-bottom: 8px;
    }

    .mainmenu_contents .menuitem,
    .mainmenu_contents .submenuitem,
    .notification_submenu .popup_menu_item {
      display: block;
      padding: 0 12px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      line-height: 2.5em;

      text-decoration: none;

      cursor: pointer;
    }

    .mainmenu_contents .menuitem {
      position: relative;
      color: #bdbdbd;
      background: #171a21;
      transition: background 0.25s, color 0.25s;
    }

    .mainmenu_contents .menuitem.username {
      max-width: none;
    }

    .mainmenu_contents .menuitem,
    .menuitem_submenu_wrapper .inner_borders,
    .mainmenu .minor_menu_items {
      border-top: 1px solid #2f3138;
      border-bottom: 1px solid #000000;
    }

    .mainmenu .minor_menu_items {
      border-bottom: none;
    }

    .mainmenu_contents .menuitem.submenu_active {
      background: #192533;
      color: #ffffff;
    }

    .mainmenu_contents .menuitem .chevron {
      background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAwCAYAAACG5f33AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABFxJREFUeNrkmg9klGEcx5/dMY4Y44hjxIgxRpSy7NwspSmNWZayGGmKFJGylCJSmlJMKctiylKa5aZpSmmMMWIcY4xxjGPEmPX72ffN23Z7732f3/Pe+97tx9dtd/e87/N+7n1+/563Ym1tTbmx8fHxLnq5QzqYSqXmbO+rMrMoaZDUz5dX6MsRl/A66OU5KUFK0/9xVb42QOLr/UTaLwZIsI7hoFG8VUsapferyhDeI1In/o7xdZL2Og2ocFrCBKkFv0Rlvo9JR0grZQKvl3Qrz/tLpCRpxhNAgteEXyDmcNL3pHbSaonDu0B67PB5ln0/adYVQILHt+0X0g4XJ39G6ilheJ0IGoVsAXdixhEgwWugl68kLz7uHulaCcJj/z5s8++FbJ50ADA3AyR4dYCnE2Uvkp6UELwU/HvM47gMlvPifwAJXi3gJQSTOkV6UwLw9sBF6WYSvwFxKbJhjc8LJ/aSdDjk8HYjOErSMAaYy7eE+aDpQrlPAfsDZzsZQni8un4JV9kIqc1K3/IFkWos5XrBSRxzp4CM/foPFAK6NkZqtee+W6UxcUCsE5yMXcI+e8QK0KpwPQ2CY3wnHcIKc5VIJ3BSyS+WQdjPBggvBrfUKDjGJODlvJZyNfTyjVQjPHkzaTkAeFyCvkW+p2vTcEc5z7WwwfQmqLp50NYc0I22SacVVOGmHyhMsC0bQp5YrLr5Kem80P38S5hFAG0lHief1YJJFatu5sbvdcH4TSWbGKCtyZAWJqG3STd9hHeZ9ECYPfCdN+fmy54AAmIjIMYEk+zB3WjaulAN6dqWbStjAAFRtxD3s24+gYgbFcBr9pr8awEExKNoBVVqTngFWf2Yoc7KqGAuOcCb8jpQGyAgSn91E3Wzl+bvVnNgeD91BosAAiLnWQPCpZNEzuXV6gEvLoDH+emE7vVHDCwf9mPdwiI/rZGo78KyjQtcSJsEnimAbK/Uekda1xKA6BbGTk3odngnSZ+lF24KIBu3868Ixte5jOxWz1K3ycGV0Bm1vqOowgSQ7aEwSeaA8MEhmlqdFUmvshtlpQojQKvSuC8Y34JkOJqnszKsZN3yc3A3KswA2a6S+gTjObLbN7qjiPSS/RZ2L/2mL9QvgGyXSC8E47mT0mvrrHQIjnUD7sW4mcgDnT6OYjmeFpyC04wmwfi7AOiL+XkHWhHvLOmd4BgSeH1+wisGQAsiNw5GVHGtH25ElTpAe9Y/VqTzvUbEVeUC0IJ4XK1vD/ppQ3AbqtwA2ot3v55a+IgqY7VcAbLx9ibvsU4bPi7Xte2qyDt/QQBkywGiqUc/JpTteZXtAJAtC4gZ4XG4EdqqNjxysR0AsvGea1LpP1Y3BZ+6HNQFBA2QzXr22OtDSDOAlwty8mEAyMZ7sM3K/UNIs1j+2aAnHhaAFhQ3EC3Yi2GYdJgAulmWC4C3EJYJhw2gU2CwAs5cmCYbRoD5UhNTKc+2AWhPjrOGk26j9leAAQDu6F3rDzHr6wAAAABJRU5ErkJggg==');
      background-size: 100% 100%;
      width: 20px;
      height: 12px;

      position: absolute;
      right: 12px;
      top: calc(50% - 6px);

      transition: transform 0.25s;
    }

    .mainmenu_contents .menuitem.submenu_active .chevron {
      transform: rotate(180deg);
      -webkit-transform: rotate(180deg);
    }

    .menuitem_submenu_wrapper {
      overflow: hidden;
      background: #171a21;

      transition: height 0.5s, background 0.25s, color 0.25s;
    }

    .menuitem_submenu_wrapper.active {
      background: #192533;
    }

    .menuitem_submenu_wrapper .submenuitem,
    .notification_submenu .popup_menu_item {
      display: block;
      font-size: 0.75em;
      color: #ffffff;
      padding-left: 28px;
    }

    .notifications_item .notification_count_total_ctn {
      display: inline-block;
      color: #ffffff;
      vertical-align: middle;
      line-height: 140%;
      padding: 0 8px;
      font-size: 0.75em;
      margin-left: 0.4em;
    }

    .notifications_item .notification_envelope {
      display: none;
      background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAAA0CAYAAAAzMZ5zAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAvRJREFUeNrsWu2RmzAQXd+kAJVACaQDroNzB6QDXEFIBXYHXAe+VGB3AB34OiAdKNJlmVN8YD2BBBi8Mzv84UO8/XirXW2klPSQT/mm9PSA4VM28uEi/8mT0sMDhg95V/pdA7JTulX6Z8VgvGowlFYbI2JipQVf1yLaCX4ofTNDppFK6TOjtQap2CvernNIG2K7hYNxYDDe21im66GYKVksLER2t6JgY2FdDcZRabIQFtlyqHT+rw6ZFwuizwug5nPDIjfu0RFRkvwnufYUi74oreX9yR74t7S5mYwHT0qF5cFYaXknQNRsRBsYhfkQXb3kwj996wXi+iUzlBL8jy/GpQ5kUwDZbKZgHEFPbw1/Ghh7yczySjbUkGT5AJJXxAzySs3GGRzqBHwMySvEHjWFIEaLUKORgwWQvJKOHELew5oCLGAMakYp1TnxUyAXDUnNQb9PPReF5hXf1JyH9lAa6LYpuMDLQCBQAwzeXpAHqxXAQgUXTH0Tp5AjsRx5cuWSqQ3J+CcHoJF3RtJjEieP8Y0URyYwRUsolWzpCHyP9x14iLnML6X5CD2OvdLsXgZV58CjDT0dSEMNqkLI78Bznl2o6YBvD6m4a1+N1BpMOXTEHD3kAPQtXUQAQ7NXz98kHyxzAdlFGMyyZ4aIWtgn5ZqldqhOie+bnHaPYNGUDKxWXeqcSSpVdLfpzXIOW4UhVXHv3S5irVBtgAL0ymwMQNB4zgI3itDNnrNRyCGGY9BdT3I8ySWezL0Bgu42p5rsnXyujzxs1sSEDWbXJG/dGdNAOvXR/PHddEbWnaOA1OCwxyed+hY037XWLNSj+PHakAkYQpnsUbO4HIcYg059Cxr6mQlILANXfzPwlgTMh6XtSBXxCaNiAWfNoE7eLUA0AD9DtOkmPoq5bTt9aAMk5sN20UIP63Z23NoaRPnH4bNlgtF4ftGVBkwPifimhNYjX45qPhm9yXJlYDROUJrJVntIbDmruhbRo5MzQrurkr8CDACZX+ZRUnCU8wAAAABJRU5ErkJggg==');
      background-size: 100% 100%;
      background-position: top left;
      width: 17px;
      height: 13px;
      vertical-align: middle;
    }

    .notifications_item .notification_count {
      vertical-align: middle;
    }

    .notifications_item .notification_count_total_ctn.has_notifications {
      color: #ffffff;
      background-color: #5c7e10;
    }

    .notifications_item .notification_count_total_ctn.has_notifications .notification_envelope {
      display: inline-block;
    }

    .mainmenu .notification_submenu .notification_icon,
    .mainmenu .notification_submenu .header_notification_dropdown_seperator {
      display: none;
    }

    .mainmenu .minor_menu_items .menuitem {
      color: #8a8a8a;
      border: none;
      font-size: 0.75em;
    }

    .mainmenu_footer_spacer {
      height: 160px;
    }

    .mainmenu_footer {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      font-size: 10px;
      white-space: normal;
      color: #8a8a8a;
      padding: 0 12px 24px 12px;
    }

    .mainmenu_footer .mainmenu_valve_links>a {
      color: #8a8a8a;
    }

    .responsive_menu_notifications .popup_menu_item {
      font-size: 16px;
    }

    .responsive_menu_notifications .popup_menu_item.active_inbox_item {
      color: #70ba24;
    }

    .responsive_local_menu_tab {
      display: none;
    }

    .responsive_local_menu_tab.active {
      display: block;
      background-color: rgba(104, 157, 221, 0.6);
      position: fixed;
      right: 0;
      top: 6px;
      border-top-left-radius: 80px;
      border-bottom-left-radius: 80px;
      width: 30px;
      height: 50px;
      z-index: 12;
      /* behind overlay, on top of page content */

      background-image: url('https://community.cloudflare.steamstatic.com/public/shared/images/responsive/local_menu_hamburger.png');
      background-repeat: no-repeat;
      background-position: 2px center;
      background-size: 110%;

      transition: opacity 0.5s;
      box-shadow: 0 0 30px 0 #6799e2;

      cursor: pointer;
    }

    .responsive_page_frame.with_header .responsive_local_menu_tab {
      top: 68px;
    }

    .responsive_page_frame.mainmenu_active .responsive_local_menu_tab,
    .responsive_page_frame.localmenu_active .responsive_local_menu_tab {
      opacity: 0;
    }

    .responsive_header {
      display: none;
      background: #171a21;

      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      text-align: center;
      z-index: 20;
      box-shadow: 0 0 7px 0 rgba(0, 0, 0, 0.75);

      overflow: hidden;

      padding: 13px 8px;
    }

    @media screen and (max-height: 360px) {
      .responsive_header {
        position: absolute;
      }
    }

    #responsive_menu_logo,
    #responsive_header_search_btn {
      position: absolute;
      top: 9px;
      cursor: pointer;
      width: 36px;
      height: 31px;
    }

    #responsive_menu_logo {
      left: 8px;
    }

    #responsive_header_search_btn {
      right: 8px;
    }

    .responsive_header_notification_badge_ctn {
      position: absolute;
      text-align: center;
      right: -26px;
      width: 60px;
      top: -4px;
    }

    .responsive_header_notification_badge {
      display: inline-block;
      background: #ca2842;
      color: #ffffff;
      padding: 0 4px;
      font-size: 11px;
      line-height: 17px;
      border-radius: 8px;
    }

    .responsive_header_notification_badge.no_notifications {
      display: none;
    }

    .responsive_header .responsive_header_logo img {
      vertical-align: middle;
    }

    .responsive_header .responsive_header_logo a {
      display: inline-block;
    }

    .localmenu_content {
      padding: 16px;
    }

    /* China Mobile Footer */

    .mainmenu_socials_china {
      display: flex;
      align-items: center;
    }

    .mainmenu_social_box {
      margin-right: 25px;
      display: flex;
      align-items: center;
    }

    .mainmenu_line {
      height: 1px;
      background: #2f3138;
      margin: 15px 0;
    }

    .mainmenu_links_china {
      margin: 10px 0;
      line-height: 17px;
    }

    .mainmenu_footer a {
      color: #8a8a8a;
    }

    .mainmenu_footer a:hover {
      color: #FFFFFF;
    }

    .mainmenu_legal_china {
      font-size: 9px;
    }

    .mainmenu_legal_pwlegal {
      margin-top: 15px;
    }

    .mainmenu_logos_china {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
    }

    .mainmenu_china_wechat_logo {
      width: 31px;
      height: 27px;
    }

    .mainmenu_china_weibo_logo {
      width: 30px;
      height: 26px;
    }

    .mainmenu_china_pw_logo {
      width: 68px;
      height: 23px;
      margin-right: 10px;
    }

    .mainmenu_china_valve_logo {
      width: 64px;
      height: 19px;
    }

    .mainmenu_footer_spacer.china_spacer {
      height: 330px;
    }

    /* reduce the event share dialog body's bottom margin */
    .EventDisplay_Share_Dialog .DialogBodyText {
      margin-bottom: 10px;
    }

    @media screen and (max-width: 910px) {

      /* these elements end up getting moved, but hide them in the main page while content is loading */
      html.responsive .responsive_page_content .responsive_local_menu {
        display: none;
      }
    }

    /*
.responsive_page_frame:not(.in_menu_drag) .responsive_header_content {
	transition: left 0.5s, right 0.5s;

}

.responsive_page_frame.mainmenu_active .responsive_header_content {
	left: 280px;
	right: -280px;
}
*/

    .responsive_menu_user_area {
      padding: 24px 20px 12px 20px;
      box-shadow: inset 0 -4px 8px 0 #000000;

      background: -webkit-linear-gradient(343deg, #24313f 0%, #171a21 33%);
      background: linear-gradient(107deg, #24313f 0%, #171a21 33%);
    }

    .responsive_menu_user_persona {
      line-height: 36px;
      padding-bottom: 12px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .responsive_menu_user_persona .playerAvatar {
      display: inline-block;
      vertical-align: middle;
      margin-right: 8px;
    }

    .responsive_change_language_select {
      font-size: 24px;
    }

    .responsive_menu_cartwallet_area {
      font-size: 16px;
      line-height: normal;
      margin-top: 12px;
    }


    @media screen and (max-width: 910px) {

      html.responsive div#global_header {
        display: none;
      }

      html.responsive div.responsive_header {
        display: block;
      }

      html.responsive div.responsive_page_content {
        position: relative;
        z-index: 10;
      }

      html.responsive .responsive_page_frame.with_header div.responsive_page_content {
        padding-top: 62px;
        /* the header overlaps this area */
      }

      /* we show a footer in the menu itself */
      html.responsive div#footer,
      html.responsive div#footer_spacer {
        display: none;
      }

      html.responsive .responsive_page_template_content {
        padding-bottom: 120px;
        min-height: calc(100vh - 120px);
      }

      html.responsive .perf_timing_area {
        margin-top: -22px;
        position: relative;
        z-index: 30;
      }

      html.responsive .responsive_hidden {
        display: none;
      }

      html.responsive h2.nonresponsive_hidden {
        display: block;
      }

      html.responsive div.nonresponsive_hidden {
        display: block;
      }


    }

    html.responsive.touch div#global_header {
      display: none;
    }

    html.responsive.touch div.responsive_header {
      display: block;
    }

    html.responsive.touch div.responsive_page_content {
      position: relative;
      z-index: 10;
    }

    html.responsive.touch .responsive_page_frame.with_header div.responsive_page_content {
      padding-top: 62px;
      /* the header overlaps this area */
    }

    /* we show a footer in the menu itself */
    html.responsive.touch div#footer,
    html.responsive.touch div#footer_spacer {
      display: none;
    }

    html.responsive.touch .responsive_page_template_content {
      padding-bottom: 120px;
      min-height: calc(100vh - 120px);
    }

    html.responsive.touch .perf_timing_area {
      margin-top: -22px;
      position: relative;
      z-index: 30;
    }

    html.responsive.touch .responsive_hidden {
      display: none;
    }

    html.responsive.touch h2.nonresponsive_hidden {
      display: block;
    }

    html.responsive.touch div.nonresponsive_hidden {
      display: block;
    }


    .perf_timing_area {
      /*display: none;*/
      margin-bottom: 0;
    }

    .perf_timing_data {
      width: auto;
    }

    .responsive_page_menu div.responsive_menu_only {
      display: block;
    }

    .responsive_page_menu span.responsive_menu_only {
      display: inline;
    }

    @media screen and (max-width: 910px) {
      html.responsive span.nonresponsive_hidden {
        display: inline;
      }

      html.responsive img.nonresponsive_hidden {
        display: block;
      }

      html.responsive a.nonresponsive_hidden {
        display: block;
      }
    }

    .responsive_tab_control select {
      color: #ffffff;
      background: rgba(0, 0, 0, 0.3);
      /*background: #3a6d8b;*/
      padding: unset;
      border: none;
      font-size: 16px;
      height: 24px;
      max-width: 98%;
      min-width: 250px;
      font-family: "Motiva Sans", Sans-serif;
      font-weight: 200;
      /* thin */

    }

    .responsive_tab_control select option {
      background: #3a6d8b;
    }

    /* If the user has opted to "view desktop site", we add a button to the bottom of the footer
	to opt back in to the mobile site.  This is button repsonds to device width
	so that it's bigger on smaller screens and easier to tap when zoomed out */

    html.force_desktop body #footer .responsive_optin_link {
      display: block;
      text-align: center;
      padding: 20px 0;
    }

    html.force_desktop body #footer_responsive_optin_spacer {
      height: 64px;
    }

    .responsive_optin_link .btn_medium>span {
      line-height: 150%;
    }

    @media screen and (max-device-width: 640px) {
      .responsive_optin_link .btn_medium>span {
        font-size: 22px;
      }

      html.force_desktop body #footer_responsive_optin_spacer {
        height: 75px;
      }
    }

    @media screen and (max-device-width: 500px) {
      .responsive_optin_link .btn_medium>span {
        font-size: 26px;
      }

      html.force_desktop body #footer .responsive_optin_link {
        padding: 25px 0;
      }

      html.force_desktop body #footer_responsive_optin_spacer {
        height: 91px;
      }
    }

    @media screen and (max-device-width: 400px) {
      .responsive_optin_link .btn_medium>span {
        font-size: 34px;
      }

      html.force_desktop body #footer .responsive_optin_link {
        padding: 40px 0;
      }

      html.force_desktop body #footer_responsive_optin_spacer {
        height: 133px;
      }

    }

    @media print {

      html .responsive_page_menu_ctn.mainmenu,
      html .responsive_local_menu_tab,
      html .responsive_page_menu_ctn.localmenu,
      html .responsive_header {
        display: none;
      }
    }

    .responsive_fixonscroll_ctn {
      position: fixed;
      left: 0;
      right: 0;
      background: #171a21;
      box-shadow: 0 2px 4px 0 #000000;
      z-index: 15;
    }

    .responsive_app_menu {
      display: flex;
      flex-direction: row;
      cursor: pointer;
    }

    .responsive_app_menu .menu_ellipses {
      width: 6px;
      height: 6px;
      background: #8A97A0;
      border-radius: 3px;
      margin-right: 3px;
    }

    @media screen and (max-width: 910px) {

      html.responsive:not(.legacy_mobile) .responsive_scroll_snap_start {
        scroll-snap-align: start;
        overflow: visible;
      }

      html.responsive:not(.legacy_mobile) .responsive_scroll_snap_ctn {
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
      }

      html.responsive div.responsive_tab_baseline {
        display: none;
      }


    }

    html.responsive.tablet:not(.legacy_mobile) .responsive_scroll_snap_start {
      scroll-snap-align: start;
      overflow: visible;
    }

    html.responsive.tablet:not(.legacy_mobile) .responsive_scroll_snap_ctn {
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
    }

    html.responsive.tablet div.responsive_tab_baseline {
      display: none;
    }


    @media screen and (max-width: 910px) {}

    html.responsive body.OverlayWindowPinned div.responsive_header {
      display: none;
    }

    html.responsive body.OverlayWindowPinned.responsive_page .responsive_page_frame.with_header div.responsive_page_content {
      padding-top: 0px;
    }

    html.responsive body.OverlayWindowPinnedView div.responsive_local_menu_tab {
      display: none;
    }

    html.responsive body.OverlayWindowPinnedView.responsive_page {
      overflow: hidden;
      background: none;
    }


    .a:focus {
      outline: 0 none;
    }

    #headerBar {
      text-align: left;
      margin: 0;
      padding: 0;
      background-color: #111111;
      width: 100%;
      color: #545454;
      font-size: 10px;
      margin-bottom: 0;
    }

    a.headerLink,
    a.headerLink:active,
    a.headerLink:visited,
    a.headerLink:hover {
      text-decoration: none;
      color: #959595;
    }

    #headerRight {
      float: right;
      padding: 0;
      margin: 0;
      padding-right: 27px;
    }

    #headerLinks>p {
      margin-bottom: 0;
      padding-bottom: 0;
    }

    #headerRight .personaName {
      color: #cfcfcf;
    }

    .headerLinkActive {
      color: #cfcfcf;
      font-weight: bold;
    }

    #steamLogo {
      float: left;
      margin: 0;
      padding: 0;
      width: 105px;
      height: 54px;
    }

    #steamText {
      margin: 0;
      padding: 0;
      height: 35px;
    }

    #headerLinks {
      margin: 0;
      padding: 0;
      height: 19px;
    }

    #headerLinks>p {
      padding-left: 6px;
    }

    #subHeader {
      position: relative;
      margin: 0;
      padding: 0;
      height: 36px;
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/header/lowerBarBG.gif');
      background-repeat: repeat-x;
      padding-left: 111px;
      color: #344c5f;
      margin-top: 1px;
    }

    .subHeaderMargin {
      padding-top: 8px;
    }

    a.subHeaderLink,
    a.subHeaderLink:hover,
    a.subHeaderLink:visited,
    a.subHeaderLink:active {
      color: #6f9fc8;
      text-decoration: none;
    }

    .subHeaderLinkActive {
      color: #8ecbff;
      font-weight: bold;
    }

    #searchBox {
      float: right;
      position: relative;
      margin: 0;
      padding: 0;
      padding-right: 27px;
      padding-top: 7px;
    }

    #searchInputBox {
      margin-top: -6px;
      width: 170px;
      color: #909090;
    }

    #searchText {
      font-style: italic;
      color: #6f9fc8;
    }

    #betaTag {
      text-align: center;
      position: absolute;
      top: 4px;
      left: 45px;
      border: none;
      z-index: 99;
    }

    #betaText {
      position: absolute;
      top: 34px;
      left: 115px;
      border: none;
      z-index: 99;
    }

    #reportAbuse {
      position: absolute;
      display: block;
      visibility: visible;
      width: auto;
      height: auto;
      top: 32px;
      left: 0;
      margin: 0;
      padding: 0;
      color: #ffffff;
      z-index: 150;
    }

    #reportAbuseNew {
      position: absolute;
      display: block;
      visibility: visible;
      width: auto;
      height: auto;
      top: 36px;
      z-index: 150;
    }

    #rAText {
      float: left;
      display: block;
      visibility: visible;
      background-color: #3f3f3f;
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/header/reportAbuseBG.gif');
      background-repeat: repeat-x;
      width: auto;
      margin: 0;
      padding: 0;
      height: 20px;
      line-height: 18px;
      padding-left: 6px;
      padding-right: 6px;
    }

    #abuseReportLink {
      color: #bebebe;
      text-decoration: none;
    }

    #rALeft,
    #rARight {
      float: left;
      width: 3px;
      height: 20px;
      margin: 0;
      padding: 0;
    }

    #rALeft {
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/header/reportAbuseLeft.gif');
    }

    #rARight {
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/header/reportAbuseRight.gif');
    }

    #reporter {
      position: absolute;
      display: none;
      visibility: visible;
      border: solid #595959 1px;
      background-color: #3f3f3f;
      margin: 0;
      width: 200px;
      left: -86px;
      top: 20px;
      padding: 6px;
      color: #898989;
      font-size: 11px;
      line-height: 14px;
      z-index: 180;
    }

    #reporter>a,
    #reporter>a:hover,
    #reporter>a:visited,
    #reporter>a:active {
      display: inline;
      visibility: visible;
      color: #e1e1e1;
      text-decoration: none;
      font-size: 11px;
    }

    #reporter.profile {
      left: 0;
      top: 10px;
    }

    #abuseForm {
      margin: 0;
      padding: 0;
    }

    .abuseRadio {
      border: none;
      background-color: #3f3f3f;
    }

    #abuseDescriptionLabel {
      display: block;
      margin-top: 4px;
      color: #777777;
      font-style: italic;
    }

    img {
      border: none;
    }

    .community_sub_nav {
      position: absolute;
      left: 7px;
      top: 65px;
      width: 650px;
      font-size: 14px;
    }


    /*
 * GENERIC POPUP
 */


    .pulldown {
      padding-left: 5px;
      padding-right: 18px;
      background-image: url('data:image/gif;base64,R0lGODlhEwAMAIABAMXDwgAAACH5BAEAAAEALAAAAAATAAwAAAIUjI+py+0PEZh0wmpjjSfzD4aiUQAAOw==');
      background-position: right center;
      background-repeat: no-repeat;

      cursor: pointer;
    }

    .popup_block {
      z-index: 200;
      position: absolute;
    }

    .popup_block .popup_body {
      position: relative;
      background-color: #171a21;
    }

    .popup_block .header {
      padding: 4px 16px;
      height: 18px;

      font-size: 12px;
      font-weight: bold;
      color: #d6d7d8;

      background-image: url(https://community.cloudflare.steamstatic.com/public/images/header/maincol_bg_gray.png);
      background-repeat: no-repeat;
      background-color: #303030;
    }

    .popup_menu_separator {
      margin: 8px;
      height: 1px;
      background-color: #262a31;
    }

    .iepopupfix {
      display: none;
      position: absolute;
      top: 0px;
      right: 0px;
      left: 0px;
      bottom: 0px;
      overflow: hidden;
    }

    img.iepopupfix_img {
      width: 200px;
      height: 500px;
    }

    /*
 * User controls popup
 */

    div#userControls {
      width: 929px;
      padding: 18px 6px 20px 13px;
      text-align: left;
      position: relative;
      margin: 0px auto;
    }

    div#userControls a.userControlsLink {
      font-size: 12px;
      text-transform: uppercase;
    }

    /**
 * Community Navigation
 */
    #CommunityNavigation {
      position: relative;
      text-align: left;
      width: 947px;
      padding-top: 15px;
      padding-bottom: 15px;
      font-size: 12px;
      height: 15px;
    }

    #CommunityNavigation .link {
      text-transform: uppercase;
      padding-top: 24px;
      padding-left: 7px;
      padding-right: 7px;
      padding-bottom: 10px;
    }

    #CommunityNavigation .link.active {
      background-color: #191919;
      background: -moz-linear-gradient(top, rgba(25, 25, 25, 0) 0%, rgba(25, 25, 25, 1) 65%, rgba(25, 25, 25, 1) 100%);
      /* FF3.6+ */
      background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, rgba(25, 25, 25, 0)), color-stop(65%, rgba(25, 25, 25, 1)), color-stop(100%, rgba(25, 25, 25, 1)));
      /* Chrome,Safari4+ */
      background: -webkit-linear-gradient(top, rgba(25, 25, 25, 0) 0%, rgba(25, 25, 25, 1) 65%, rgba(25, 25, 25, 1) 100%);
      /* Chrome10+,Safari5.1+ */
      background: -o-linear-gradient(top, rgba(25, 25, 25, 0) 0%, rgba(25, 25, 25, 1) 65%, rgba(25, 25, 25, 1) 100%);
      /* Opera 11.10+ */
      background: -ms-linear-gradient(top, rgba(25, 25, 25, 0) 0%, rgba(25, 25, 25, 1) 65%, rgba(25, 25, 25, 1) 100%);
      /* IE10+ */
      background: linear-gradient(to bottom, rgba(25, 25, 25, 0) 0%, rgba(25, 25, 25, 1) 65%, rgba(25, 25, 25, 1) 100%);
      /* W3C */
      filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#00191919', endColorstr='#191919', GradientType=0);
      /* IE6-9 */
    }

    div#headerSearch {
      float: right;
      position: relative;
      width: 280px;
      height: 27px;
      background-image: url(https://community.cloudflare.steamstatic.com/public/images/community/searchbox_friendactivity_bg.gif);
      background-repeat: no-repeat;
      padding: 0;
      margin: 0;
      margin-top: -5px;
    }

    #searchInputBoxNew {
      padding: 0;
      margin: 0;
      border: none;
      outline: none;
      position: absolute;
      top: 6px;
      left: 6px;
      width: 212px;
      background-color: #3a3a3a;
    }

    #searchSubmitImg {
      position: absolute;
      top: 5px;
      right: 4px;
      width: 23px;
      height: 18px;
      padding: 0;
      margin: 0;
      border: none;
    }

    #headerSearchForm {
      padding: 0;
      margin: 0;
    }

    /*
 * DROP SHADOWS
 */

    .shadow_content {
      margin: 12px;
    }

    .shadow_ul,
    .shadow_ur,
    .shadow_bl,
    .shadow_br {
      position: absolute;
      height: 12px;
      width: 12px;
      background-image: url(https://community.cloudflare.steamstatic.com/public/images/header/shadow_corners.png );
      background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAVRJREFUeNq0VlGyAiEMo8Dq/a+rCzj66E7IS/FLZjqgQtq0oWjpb1hah4k17xk08/rz2TbgOPs6z7kD4Ng4TFWAMzCb/zbIFLvFQQSYaXaATvNQ6aoBOIKyeYrcjJwtTAocQkBflxmE2zG/Y0ZcP2diRUTuVsHBAVYEuIk6hDXIAHIQA99/TvMzz3nGozesgWJQKC0HOEuCxSDZuhNZZOXgBvN7PAh8QJE7YI1K2s6ChUd/Bwcs17c1OOtqsgo3lBkgi9u0O+ncgdvc3win5fTjoe6BumyYljZr8JjqeYKqGl3CD32UVaecnoFaGJyBL1XVQAlNNDhsBecm+qUvlaA9q6vv1gQ4s7j2F9GGo+s/KHVoXTBIzCCJlCTRnhtEjNbVG1EEMDNR9WFgfhuWdm0bGXOPYZX1IPKLgW1StHsyQ8BvNYgYMJseAP979O3Xf1teAgwAvqvFROfF+RQAAAAASUVORK5CYII= );
    }

    .shadow_ul {
      top: 0;
      left: 0;
      background-position: top left;
    }

    .shadow_ur {
      top: 0;
      right: 0;
      background-position: top right;
    }

    .shadow_bl {
      bottom: 0;
      left: 0;
      background-position: bottom left;
    }

    .shadow_br {
      bottom: 0;
      right: 0;
      background-position: bottom right;
    }

    .shadow_top,
    .shadow_bottom {
      position: absolute;
      margin: 0 12px;
      height: 12px;
      left: 0;
      right: 0;
      background-image: url(https://community.cloudflare.steamstatic.com/public/images/header/shadow_topbottom.png );
      background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAaCAYAAAB2BDbRAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAD9JREFUeNo0zFEKQFAQAMB9u0hSEvc/IUk5gEb5mc+JiGj5kyh0GDBiwowFKzbsCBw4ceHGUwL0KCQa4uMVYAAMZQVwOy2LWAAAAABJRU5ErkJggg== );
      background-repeat: repeat-x;
    }

    .shadow_top {
      background-position: top;
      top: 0;
    }

    .shadow_bottom {
      background-position: bottom;
      bottom: 0;
    }

    .shadow_left,
    .shadow_right {
      position: absolute;
      top: 0;
      bottom: 0;
      margin: 12px 0;
      width: 12px;
      background-image: url(https://community.cloudflare.steamstatic.com/public/images/header/shadow_leftright.png );
      background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAABCAYAAADAW76WAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAD5JREFUeNosyssKQFAUAMBzkSQl8f9fKFIsyGuUxewmRUT6ZeQUlFTUNLR09Aw8jEzMLKxs7BycXNzffwUYAFWiDQPUjcVGAAAAAElFTkSuQmCC );
      background-repeat: repeat-y;
    }

    .shadow_left {
      background-position: left;
      left: 0;
    }

    .shadow_right {
      background-position: right;
      right: 0;
    }

    .suppress_shadow .shadow_ul,
    .suppress_shadow .shadow_ur,
    .suppress_shadow .shadow_bl,
    .suppress_shadow .shadow_br,
    .suppress_shadow .shadow_top,
    .suppress_shadow .shadow_bottom,
    .suppress_shadow .shadow_left,
    .suppress_shadow .shadow_right {
      background-image: none;
    }

    #reportAbuseModal {
      position: absolute;
      width: 516px;
      padding: 16px;
      z-index: 1000;
      background-color: #3a3a3a;
      text-align: left;
    }

    #reportAbuseModalClose {
      position: absolute;
      width: 11px;
      height: 11px;
      right: 12px;
      top: 12px;
    }

    #reportAbuseModalContents {
      font-size: 14px;
      color: #B0B0B0;
      max-width: 500px;
    }

    .reportAbuseModalRule {
      border-top: 1px solid #595959;
      margin-bottom: 8px;
      margin-top: 4px;
    }

    #reportAbuseModalContents .halfBox {
      width: 50%;
      float: left;
      margin-bottom: 10px;
    }

    #reportAbuseModal h1 {
      color: #fff;
      font-size: 20px
    }

    #abuseDescriptionArea {
      width: 100%;
      resize: none;
      font-size: 14px;
      color: #fff;
      background-color: #565658;
      border: none;
    }

    #abuseDescriptionArea::-webkit-input-placeholder {
      color: #aaa;
    }

    #abuseDescriptionArea::-moz-placeholder {
      /* Firefox 19+ */
      color: #aaa;
    }

    #abuseDescriptionArea:-ms-input-placeholder {
      color: #aaa;
    }

    .abuseDescriptionCtn {
      margin-bottom: 10px;
      padding: 4px 6px;
      background-color: #565658;
    }

    .abuseOptions {
      margin-bottom: 12px;
    }

    .abuseOption {
      float: left;
      width: 50%;
      margin-bottom: 8px;
    }

    @media screen and (max-width: 440px) {
      html.responsive .abuseOption {
        float: none;
        width: auto;
      }
    }

    .reportAbuseButtons {
      text-align: right;
    }

    .community_ban_notice {
      background-color: #a94847;
      color: #ffffff;
      font-size: 12px;

      padding: 6px;
      margin-bottom: 16px;
    }

    .community_ban_notice h3 {
      font-size: 14px;
      font-weight: normal;
      margin: 0px;
      padding: 0px;
    }

    .community_ban_notice a {
      text-decoration: underline;
    }

    /* temporary */
    .community_content_update_open_beta_wrapper {
      position: relative;
      min-width: 958px;
      overflow: hidden;
      margin: 0px auto;
    }

    .community_content_update_open_beta {
      position: relative;
      width: 958px;
      height: 177px;
    }

    .community_content_update_open_beta_bg {
      position: absolute;
      left: -108px;
      background-image: url('https://community.cloudflare.steamstatic.com/public/images/updates/communitycontent/community_banner.png');
      width: 1200px;
      height: 177px;
    }

    .community_content_update_text {
      text-align: left;
      padding-top: 40px;
      padding-left: 126px;
    }

    .community_content_update_coming_soon {
      font-size: 22px;
      font-weight: bold;
      color: #ffffff;
    }

    .community_content_update_get_it_now {
      font-size: 16px;
      color: #a6bfe3;
    }

    .community_content_update_links {
      font-size: 14px;
      color: #ffffff;
      padding-top: 30px;
    }

    .community_content_opt_in {
      position: absolute;
      width: 348px;
      right: 171px;
      top: 60px;
      font-size: 16px;
      color: #ffffff;
    }

    .community_content_opt_in_button {
      margin-top: 10px;
      font-size: 16px;
      font-weight: bold;
      color: #ffffff;
    }

    .menuitem.username {
      max-width: 250px;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
    }

    /* end temporary */
  </style>
  <script>

    /*  Prototype JavaScript framework, version 1.7
     *  (c) 2005-2010 Sam Stephenson
     *
     *  Prototype is freely distributable under the terms of an MIT-style license.
     *  For details, see the Prototype web site: http://www.prototypejs.org/
     *
     *--------------------------------------------------------------------------*/

    var Prototype = {

      Version: '1.7',

      Browser: (function () {
        var ua = navigator.userAgent;
        var isOpera = Object.prototype.toString.call(window.opera) == '[object Opera]';
        return {
          IE: !!window.attachEvent && !isOpera,
          Opera: isOpera,
          WebKit: ua.indexOf('AppleWebKit/') > -1,
          Gecko: ua.indexOf('Gecko') > -1 && ua.indexOf('KHTML') === -1,
          MobileSafari: /Apple.*Mobile/.test(ua)
        }
      })(),

      BrowserFeatures: {
        XPath: !!document.evaluate,

        SelectorsAPI: !!document.querySelector,

        ElementExtensions: (function () {
          var constructor = window.Element || window.HTMLElement;
          return !!(constructor && constructor.prototype);
        })(),
        SpecificElementExtensions: (function () {
          if (typeof window.HTMLDivElement !== 'undefined')
            return true;

          var div = document.createElement('div'),
            form = document.createElement('form'),
            isSupported = false;

          if (div['__proto__'] && (div['__proto__'] !== form['__proto__'])) {
            isSupported = true;
          }

          div = form = null;

          return isSupported;
        })()
      },

      ScriptFragment: '<script[^>]*>([\\S\\s]*?)<\/script>',
      JSONFilter: /^\/\*-secure-([\s\S]*)\*\/\s*$/,

      emptyFunction: function () { },

      K: function (x) { return x }
    };

    if (Prototype.Browser.MobileSafari)
      Prototype.BrowserFeatures.SpecificElementExtensions = false;


    var Abstract = {};


    var Try = {
      these: function () {
        var returnValue;

        for (var i = 0, length = arguments.length; i < length; i++) {
          var lambda = arguments[i];
          try {
            returnValue = lambda();
            break;
          } catch (e) { }
        }

        return returnValue;
      }
    };

    /* Based on Alex Arnell's inheritance implementation. */

    var Class = (function () {

      var IS_DONTENUM_BUGGY = (function () {
        for (var p in { toString: 1 }) {
          if (p === 'toString') return false;
        }
        return true;
      })();

      function subclass() { };
      function create() {
        var parent = null, properties = $A(arguments);
        if (Object.isFunction(properties[0]))
          parent = properties.shift();

        function klass() {
          this.initialize.apply(this, arguments);
        }

        Object.extend(klass, Class.Methods);
        klass.superclass = parent;
        klass.subclasses = [];

        if (parent) {
          subclass.prototype = parent.prototype;
          klass.prototype = new subclass;
          parent.subclasses.push(klass);
        }

        for (var i = 0, length = properties.length; i < length; i++)
          klass.addMethods(properties[i]);

        if (!klass.prototype.initialize)
          klass.prototype.initialize = Prototype.emptyFunction;

        klass.prototype.constructor = klass;
        return klass;
      }

      function addMethods(source) {
        var ancestor = this.superclass && this.superclass.prototype,
          properties = Object.keys(source);

        if (IS_DONTENUM_BUGGY) {
          if (source.toString != Object.prototype.toString)
            properties.push("toString");
          if (source.valueOf != Object.prototype.valueOf)
            properties.push("valueOf");
        }

        for (var i = 0, length = properties.length; i < length; i++) {
          var property = properties[i], value = source[property];
          if (ancestor && Object.isFunction(value) &&
            value.argumentNames()[0] == "$super") {
            var method = value;
            value = (function (m) {
              return function () { return ancestor[m].apply(this, arguments); };
            })(property).wrap(method);

            value.valueOf = method.valueOf.bind(method);
            value.toString = method.toString.bind(method);
          }
          this.prototype[property] = value;
        }

        return this;
      }

      return {
        create: create,
        Methods: {
          addMethods: addMethods
        }
      };
    })();
    (function () {

      var _toString = Object.prototype.toString,
        NULL_TYPE = 'Null',
        UNDEFINED_TYPE = 'Undefined',
        BOOLEAN_TYPE = 'Boolean',
        NUMBER_TYPE = 'Number',
        STRING_TYPE = 'String',
        OBJECT_TYPE = 'Object',
        FUNCTION_CLASS = '[object Function]',
        BOOLEAN_CLASS = '[object Boolean]',
        NUMBER_CLASS = '[object Number]',
        STRING_CLASS = '[object String]',
        ARRAY_CLASS = '[object Array]',
        DATE_CLASS = '[object Date]',
        NATIVE_JSON_STRINGIFY_SUPPORT = window.JSON &&
          typeof JSON.stringify === 'function' &&
          JSON.stringify(0) === '0' &&
          typeof JSON.stringify(Prototype.K) === 'undefined';

      function Type(o) {
        switch (o) {
          case null: return NULL_TYPE;
          case (void 0): return UNDEFINED_TYPE;
        }
        var type = typeof o;
        switch (type) {
          case 'boolean': return BOOLEAN_TYPE;
          case 'number': return NUMBER_TYPE;
          case 'string': return STRING_TYPE;
        }
        return OBJECT_TYPE;
      }

      function extend(destination, source) {
        for (var property in source)
          destination[property] = source[property];
        return destination;
      }

      function inspect(object) {
        try {
          if (isUndefined(object)) return 'undefined';
          if (object === null) return 'null';
          return object.inspect ? object.inspect() : String(object);
        } catch (e) {
          if (e instanceof RangeError) return '...';
          throw e;
        }
      }

      function toJSON(value) {
        return Str('', { '': value }, []);
      }

      function Str(key, holder, stack) {
        var value = holder[key],
          type = typeof value;

        if (Type(value) === OBJECT_TYPE && typeof value.toJSON === 'function') {
          value = value.toJSON(key);
        }

        var _class = _toString.call(value);

        switch (_class) {
          case NUMBER_CLASS:
          case BOOLEAN_CLASS:
          case STRING_CLASS:
            value = value.valueOf();
        }

        switch (value) {
          case null: return 'null';
          case true: return 'true';
          case false: return 'false';
        }

        type = typeof value;
        switch (type) {
          case 'string':
            return value.inspect(true);
          case 'number':
            return isFinite(value) ? String(value) : 'null';
          case 'object':

            for (var i = 0, length = stack.length; i < length; i++) {
              if (stack[i] === value) { throw new TypeError(); }
            }
            stack.push(value);

            var partial = [];
            if (_class === ARRAY_CLASS) {
              for (var i = 0, length = value.length; i < length; i++) {
                var str = Str(i, value, stack);
                partial.push(typeof str === 'undefined' ? 'null' : str);
              }
              partial = '[' + partial.join(',') + ']';
            } else {
              var keys = Object.keys(value);
              for (var i = 0, length = keys.length; i < length; i++) {
                var key = keys[i], str = Str(key, value, stack);
                if (typeof str !== "undefined") {
                  partial.push(key.inspect(true) + ':' + str);
                }
              }
              partial = '{' + partial.join(',') + '}';
            }
            stack.pop();
            return partial;
        }
      }

      function stringify(object) {
        return JSON.stringify(object);
      }

      function toQueryString(object) {
        return $H(object).toQueryString();
      }

      function toHTML(object) {
        return object && object.toHTML ? object.toHTML() : String.interpret(object);
      }

      function keys(object) {
        if (Type(object) !== OBJECT_TYPE) { throw new TypeError(); }
        var results = [];
        for (var property in object) {
          if (object.hasOwnProperty(property)) {
            results.push(property);
          }
        }
        return results;
      }

      function values(object) {
        var results = [];
        for (var property in object)
          results.push(object[property]);
        return results;
      }

      function clone(object) {
        return extend({}, object);
      }

      function isElement(object) {
        return !!(object && object.nodeType == 1);
      }

      function isArray(object) {
        return _toString.call(object) === ARRAY_CLASS;
      }

      var hasNativeIsArray = (typeof Array.isArray == 'function')
        && Array.isArray([]) && !Array.isArray({});

      if (hasNativeIsArray) {
        isArray = Array.isArray;
      }

      function isHash(object) {
        return object instanceof Hash;
      }

      function isFunction(object) {
        return _toString.call(object) === FUNCTION_CLASS;
      }

      function isString(object) {
        return _toString.call(object) === STRING_CLASS;
      }

      function isNumber(object) {
        return _toString.call(object) === NUMBER_CLASS;
      }

      function isDate(object) {
        return _toString.call(object) === DATE_CLASS;
      }

      function isUndefined(object) {
        return typeof object === "undefined";
      }

      extend(Object, {
        extend: extend,
        inspect: inspect,
        toJSON: NATIVE_JSON_STRINGIFY_SUPPORT ? stringify : toJSON,
        toQueryString: toQueryString,
        toHTML: toHTML,
        keys: Object.keys || keys,
        values: values,
        clone: clone,
        isElement: isElement,
        isArray: isArray,
        isHash: isHash,
        isFunction: isFunction,
        isString: isString,
        isNumber: isNumber,
        isDate: isDate,
        isUndefined: isUndefined
      });
    })();
    Object.extend(Function.prototype, (function () {
      var slice = Array.prototype.slice;

      function update(array, args) {
        var arrayLength = array.length, length = args.length;
        while (length--) array[arrayLength + length] = args[length];
        return array;
      }

      function merge(array, args) {
        array = slice.call(array, 0);
        return update(array, args);
      }

      function argumentNames() {
        var names = this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1]
          .replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g, '')
          .replace(/\s+/g, '').split(',');
        return names.length == 1 && !names[0] ? [] : names;
      }

      function bind(context) {
        if (arguments.length < 2 && Object.isUndefined(arguments[0])) return this;
        var __method = this, args = slice.call(arguments, 1);
        return function () {
          var a = merge(args, arguments);
          return __method.apply(context, a);
        }
      }

      function bindAsEventListener(context) {
        var __method = this, args = slice.call(arguments, 1);
        return function (event) {
          var a = update([event || window.event], args);
          return __method.apply(context, a);
        }
      }

      function curry() {
        if (!arguments.length) return this;
        var __method = this, args = slice.call(arguments, 0);
        return function () {
          var a = merge(args, arguments);
          return __method.apply(this, a);
        }
      }

      function delay(timeout) {
        var __method = this, args = slice.call(arguments, 1);
        timeout = timeout * 1000;
        return window.setTimeout(function () {
          return __method.apply(__method, args);
        }, timeout);
      }

      function defer() {
        var args = update([0.01], arguments);
        return this.delay.apply(this, args);
      }

      function wrap(wrapper) {
        var __method = this;
        return function () {
          var a = update([__method.bind(this)], arguments);
          return wrapper.apply(this, a);
        }
      }

      function methodize() {
        if (this._methodized) return this._methodized;
        var __method = this;
        return this._methodized = function () {
          var a = update([this], arguments);
          return __method.apply(null, a);
        };
      }

      return {
        argumentNames: argumentNames,
        bind: bind,
        bindAsEventListener: bindAsEventListener,
        curry: curry,
        delay: delay,
        defer: defer,
        wrap: wrap,
        methodize: methodize
      }
    })());



    (function (proto) {


      function toISOString() {
        return this.getUTCFullYear() + '-' +
          (this.getUTCMonth() + 1).toPaddedString(2) + '-' +
          this.getUTCDate().toPaddedString(2) + 'T' +
          this.getUTCHours().toPaddedString(2) + ':' +
          this.getUTCMinutes().toPaddedString(2) + ':' +
          this.getUTCSeconds().toPaddedString(2) + 'Z';
      }


      function toJSON() {
        return this.toISOString();
      }

      if (!proto.toISOString) proto.toISOString = toISOString;
      if (!proto.toJSON) proto.toJSON = toJSON;

    })(Date.prototype);


    RegExp.prototype.match = RegExp.prototype.test;

    RegExp.escape = function (str) {
      return String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g, '\\$1');
    };
    var PeriodicalExecuter = Class.create({
      initialize: function (callback, frequency) {
        this.callback = callback;
        this.frequency = frequency;
        this.currentlyExecuting = false;

        this.registerCallback();
      },

      registerCallback: function () {
        this.timer = setInterval(this.onTimerEvent.bind(this), this.frequency * 1000);
      },

      execute: function () {
        this.callback(this);
      },

      stop: function () {
        if (!this.timer) return;
        clearInterval(this.timer);
        this.timer = null;
      },

      onTimerEvent: function () {
        if (!this.currentlyExecuting) {
          try {
            this.currentlyExecuting = true;
            this.execute();
            this.currentlyExecuting = false;
          } catch (e) {
            this.currentlyExecuting = false;
            throw e;
          }
        }
      }
    });
    Object.extend(String, {
      interpret: function (value) {
        return value == null ? '' : String(value);
      },
      specialChar: {
        '\b': '\\b',
        '\t': '\\t',
        '\n': '\\n',
        '\f': '\\f',
        '\r': '\\r',
        '\\': '\\\\'
      }
    });

    Object.extend(String.prototype, (function () {
      var NATIVE_JSON_PARSE_SUPPORT = window.JSON &&
        typeof JSON.parse === 'function' &&
        JSON.parse('{"test": true}').test;

      function prepareReplacement(replacement) {
        if (Object.isFunction(replacement)) return replacement;
        var template = new Template(replacement);
        return function (match) { return template.evaluate(match) };
      }

      function gsub(pattern, replacement) {
        var result = '', source = this, match;
        replacement = prepareReplacement(replacement);

        if (Object.isString(pattern))
          pattern = RegExp.escape(pattern);

        if (!(pattern.length || pattern.source)) {
          replacement = replacement('');
          return replacement + source.split('').join(replacement) + replacement;
        }

        while (source.length > 0) {
          if (match = source.match(pattern)) {
            result += source.slice(0, match.index);
            result += String.interpret(replacement(match));
            source = source.slice(match.index + match[0].length);
          } else {
            result += source, source = '';
          }
        }
        return result;
      }

      function sub(pattern, replacement, count) {
        replacement = prepareReplacement(replacement);
        count = Object.isUndefined(count) ? 1 : count;

        return this.gsub(pattern, function (match) {
          if (--count < 0) return match[0];
          return replacement(match);
        });
      }

      function scan(pattern, iterator) {
        this.gsub(pattern, iterator);
        return String(this);
      }

      function truncate(length, truncation) {
        length = length || 30;
        truncation = Object.isUndefined(truncation) ? '...' : truncation;
        return this.length > length ?
          this.slice(0, length - truncation.length) + truncation : String(this);
      }

      function strip() {
        return this.replace(/^\s+/, '').replace(/\s+$/, '');
      }

      function stripTags() {
        return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi, '');
      }

      function stripScripts() {
        return this.replace(new RegExp(Prototype.ScriptFragment, 'img'), '');
      }

      function extractScripts() {
        var matchAll = new RegExp(Prototype.ScriptFragment, 'img'),
          matchOne = new RegExp(Prototype.ScriptFragment, 'im');
        return (this.match(matchAll) || []).map(function (scriptTag) {
          return (scriptTag.match(matchOne) || ['', ''])[1];
        });
      }

      function evalScripts() {
        return this.extractScripts().map(function (script) { return eval(script) });
      }

      function escapeHTML() {
        return this.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
      }

      function unescapeHTML() {
        return this.stripTags().replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&');
      }


      function toQueryParams(separator) {
        var match = this.strip().match(/([^?#]*)(#.*)?$/);
        if (!match) return {};

        return match[1].split(separator || '&').inject({}, function (hash, pair) {
          if ((pair = pair.split('='))[0]) {
            var key = decodeURIComponent(pair.shift()),
              value = pair.length > 1 ? pair.join('=') : pair[0];

            if (value != undefined) value = decodeURIComponent(value);

            if (key in hash) {
              if (!Object.isArray(hash[key])) hash[key] = [hash[key]];
              hash[key].push(value);
            }
            else hash[key] = value;
          }
          return hash;
        });
      }

      function toArray() {
        return this.split('');
      }

      function succ() {
        return this.slice(0, this.length - 1) +
          String.fromCharCode(this.charCodeAt(this.length - 1) + 1);
      }

      function times(count) {
        return count < 1 ? '' : new Array(count + 1).join(this);
      }

      function camelize() {
        return this.replace(/-+(.)?/g, function (match, chr) {
          return chr ? chr.toUpperCase() : '';
        });
      }

      function capitalize() {
        return this.charAt(0).toUpperCase() + this.substring(1).toLowerCase();
      }

      function underscore() {
        return this.replace(/::/g, '/')
          .replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2')
          .replace(/([a-z\d])([A-Z])/g, '$1_$2')
          .replace(/-/g, '_')
          .toLowerCase();
      }

      function dasherize() {
        return this.replace(/_/g, '-');
      }

      function inspect(useDoubleQuotes) {
        var escapedString = this.replace(/[\x00-\x1f\\]/g, function (character) {
          if (character in String.specialChar) {
            return String.specialChar[character];
          }
          return '\\u00' + character.charCodeAt().toPaddedString(2, 16);
        });
        if (useDoubleQuotes) return '"' + escapedString.replace(/"/g, '\\"') + '"';
        return "'" + escapedString.replace(/'/g, '\\\'') + "'";
      }

      function unfilterJSON(filter) {
        return this.replace(filter || Prototype.JSONFilter, '$1');
      }

      function isJSON() {
        var str = this;
        if (str.blank()) return false;
        str = str.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@');
        str = str.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, ']');
        str = str.replace(/(?:^|:|,)(?:\s*\[)+/g, '');
        return (/^[\],:{}\s]*$/).test(str);
      }

      function evalJSON(sanitize) {
        var json = this.unfilterJSON(),
          cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;
        if (cx.test(json)) {
          json = json.replace(cx, function (a) {
            return '\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
          });
        }
        try {
          if (!sanitize || json.isJSON()) return eval('(' + json + ')');
        } catch (e) { }
        throw new SyntaxError('Badly formed JSON string: ' + this.inspect());
      }

      function parseJSON() {
        var json = this.unfilterJSON();
        return JSON.parse(json);
      }

      function include(pattern) {
        return this.indexOf(pattern) > -1;
      }

      function startsWith(pattern) {
        return this.lastIndexOf(pattern, 0) === 0;
      }

      function endsWith(pattern) {
        var d = this.length - pattern.length;
        return d >= 0 && this.indexOf(pattern, d) === d;
      }

      function empty() {
        return this == '';
      }

      function blank() {
        return /^\s*$/.test(this);
      }

      function interpolate(object, pattern) {
        return new Template(this, pattern).evaluate(object);
      }

      return {
        gsub: gsub,
        sub: sub,
        scan: scan,
        truncate: truncate,
        strip: String.prototype.trim || strip,
        stripTags: stripTags,
        stripScripts: stripScripts,
        extractScripts: extractScripts,
        evalScripts: evalScripts,
        escapeHTML: escapeHTML,
        unescapeHTML: unescapeHTML,
        toQueryParams: toQueryParams,
        parseQuery: toQueryParams,
        toArray: toArray,
        succ: succ,
        times: times,
        camelize: camelize,
        capitalize: capitalize,
        underscore: underscore,
        dasherize: dasherize,
        inspect: inspect,
        unfilterJSON: unfilterJSON,
        isJSON: isJSON,
        evalJSON: NATIVE_JSON_PARSE_SUPPORT ? parseJSON : evalJSON,
        include: include,
        startsWith: startsWith,
        endsWith: endsWith,
        empty: empty,
        blank: blank,
        interpolate: interpolate
      };
    })());

    var Template = Class.create({
      initialize: function (template, pattern) {
        this.template = template.toString();
        this.pattern = pattern || Template.Pattern;
      },

      evaluate: function (object) {
        if (object && Object.isFunction(object.toTemplateReplacements))
          object = object.toTemplateReplacements();

        return this.template.gsub(this.pattern, function (match) {
          if (object == null) return (match[1] + '');

          var before = match[1] || '';
          if (before == '\\') return match[2];

          var ctx = object, expr = match[3],
            pattern = /^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;

          match = pattern.exec(expr);
          if (match == null) return before;

          while (match != null) {
            var comp = match[1].startsWith('[') ? match[2].replace(/\\\\]/g, ']') : match[1];
            ctx = ctx[comp];
            if (null == ctx || '' == match[3]) break;
            expr = expr.substring('[' == match[3] ? match[1].length : match[0].length);
            match = pattern.exec(expr);
          }

          return before + String.interpret(ctx);
        });
      }
    });
    Template.Pattern = /(^|.|\r|\n)(#\{(.*?)\})/;

    var $break = {};

    var Enumerable = (function () {
      function each(iterator, context) {
        var index = 0;
        try {
          this._each(function (value) {
            iterator.call(context, value, index++);
          });
        } catch (e) {
          if (e != $break) throw e;
        }
        return this;
      }

      function eachSlice(number, iterator, context) {
        var index = -number, slices = [], array = this.toArray();
        if (number < 1) return array;
        while ((index += number) < array.length)
          slices.push(array.slice(index, index + number));
        return slices.collect(iterator, context);
      }

      function all(iterator, context) {
        iterator = iterator || Prototype.K;
        var result = true;
        this.each(function (value, index) {
          result = result && !!iterator.call(context, value, index);
          if (!result) throw $break;
        });
        return result;
      }

      function any(iterator, context) {
        iterator = iterator || Prototype.K;
        var result = false;
        this.each(function (value, index) {
          if (result = !!iterator.call(context, value, index))
            throw $break;
        });
        return result;
      }

      function collect(iterator, context) {
        iterator = iterator || Prototype.K;
        var results = [];
        this.each(function (value, index) {
          results.push(iterator.call(context, value, index));
        });
        return results;
      }

      function detect(iterator, context) {
        var result;
        this.each(function (value, index) {
          if (iterator.call(context, value, index)) {
            result = value;
            throw $break;
          }
        });
        return result;
      }

      function findAll(iterator, context) {
        var results = [];
        this.each(function (value, index) {
          if (iterator.call(context, value, index))
            results.push(value);
        });
        return results;
      }

      function grep(filter, iterator, context) {
        iterator = iterator || Prototype.K;
        var results = [];

        if (Object.isString(filter))
          filter = new RegExp(RegExp.escape(filter));

        this.each(function (value, index) {
          if (filter.match(value))
            results.push(iterator.call(context, value, index));
        });
        return results;
      }

      function include(object) {
        if (Object.isFunction(this.indexOf))
          if (this.indexOf(object) != -1) return true;

        var found = false;
        this.each(function (value) {
          if (value == object) {
            found = true;
            throw $break;
          }
        });
        return found;
      }

      function inGroupsOf(number, fillWith) {
        fillWith = Object.isUndefined(fillWith) ? null : fillWith;
        return this.eachSlice(number, function (slice) {
          while (slice.length < number) slice.push(fillWith);
          return slice;
        });
      }

      function inject(memo, iterator, context) {
        this.each(function (value, index) {
          memo = iterator.call(context, memo, value, index);
        });
        return memo;
      }

      function invoke(method) {
        var args = $A(arguments).slice(1);
        return this.map(function (value) {
          return value[method].apply(value, args);
        });
      }

      function max(iterator, context) {
        iterator = iterator || Prototype.K;
        var result;
        this.each(function (value, index) {
          value = iterator.call(context, value, index);
          if (result == null || value >= result)
            result = value;
        });
        return result;
      }

      function min(iterator, context) {
        iterator = iterator || Prototype.K;
        var result;
        this.each(function (value, index) {
          value = iterator.call(context, value, index);
          if (result == null || value < result)
            result = value;
        });
        return result;
      }

      function partition(iterator, context) {
        iterator = iterator || Prototype.K;
        var trues = [], falses = [];
        this.each(function (value, index) {
          (iterator.call(context, value, index) ?
            trues : falses).push(value);
        });
        return [trues, falses];
      }

      function pluck(property) {
        var results = [];
        this.each(function (value) {
          results.push(value[property]);
        });
        return results;
      }

      function reject(iterator, context) {
        var results = [];
        this.each(function (value, index) {
          if (!iterator.call(context, value, index))
            results.push(value);
        });
        return results;
      }

      function sortBy(iterator, context) {
        return this.map(function (value, index) {
          return {
            value: value,
            criteria: iterator.call(context, value, index)
          };
        }).sort(function (left, right) {
          var a = left.criteria, b = right.criteria;
          return a < b ? -1 : a > b ? 1 : 0;
        }).pluck('value');
      }

      function toArray() {
        return this.map();
      }

      function zip() {
        var iterator = Prototype.K, args = $A(arguments);
        if (Object.isFunction(args.last()))
          iterator = args.pop();

        var collections = [this].concat(args).map($A);
        return this.map(function (value, index) {
          return iterator(collections.pluck(index));
        });
      }

      function size() {
        return this.toArray().length;
      }

      function inspect() {
        return '#<Enumerable:' + this.toArray().inspect() + '>';
      }









      return {
        each: each,
        eachSlice: eachSlice,
        all: all,
        every: all,
        any: any,
        some: any,
        collect: collect,
        map: collect,
        detect: detect,
        findAll: findAll,
        select: findAll,
        filter: findAll,
        grep: grep,
        include: include,
        member: include,
        inGroupsOf: inGroupsOf,
        inject: inject,
        invoke: invoke,
        max: max,
        min: min,
        partition: partition,
        pluck: pluck,
        reject: reject,
        sortBy: sortBy,
        toArray: toArray,
        entries: toArray,
        zip: zip,
        size: size,
        inspect: inspect,
        find: detect
      };
    })();

    function $A(iterable) {
      if (!iterable) return [];
      if ('toArray' in Object(iterable)) return iterable.toArray();
      var length = iterable.length || 0, results = new Array(length);
      while (length--) results[length] = iterable[length];
      return results;
    }


    function $w(string) {
      if (!Object.isString(string)) return [];
      string = string.strip();
      return string ? string.split(/\s+/) : [];
    }

    Array.from = $A;


    (function () {
      var arrayProto = Array.prototype,
        slice = arrayProto.slice,
        _each = arrayProto.forEach; // use native browser JS 1.6 implementation if available

      function each(iterator, context) {
        for (var i = 0, length = this.length >>> 0; i < length; i++) {
          if (i in this) iterator.call(context, this[i], i, this);
        }
      }
      if (!_each) _each = each;

      function clear() {
        this.length = 0;
        return this;
      }

      function first() {
        return this[0];
      }

      function last() {
        return this[this.length - 1];
      }

      function compact() {
        return this.select(function (value) {
          return value != null;
        });
      }

      function flatten() {
        return this.inject([], function (array, value) {
          if (Object.isArray(value))
            return array.concat(value.flatten());
          array.push(value);
          return array;
        });
      }

      function without() {
        var values = slice.call(arguments, 0);
        return this.select(function (value) {
          return !values.include(value);
        });
      }

      function reverse(inline) {
        return (inline === false ? this.toArray() : this)._reverse();
      }

      function uniq(sorted) {
        return this.inject([], function (array, value, index) {
          if (0 == index || (sorted ? array.last() != value : !array.include(value)))
            array.push(value);
          return array;
        });
      }

      function intersect(array) {
        return this.uniq().findAll(function (item) {
          return array.detect(function (value) { return item === value });
        });
      }


      function clone() {
        return slice.call(this, 0);
      }

      function size() {
        return this.length;
      }

      function inspect() {
        return '[' + this.map(Object.inspect).join(', ') + ']';
      }

      function indexOf(item, i) {
        i || (i = 0);
        var length = this.length;
        if (i < 0) i = length + i;
        for (; i < length; i++)
          if (this[i] === item) return i;
        return -1;
      }

      function lastIndexOf(item, i) {
        i = isNaN(i) ? this.length : (i < 0 ? this.length + i : i) + 1;
        var n = this.slice(0, i).reverse().indexOf(item);
        return (n < 0) ? n : i - n - 1;
      }

      function concat() {
        var array = slice.call(this, 0), item;
        for (var i = 0, length = arguments.length; i < length; i++) {
          item = arguments[i];
          if (Object.isArray(item) && !('callee' in item)) {
            for (var j = 0, arrayLength = item.length; j < arrayLength; j++)
              array.push(item[j]);
          } else {
            array.push(item);
          }
        }
        return array;
      }

      Object.extend(arrayProto, Enumerable);

      if (!arrayProto._reverse)
        arrayProto._reverse = arrayProto.reverse;

      Object.extend(arrayProto, {
        _each: _each,
        clear: clear,
        first: first,
        last: last,
        compact: compact,
        flatten: flatten,
        without: without,
        reverse: reverse,
        uniq: uniq,
        intersect: intersect,
        clone: clone,
        toArray: clone,
        size: size,
        inspect: inspect
      });

      var CONCAT_ARGUMENTS_BUGGY = (function () {
        return [].concat(arguments)[0][0] !== 1;
      })(1, 2)

      if (CONCAT_ARGUMENTS_BUGGY) arrayProto.concat = concat;

      if (!arrayProto.indexOf) arrayProto.indexOf = indexOf;
      if (!arrayProto.lastIndexOf) arrayProto.lastIndexOf = lastIndexOf;
    })();
    function $H(object) {
      return new Hash(object);
    };

    var Hash = Class.create(Enumerable, (function () {
      function initialize(object) {
        this._object = Object.isHash(object) ? object.toObject() : Object.clone(object);
      }


      function _each(iterator) {
        for (var key in this._object) {
          var value = this._object[key], pair = [key, value];
          pair.key = key;
          pair.value = value;
          iterator(pair);
        }
      }

      function set(key, value) {
        return this._object[key] = value;
      }

      function get(key) {
        if (this._object[key] !== Object.prototype[key])
          return this._object[key];
      }

      function unset(key) {
        var value = this._object[key];
        delete this._object[key];
        return value;
      }

      function toObject() {
        return Object.clone(this._object);
      }



      function keys() {
        return this.pluck('key');
      }

      function values() {
        return this.pluck('value');
      }

      function index(value) {
        var match = this.detect(function (pair) {
          return pair.value === value;
        });
        return match && match.key;
      }

      function merge(object) {
        return this.clone().update(object);
      }

      function update(object) {
        return new Hash(object).inject(this, function (result, pair) {
          result.set(pair.key, pair.value);
          return result;
        });
      }

      function toQueryPair(key, value) {
        if (Object.isUndefined(value)) return key;
        return key + '=' + encodeURIComponent(String.interpret(value));
      }

      function toQueryString() {
        return this.inject([], function (results, pair) {
          var key = encodeURIComponent(pair.key), values = pair.value;

          if (values && typeof values == 'object') {
            if (Object.isArray(values)) {
              var queryValues = [];
              for (var i = 0, len = values.length, value; i < len; i++) {
                value = values[i];
                queryValues.push(toQueryPair(key, value));
              }
              return results.concat(queryValues);
            }
          } else results.push(toQueryPair(key, values));
          return results;
        }).join('&');
      }

      function inspect() {
        return '#<Hash:{' + this.map(function (pair) {
          return pair.map(Object.inspect).join(': ');
        }).join(', ') + '}>';
      }

      function clone() {
        return new Hash(this);
      }

      return {
        initialize: initialize,
        _each: _each,
        set: set,
        get: get,
        unset: unset,
        toObject: toObject,
        toTemplateReplacements: toObject,
        keys: keys,
        values: values,
        index: index,
        merge: merge,
        update: update,
        toQueryString: toQueryString,
        inspect: inspect,
        toJSON: toObject,
        clone: clone
      };
    })());

    Hash.from = $H;
    Object.extend(Number.prototype, (function () {
      function toColorPart() {
        return this.toPaddedString(2, 16);
      }

      function succ() {
        return this + 1;
      }

      function times(iterator, context) {
        $R(0, this, true).each(iterator, context);
        return this;
      }

      function toPaddedString(length, radix) {
        var string = this.toString(radix || 10);
        return '0'.times(length - string.length) + string;
      }

      function abs() {
        return Math.abs(this);
      }

      function round() {
        return Math.round(this);
      }

      function ceil() {
        return Math.ceil(this);
      }

      function floor() {
        return Math.floor(this);
      }

      return {
        toColorPart: toColorPart,
        succ: succ,
        times: times,
        toPaddedString: toPaddedString,
        abs: abs,
        round: round,
        ceil: ceil,
        floor: floor
      };
    })());

    function $R(start, end, exclusive) {
      return new ObjectRange(start, end, exclusive);
    }

    var ObjectRange = Class.create(Enumerable, (function () {
      function initialize(start, end, exclusive) {
        this.start = start;
        this.end = end;
        this.exclusive = exclusive;
      }

      function _each(iterator) {
        var value = this.start;
        while (this.include(value)) {
          iterator(value);
          value = value.succ();
        }
      }

      function include(value) {
        if (value < this.start)
          return false;
        if (this.exclusive)
          return value < this.end;
        return value <= this.end;
      }

      return {
        initialize: initialize,
        _each: _each,
        include: include
      };
    })());



    var Ajax = {
      getTransport: function () {
        return Try.these(
          function () { return new XMLHttpRequest() },
          function () { return new ActiveXObject('Msxml2.XMLHTTP') },
          function () { return new ActiveXObject('Microsoft.XMLHTTP') }
        ) || false;
      },

      activeRequestCount: 0
    };

    Ajax.Responders = {
      responders: [],

      _each: function (iterator) {
        this.responders._each(iterator);
      },

      register: function (responder) {
        if (!this.include(responder))
          this.responders.push(responder);
      },

      unregister: function (responder) {
        this.responders = this.responders.without(responder);
      },

      dispatch: function (callback, request, transport, json) {
        this.each(function (responder) {
          if (Object.isFunction(responder[callback])) {
            try {
              responder[callback].apply(responder, [request, transport, json]);
            } catch (e) { }
          }
        });
      }
    };

    Object.extend(Ajax.Responders, Enumerable);

    Ajax.Responders.register({
      onCreate: function () { Ajax.activeRequestCount++ },
      onComplete: function () { Ajax.activeRequestCount-- }
    });
    Ajax.Base = Class.create({
      initialize: function (options) {
        this.options = {
          method: 'post',
          asynchronous: true,
          contentType: 'application/x-www-form-urlencoded',
          encoding: 'UTF-8',
          parameters: '',
          evalJSON: true,
          evalJS: true
        };
        Object.extend(this.options, options || {});

        this.options.method = this.options.method.toLowerCase();

        if (Object.isHash(this.options.parameters))
          this.options.parameters = this.options.parameters.toObject();
      }
    });
    Ajax.Request = Class.create(Ajax.Base, {
      _complete: false,

      initialize: function ($super, url, options) {
        $super(options);
        this.transport = Ajax.getTransport();
        this.request(url);
      },

      request: function (url) {
        this.url = url;
        this.method = this.options.method;
        var params = Object.isString(this.options.parameters) ?
          this.options.parameters :
          Object.toQueryString(this.options.parameters);

        if (!['get', 'post'].include(this.method)) {
          params += (params ? '&' : '') + "_method=" + this.method;
          this.method = 'post';
        }

        if (params && this.method === 'get') {
          this.url += (this.url.include('?') ? '&' : '?') + params;
        }

        this.parameters = params.toQueryParams();

        try {
          var response = new Ajax.Response(this);
          if (this.options.onCreate) this.options.onCreate(response);
          Ajax.Responders.dispatch('onCreate', this, response);

          this.transport.open(this.method.toUpperCase(), this.url,
            this.options.asynchronous);

          if (this.options.asynchronous) this.respondToReadyState.bind(this).defer(1);

          this.transport.onreadystatechange = this.onStateChange.bind(this);
          this.setRequestHeaders();

          this.body = this.method == 'post' ? (this.options.postBody || params) : null;
          this.transport.send(this.body);

          /* Force Firefox to handle ready state 4 for synchronous requests */
          if (!this.options.asynchronous && this.transport.overrideMimeType)
            this.onStateChange();

        }
        catch (e) {
          this.dispatchException(e);
        }
      },

      onStateChange: function () {
        var readyState = this.transport.readyState;
        if (readyState > 1 && !((readyState == 4) && this._complete))
          this.respondToReadyState(this.transport.readyState);
      },

      setRequestHeaders: function () {
        var headers = {
          'X-Requested-With': 'XMLHttpRequest',
          'X-Prototype-Version': Prototype.Version,
          'Accept': 'text/javascript, text/html, application/xml, text/xml, */*'
        };

        if (this.method == 'post') {
          headers['Content-type'] = this.options.contentType +
            (this.options.encoding ? '; charset=' + this.options.encoding : '');

          /* Force "Connection: close" for older Mozilla browsers to work
           * around a bug where XMLHttpRequest sends an incorrect
           * Content-length header. See Mozilla Bugzilla #246651.
           */
          if (this.transport.overrideMimeType &&
            (navigator.userAgent.match(/Gecko\/(\d{4})/) || [0, 2005])[1] < 2005)
            headers['Connection'] = 'close';
        }

        if (typeof this.options.requestHeaders == 'object') {
          var extras = this.options.requestHeaders;

          if (Object.isFunction(extras.push))
            for (var i = 0, length = extras.length; i < length; i += 2)
              headers[extras[i]] = extras[i + 1];
          else
            $H(extras).each(function (pair) { headers[pair.key] = pair.value });
        }

        for (var name in headers)
          this.transport.setRequestHeader(name, headers[name]);
      },

      success: function () {
        var status = this.getStatus();
        return !status || (status >= 200 && status < 300) || status == 304;
      },

      getStatus: function () {
        try {
          if (this.transport.status === 1223) return 204;
          return this.transport.status || 0;
        } catch (e) { return 0 }
      },

      respondToReadyState: function (readyState) {
        var state = Ajax.Request.Events[readyState], response = new Ajax.Response(this);

        if (state == 'Complete') {
          try {
            this._complete = true;
            (this.options['on' + response.status]
              || this.options['on' + (this.success() ? 'Success' : 'Failure')]
              || Prototype.emptyFunction)(response, response.headerJSON);
          } catch (e) {
            this.dispatchException(e);
          }

          var contentType = response.getHeader('Content-type');
          if (this.options.evalJS == 'force'
            || (this.options.evalJS && this.isSameOrigin() && contentType
              && contentType.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i)))
            this.evalResponse();
        }

        try {
          (this.options['on' + state] || Prototype.emptyFunction)(response, response.headerJSON);
          Ajax.Responders.dispatch('on' + state, this, response, response.headerJSON);
        } catch (e) {
          this.dispatchException(e);
        }

        if (state == 'Complete') {
          this.transport.onreadystatechange = Prototype.emptyFunction;
        }
      },

      isSameOrigin: function () {
        var m = this.url.match(/^\s*https?:\/\/[^\/]*/);
        return !m || (m[0] == '#{protocol}//#{domain}#{port}'.interpolate({
          protocol: location.protocol,
          domain: document.domain,
          port: location.port ? ':' + location.port : ''
        }));
      },

      getHeader: function (name) {
        try {
          return this.transport.getResponseHeader(name) || null;
        } catch (e) { return null; }
      },

      evalResponse: function () {
        try {
          return eval((this.transport.responseText || '').unfilterJSON());
        } catch (e) {
          this.dispatchException(e);
        }
      },

      dispatchException: function (exception) {
        (this.options.onException || Prototype.emptyFunction)(this, exception);
        Ajax.Responders.dispatch('onException', this, exception);
      }
    });

    Ajax.Request.Events =
      ['Uninitialized', 'Loading', 'Loaded', 'Interactive', 'Complete'];








    Ajax.Response = Class.create({
      initialize: function (request) {
        this.request = request;
        var transport = this.transport = request.transport,
          readyState = this.readyState = transport.readyState;

        if ((readyState > 2 && !Prototype.Browser.IE) || readyState == 4) {
          this.status = this.getStatus();
          this.statusText = this.getStatusText();
          this.responseText = String.interpret(transport.responseText);
          this.headerJSON = this._getHeaderJSON();
        }

        if (readyState == 4) {
          var xml = transport.responseXML;
          this.responseXML = Object.isUndefined(xml) ? null : xml;
          this.responseJSON = this._getResponseJSON();
        }
      },

      status: 0,

      statusText: '',

      getStatus: Ajax.Request.prototype.getStatus,

      getStatusText: function () {
        try {
          return this.transport.statusText || '';
        } catch (e) { return '' }
      },

      getHeader: Ajax.Request.prototype.getHeader,

      getAllHeaders: function () {
        try {
          return this.getAllResponseHeaders();
        } catch (e) { return null }
      },

      getResponseHeader: function (name) {
        return this.transport.getResponseHeader(name);
      },

      getAllResponseHeaders: function () {
        return this.transport.getAllResponseHeaders();
      },

      _getHeaderJSON: function () {
        var json = this.getHeader('X-JSON');
        if (!json) return null;
        json = decodeURIComponent(escape(json));
        try {
          return json.evalJSON(this.request.options.sanitizeJSON ||
            !this.request.isSameOrigin());
        } catch (e) {
          this.request.dispatchException(e);
        }
      },

      _getResponseJSON: function () {
        var options = this.request.options;
        if (!options.evalJSON || (options.evalJSON != 'force' &&
          !(this.getHeader('Content-type') || '').include('application/json')) ||
          this.responseText.blank())
          return null;
        try {
          return this.responseText.evalJSON(options.sanitizeJSON ||
            !this.request.isSameOrigin());
        } catch (e) {
          this.request.dispatchException(e);
        }
      }
    });

    Ajax.Updater = Class.create(Ajax.Request, {
      initialize: function ($super, container, url, options) {
        this.container = {
          success: (container.success || container),
          failure: (container.failure || (container.success ? null : container))
        };

        options = Object.clone(options);
        var onComplete = options.onComplete;
        options.onComplete = (function (response, json) {
          this.updateContent(response.responseText);
          if (Object.isFunction(onComplete)) onComplete(response, json);
        }).bind(this);

        $super(url, options);
      },

      updateContent: function (responseText) {
        var receiver = this.container[this.success() ? 'success' : 'failure'],
          options = this.options;

        if (!options.evalScripts) responseText = responseText.stripScripts();

        if (receiver = $(receiver)) {
          if (options.insertion) {
            if (Object.isString(options.insertion)) {
              var insertion = {}; insertion[options.insertion] = responseText;
              receiver.insert(insertion);
            }
            else options.insertion(receiver, responseText);
          }
          else receiver.update(responseText);
        }
      }
    });

    Ajax.PeriodicalUpdater = Class.create(Ajax.Base, {
      initialize: function ($super, container, url, options) {
        $super(options);
        this.onComplete = this.options.onComplete;

        this.frequency = (this.options.frequency || 2);
        this.decay = (this.options.decay || 1);

        this.updater = {};
        this.container = container;
        this.url = url;

        this.start();
      },

      start: function () {
        this.options.onComplete = this.updateComplete.bind(this);
        this.onTimerEvent();
      },

      stop: function () {
        this.updater.options.onComplete = undefined;
        clearTimeout(this.timer);
        (this.onComplete || Prototype.emptyFunction).apply(this, arguments);
      },

      updateComplete: function (response) {
        if (this.options.decay) {
          this.decay = (response.responseText == this.lastText ?
            this.decay * this.options.decay : 1);

          this.lastText = response.responseText;
        }
        this.timer = this.onTimerEvent.bind(this).delay(this.decay * this.frequency);
      },

      onTimerEvent: function () {
        this.updater = new Ajax.Updater(this.container, this.url, this.options);
      }
    });


    function $(element) {
      if (arguments.length > 1) {
        for (var i = 0, elements = [], length = arguments.length; i < length; i++)
          elements.push($(arguments[i]));
        return elements;
      }
      if (Object.isString(element))
        element = document.getElementById(element);
      return Element.extend(element);
    }

    if (Prototype.BrowserFeatures.XPath) {
      document._getElementsByXPath = function (expression, parentElement) {
        var results = [];
        var query = document.evaluate(expression, $(parentElement) || document,
          null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
        for (var i = 0, length = query.snapshotLength; i < length; i++)
          results.push(Element.extend(query.snapshotItem(i)));
        return results;
      };
    }

    /*--------------------------------------------------------------------------*/

    if (!Node) var Node = {};

    if (!Node.ELEMENT_NODE) {
      Object.extend(Node, {
        ELEMENT_NODE: 1,
        ATTRIBUTE_NODE: 2,
        TEXT_NODE: 3,
        CDATA_SECTION_NODE: 4,
        ENTITY_REFERENCE_NODE: 5,
        ENTITY_NODE: 6,
        PROCESSING_INSTRUCTION_NODE: 7,
        COMMENT_NODE: 8,
        DOCUMENT_NODE: 9,
        DOCUMENT_TYPE_NODE: 10,
        DOCUMENT_FRAGMENT_NODE: 11,
        NOTATION_NODE: 12
      });
    }



    (function (global) {
      function shouldUseCache(tagName, attributes) {
        if (tagName === 'select') return false;
        if ('type' in attributes) return false;
        return true;
      }

      var HAS_EXTENDED_CREATE_ELEMENT_SYNTAX = (function () {
        try {
          var el = document.createElement('<input name="x">');
          return el.tagName.toLowerCase() === 'input' && el.name === 'x';
        }
        catch (err) {
          return false;
        }
      })();

      var element = global.Element;

      global.Element = function (tagName, attributes) {
        attributes = attributes || {};
        tagName = tagName.toLowerCase();
        var cache = Element.cache;

        if (HAS_EXTENDED_CREATE_ELEMENT_SYNTAX && attributes.name) {
          tagName = '<' + tagName + ' name="' + attributes.name + '">';
          delete attributes.name;
          return Element.writeAttribute(document.createElement(tagName), attributes);
        }

        if (!cache[tagName]) cache[tagName] = Element.extend(document.createElement(tagName));

        var node = shouldUseCache(tagName, attributes) ?
          cache[tagName].cloneNode(false) : document.createElement(tagName);

        return Element.writeAttribute(node, attributes);
      };

      Object.extend(global.Element, element || {});
      if (element) global.Element.prototype = element.prototype;

    })(this);

    Element.idCounter = 1;
    Element.cache = {};

    Element._purgeElement = function (element) {
      var uid = element._prototypeUID;
      if (uid) {
        Element.stopObserving(element);
        element._prototypeUID = void 0;
        delete Element.Storage[uid];
      }
    }

    Element.Methods = {
      visible: function (element) {
        return $(element).style.display != 'none';
      },

      toggle: function (element) {
        element = $(element);
        Element[Element.visible(element) ? 'hide' : 'show'](element);
        return element;
      },

      hide: function (element) {
        element = $(element);
        element.style.display = 'none';
        return element;
      },

      show: function (element) {
        element = $(element);
        element.style.display = '';
        return element;
      },

      remove: function (element) {
        element = $(element);
        element.parentNode.removeChild(element);
        return element;
      },

      update: (function () {

        var SELECT_ELEMENT_INNERHTML_BUGGY = (function () {
          var el = document.createElement("select"),
            isBuggy = true;
          el.innerHTML = "<option value=\"test\">test</option>";
          if (el.options && el.options[0]) {
            isBuggy = el.options[0].nodeName.toUpperCase() !== "OPTION";
          }
          el = null;
          return isBuggy;
        })();

        var TABLE_ELEMENT_INNERHTML_BUGGY = (function () {
          try {
            var el = document.createElement("table");
            if (el && el.tBodies) {
              el.innerHTML = "<tbody><tr><td>test</td></tr></tbody>";
              var isBuggy = typeof el.tBodies[0] == "undefined";
              el = null;
              return isBuggy;
            }
          } catch (e) {
            return true;
          }
        })();

        var LINK_ELEMENT_INNERHTML_BUGGY = (function () {
          try {
            var el = document.createElement('div');
            el.innerHTML = "<link>";
            var isBuggy = (el.childNodes.length === 0);
            el = null;
            return isBuggy;
          } catch (e) {
            return true;
          }
        })();

        var ANY_INNERHTML_BUGGY = SELECT_ELEMENT_INNERHTML_BUGGY ||
          TABLE_ELEMENT_INNERHTML_BUGGY || LINK_ELEMENT_INNERHTML_BUGGY;

        var SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING = (function () {
          var s = document.createElement("script"),
            isBuggy = false;
          try {
            s.appendChild(document.createTextNode(""));
            isBuggy = !s.firstChild ||
              s.firstChild && s.firstChild.nodeType !== 3;
          } catch (e) {
            isBuggy = true;
          }
          s = null;
          return isBuggy;
        })();


        function update(element, content) {
          element = $(element);
          var purgeElement = Element._purgeElement;

          var descendants = element.getElementsByTagName('*'),
            i = descendants.length;
          while (i--) purgeElement(descendants[i]);

          if (content && content.toElement)
            content = content.toElement();

          if (Object.isElement(content))
            return element.update().insert(content);

          content = Object.toHTML(content);

          var tagName = element.tagName.toUpperCase();

          if (tagName === 'SCRIPT' && SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING) {
            element.text = content;
            return element;
          }

          if (ANY_INNERHTML_BUGGY) {
            if (tagName in Element._insertionTranslations.tags) {
              while (element.firstChild) {
                element.removeChild(element.firstChild);
              }
              Element._getContentFromAnonymousElement(tagName, content.stripScripts())
                .each(function (node) {
                  element.appendChild(node)
                });
            } else if (LINK_ELEMENT_INNERHTML_BUGGY && Object.isString(content) && content.indexOf('<link') > -1) {
              while (element.firstChild) {
                element.removeChild(element.firstChild);
              }
              var nodes = Element._getContentFromAnonymousElement(tagName, content.stripScripts(), true);
              nodes.each(function (node) { element.appendChild(node) });
            }
            else {
              element.innerHTML = content.stripScripts();
            }
          }
          else {
            element.innerHTML = content.stripScripts();
          }

          content.evalScripts.bind(content).defer();
          return element;
        }

        return update;
      })(),

      replace: function (element, content) {
        element = $(element);
        if (content && content.toElement) content = content.toElement();
        else if (!Object.isElement(content)) {
          content = Object.toHTML(content);
          var range = element.ownerDocument.createRange();
          range.selectNode(element);
          content.evalScripts.bind(content).defer();
          content = range.createContextualFragment(content.stripScripts());
        }
        element.parentNode.replaceChild(content, element);
        return element;
      },

      insert: function (element, insertions) {
        element = $(element);

        if (Object.isString(insertions) || Object.isNumber(insertions) ||
          Object.isElement(insertions) || (insertions && (insertions.toElement || insertions.toHTML)))
          insertions = { bottom: insertions };

        var content, insert, tagName, childNodes;

        for (var position in insertions) {
          content = insertions[position];
          position = position.toLowerCase();
          insert = Element._insertionTranslations[position];

          if (content && content.toElement) content = content.toElement();
          if (Object.isElement(content)) {
            insert(element, content);
            continue;
          }

          content = Object.toHTML(content);

          tagName = ((position == 'before' || position == 'after')
            ? element.parentNode : element).tagName.toUpperCase();

          childNodes = Element._getContentFromAnonymousElement(tagName, content.stripScripts());

          if (position == 'top' || position == 'after') childNodes.reverse();
          childNodes.each(insert.curry(element));

          content.evalScripts.bind(content).defer();
        }

        return element;
      },

      wrap: function (element, wrapper, attributes) {
        element = $(element);
        if (Object.isElement(wrapper))
          $(wrapper).writeAttribute(attributes || {});
        else if (Object.isString(wrapper)) wrapper = new Element(wrapper, attributes);
        else wrapper = new Element('div', wrapper);
        if (element.parentNode)
          element.parentNode.replaceChild(wrapper, element);
        wrapper.appendChild(element);
        return wrapper;
      },

      inspect: function (element) {
        element = $(element);
        var result = '<' + element.tagName.toLowerCase();
        $H({ 'id': 'id', 'className': 'class' }).each(function (pair) {
          var property = pair.first(),
            attribute = pair.last(),
            value = (element[property] || '').toString();
          if (value) result += ' ' + attribute + '=' + value.inspect(true);
        });
        return result + '>';
      },

      recursivelyCollect: function (element, property, maximumLength) {
        element = $(element);
        maximumLength = maximumLength || -1;
        var elements = [];

        while (element = element[property]) {
          if (element.nodeType == 1)
            elements.push(Element.extend(element));
          if (elements.length == maximumLength)
            break;
        }

        return elements;
      },

      ancestors: function (element) {
        return Element.recursivelyCollect(element, 'parentNode');
      },

      descendants: function (element) {
        return Element.select(element, "*");
      },

      firstDescendant: function (element) {
        element = $(element).firstChild;
        while (element && element.nodeType != 1) element = element.nextSibling;
        return $(element);
      },

      immediateDescendants: function (element) {
        var results = [], child = $(element).firstChild;
        while (child) {
          if (child.nodeType === 1) {
            results.push(Element.extend(child));
          }
          child = child.nextSibling;
        }
        return results;
      },

      previousSiblings: function (element, maximumLength) {
        return Element.recursivelyCollect(element, 'previousSibling');
      },

      nextSiblings: function (element) {
        return Element.recursivelyCollect(element, 'nextSibling');
      },

      siblings: function (element) {
        element = $(element);
        return Element.previousSiblings(element).reverse()
          .concat(Element.nextSiblings(element));
      },

      match: function (element, selector) {
        element = $(element);
        if (Object.isString(selector))
          return Prototype.Selector.match(element, selector);
        return selector.match(element);
      },

      up: function (element, expression, index) {
        element = $(element);
        if (arguments.length == 1) return $(element.parentNode);
        var ancestors = Element.ancestors(element);
        return Object.isNumber(expression) ? ancestors[expression] :
          Prototype.Selector.find(ancestors, expression, index);
      },

      down: function (element, expression, index) {
        element = $(element);
        if (arguments.length == 1) return Element.firstDescendant(element);
        return Object.isNumber(expression) ? Element.descendants(element)[expression] :
          Element.select(element, expression)[index || 0];
      },

      previous: function (element, expression, index) {
        element = $(element);
        if (Object.isNumber(expression)) index = expression, expression = false;
        if (!Object.isNumber(index)) index = 0;

        if (expression) {
          return Prototype.Selector.find(element.previousSiblings(), expression, index);
        } else {
          return element.recursivelyCollect("previousSibling", index + 1)[index];
        }
      },

      next: function (element, expression, index) {
        element = $(element);
        if (Object.isNumber(expression)) index = expression, expression = false;
        if (!Object.isNumber(index)) index = 0;

        if (expression) {
          return Prototype.Selector.find(element.nextSiblings(), expression, index);
        } else {
          var maximumLength = Object.isNumber(index) ? index + 1 : 1;
          return element.recursivelyCollect("nextSibling", index + 1)[index];
        }
      },


      select: function (element) {
        element = $(element);
        var expressions = Array.prototype.slice.call(arguments, 1).join(', ');
        return Prototype.Selector.select(expressions, element);
      },

      adjacent: function (element) {
        element = $(element);
        var expressions = Array.prototype.slice.call(arguments, 1).join(', ');
        return Prototype.Selector.select(expressions, element.parentNode).without(element);
      },

      identify: function (element) {
        element = $(element);
        var id = Element.readAttribute(element, 'id');
        if (id) return id;
        do { id = 'anonymous_element_' + Element.idCounter++ } while ($(id));
        Element.writeAttribute(element, 'id', id);
        return id;
      },

      readAttribute: function (element, name) {
        element = $(element);
        if (Prototype.Browser.IE) {
          var t = Element._attributeTranslations.read;
          if (t.values[name]) return t.values[name](element, name);
          if (t.names[name]) name = t.names[name];
          if (name.include(':')) {
            return (!element.attributes || !element.attributes[name]) ? null :
              element.attributes[name].value;
          }
        }
        return element.getAttribute(name);
      },

      writeAttribute: function (element, name, value) {
        element = $(element);
        var attributes = {}, t = Element._attributeTranslations.write;

        if (typeof name == 'object') attributes = name;
        else attributes[name] = Object.isUndefined(value) ? true : value;

        for (var attr in attributes) {
          name = t.names[attr] || attr;
          value = attributes[attr];
          if (t.values[attr]) name = t.values[attr](element, value);
          if (value === false || value === null)
            element.removeAttribute(name);
          else if (value === true)
            element.setAttribute(name, name);
          else element.setAttribute(name, value);
        }
        return element;
      },

      getHeight: function (element) {
        return Element.getDimensions(element).height;
      },

      getWidth: function (element) {
        return Element.getDimensions(element).width;
      },

      classNames: function (element) {
        return new Element.ClassNames(element);
      },

      hasClassName: function (element, className) {
        if (!(element = $(element))) return;
        var elementClassName = element.className;
        return (elementClassName.length > 0 && (elementClassName == className ||
          new RegExp("(^|\\s)" + className + "(\\s|$)").test(elementClassName)));
      },

      addClassName: function (element, className) {
        if (!(element = $(element))) return;
        if (!Element.hasClassName(element, className))
          element.className += (element.className ? ' ' : '') + className;
        return element;
      },

      removeClassName: function (element, className) {
        if (!(element = $(element))) return;
        element.className = element.className.replace(
          new RegExp("(^|\\s+)" + className + "(\\s+|$)"), ' ').strip();
        return element;
      },

      toggleClassName: function (element, className) {
        if (!(element = $(element))) return;
        return Element[Element.hasClassName(element, className) ?
          'removeClassName' : 'addClassName'](element, className);
      },

      cleanWhitespace: function (element) {
        element = $(element);
        var node = element.firstChild;
        while (node) {
          var nextNode = node.nextSibling;
          if (node.nodeType == 3 && !/\S/.test(node.nodeValue))
            element.removeChild(node);
          node = nextNode;
        }
        return element;
      },

      empty: function (element) {
        return $(element).innerHTML.blank();
      },

      descendantOf: function (element, ancestor) {
        element = $(element), ancestor = $(ancestor);

        if (element.compareDocumentPosition)
          return (element.compareDocumentPosition(ancestor) & 8) === 8;

        if (ancestor.contains)
          return ancestor.contains(element) && ancestor !== element;

        while (element = element.parentNode)
          if (element == ancestor) return true;

        return false;
      },

      scrollTo: function (element) {
        element = $(element);
        var pos = Element.cumulativeOffset(element);
        window.scrollTo(pos[0], pos[1]);
        return element;
      },

      getStyle: function (element, style) {
        element = $(element);
        style = style == 'float' ? 'cssFloat' : style.camelize();
        var value = element.style[style];
        if (!value || value == 'auto') {
          var css = document.defaultView.getComputedStyle(element, null);
          value = css ? css[style] : null;
        }
        if (style == 'opacity') return value ? parseFloat(value) : 1.0;
        return value == 'auto' ? null : value;
      },

      getOpacity: function (element) {
        return $(element).getStyle('opacity');
      },

      setStyle: function (element, styles) {
        element = $(element);
        var elementStyle = element.style, match;
        if (Object.isString(styles)) {
          element.style.cssText += ';' + styles;
          return styles.include('opacity') ?
            element.setOpacity(styles.match(/opacity:\s*(\d?\.?\d*)/)[1]) : element;
        }
        for (var property in styles)
          if (property == 'opacity') element.setOpacity(styles[property]);
          else
            elementStyle[(property == 'float' || property == 'cssFloat') ?
              (Object.isUndefined(elementStyle.styleFloat) ? 'cssFloat' : 'styleFloat') :
              property] = styles[property];

        return element;
      },

      setOpacity: function (element, value) {
        element = $(element);
        element.style.opacity = (value == 1 || value === '') ? '' :
          (value < 0.00001) ? 0 : value;
        return element;
      },

      makePositioned: function (element) {
        element = $(element);
        var pos = Element.getStyle(element, 'position');
        if (pos == 'static' || !pos) {
          element._madePositioned = true;
          element.style.position = 'relative';
          if (Prototype.Browser.Opera) {
            element.style.top = 0;
            element.style.left = 0;
          }
        }
        return element;
      },

      undoPositioned: function (element) {
        element = $(element);
        if (element._madePositioned) {
          element._madePositioned = undefined;
          element.style.position =
            element.style.top =
            element.style.left =
            element.style.bottom =
            element.style.right = '';
        }
        return element;
      },

      makeClipping: function (element) {
        element = $(element);
        if (element._overflow) return element;
        element._overflow = Element.getStyle(element, 'overflow') || 'auto';
        if (element._overflow !== 'hidden')
          element.style.overflow = 'hidden';
        return element;
      },

      undoClipping: function (element) {
        element = $(element);
        if (!element._overflow) return element;
        element.style.overflow = element._overflow == 'auto' ? '' : element._overflow;
        element._overflow = null;
        return element;
      },

      clonePosition: function (element, source) {
        var options = Object.extend({
          setLeft: true,
          setTop: true,
          setWidth: true,
          setHeight: true,
          offsetTop: 0,
          offsetLeft: 0
        }, arguments[2] || {});

        source = $(source);
        var p = Element.viewportOffset(source), delta = [0, 0], parent = null;

        element = $(element);

        if (Element.getStyle(element, 'position') == 'absolute') {
          parent = Element.getOffsetParent(element);
          delta = Element.viewportOffset(parent);
        }

        if (parent == document.body) {
          delta[0] -= document.body.offsetLeft;
          delta[1] -= document.body.offsetTop;
        }

        if (options.setLeft) element.style.left = (p[0] - delta[0] + options.offsetLeft) + 'px';
        if (options.setTop) element.style.top = (p[1] - delta[1] + options.offsetTop) + 'px';
        if (options.setWidth) element.style.width = source.offsetWidth + 'px';
        if (options.setHeight) element.style.height = source.offsetHeight + 'px';
        return element;
      }
    };

    Object.extend(Element.Methods, {
      getElementsBySelector: Element.Methods.select,

      childElements: Element.Methods.immediateDescendants
    });

    Element._attributeTranslations = {
      write: {
        names: {
          className: 'class',
          htmlFor: 'for'
        },
        values: {}
      }
    };

    if (Prototype.Browser.Opera) {
      Element.Methods.getStyle = Element.Methods.getStyle.wrap(
        function (proceed, element, style) {
          switch (style) {
            case 'height': case 'width':
              if (!Element.visible(element)) return null;

              var dim = parseInt(proceed(element, style), 10);

              if (dim !== element['offset' + style.capitalize()])
                return dim + 'px';

              var properties;
              if (style === 'height') {
                properties = ['border-top-width', 'padding-top',
                  'padding-bottom', 'border-bottom-width'];
              }
              else {
                properties = ['border-left-width', 'padding-left',
                  'padding-right', 'border-right-width'];
              }
              return properties.inject(dim, function (memo, property) {
                var val = proceed(element, property);
                return val === null ? memo : memo - parseInt(val, 10);
              }) + 'px';
            default: return proceed(element, style);
          }
        }
      );

      Element.Methods.readAttribute = Element.Methods.readAttribute.wrap(
        function (proceed, element, attribute) {
          if (attribute === 'title') return element.title;
          return proceed(element, attribute);
        }
      );
    }

    else if (Prototype.Browser.IE) {
      Element.Methods.getStyle = function (element, style) {
        element = $(element);
        style = (style == 'float' || style == 'cssFloat') ? 'styleFloat' : style.camelize();
        var value = element.style[style];
        if (!value && element.currentStyle) value = element.currentStyle[style];

        if (style == 'opacity') {
          if (value = (element.getStyle('filter') || '').match(/alpha\(opacity=(.*)\)/))
            if (value[1]) return parseFloat(value[1]) / 100;
          return 1.0;
        }

        if (value == 'auto') {
          if ((style == 'width' || style == 'height') && (element.getStyle('display') != 'none'))
            return element['offset' + style.capitalize()] + 'px';
          return null;
        }
        return value;
      };

      Element.Methods.setOpacity = function (element, value) {
        function stripAlpha(filter) {
          return filter.replace(/alpha\([^\)]*\)/gi, '');
        }
        element = $(element);
        var currentStyle = element.currentStyle;
        if ((currentStyle && !currentStyle.hasLayout) ||
          (!currentStyle && element.style.zoom == 'normal'))
          element.style.zoom = 1;

        var filter = element.getStyle('filter'), style = element.style;
        if (value == 1 || value === '') {
          (filter = stripAlpha(filter)) ?
            style.filter = filter : style.removeAttribute('filter');
          return element;
        } else if (value < 0.00001) value = 0;
        style.filter = stripAlpha(filter) +
          'alpha(opacity=' + (value * 100) + ')';
        return element;
      };

      Element._attributeTranslations = (function () {

        var classProp = 'className',
          forProp = 'for',
          el = document.createElement('div');

        el.setAttribute(classProp, 'x');

        if (el.className !== 'x') {
          el.setAttribute('class', 'x');
          if (el.className === 'x') {
            classProp = 'class';
          }
        }
        el = null;

        el = document.createElement('label');
        el.setAttribute(forProp, 'x');
        if (el.htmlFor !== 'x') {
          el.setAttribute('htmlFor', 'x');
          if (el.htmlFor === 'x') {
            forProp = 'htmlFor';
          }
        }
        el = null;

        return {
          read: {
            names: {
              'class': classProp,
              'className': classProp,
              'for': forProp,
              'htmlFor': forProp
            },
            values: {
              _getAttr: function (element, attribute) {
                return element.getAttribute(attribute);
              },
              _getAttr2: function (element, attribute) {
                return element.getAttribute(attribute, 2);
              },
              _getAttrNode: function (element, attribute) {
                var node = element.getAttributeNode(attribute);
                return node ? node.value : "";
              },
              _getEv: (function () {

                var el = document.createElement('div'), f;
                el.onclick = Prototype.emptyFunction;
                var value = el.getAttribute('onclick');

                if (String(value).indexOf('{') > -1) {
                  f = function (element, attribute) {
                    attribute = element.getAttribute(attribute);
                    if (!attribute) return null;
                    attribute = attribute.toString();
                    attribute = attribute.split('{')[1];
                    attribute = attribute.split('}')[0];
                    return attribute.strip();
                  };
                }
                else if (value === '') {
                  f = function (element, attribute) {
                    attribute = element.getAttribute(attribute);
                    if (!attribute) return null;
                    return attribute.strip();
                  };
                }
                el = null;
                return f;
              })(),
              _flag: function (element, attribute) {
                return $(element).hasAttribute(attribute) ? attribute : null;
              },
              style: function (element) {
                return element.style.cssText.toLowerCase();
              },
              title: function (element) {
                return element.title;
              }
            }
          }
        }
      })();

      Element._attributeTranslations.write = {
        names: Object.extend({
          cellpadding: 'cellPadding',
          cellspacing: 'cellSpacing'
        }, Element._attributeTranslations.read.names),
        values: {
          checked: function (element, value) {
            element.checked = !!value;
          },

          style: function (element, value) {
            element.style.cssText = value ? value : '';
          }
        }
      };

      Element._attributeTranslations.has = {};

      $w('colSpan rowSpan vAlign dateTime accessKey tabIndex ' +
        'encType maxLength readOnly longDesc frameBorder').each(function (attr) {
          Element._attributeTranslations.write.names[attr.toLowerCase()] = attr;
          Element._attributeTranslations.has[attr.toLowerCase()] = attr;
        });

      (function (v) {
        Object.extend(v, {
          href: v._getAttr2,
          src: v._getAttr2,
          type: v._getAttr,
          action: v._getAttrNode,
          disabled: v._flag,
          checked: v._flag,
          readonly: v._flag,
          multiple: v._flag,
          onload: v._getEv,
          onunload: v._getEv,
          onclick: v._getEv,
          ondblclick: v._getEv,
          onmousedown: v._getEv,
          onmouseup: v._getEv,
          onmouseover: v._getEv,
          onmousemove: v._getEv,
          onmouseout: v._getEv,
          onfocus: v._getEv,
          onblur: v._getEv,
          onkeypress: v._getEv,
          onkeydown: v._getEv,
          onkeyup: v._getEv,
          onsubmit: v._getEv,
          onreset: v._getEv,
          onselect: v._getEv,
          onchange: v._getEv
        });
      })(Element._attributeTranslations.read.values);

      if (Prototype.BrowserFeatures.ElementExtensions) {
        (function () {
          function _descendants(element) {
            var nodes = element.getElementsByTagName('*'), results = [];
            for (var i = 0, node; node = nodes[i]; i++)
              if (node.tagName !== "!") // Filter out comment nodes.
                results.push(node);
            return results;
          }

          Element.Methods.down = function (element, expression, index) {
            element = $(element);
            if (arguments.length == 1) return element.firstDescendant();
            return Object.isNumber(expression) ? _descendants(element)[expression] :
              Element.select(element, expression)[index || 0];
          }
        })();
      }

    }

    else if (Prototype.Browser.Gecko && /rv:1\.8\.0/.test(navigator.userAgent)) {
      Element.Methods.setOpacity = function (element, value) {
        element = $(element);
        element.style.opacity = (value == 1) ? 0.999999 :
          (value === '') ? '' : (value < 0.00001) ? 0 : value;
        return element;
      };
    }

    else if (Prototype.Browser.WebKit) {
      Element.Methods.setOpacity = function (element, value) {
        element = $(element);
        element.style.opacity = (value == 1 || value === '') ? '' :
          (value < 0.00001) ? 0 : value;

        if (value == 1)
          if (element.tagName.toUpperCase() == 'IMG' && element.width) {
            element.width++; element.width--;
          } else try {
            var n = document.createTextNode(' ');
            element.appendChild(n);
            element.removeChild(n);
          } catch (e) { }

        return element;
      };
    }

    if ('outerHTML' in document.documentElement) {
      Element.Methods.replace = function (element, content) {
        element = $(element);

        if (content && content.toElement) content = content.toElement();
        if (Object.isElement(content)) {
          element.parentNode.replaceChild(content, element);
          return element;
        }

        content = Object.toHTML(content);
        var parent = element.parentNode, tagName = parent.tagName.toUpperCase();

        if (Element._insertionTranslations.tags[tagName]) {
          var nextSibling = element.next(),
            fragments = Element._getContentFromAnonymousElement(tagName, content.stripScripts());
          parent.removeChild(element);
          if (nextSibling)
            fragments.each(function (node) { parent.insertBefore(node, nextSibling) });
          else
            fragments.each(function (node) { parent.appendChild(node) });
        }
        else element.outerHTML = content.stripScripts();

        content.evalScripts.bind(content).defer();
        return element;
      };
    }

    Element._returnOffset = function (l, t) {
      var result = [l, t];
      result.left = l;
      result.top = t;
      return result;
    };

    Element._getContentFromAnonymousElement = function (tagName, html, force) {
      var div = new Element('div'),
        t = Element._insertionTranslations.tags[tagName];

      var workaround = false;
      if (t) workaround = true;
      else if (force) {
        workaround = true;
        t = ['', '', 0];
      }

      if (workaround) {
        div.innerHTML = '&nbsp;' + t[0] + html + t[1];
        div.removeChild(div.firstChild);
        for (var i = t[2]; i--;) {
          div = div.firstChild;
        }
      }
      else {
        div.innerHTML = html;
      }
      return $A(div.childNodes);
    };

    Element._insertionTranslations = {
      before: function (element, node) {
        element.parentNode.insertBefore(node, element);
      },
      top: function (element, node) {
        element.insertBefore(node, element.firstChild);
      },
      bottom: function (element, node) {
        element.appendChild(node);
      },
      after: function (element, node) {
        element.parentNode.insertBefore(node, element.nextSibling);
      },
      tags: {
        TABLE: ['<table>', '</table>', 1],
        TBODY: ['<table><tbody>', '</tbody></table>', 2],
        TR: ['<table><tbody><tr>', '</tr></tbody></table>', 3],
        TD: ['<table><tbody><tr><td>', '</td></tr></tbody></table>', 4],
        SELECT: ['<select>', '</select>', 1]
      }
    };

    (function () {
      var tags = Element._insertionTranslations.tags;
      Object.extend(tags, {
        THEAD: tags.TBODY,
        TFOOT: tags.TBODY,
        TH: tags.TD
      });
    })();

    Element.Methods.Simulated = {
      hasAttribute: function (element, attribute) {
        attribute = Element._attributeTranslations.has[attribute] || attribute;
        var node = $(element).getAttributeNode(attribute);
        return !!(node && node.specified);
      }
    };

    Element.Methods.ByTag = {};

    Object.extend(Element, Element.Methods);

    (function (div) {

      if (!Prototype.BrowserFeatures.ElementExtensions && div['__proto__']) {
        window.HTMLElement = {};
        window.HTMLElement.prototype = div['__proto__'];
        Prototype.BrowserFeatures.ElementExtensions = true;
      }

      div = null;

    })(document.createElement('div'));

    Element.extend = (function () {

      function checkDeficiency(tagName) {
        if (typeof window.Element != 'undefined') {
          var proto = window.Element.prototype;
          if (proto) {
            var id = '_' + (Math.random() + '').slice(2),
              el = document.createElement(tagName);
            proto[id] = 'x';
            var isBuggy = (el[id] !== 'x');
            delete proto[id];
            el = null;
            return isBuggy;
          }
        }
        return false;
      }

      function extendElementWith(element, methods) {
        for (var property in methods) {
          var value = methods[property];
          if (Object.isFunction(value) && !(property in element))
            element[property] = value.methodize();
        }
      }

      var HTMLOBJECTELEMENT_PROTOTYPE_BUGGY = checkDeficiency('object');

      if (Prototype.BrowserFeatures.SpecificElementExtensions) {
        if (HTMLOBJECTELEMENT_PROTOTYPE_BUGGY) {
          return function (element) {
            if (element && typeof element._extendedByPrototype == 'undefined') {
              var t = element.tagName;
              if (t && (/^(?:object|applet|embed)$/i.test(t))) {
                extendElementWith(element, Element.Methods);
                extendElementWith(element, Element.Methods.Simulated);
                extendElementWith(element, Element.Methods.ByTag[t.toUpperCase()]);
              }
            }
            return element;
          }
        }
        return Prototype.K;
      }

      var Methods = {}, ByTag = Element.Methods.ByTag;

      var extend = Object.extend(function (element) {
        if (!element || typeof element._extendedByPrototype != 'undefined' ||
          element.nodeType != 1 || element == window) return element;

        var methods = Object.clone(Methods),
          tagName = element.tagName.toUpperCase();

        if (ByTag[tagName]) Object.extend(methods, ByTag[tagName]);

        extendElementWith(element, methods);

        element._extendedByPrototype = Prototype.emptyFunction;
        return element;

      }, {
        refresh: function () {
          if (!Prototype.BrowserFeatures.ElementExtensions) {
            Object.extend(Methods, Element.Methods);
            Object.extend(Methods, Element.Methods.Simulated);
          }
        }
      });

      extend.refresh();
      return extend;
    })();

    if (document.documentElement.hasAttribute) {
      Element.hasAttribute = function (element, attribute) {
        return element.hasAttribute(attribute);
      };
    }
    else {
      Element.hasAttribute = Element.Methods.Simulated.hasAttribute;
    }

    Element.addMethods = function (methods) {
      var F = Prototype.BrowserFeatures, T = Element.Methods.ByTag;

      if (!methods) {
        Object.extend(Form, Form.Methods);
        Object.extend(Form.Element, Form.Element.Methods);
        Object.extend(Element.Methods.ByTag, {
          "FORM": Object.clone(Form.Methods),
          "INPUT": Object.clone(Form.Element.Methods),
          "SELECT": Object.clone(Form.Element.Methods),
          "TEXTAREA": Object.clone(Form.Element.Methods),
          "BUTTON": Object.clone(Form.Element.Methods)
        });
      }

      if (arguments.length == 2) {
        var tagName = methods;
        methods = arguments[1];
      }

      if (!tagName) Object.extend(Element.Methods, methods || {});
      else {
        if (Object.isArray(tagName)) tagName.each(extend);
        else extend(tagName);
      }

      function extend(tagName) {
        tagName = tagName.toUpperCase();
        if (!Element.Methods.ByTag[tagName])
          Element.Methods.ByTag[tagName] = {};
        Object.extend(Element.Methods.ByTag[tagName], methods);
      }

      function copy(methods, destination, onlyIfAbsent) {
        onlyIfAbsent = onlyIfAbsent || false;
        for (var property in methods) {
          var value = methods[property];
          if (!Object.isFunction(value)) continue;
          if (!onlyIfAbsent || !(property in destination))
            destination[property] = value.methodize();
        }
      }

      function findDOMClass(tagName) {
        var klass;
        var trans = {
          "OPTGROUP": "OptGroup", "TEXTAREA": "TextArea", "P": "Paragraph",
          "FIELDSET": "FieldSet", "UL": "UList", "OL": "OList", "DL": "DList",
          "DIR": "Directory", "H1": "Heading", "H2": "Heading", "H3": "Heading",
          "H4": "Heading", "H5": "Heading", "H6": "Heading", "Q": "Quote",
          "INS": "Mod", "DEL": "Mod", "A": "Anchor", "IMG": "Image", "CAPTION":
            "TableCaption", "COL": "TableCol", "COLGROUP": "TableCol", "THEAD":
            "TableSection", "TFOOT": "TableSection", "TBODY": "TableSection", "TR":
            "TableRow", "TH": "TableCell", "TD": "TableCell", "FRAMESET":
            "FrameSet", "IFRAME": "IFrame"
        };
        if (trans[tagName]) klass = 'HTML' + trans[tagName] + 'Element';
        if (window[klass]) return window[klass];
        klass = 'HTML' + tagName + 'Element';
        if (window[klass]) return window[klass];
        klass = 'HTML' + tagName.capitalize() + 'Element';
        if (window[klass]) return window[klass];

        var element = document.createElement(tagName),
          proto = element['__proto__'] || element.constructor.prototype;

        element = null;
        return proto;
      }

      var elementPrototype = window.HTMLElement ? HTMLElement.prototype :
        Element.prototype;

      if (F.ElementExtensions) {
        copy(Element.Methods, elementPrototype);
        copy(Element.Methods.Simulated, elementPrototype, true);
      }

      if (F.SpecificElementExtensions) {
        for (var tag in Element.Methods.ByTag) {
          var klass = findDOMClass(tag);
          if (Object.isUndefined(klass)) continue;
          copy(T[tag], klass.prototype);
        }
      }

      Object.extend(Element, Element.Methods);
      delete Element.ByTag;

      if (Element.extend.refresh) Element.extend.refresh();
      Element.cache = {};
    };


    document.viewport = {

      getDimensions: function () {
        return { width: this.getWidth(), height: this.getHeight() };
      },

      getScrollOffsets: function () {
        return Element._returnOffset(
          window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft,
          window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop);
      }
    };

    (function (viewport) {
      var B = Prototype.Browser, doc = document, element, property = {};

      function getRootElement() {
        if (B.WebKit && !doc.evaluate)
          return document;

        if (B.Opera && window.parseFloat(window.opera.version()) < 9.5)
          return document.body;

        return document.documentElement;
      }

      function define(D) {
        if (!element) element = getRootElement();

        property[D] = 'client' + D;

        viewport['get' + D] = function () { return element[property[D]] };
        return viewport['get' + D]();
      }

      viewport.getWidth = define.curry('Width');

      viewport.getHeight = define.curry('Height');
    })(document.viewport);


    Element.Storage = {
      UID: 1
    };

    Element.addMethods({
      getStorage: function (element) {
        if (!(element = $(element))) return;

        var uid;
        if (element === window) {
          uid = 0;
        } else {
          if (typeof element._prototypeUID === "undefined")
            element._prototypeUID = Element.Storage.UID++;
          uid = element._prototypeUID;
        }

        if (!Element.Storage[uid])
          Element.Storage[uid] = $H();

        return Element.Storage[uid];
      },

      store: function (element, key, value) {
        if (!(element = $(element))) return;

        if (arguments.length === 2) {
          Element.getStorage(element).update(key);
        } else {
          Element.getStorage(element).set(key, value);
        }

        return element;
      },

      retrieve: function (element, key, defaultValue) {
        if (!(element = $(element))) return;
        var hash = Element.getStorage(element), value = hash.get(key);

        if (Object.isUndefined(value)) {
          hash.set(key, defaultValue);
          value = defaultValue;
        }

        return value;
      },

      clone: function (element, deep) {
        if (!(element = $(element))) return;
        var clone = element.cloneNode(deep);
        clone._prototypeUID = void 0;
        if (deep) {
          var descendants = Element.select(clone, '*'),
            i = descendants.length;
          while (i--) {
            descendants[i]._prototypeUID = void 0;
          }
        }
        return Element.extend(clone);
      },

      purge: function (element) {
        if (!(element = $(element))) return;
        var purgeElement = Element._purgeElement;

        purgeElement(element);

        var descendants = element.getElementsByTagName('*'),
          i = descendants.length;

        while (i--) purgeElement(descendants[i]);

        return null;
      }
    });

    (function () {

      function toDecimal(pctString) {
        var match = pctString.match(/^(\d+)%?$/i);
        if (!match) return null;
        return (Number(match[1]) / 100);
      }

      function getPixelValue(value, property, context) {
        var element = null;
        if (Object.isElement(value)) {
          element = value;
          value = element.getStyle(property);
        }

        if (value === null) {
          return null;
        }

        if ((/^(?:-)?\d+(\.\d+)?(px)?$/i).test(value)) {
          return window.parseFloat(value);
        }

        var isPercentage = value.include('%'), isViewport = (context === document.viewport);

        if (/\d/.test(value) && element && element.runtimeStyle && !(isPercentage && isViewport)) {
          var style = element.style.left, rStyle = element.runtimeStyle.left;
          element.runtimeStyle.left = element.currentStyle.left;
          element.style.left = value || 0;
          value = element.style.pixelLeft;
          element.style.left = style;
          element.runtimeStyle.left = rStyle;

          return value;
        }

        if (element && isPercentage) {
          context = context || element.parentNode;
          var decimal = toDecimal(value);
          var whole = null;
          var position = element.getStyle('position');

          var isHorizontal = property.include('left') || property.include('right') ||
            property.include('width');

          var isVertical = property.include('top') || property.include('bottom') ||
            property.include('height');

          if (context === document.viewport) {
            if (isHorizontal) {
              whole = document.viewport.getWidth();
            } else if (isVertical) {
              whole = document.viewport.getHeight();
            }
          } else {
            if (isHorizontal) {
              whole = $(context).measure('width');
            } else if (isVertical) {
              whole = $(context).measure('height');
            }
          }

          return (whole === null) ? 0 : whole * decimal;
        }

        return 0;
      }

      function toCSSPixels(number) {
        if (Object.isString(number) && number.endsWith('px')) {
          return number;
        }
        return number + 'px';
      }

      function isDisplayed(element) {
        var originalElement = element;
        while (element && element.parentNode) {
          var display = element.getStyle('display');
          if (display === 'none') {
            return false;
          }
          element = $(element.parentNode);
        }
        return true;
      }

      var hasLayout = Prototype.K;
      if ('currentStyle' in document.documentElement) {
        hasLayout = function (element) {
          if (!element.currentStyle.hasLayout) {
            element.style.zoom = 1;
          }
          return element;
        };
      }

      function cssNameFor(key) {
        if (key.include('border')) key = key + '-width';
        return key.camelize();
      }

      Element.Layout = Class.create(Hash, {
        initialize: function ($super, element, preCompute) {
          $super();
          this.element = $(element);

          Element.Layout.PROPERTIES.each(function (property) {
            this._set(property, null);
          }, this);

          if (preCompute) {
            this._preComputing = true;
            this._begin();
            Element.Layout.PROPERTIES.each(this._compute, this);
            this._end();
            this._preComputing = false;
          }
        },

        _set: function (property, value) {
          return Hash.prototype.set.call(this, property, value);
        },

        set: function (property, value) {
          throw "Properties of Element.Layout are read-only.";
        },

        get: function ($super, property) {
          var value = $super(property);
          return value === null ? this._compute(property) : value;
        },

        _begin: function () {
          if (this._prepared) return;

          var element = this.element;
          if (isDisplayed(element)) {
            this._prepared = true;
            return;
          }

          var originalStyles = {
            position: element.style.position || '',
            width: element.style.width || '',
            visibility: element.style.visibility || '',
            display: element.style.display || ''
          };

          element.store('prototype_original_styles', originalStyles);

          var position = element.getStyle('position'),
            width = element.getStyle('width');

          if (width === "0px" || width === null) {
            element.style.display = 'block';
            width = element.getStyle('width');
          }

          var context = (position === 'fixed') ? document.viewport :
            element.parentNode;

          element.setStyle({
            position: 'absolute',
            visibility: 'hidden',
            display: 'block'
          });

          var positionedWidth = element.getStyle('width');

          var newWidth;
          if (width && (positionedWidth === width)) {
            newWidth = getPixelValue(element, 'width', context);
          } else if (position === 'absolute' || position === 'fixed') {
            newWidth = getPixelValue(element, 'width', context);
          } else {
            var parent = element.parentNode, pLayout = $(parent).getLayout();

            newWidth = pLayout.get('width') -
              this.get('margin-left') -
              this.get('border-left') -
              this.get('padding-left') -
              this.get('padding-right') -
              this.get('border-right') -
              this.get('margin-right');
          }

          element.setStyle({ width: newWidth + 'px' });

          this._prepared = true;
        },

        _end: function () {
          var element = this.element;
          var originalStyles = element.retrieve('prototype_original_styles');
          element.store('prototype_original_styles', null);
          element.setStyle(originalStyles);
          this._prepared = false;
        },

        _compute: function (property) {
          var COMPUTATIONS = Element.Layout.COMPUTATIONS;
          if (!(property in COMPUTATIONS)) {
            throw "Property not found.";
          }

          return this._set(property, COMPUTATIONS[property].call(this, this.element));
        },

        toObject: function () {
          var args = $A(arguments);
          var keys = (args.length === 0) ? Element.Layout.PROPERTIES :
            args.join(' ').split(' ');
          var obj = {};
          keys.each(function (key) {
            if (!Element.Layout.PROPERTIES.include(key)) return;
            var value = this.get(key);
            if (value != null) obj[key] = value;
          }, this);
          return obj;
        },

        toHash: function () {
          var obj = this.toObject.apply(this, arguments);
          return new Hash(obj);
        },

        toCSS: function () {
          var args = $A(arguments);
          var keys = (args.length === 0) ? Element.Layout.PROPERTIES :
            args.join(' ').split(' ');
          var css = {};

          keys.each(function (key) {
            if (!Element.Layout.PROPERTIES.include(key)) return;
            if (Element.Layout.COMPOSITE_PROPERTIES.include(key)) return;

            var value = this.get(key);
            if (value != null) css[cssNameFor(key)] = value + 'px';
          }, this);
          return css;
        },

        inspect: function () {
          return "#<Element.Layout>";
        }
      });

      Object.extend(Element.Layout, {
        PROPERTIES: $w('height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height'),

        COMPOSITE_PROPERTIES: $w('padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height'),

        COMPUTATIONS: {
          'height': function (element) {
            if (!this._preComputing) this._begin();

            var bHeight = this.get('border-box-height');
            if (bHeight <= 0) {
              if (!this._preComputing) this._end();
              return 0;
            }

            var bTop = this.get('border-top'),
              bBottom = this.get('border-bottom');

            var pTop = this.get('padding-top'),
              pBottom = this.get('padding-bottom');

            if (!this._preComputing) this._end();

            return bHeight - bTop - bBottom - pTop - pBottom;
          },

          'width': function (element) {
            if (!this._preComputing) this._begin();

            var bWidth = this.get('border-box-width');
            if (bWidth <= 0) {
              if (!this._preComputing) this._end();
              return 0;
            }

            var bLeft = this.get('border-left'),
              bRight = this.get('border-right');

            var pLeft = this.get('padding-left'),
              pRight = this.get('padding-right');

            if (!this._preComputing) this._end();

            return bWidth - bLeft - bRight - pLeft - pRight;
          },

          'padding-box-height': function (element) {
            var height = this.get('height'),
              pTop = this.get('padding-top'),
              pBottom = this.get('padding-bottom');

            return height + pTop + pBottom;
          },

          'padding-box-width': function (element) {
            var width = this.get('width'),
              pLeft = this.get('padding-left'),
              pRight = this.get('padding-right');

            return width + pLeft + pRight;
          },

          'border-box-height': function (element) {
            if (!this._preComputing) this._begin();
            var height = element.offsetHeight;
            if (!this._preComputing) this._end();
            return height;
          },

          'border-box-width': function (element) {
            if (!this._preComputing) this._begin();
            var width = element.offsetWidth;
            if (!this._preComputing) this._end();
            return width;
          },

          'margin-box-height': function (element) {
            var bHeight = this.get('border-box-height'),
              mTop = this.get('margin-top'),
              mBottom = this.get('margin-bottom');

            if (bHeight <= 0) return 0;

            return bHeight + mTop + mBottom;
          },

          'margin-box-width': function (element) {
            var bWidth = this.get('border-box-width'),
              mLeft = this.get('margin-left'),
              mRight = this.get('margin-right');

            if (bWidth <= 0) return 0;

            return bWidth + mLeft + mRight;
          },

          'top': function (element) {
            var offset = element.positionedOffset();
            return offset.top;
          },

          'bottom': function (element) {
            var offset = element.positionedOffset(),
              parent = element.getOffsetParent(),
              pHeight = parent.measure('height');

            var mHeight = this.get('border-box-height');

            return pHeight - mHeight - offset.top;
          },

          'left': function (element) {
            var offset = element.positionedOffset();
            return offset.left;
          },

          'right': function (element) {
            var offset = element.positionedOffset(),
              parent = element.getOffsetParent(),
              pWidth = parent.measure('width');

            var mWidth = this.get('border-box-width');

            return pWidth - mWidth - offset.left;
          },

          'padding-top': function (element) {
            return getPixelValue(element, 'paddingTop');
          },

          'padding-bottom': function (element) {
            return getPixelValue(element, 'paddingBottom');
          },

          'padding-left': function (element) {
            return getPixelValue(element, 'paddingLeft');
          },

          'padding-right': function (element) {
            return getPixelValue(element, 'paddingRight');
          },

          'border-top': function (element) {
            return getPixelValue(element, 'borderTopWidth');
          },

          'border-bottom': function (element) {
            return getPixelValue(element, 'borderBottomWidth');
          },

          'border-left': function (element) {
            return getPixelValue(element, 'borderLeftWidth');
          },

          'border-right': function (element) {
            return getPixelValue(element, 'borderRightWidth');
          },

          'margin-top': function (element) {
            return getPixelValue(element, 'marginTop');
          },

          'margin-bottom': function (element) {
            return getPixelValue(element, 'marginBottom');
          },

          'margin-left': function (element) {
            return getPixelValue(element, 'marginLeft');
          },

          'margin-right': function (element) {
            return getPixelValue(element, 'marginRight');
          }
        }
      });

      if ('getBoundingClientRect' in document.documentElement) {
        Object.extend(Element.Layout.COMPUTATIONS, {
          'right': function (element) {
            var parent = hasLayout(element.getOffsetParent());
            var rect = element.getBoundingClientRect(),
              pRect = parent.getBoundingClientRect();

            return (pRect.right - rect.right).round();
          },

          'bottom': function (element) {
            var parent = hasLayout(element.getOffsetParent());
            var rect = element.getBoundingClientRect(),
              pRect = parent.getBoundingClientRect();

            return (pRect.bottom - rect.bottom).round();
          }
        });
      }

      Element.Offset = Class.create({
        initialize: function (left, top) {
          this.left = left.round();
          this.top = top.round();

          this[0] = this.left;
          this[1] = this.top;
        },

        relativeTo: function (offset) {
          return new Element.Offset(
            this.left - offset.left,
            this.top - offset.top
          );
        },

        inspect: function () {
          return "#<Element.Offset left: #{left} top: #{top}>".interpolate(this);
        },

        toString: function () {
          return "[#{left}, #{top}]".interpolate(this);
        },

        toArray: function () {
          return [this.left, this.top];
        }
      });

      function getLayout(element, preCompute) {
        return new Element.Layout(element, preCompute);
      }

      function measure(element, property) {
        return $(element).getLayout().get(property);
      }

      function getDimensions(element) {
        element = $(element);
        var display = Element.getStyle(element, 'display');

        if (display && display !== 'none') {
          return { width: element.offsetWidth, height: element.offsetHeight };
        }

        var style = element.style;
        var originalStyles = {
          visibility: style.visibility,
          position: style.position,
          display: style.display
        };

        var newStyles = {
          visibility: 'hidden',
          display: 'block'
        };

        if (originalStyles.position !== 'fixed')
          newStyles.position = 'absolute';

        Element.setStyle(element, newStyles);

        var dimensions = {
          width: element.offsetWidth,
          height: element.offsetHeight
        };

        Element.setStyle(element, originalStyles);

        return dimensions;
      }

      function getOffsetParent(element) {
        element = $(element);

        if (isDocument(element) || isDetached(element) || isBody(element) || isHtml(element))
          return $(document.body);

        var isInline = (Element.getStyle(element, 'display') === 'inline');
        if (!isInline && element.offsetParent) return $(element.offsetParent);

        while ((element = element.parentNode) && element !== document.body) {
          if (Element.getStyle(element, 'position') !== 'static') {
            return isHtml(element) ? $(document.body) : $(element);
          }
        }

        return $(document.body);
      }


      function cumulativeOffset(element) {
        element = $(element);
        var valueT = 0, valueL = 0;
        if (element.parentNode) {
          do {
            valueT += element.offsetTop || 0;
            valueL += element.offsetLeft || 0;
            element = element.offsetParent;
          } while (element);
        }
        return new Element.Offset(valueL, valueT);
      }

      function positionedOffset(element) {
        element = $(element);

        var layout = element.getLayout();

        var valueT = 0, valueL = 0;
        do {
          valueT += element.offsetTop || 0;
          valueL += element.offsetLeft || 0;
          element = element.offsetParent;
          if (element) {
            if (isBody(element)) break;
            var p = Element.getStyle(element, 'position');
            if (p !== 'static') break;
          }
        } while (element);

        valueL -= layout.get('margin-top');
        valueT -= layout.get('margin-left');

        return new Element.Offset(valueL, valueT);
      }

      function cumulativeScrollOffset(element) {
        var valueT = 0, valueL = 0;
        do {
          valueT += element.scrollTop || 0;
          valueL += element.scrollLeft || 0;
          element = element.parentNode;
        } while (element);
        return new Element.Offset(valueL, valueT);
      }

      function viewportOffset(forElement) {
        element = $(element);
        var valueT = 0, valueL = 0, docBody = document.body;

        var element = forElement;
        do {
          valueT += element.offsetTop || 0;
          valueL += element.offsetLeft || 0;
          if (element.offsetParent == docBody &&
            Element.getStyle(element, 'position') == 'absolute') break;
        } while (element = element.offsetParent);

        element = forElement;
        do {
          if (element != docBody) {
            valueT -= element.scrollTop || 0;
            valueL -= element.scrollLeft || 0;
          }
        } while (element = element.parentNode);
        return new Element.Offset(valueL, valueT);
      }

      function absolutize(element) {
        element = $(element);

        if (Element.getStyle(element, 'position') === 'absolute') {
          return element;
        }

        var offsetParent = getOffsetParent(element);
        var eOffset = element.viewportOffset(),
          pOffset = offsetParent.viewportOffset();

        var offset = eOffset.relativeTo(pOffset);
        var layout = element.getLayout();

        element.store('prototype_absolutize_original_styles', {
          left: element.getStyle('left'),
          top: element.getStyle('top'),
          width: element.getStyle('width'),
          height: element.getStyle('height')
        });

        element.setStyle({
          position: 'absolute',
          top: offset.top + 'px',
          left: offset.left + 'px',
          width: layout.get('width') + 'px',
          height: layout.get('height') + 'px'
        });

        return element;
      }

      function relativize(element) {
        element = $(element);
        if (Element.getStyle(element, 'position') === 'relative') {
          return element;
        }

        var originalStyles =
          element.retrieve('prototype_absolutize_original_styles');

        if (originalStyles) element.setStyle(originalStyles);
        return element;
      }

      if (Prototype.Browser.IE) {
        getOffsetParent = getOffsetParent.wrap(
          function (proceed, element) {
            element = $(element);

            if (isDocument(element) || isDetached(element) || isBody(element) || isHtml(element))
              return $(document.body);

            var position = element.getStyle('position');
            if (position !== 'static') return proceed(element);

            element.setStyle({ position: 'relative' });
            var value = proceed(element);
            element.setStyle({ position: position });
            return value;
          }
        );

        positionedOffset = positionedOffset.wrap(function (proceed, element) {
          element = $(element);
          if (!element.parentNode) return new Element.Offset(0, 0);
          var position = element.getStyle('position');
          if (position !== 'static') return proceed(element);

          var offsetParent = element.getOffsetParent();
          if (offsetParent && offsetParent.getStyle('position') === 'fixed')
            hasLayout(offsetParent);

          element.setStyle({ position: 'relative' });
          var value = proceed(element);
          element.setStyle({ position: position });
          return value;
        });
      } else if (Prototype.Browser.Webkit) {
        cumulativeOffset = function (element) {
          element = $(element);
          var valueT = 0, valueL = 0;
          do {
            valueT += element.offsetTop || 0;
            valueL += element.offsetLeft || 0;
            if (element.offsetParent == document.body)
              if (Element.getStyle(element, 'position') == 'absolute') break;

            element = element.offsetParent;
          } while (element);

          return new Element.Offset(valueL, valueT);
        };
      }


      Element.addMethods({
        getLayout: getLayout,
        measure: measure,
        getDimensions: getDimensions,
        getOffsetParent: getOffsetParent,
        cumulativeOffset: cumulativeOffset,
        positionedOffset: positionedOffset,
        cumulativeScrollOffset: cumulativeScrollOffset,
        viewportOffset: viewportOffset,
        absolutize: absolutize,
        relativize: relativize
      });

      function isBody(element) {
        return element.nodeName.toUpperCase() === 'BODY';
      }

      function isHtml(element) {
        return element.nodeName.toUpperCase() === 'HTML';
      }

      function isDocument(element) {
        return element.nodeType === Node.DOCUMENT_NODE;
      }

      function isDetached(element) {
        return element !== document.body &&
          !Element.descendantOf(element, document.body);
      }

      if ('getBoundingClientRect' in document.documentElement) {
        Element.addMethods({
          viewportOffset: function (element) {
            element = $(element);
            if (isDetached(element)) return new Element.Offset(0, 0);

            var rect = element.getBoundingClientRect(),
              docEl = document.documentElement;
            return new Element.Offset(rect.left - docEl.clientLeft,
              rect.top - docEl.clientTop);
          }
        });
      }
    })();
    window.$$ = function () {
      var expression = $A(arguments).join(', ');
      return Prototype.Selector.select(expression, document);
    };

    Prototype.Selector = (function () {

      function select() {
        throw new Error('Method "Prototype.Selector.select" must be defined.');
      }

      function match() {
        throw new Error('Method "Prototype.Selector.match" must be defined.');
      }

      function find(elements, expression, index) {
        index = index || 0;
        var match = Prototype.Selector.match, length = elements.length, matchIndex = 0, i;

        for (i = 0; i < length; i++) {
          if (match(elements[i], expression) && index == matchIndex++) {
            return Element.extend(elements[i]);
          }
        }
      }

      function extendElements(elements) {
        for (var i = 0, length = elements.length; i < length; i++) {
          Element.extend(elements[i]);
        }
        return elements;
      }


      var K = Prototype.K;

      return {
        select: select,
        match: match,
        find: find,
        extendElements: (Element.extend === K) ? K : extendElements,
        extendElement: Element.extend
      };
    })();
    Prototype._original_property = window.Sizzle;
    /*!
    * Sizzle CSS Selector Engine - v1.0
    *  Copyright 2009, The Dojo Foundation
    *  Released under the MIT, BSD, and GPL Licenses.
    *  More information: http://sizzlejs.com/
    */
    (function () {

      var chunker = /((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,
        done = 0,
        toString = Object.prototype.toString,
        hasDuplicate = false,
        baseHasDuplicate = true;

      [0, 0].sort(function () {
        baseHasDuplicate = false;
        return 0;
      });

      var Sizzle = function (selector, context, results, seed) {
        results = results || [];
        var origContext = context = context || document;

        if (context.nodeType !== 1 && context.nodeType !== 9) {
          return [];
        }

        if (!selector || typeof selector !== "string") {
          return results;
        }

        var parts = [], m, set, checkSet, check, mode, extra, prune = true, contextXML = isXML(context),
          soFar = selector;

        while ((chunker.exec(""), m = chunker.exec(soFar)) !== null) {
          soFar = m[3];

          parts.push(m[1]);

          if (m[2]) {
            extra = m[3];
            break;
          }
        }

        if (parts.length > 1 && origPOS.exec(selector)) {
          if (parts.length === 2 && Expr.relative[parts[0]]) {
            set = posProcess(parts[0] + parts[1], context);
          } else {
            set = Expr.relative[parts[0]] ?
              [context] :
              Sizzle(parts.shift(), context);

            while (parts.length) {
              selector = parts.shift();

              if (Expr.relative[selector])
                selector += parts.shift();

              set = posProcess(selector, set);
            }
          }
        } else {
          if (!seed && parts.length > 1 && context.nodeType === 9 && !contextXML &&
            Expr.match.ID.test(parts[0]) && !Expr.match.ID.test(parts[parts.length - 1])) {
            var ret = Sizzle.find(parts.shift(), context, contextXML);
            context = ret.expr ? Sizzle.filter(ret.expr, ret.set)[0] : ret.set[0];
          }

          if (context) {
            var ret = seed ?
              { expr: parts.pop(), set: makeArray(seed) } :
              Sizzle.find(parts.pop(), parts.length === 1 && (parts[0] === "~" || parts[0] === "+") && context.parentNode ? context.parentNode : context, contextXML);
            set = ret.expr ? Sizzle.filter(ret.expr, ret.set) : ret.set;

            if (parts.length > 0) {
              checkSet = makeArray(set);
            } else {
              prune = false;
            }

            while (parts.length) {
              var cur = parts.pop(), pop = cur;

              if (!Expr.relative[cur]) {
                cur = "";
              } else {
                pop = parts.pop();
              }

              if (pop == null) {
                pop = context;
              }

              Expr.relative[cur](checkSet, pop, contextXML);
            }
          } else {
            checkSet = parts = [];
          }
        }

        if (!checkSet) {
          checkSet = set;
        }

        if (!checkSet) {
          throw "Syntax error, unrecognized expression: " + (cur || selector);
        }

        if (toString.call(checkSet) === "[object Array]") {
          if (!prune) {
            results.push.apply(results, checkSet);
          } else if (context && context.nodeType === 1) {
            for (var i = 0; checkSet[i] != null; i++) {
              if (checkSet[i] && (checkSet[i] === true || checkSet[i].nodeType === 1 && contains(context, checkSet[i]))) {
                results.push(set[i]);
              }
            }
          } else {
            for (var i = 0; checkSet[i] != null; i++) {
              if (checkSet[i] && checkSet[i].nodeType === 1) {
                results.push(set[i]);
              }
            }
          }
        } else {
          makeArray(checkSet, results);
        }

        if (extra) {
          Sizzle(extra, origContext, results, seed);
          Sizzle.uniqueSort(results);
        }

        return results;
      };

      Sizzle.uniqueSort = function (results) {
        if (sortOrder) {
          hasDuplicate = baseHasDuplicate;
          results.sort(sortOrder);

          if (hasDuplicate) {
            for (var i = 1; i < results.length; i++) {
              if (results[i] === results[i - 1]) {
                results.splice(i--, 1);
              }
            }
          }
        }

        return results;
      };

      Sizzle.matches = function (expr, set) {
        return Sizzle(expr, null, null, set);
      };

      Sizzle.find = function (expr, context, isXML) {
        var set, match;

        if (!expr) {
          return [];
        }

        for (var i = 0, l = Expr.order.length; i < l; i++) {
          var type = Expr.order[i], match;

          if ((match = Expr.leftMatch[type].exec(expr))) {
            var left = match[1];
            match.splice(1, 1);

            if (left.substr(left.length - 1) !== "\\") {
              match[1] = (match[1] || "").replace(/\\/g, "");
              set = Expr.find[type](match, context, isXML);
              if (set != null) {
                expr = expr.replace(Expr.match[type], "");
                break;
              }
            }
          }
        }

        if (!set) {
          set = context.getElementsByTagName("*");
        }

        return { set: set, expr: expr };
      };

      Sizzle.filter = function (expr, set, inplace, not) {
        var old = expr, result = [], curLoop = set, match, anyFound,
          isXMLFilter = set && set[0] && isXML(set[0]);

        while (expr && set.length) {
          for (var type in Expr.filter) {
            if ((match = Expr.match[type].exec(expr)) != null) {
              var filter = Expr.filter[type], found, item;
              anyFound = false;

              if (curLoop == result) {
                result = [];
              }

              if (Expr.preFilter[type]) {
                match = Expr.preFilter[type](match, curLoop, inplace, result, not, isXMLFilter);

                if (!match) {
                  anyFound = found = true;
                } else if (match === true) {
                  continue;
                }
              }

              if (match) {
                for (var i = 0; (item = curLoop[i]) != null; i++) {
                  if (item) {
                    found = filter(item, match, i, curLoop);
                    var pass = not ^ !!found;

                    if (inplace && found != null) {
                      if (pass) {
                        anyFound = true;
                      } else {
                        curLoop[i] = false;
                      }
                    } else if (pass) {
                      result.push(item);
                      anyFound = true;
                    }
                  }
                }
              }

              if (found !== undefined) {
                if (!inplace) {
                  curLoop = result;
                }

                expr = expr.replace(Expr.match[type], "");

                if (!anyFound) {
                  return [];
                }

                break;
              }
            }
          }

          if (expr == old) {
            if (anyFound == null) {
              throw "Syntax error, unrecognized expression: " + expr;
            } else {
              break;
            }
          }

          old = expr;
        }

        return curLoop;
      };

      var Expr = Sizzle.selectors = {
        order: ["ID", "NAME", "TAG"],
        match: {
          ID: /#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,
          CLASS: /\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,
          NAME: /\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,
          ATTR: /\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,
          TAG: /^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,
          CHILD: /:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,
          POS: /:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,
          PSEUDO: /:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/
        },
        leftMatch: {},
        attrMap: {
          "class": "className",
          "for": "htmlFor"
        },
        attrHandle: {
          href: function (elem) {
            return elem.getAttribute("href");
          }
        },
        relative: {
          "+": function (checkSet, part, isXML) {
            var isPartStr = typeof part === "string",
              isTag = isPartStr && !/\W/.test(part),
              isPartStrNotTag = isPartStr && !isTag;

            if (isTag && !isXML) {
              part = part.toUpperCase();
            }

            for (var i = 0, l = checkSet.length, elem; i < l; i++) {
              if ((elem = checkSet[i])) {
                while ((elem = elem.previousSibling) && elem.nodeType !== 1) { }

                checkSet[i] = isPartStrNotTag || elem && elem.nodeName === part ?
                  elem || false :
                  elem === part;
              }
            }

            if (isPartStrNotTag) {
              Sizzle.filter(part, checkSet, true);
            }
          },
          ">": function (checkSet, part, isXML) {
            var isPartStr = typeof part === "string";

            if (isPartStr && !/\W/.test(part)) {
              part = isXML ? part : part.toUpperCase();

              for (var i = 0, l = checkSet.length; i < l; i++) {
                var elem = checkSet[i];
                if (elem) {
                  var parent = elem.parentNode;
                  checkSet[i] = parent.nodeName === part ? parent : false;
                }
              }
            } else {
              for (var i = 0, l = checkSet.length; i < l; i++) {
                var elem = checkSet[i];
                if (elem) {
                  checkSet[i] = isPartStr ?
                    elem.parentNode :
                    elem.parentNode === part;
                }
              }

              if (isPartStr) {
                Sizzle.filter(part, checkSet, true);
              }
            }
          },
          "": function (checkSet, part, isXML) {
            var doneName = done++, checkFn = dirCheck;

            if (!/\W/.test(part)) {
              var nodeCheck = part = isXML ? part : part.toUpperCase();
              checkFn = dirNodeCheck;
            }

            checkFn("parentNode", part, doneName, checkSet, nodeCheck, isXML);
          },
          "~": function (checkSet, part, isXML) {
            var doneName = done++, checkFn = dirCheck;

            if (typeof part === "string" && !/\W/.test(part)) {
              var nodeCheck = part = isXML ? part : part.toUpperCase();
              checkFn = dirNodeCheck;
            }

            checkFn("previousSibling", part, doneName, checkSet, nodeCheck, isXML);
          }
        },
        find: {
          ID: function (match, context, isXML) {
            if (typeof context.getElementById !== "undefined" && !isXML) {
              var m = context.getElementById(match[1]);
              return m ? [m] : [];
            }
          },
          NAME: function (match, context, isXML) {
            if (typeof context.getElementsByName !== "undefined") {
              var ret = [], results = context.getElementsByName(match[1]);

              for (var i = 0, l = results.length; i < l; i++) {
                if (results[i].getAttribute("name") === match[1]) {
                  ret.push(results[i]);
                }
              }

              return ret.length === 0 ? null : ret;
            }
          },
          TAG: function (match, context) {
            return context.getElementsByTagName(match[1]);
          }
        },
        preFilter: {
          CLASS: function (match, curLoop, inplace, result, not, isXML) {
            match = " " + match[1].replace(/\\/g, "") + " ";

            if (isXML) {
              return match;
            }

            for (var i = 0, elem; (elem = curLoop[i]) != null; i++) {
              if (elem) {
                if (not ^ (elem.className && (" " + elem.className + " ").indexOf(match) >= 0)) {
                  if (!inplace)
                    result.push(elem);
                } else if (inplace) {
                  curLoop[i] = false;
                }
              }
            }

            return false;
          },
          ID: function (match) {
            return match[1].replace(/\\/g, "");
          },
          TAG: function (match, curLoop) {
            for (var i = 0; curLoop[i] === false; i++) { }
            return curLoop[i] && isXML(curLoop[i]) ? match[1] : match[1].toUpperCase();
          },
          CHILD: function (match) {
            if (match[1] == "nth") {
              var test = /(-?)(\d*)n((?:\+|-)?\d*)/.exec(
                match[2] == "even" && "2n" || match[2] == "odd" && "2n+1" ||
                !/\D/.test(match[2]) && "0n+" + match[2] || match[2]);

              match[2] = (test[1] + (test[2] || 1)) - 0;
              match[3] = test[3] - 0;
            }

            match[0] = done++;

            return match;
          },
          ATTR: function (match, curLoop, inplace, result, not, isXML) {
            var name = match[1].replace(/\\/g, "");

            if (!isXML && Expr.attrMap[name]) {
              match[1] = Expr.attrMap[name];
            }

            if (match[2] === "~=") {
              match[4] = " " + match[4] + " ";
            }

            return match;
          },
          PSEUDO: function (match, curLoop, inplace, result, not) {
            if (match[1] === "not") {
              if ((chunker.exec(match[3]) || "").length > 1 || /^\w/.test(match[3])) {
                match[3] = Sizzle(match[3], null, null, curLoop);
              } else {
                var ret = Sizzle.filter(match[3], curLoop, inplace, true ^ not);
                if (!inplace) {
                  result.push.apply(result, ret);
                }
                return false;
              }
            } else if (Expr.match.POS.test(match[0]) || Expr.match.CHILD.test(match[0])) {
              return true;
            }

            return match;
          },
          POS: function (match) {
            match.unshift(true);
            return match;
          }
        },
        filters: {
          enabled: function (elem) {
            return elem.disabled === false && elem.type !== "hidden";
          },
          disabled: function (elem) {
            return elem.disabled === true;
          },
          checked: function (elem) {
            return elem.checked === true;
          },
          selected: function (elem) {
            elem.parentNode.selectedIndex;
            return elem.selected === true;
          },
          parent: function (elem) {
            return !!elem.firstChild;
          },
          empty: function (elem) {
            return !elem.firstChild;
          },
          has: function (elem, i, match) {
            return !!Sizzle(match[3], elem).length;
          },
          header: function (elem) {
            return /h\d/i.test(elem.nodeName);
          },
          text: function (elem) {
            return "text" === elem.type;
          },
          radio: function (elem) {
            return "radio" === elem.type;
          },
          checkbox: function (elem) {
            return "checkbox" === elem.type;
          },
          file: function (elem) {
            return "file" === elem.type;
          },
          password: function (elem) {
            return "password" === elem.type;
          },
          submit: function (elem) {
            return "submit" === elem.type;
          },
          image: function (elem) {
            return "image" === elem.type;
          },
          reset: function (elem) {
            return "reset" === elem.type;
          },
          button: function (elem) {
            return "button" === elem.type || elem.nodeName.toUpperCase() === "BUTTON";
          },
          input: function (elem) {
            return /input|select|textarea|button/i.test(elem.nodeName);
          }
        },
        setFilters: {
          first: function (elem, i) {
            return i === 0;
          },
          last: function (elem, i, match, array) {
            return i === array.length - 1;
          },
          even: function (elem, i) {
            return i % 2 === 0;
          },
          odd: function (elem, i) {
            return i % 2 === 1;
          },
          lt: function (elem, i, match) {
            return i < match[3] - 0;
          },
          gt: function (elem, i, match) {
            return i > match[3] - 0;
          },
          nth: function (elem, i, match) {
            return match[3] - 0 == i;
          },
          eq: function (elem, i, match) {
            return match[3] - 0 == i;
          }
        },
        filter: {
          PSEUDO: function (elem, match, i, array) {
            var name = match[1], filter = Expr.filters[name];

            if (filter) {
              return filter(elem, i, match, array);
            } else if (name === "contains") {
              return (elem.textContent || elem.innerText || "").indexOf(match[3]) >= 0;
            } else if (name === "not") {
              var not = match[3];

              for (var i = 0, l = not.length; i < l; i++) {
                if (not[i] === elem) {
                  return false;
                }
              }

              return true;
            }
          },
          CHILD: function (elem, match) {
            var type = match[1], node = elem;
            switch (type) {
              case 'only':
              case 'first':
                while ((node = node.previousSibling)) {
                  if (node.nodeType === 1) return false;
                }
                if (type == 'first') return true;
                node = elem;
              case 'last':
                while ((node = node.nextSibling)) {
                  if (node.nodeType === 1) return false;
                }
                return true;
              case 'nth':
                var first = match[2], last = match[3];

                if (first == 1 && last == 0) {
                  return true;
                }

                var doneName = match[0],
                  parent = elem.parentNode;

                if (parent && (parent.sizcache !== doneName || !elem.nodeIndex)) {
                  var count = 0;
                  for (node = parent.firstChild; node; node = node.nextSibling) {
                    if (node.nodeType === 1) {
                      node.nodeIndex = ++count;
                    }
                  }
                  parent.sizcache = doneName;
                }

                var diff = elem.nodeIndex - last;
                if (first == 0) {
                  return diff == 0;
                } else {
                  return (diff % first == 0 && diff / first >= 0);
                }
            }
          },
          ID: function (elem, match) {
            return elem.nodeType === 1 && elem.getAttribute("id") === match;
          },
          TAG: function (elem, match) {
            return (match === "*" && elem.nodeType === 1) || elem.nodeName === match;
          },
          CLASS: function (elem, match) {
            return (" " + (elem.className || elem.getAttribute("class")) + " ")
              .indexOf(match) > -1;
          },
          ATTR: function (elem, match) {
            var name = match[1],
              result = Expr.attrHandle[name] ?
                Expr.attrHandle[name](elem) :
                elem[name] != null ?
                  elem[name] :
                  elem.getAttribute(name),
              value = result + "",
              type = match[2],
              check = match[4];

            return result == null ?
              type === "!=" :
              type === "=" ?
                value === check :
                type === "*=" ?
                  value.indexOf(check) >= 0 :
                  type === "~=" ?
                    (" " + value + " ").indexOf(check) >= 0 :
                    !check ?
                      value && result !== false :
                      type === "!=" ?
                        value != check :
                        type === "^=" ?
                          value.indexOf(check) === 0 :
                          type === "$=" ?
                            value.substr(value.length - check.length) === check :
                            type === "|=" ?
                              value === check || value.substr(0, check.length + 1) === check + "-" :
                              false;
          },
          POS: function (elem, match, i, array) {
            var name = match[2], filter = Expr.setFilters[name];

            if (filter) {
              return filter(elem, i, match, array);
            }
          }
        }
      };

      var origPOS = Expr.match.POS;

      for (var type in Expr.match) {
        Expr.match[type] = new RegExp(Expr.match[type].source + /(?![^\[]*\])(?![^\(]*\))/.source);
        Expr.leftMatch[type] = new RegExp(/(^(?:.|\r|\n)*?)/.source + Expr.match[type].source);
      }

      var makeArray = function (array, results) {
        array = Array.prototype.slice.call(array, 0);

        if (results) {
          results.push.apply(results, array);
          return results;
        }

        return array;
      };

      try {
        Array.prototype.slice.call(document.documentElement.childNodes, 0);

      } catch (e) {
        makeArray = function (array, results) {
          var ret = results || [];

          if (toString.call(array) === "[object Array]") {
            Array.prototype.push.apply(ret, array);
          } else {
            if (typeof array.length === "number") {
              for (var i = 0, l = array.length; i < l; i++) {
                ret.push(array[i]);
              }
            } else {
              for (var i = 0; array[i]; i++) {
                ret.push(array[i]);
              }
            }
          }

          return ret;
        };
      }

      var sortOrder;

      if (document.documentElement.compareDocumentPosition) {
        sortOrder = function (a, b) {
          if (!a.compareDocumentPosition || !b.compareDocumentPosition) {
            if (a == b) {
              hasDuplicate = true;
            }
            return 0;
          }

          var ret = a.compareDocumentPosition(b) & 4 ? -1 : a === b ? 0 : 1;
          if (ret === 0) {
            hasDuplicate = true;
          }
          return ret;
        };
      } else if ("sourceIndex" in document.documentElement) {
        sortOrder = function (a, b) {
          if (!a.sourceIndex || !b.sourceIndex) {
            if (a == b) {
              hasDuplicate = true;
            }
            return 0;
          }

          var ret = a.sourceIndex - b.sourceIndex;
          if (ret === 0) {
            hasDuplicate = true;
          }
          return ret;
        };
      } else if (document.createRange) {
        sortOrder = function (a, b) {
          if (!a.ownerDocument || !b.ownerDocument) {
            if (a == b) {
              hasDuplicate = true;
            }
            return 0;
          }

          var aRange = a.ownerDocument.createRange(), bRange = b.ownerDocument.createRange();
          aRange.setStart(a, 0);
          aRange.setEnd(a, 0);
          bRange.setStart(b, 0);
          bRange.setEnd(b, 0);
          var ret = aRange.compareBoundaryPoints(Range.START_TO_END, bRange);
          if (ret === 0) {
            hasDuplicate = true;
          }
          return ret;
        };
      }

      (function () {
        var form = document.createElement("div"),
          id = "script" + (new Date).getTime();
        form.innerHTML = "<a name='" + id + "'/>";

        var root = document.documentElement;
        root.insertBefore(form, root.firstChild);

        if (!!document.getElementById(id)) {
          Expr.find.ID = function (match, context, isXML) {
            if (typeof context.getElementById !== "undefined" && !isXML) {
              var m = context.getElementById(match[1]);
              return m ? m.id === match[1] || typeof m.getAttributeNode !== "undefined" && m.getAttributeNode("id").nodeValue === match[1] ? [m] : undefined : [];
            }
          };

          Expr.filter.ID = function (elem, match) {
            var node = typeof elem.getAttributeNode !== "undefined" && elem.getAttributeNode("id");
            return elem.nodeType === 1 && node && node.nodeValue === match;
          };
        }

        root.removeChild(form);
        root = form = null; // release memory in IE
      })();

      (function () {

        var div = document.createElement("div");
        div.appendChild(document.createComment(""));

        if (div.getElementsByTagName("*").length > 0) {
          Expr.find.TAG = function (match, context) {
            var results = context.getElementsByTagName(match[1]);

            if (match[1] === "*") {
              var tmp = [];

              for (var i = 0; results[i]; i++) {
                if (results[i].nodeType === 1) {
                  tmp.push(results[i]);
                }
              }

              results = tmp;
            }

            return results;
          };
        }

        div.innerHTML = "<a href='#'></a>";
        if (div.firstChild && typeof div.firstChild.getAttribute !== "undefined" &&
          div.firstChild.getAttribute("href") !== "#") {
          Expr.attrHandle.href = function (elem) {
            return elem.getAttribute("href", 2);
          };
        }

        div = null; // release memory in IE
      })();

      if (document.querySelectorAll) (function () {
        var oldSizzle = Sizzle, div = document.createElement("div");
        div.innerHTML = "<p class='TEST'></p>";

        if (div.querySelectorAll && div.querySelectorAll(".TEST").length === 0) {
          return;
        }

        Sizzle = function (query, context, extra, seed) {
          context = context || document;

          if (!seed && context.nodeType === 9 && !isXML(context)) {
            try {
              return makeArray(context.querySelectorAll(query), extra);
            } catch (e) { }
          }

          return oldSizzle(query, context, extra, seed);
        };

        for (var prop in oldSizzle) {
          Sizzle[prop] = oldSizzle[prop];
        }

        div = null; // release memory in IE
      })();

      if (document.getElementsByClassName && document.documentElement.getElementsByClassName) (function () {
        var div = document.createElement("div");
        div.innerHTML = "<div class='test e'></div><div class='test'></div>";

        if (div.getElementsByClassName("e").length === 0)
          return;

        div.lastChild.className = "e";

        if (div.getElementsByClassName("e").length === 1)
          return;

        Expr.order.splice(1, 0, "CLASS");
        Expr.find.CLASS = function (match, context, isXML) {
          if (typeof context.getElementsByClassName !== "undefined" && !isXML) {
            return context.getElementsByClassName(match[1]);
          }
        };

        div = null; // release memory in IE
      })();

      function dirNodeCheck(dir, cur, doneName, checkSet, nodeCheck, isXML) {
        var sibDir = dir == "previousSibling" && !isXML;
        for (var i = 0, l = checkSet.length; i < l; i++) {
          var elem = checkSet[i];
          if (elem) {
            if (sibDir && elem.nodeType === 1) {
              elem.sizcache = doneName;
              elem.sizset = i;
            }
            elem = elem[dir];
            var match = false;

            while (elem) {
              if (elem.sizcache === doneName) {
                match = checkSet[elem.sizset];
                break;
              }

              if (elem.nodeType === 1 && !isXML) {
                elem.sizcache = doneName;
                elem.sizset = i;
              }

              if (elem.nodeName === cur) {
                match = elem;
                break;
              }

              elem = elem[dir];
            }

            checkSet[i] = match;
          }
        }
      }

      function dirCheck(dir, cur, doneName, checkSet, nodeCheck, isXML) {
        var sibDir = dir == "previousSibling" && !isXML;
        for (var i = 0, l = checkSet.length; i < l; i++) {
          var elem = checkSet[i];
          if (elem) {
            if (sibDir && elem.nodeType === 1) {
              elem.sizcache = doneName;
              elem.sizset = i;
            }
            elem = elem[dir];
            var match = false;

            while (elem) {
              if (elem.sizcache === doneName) {
                match = checkSet[elem.sizset];
                break;
              }

              if (elem.nodeType === 1) {
                if (!isXML) {
                  elem.sizcache = doneName;
                  elem.sizset = i;
                }
                if (typeof cur !== "string") {
                  if (elem === cur) {
                    match = true;
                    break;
                  }

                } else if (Sizzle.filter(cur, [elem]).length > 0) {
                  match = elem;
                  break;
                }
              }

              elem = elem[dir];
            }

            checkSet[i] = match;
          }
        }
      }

      var contains = document.compareDocumentPosition ? function (a, b) {
        return a.compareDocumentPosition(b) & 16;
      } : function (a, b) {
        return a !== b && (a.contains ? a.contains(b) : true);
      };

      var isXML = function (elem) {
        return elem.nodeType === 9 && elem.documentElement.nodeName !== "HTML" ||
          !!elem.ownerDocument && elem.ownerDocument.documentElement.nodeName !== "HTML";
      };

      var posProcess = function (selector, context) {
        var tmpSet = [], later = "", match,
          root = context.nodeType ? [context] : context;

        while ((match = Expr.match.PSEUDO.exec(selector))) {
          later += match[0];
          selector = selector.replace(Expr.match.PSEUDO, "");
        }

        selector = Expr.relative[selector] ? selector + "*" : selector;

        for (var i = 0, l = root.length; i < l; i++) {
          Sizzle(selector, root[i], tmpSet);
        }

        return Sizzle.filter(later, tmpSet);
      };


      window.Sizzle = Sizzle;

    })();

    ; (function (engine) {
      var extendElements = Prototype.Selector.extendElements;

      function select(selector, scope) {
        return extendElements(engine(selector, scope || document));
      }

      function match(element, selector) {
        return engine.matches(selector, [element]).length == 1;
      }

      Prototype.Selector.engine = engine;
      Prototype.Selector.select = select;
      Prototype.Selector.match = match;
    })(Sizzle);

    window.Sizzle = Prototype._original_property;
    delete Prototype._original_property;

    var Form = {
      reset: function (form) {
        form = $(form);
        form.reset();
        return form;
      },

      serializeElements: function (elements, options) {
        if (typeof options != 'object') options = { hash: !!options };
        else if (Object.isUndefined(options.hash)) options.hash = true;
        var key, value, submitted = false, submit = options.submit, accumulator, initial;

        if (options.hash) {
          initial = {};
          accumulator = function (result, key, value) {
            if (key in result) {
              if (!Object.isArray(result[key])) result[key] = [result[key]];
              result[key].push(value);
            } else result[key] = value;
            return result;
          };
        } else {
          initial = '';
          accumulator = function (result, key, value) {
            return result + (result ? '&' : '') + encodeURIComponent(key) + '=' + encodeURIComponent(value);
          }
        }

        return elements.inject(initial, function (result, element) {
          if (!element.disabled && element.name) {
            key = element.name; value = $(element).getValue();
            if (value != null && element.type != 'file' && (element.type != 'submit' || (!submitted &&
              submit !== false && (!submit || key == submit) && (submitted = true)))) {
              result = accumulator(result, key, value);
            }
          }
          return result;
        });
      }
    };

    Form.Methods = {
      serialize: function (form, options) {
        return Form.serializeElements(Form.getElements(form), options);
      },

      getElements: function (form) {
        var elements = $(form).getElementsByTagName('*'),
          element,
          arr = [],
          serializers = Form.Element.Serializers;
        for (var i = 0; element = elements[i]; i++) {
          arr.push(element);
        }
        return arr.inject([], function (elements, child) {
          if (serializers[child.tagName.toLowerCase()])
            elements.push(Element.extend(child));
          return elements;
        })
      },

      getInputs: function (form, typeName, name) {
        form = $(form);
        var inputs = form.getElementsByTagName('input');

        if (!typeName && !name) return $A(inputs).map(Element.extend);

        for (var i = 0, matchingInputs = [], length = inputs.length; i < length; i++) {
          var input = inputs[i];
          if ((typeName && input.type != typeName) || (name && input.name != name))
            continue;
          matchingInputs.push(Element.extend(input));
        }

        return matchingInputs;
      },

      disable: function (form) {
        form = $(form);
        Form.getElements(form).invoke('disable');
        return form;
      },

      enable: function (form) {
        form = $(form);
        Form.getElements(form).invoke('enable');
        return form;
      },

      findFirstElement: function (form) {
        var elements = $(form).getElements().findAll(function (element) {
          return 'hidden' != element.type && !element.disabled;
        });
        var firstByIndex = elements.findAll(function (element) {
          return element.hasAttribute('tabIndex') && element.tabIndex >= 0;
        }).sortBy(function (element) { return element.tabIndex }).first();

        return firstByIndex ? firstByIndex : elements.find(function (element) {
          return /^(?:input|select|textarea)$/i.test(element.tagName);
        });
      },

      focusFirstElement: function (form) {
        form = $(form);
        var element = form.findFirstElement();
        if (element) element.activate();
        return form;
      },

      request: function (form, options) {
        form = $(form), options = Object.clone(options || {});

        var params = options.parameters, action = form.readAttribute('action') || '';
        if (action.blank()) action = window.location.href;
        options.parameters = form.serialize(true);

        if (params) {
          if (Object.isString(params)) params = params.toQueryParams();
          Object.extend(options.parameters, params);
        }

        if (form.hasAttribute('method') && !options.method)
          options.method = form.method;

        return new Ajax.Request(action, options);
      }
    };

    Form.Element = {
      focus: function (element) {
        $(element).focus();
        return element;
      },

      select: function (element) {
        $(element).select();
        return element;
      }
    };

    Form.Element.Methods = {

      serialize: function (element) {
        element = $(element);
        if (!element.disabled && element.name) {
          var value = element.getValue();
          if (value != undefined) {
            var pair = {};
            pair[element.name] = value;
            return Object.toQueryString(pair);
          }
        }
        return '';
      },

      getValue: function (element) {
        element = $(element);
        var method = element.tagName.toLowerCase();
        return Form.Element.Serializers[method](element);
      },

      setValue: function (element, value) {
        element = $(element);
        var method = element.tagName.toLowerCase();
        Form.Element.Serializers[method](element, value);
        return element;
      },

      clear: function (element) {
        $(element).value = '';
        return element;
      },

      present: function (element) {
        return $(element).value != '';
      },

      activate: function (element) {
        element = $(element);
        try {
          element.focus();
          if (element.select && (element.tagName.toLowerCase() != 'input' ||
            !(/^(?:button|reset|submit)$/i.test(element.type))))
            element.select();
        } catch (e) { }
        return element;
      },

      disable: function (element) {
        element = $(element);
        element.disabled = true;
        return element;
      },

      enable: function (element) {
        element = $(element);
        element.disabled = false;
        return element;
      }
    };

    /*--------------------------------------------------------------------------*/

    var Field = Form.Element;

    var $F = Form.Element.Methods.getValue;

    /*--------------------------------------------------------------------------*/

    Form.Element.Serializers = (function () {
      function input(element, value) {
        switch (element.type.toLowerCase()) {
          case 'checkbox':
          case 'radio':
            return inputSelector(element, value);
          default:
            return valueSelector(element, value);
        }
      }

      function inputSelector(element, value) {
        if (Object.isUndefined(value))
          return element.checked ? element.value : null;
        else element.checked = !!value;
      }

      function valueSelector(element, value) {
        if (Object.isUndefined(value)) return element.value;
        else element.value = value;
      }

      function select(element, value) {
        if (Object.isUndefined(value))
          return (element.type === 'select-one' ? selectOne : selectMany)(element);

        var opt, currentValue, single = !Object.isArray(value);
        for (var i = 0, length = element.length; i < length; i++) {
          opt = element.options[i];
          currentValue = this.optionValue(opt);
          if (single) {
            if (currentValue == value) {
              opt.selected = true;
              return;
            }
          }
          else opt.selected = value.include(currentValue);
        }
      }

      function selectOne(element) {
        var index = element.selectedIndex;
        return index >= 0 ? optionValue(element.options[index]) : null;
      }

      function selectMany(element) {
        var values, length = element.length;
        if (!length) return null;

        for (var i = 0, values = []; i < length; i++) {
          var opt = element.options[i];
          if (opt.selected) values.push(optionValue(opt));
        }
        return values;
      }

      function optionValue(opt) {
        return Element.hasAttribute(opt, 'value') ? opt.value : opt.text;
      }

      return {
        input: input,
        inputSelector: inputSelector,
        textarea: valueSelector,
        select: select,
        selectOne: selectOne,
        selectMany: selectMany,
        optionValue: optionValue,
        button: valueSelector
      };
    })();

    /*--------------------------------------------------------------------------*/


    Abstract.TimedObserver = Class.create(PeriodicalExecuter, {
      initialize: function ($super, element, frequency, callback) {
        $super(callback, frequency);
        this.element = $(element);
        this.lastValue = this.getValue();
      },

      execute: function () {
        var value = this.getValue();
        if (Object.isString(this.lastValue) && Object.isString(value) ?
          this.lastValue != value : String(this.lastValue) != String(value)) {
          this.callback(this.element, value);
          this.lastValue = value;
        }
      }
    });

    Form.Element.Observer = Class.create(Abstract.TimedObserver, {
      getValue: function () {
        return Form.Element.getValue(this.element);
      }
    });

    Form.Observer = Class.create(Abstract.TimedObserver, {
      getValue: function () {
        return Form.serialize(this.element);
      }
    });

    /*--------------------------------------------------------------------------*/

    Abstract.EventObserver = Class.create({
      initialize: function (element, callback) {
        this.element = $(element);
        this.callback = callback;

        this.lastValue = this.getValue();
        if (this.element.tagName.toLowerCase() == 'form')
          this.registerFormCallbacks();
        else
          this.registerCallback(this.element);
      },

      onElementEvent: function () {
        var value = this.getValue();
        if (this.lastValue != value) {
          this.callback(this.element, value);
          this.lastValue = value;
        }
      },

      registerFormCallbacks: function () {
        Form.getElements(this.element).each(this.registerCallback, this);
      },

      registerCallback: function (element) {
        if (element.type) {
          switch (element.type.toLowerCase()) {
            case 'checkbox':
            case 'radio':
              Event.observe(element, 'click', this.onElementEvent.bind(this));
              break;
            default:
              Event.observe(element, 'change', this.onElementEvent.bind(this));
              break;
          }
        }
      }
    });

    Form.Element.EventObserver = Class.create(Abstract.EventObserver, {
      getValue: function () {
        return Form.Element.getValue(this.element);
      }
    });

    Form.EventObserver = Class.create(Abstract.EventObserver, {
      getValue: function () {
        return Form.serialize(this.element);
      }
    });
    (function () {

      var Event = {
        KEY_BACKSPACE: 8,
        KEY_TAB: 9,
        KEY_RETURN: 13,
        KEY_ESC: 27,
        KEY_LEFT: 37,
        KEY_UP: 38,
        KEY_RIGHT: 39,
        KEY_DOWN: 40,
        KEY_DELETE: 46,
        KEY_HOME: 36,
        KEY_END: 35,
        KEY_PAGEUP: 33,
        KEY_PAGEDOWN: 34,
        KEY_INSERT: 45,

        cache: {}
      };

      var docEl = document.documentElement;
      var MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED = 'onmouseenter' in docEl
        && 'onmouseleave' in docEl;



      var isIELegacyEvent = function (event) { return false; };

      if (window.attachEvent) {
        if (window.addEventListener) {
          isIELegacyEvent = function (event) {
            return !(event instanceof window.Event);
          };
        } else {
          isIELegacyEvent = function (event) { return true; };
        }
      }

      var _isButton;

      function _isButtonForDOMEvents(event, code) {
        return event.which ? (event.which === code + 1) : (event.button === code);
      }

      var legacyButtonMap = { 0: 1, 1: 4, 2: 2 };
      function _isButtonForLegacyEvents(event, code) {
        return event.button === legacyButtonMap[code];
      }

      function _isButtonForWebKit(event, code) {
        switch (code) {
          case 0: return event.which == 1 && !event.metaKey;
          case 1: return event.which == 2 || (event.which == 1 && event.metaKey);
          case 2: return event.which == 3;
          default: return false;
        }
      }

      if (window.attachEvent) {
        if (!window.addEventListener) {
          _isButton = _isButtonForLegacyEvents;
        } else {
          _isButton = function (event, code) {
            return isIELegacyEvent(event) ? _isButtonForLegacyEvents(event, code) :
              _isButtonForDOMEvents(event, code);
          }
        }
      } else if (Prototype.Browser.WebKit) {
        _isButton = _isButtonForWebKit;
      } else {
        _isButton = _isButtonForDOMEvents;
      }

      function isLeftClick(event) { return _isButton(event, 0) }

      function isMiddleClick(event) { return _isButton(event, 1) }

      function isRightClick(event) { return _isButton(event, 2) }

      function element(event) {
        event = Event.extend(event);

        var node = event.target, type = event.type,
          currentTarget = event.currentTarget;

        if (currentTarget && currentTarget.tagName) {
          if (type === 'load' || type === 'error' ||
            (type === 'click' && currentTarget.tagName.toLowerCase() === 'input'
              && currentTarget.type === 'radio'))
            node = currentTarget;
        }

        if (node.nodeType == Node.TEXT_NODE)
          node = node.parentNode;

        return Element.extend(node);
      }

      function findElement(event, expression) {
        var element = Event.element(event);

        if (!expression) return element;
        while (element) {
          if (Object.isElement(element) && Prototype.Selector.match(element, expression)) {
            return Element.extend(element);
          }
          element = element.parentNode;
        }
      }

      function pointer(event) {
        return { x: pointerX(event), y: pointerY(event) };
      }

      function pointerX(event) {
        var docElement = document.documentElement,
          body = document.body || { scrollLeft: 0 };

        return event.pageX || (event.clientX +
          (docElement.scrollLeft || body.scrollLeft) -
          (docElement.clientLeft || 0));
      }

      function pointerY(event) {
        var docElement = document.documentElement,
          body = document.body || { scrollTop: 0 };

        return event.pageY || (event.clientY +
          (docElement.scrollTop || body.scrollTop) -
          (docElement.clientTop || 0));
      }


      function stop(event) {
        Event.extend(event);
        event.preventDefault();
        event.stopPropagation();

        event.stopped = true;
      }


      Event.Methods = {
        isLeftClick: isLeftClick,
        isMiddleClick: isMiddleClick,
        isRightClick: isRightClick,

        element: element,
        findElement: findElement,

        pointer: pointer,
        pointerX: pointerX,
        pointerY: pointerY,

        stop: stop
      };

      var methods = Object.keys(Event.Methods).inject({}, function (m, name) {
        m[name] = Event.Methods[name].methodize();
        return m;
      });

      if (window.attachEvent) {
        function _relatedTarget(event) {
          var element;
          switch (event.type) {
            case 'mouseover':
            case 'mouseenter':
              element = event.fromElement;
              break;
            case 'mouseout':
            case 'mouseleave':
              element = event.toElement;
              break;
            default:
              return null;
          }
          return Element.extend(element);
        }

        var additionalMethods = {
          stopPropagation: function () { this.cancelBubble = true },
          preventDefault: function () { this.returnValue = false },
          inspect: function () { return '[object Event]' }
        };

        Event.extend = function (event, element) {
          if (!event) return false;

          if (!isIELegacyEvent(event)) return event;

          if (event._extendedByPrototype) return event;
          event._extendedByPrototype = Prototype.emptyFunction;

          var pointer = Event.pointer(event);

          Object.extend(event, {
            target: event.srcElement || element,
            relatedTarget: _relatedTarget(event),
            pageX: pointer.x,
            pageY: pointer.y
          });

          Object.extend(event, methods);
          Object.extend(event, additionalMethods);

          return event;
        };
      } else {
        Event.extend = Prototype.K;
      }

      if (window.addEventListener) {
        Event.prototype = window.Event.prototype || document.createEvent('HTMLEvents').__proto__;
        Object.extend(Event.prototype, methods);
      }

      function _createResponder(element, eventName, handler) {
        var registry = Element.retrieve(element, 'prototype_event_registry');

        if (Object.isUndefined(registry)) {
          CACHE.push(element);
          registry = Element.retrieve(element, 'prototype_event_registry', $H());
        }

        var respondersForEvent = registry.get(eventName);
        if (Object.isUndefined(respondersForEvent)) {
          respondersForEvent = [];
          registry.set(eventName, respondersForEvent);
        }

        if (respondersForEvent.pluck('handler').include(handler)) return false;

        var responder;
        if (eventName.include(":")) {
          responder = function (event) {
            if (Object.isUndefined(event.eventName))
              return false;

            if (event.eventName !== eventName)
              return false;

            Event.extend(event, element);
            handler.call(element, event);
          };
        } else {
          if (!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED &&
            (eventName === "mouseenter" || eventName === "mouseleave")) {
            if (eventName === "mouseenter" || eventName === "mouseleave") {
              responder = function (event) {
                Event.extend(event, element);

                var parent = event.relatedTarget;
                while (parent && parent !== element) {
                  try { parent = parent.parentNode; }
                  catch (e) { parent = element; }
                }

                if (parent === element) return;

                handler.call(element, event);
              };
            }
          } else {
            responder = function (event) {
              Event.extend(event, element);
              handler.call(element, event);
            };
          }
        }

        responder.handler = handler;
        respondersForEvent.push(responder);
        return responder;
      }

      function _destroyCache() {
        for (var i = 0, length = CACHE.length; i < length; i++) {
          Event.stopObserving(CACHE[i]);
          CACHE[i] = null;
        }
      }

      var CACHE = [];

      if (Prototype.Browser.IE)
        window.attachEvent('onunload', _destroyCache);

      if (Prototype.Browser.WebKit)
        window.addEventListener('unload', Prototype.emptyFunction, false);


      var _getDOMEventName = Prototype.K,
        translations = { mouseenter: "mouseover", mouseleave: "mouseout" };

      if (!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED) {
        _getDOMEventName = function (eventName) {
          return (translations[eventName] || eventName);
        };
      }

      function observe(element, eventName, handler) {
        element = $(element);

        var responder = _createResponder(element, eventName, handler);

        if (!responder) return element;

        if (eventName.include(':')) {
          if (element.addEventListener)
            element.addEventListener("dataavailable", responder, false);
          else {
            element.attachEvent("ondataavailable", responder);
            element.attachEvent("onlosecapture", responder);
          }
        } else {
          var actualEventName = _getDOMEventName(eventName);

          if (element.addEventListener)
            element.addEventListener(actualEventName, responder, false);
          else
            element.attachEvent("on" + actualEventName, responder);
        }

        return element;
      }

      function stopObserving(element, eventName, handler) {
        element = $(element);

        var registry = Element.retrieve(element, 'prototype_event_registry');
        if (!registry) return element;

        if (!eventName) {
          registry.each(function (pair) {
            var eventName = pair.key;
            stopObserving(element, eventName);
          });
          return element;
        }

        var responders = registry.get(eventName);
        if (!responders) return element;

        if (!handler) {
          responders.each(function (r) {
            stopObserving(element, eventName, r.handler);
          });
          return element;
        }

        var i = responders.length, responder;
        while (i--) {
          if (responders[i].handler === handler) {
            responder = responders[i];
            break;
          }
        }
        if (!responder) return element;

        if (eventName.include(':')) {
          if (element.removeEventListener)
            element.removeEventListener("dataavailable", responder, false);
          else {
            element.detachEvent("ondataavailable", responder);
            element.detachEvent("onlosecapture", responder);
          }
        } else {
          var actualEventName = _getDOMEventName(eventName);
          if (element.removeEventListener)
            element.removeEventListener(actualEventName, responder, false);
          else
            element.detachEvent('on' + actualEventName, responder);
        }

        registry.set(eventName, responders.without(responder));

        return element;
      }

      function fire(element, eventName, memo, bubble) {
        element = $(element);

        if (Object.isUndefined(bubble))
          bubble = true;

        if (element == document && document.createEvent && !element.dispatchEvent)
          element = document.documentElement;

        var event;
        if (document.createEvent) {
          event = document.createEvent('HTMLEvents');
          event.initEvent('dataavailable', bubble, true);
        } else {
          event = document.createEventObject();
          event.eventType = bubble ? 'ondataavailable' : 'onlosecapture';
        }

        event.eventName = eventName;
        event.memo = memo || {};

        if (document.createEvent)
          element.dispatchEvent(event);
        else
          element.fireEvent(event.eventType, event);

        return Event.extend(event);
      }

      Event.Handler = Class.create({
        initialize: function (element, eventName, selector, callback) {
          this.element = $(element);
          this.eventName = eventName;
          this.selector = selector;
          this.callback = callback;
          this.handler = this.handleEvent.bind(this);
        },

        start: function () {
          Event.observe(this.element, this.eventName, this.handler);
          return this;
        },

        stop: function () {
          Event.stopObserving(this.element, this.eventName, this.handler);
          return this;
        },

        handleEvent: function (event) {
          var element = Event.findElement(event, this.selector);
          if (element) this.callback.call(this.element, event, element);
        }
      });

      function on(element, eventName, selector, callback) {
        element = $(element);
        if (Object.isFunction(selector) && Object.isUndefined(callback)) {
          callback = selector, selector = null;
        }

        return new Event.Handler(element, eventName, selector, callback).start();
      }

      Object.extend(Event, Event.Methods);

      Object.extend(Event, {
        fire: fire,
        observe: observe,
        stopObserving: stopObserving,
        on: on
      });

      Element.addMethods({
        fire: fire,

        observe: observe,

        stopObserving: stopObserving,

        on: on
      });

      Object.extend(document, {
        fire: fire.methodize(),

        observe: observe.methodize(),

        stopObserving: stopObserving.methodize(),

        on: on.methodize(),

        loaded: false
      });

      if (window.Event) Object.extend(window.Event, Event);
      else window.Event = Event;
    })();

    (function () {
      /* Support for the DOMContentLoaded event is based on work by Dan Webb,
         Matthias Miller, Dean Edwards, John Resig, and Diego Perini. */

      var timer;

      function fireContentLoadedEvent() {
        if (document.loaded) return;
        if (timer) window.clearTimeout(timer);
        document.loaded = true;
        document.fire('dom:loaded');
      }

      function checkReadyState() {
        if (document.readyState === 'complete') {
          document.stopObserving('readystatechange', checkReadyState);
          fireContentLoadedEvent();
        }
      }

      function pollDoScroll() {
        try { document.documentElement.doScroll('left'); }
        catch (e) {
          timer = pollDoScroll.defer();
          return;
        }
        fireContentLoadedEvent();
      }

      if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', fireContentLoadedEvent, false);
      } else {
        document.observe('readystatechange', checkReadyState);
        if (window == top)
          timer = pollDoScroll.defer();
      }

      Event.observe(window, 'load', fireContentLoadedEvent);
    })();

    Element.addMethods();

    /*------------------------------- DEPRECATED -------------------------------*/

    Hash.toQueryString = Object.toQueryString;

    var Toggle = { display: Element.toggle };

    Element.Methods.childOf = Element.Methods.descendantOf;

    var Insertion = {
      Before: function (element, content) {
        return Element.insert(element, { before: content });
      },

      Top: function (element, content) {
        return Element.insert(element, { top: content });
      },

      Bottom: function (element, content) {
        return Element.insert(element, { bottom: content });
      },

      After: function (element, content) {
        return Element.insert(element, { after: content });
      }
    };

    var $continue = new Error('"throw $continue" is deprecated, use "return" instead');

    var Position = {
      includeScrollOffsets: false,

      prepare: function () {
        this.deltaX = window.pageXOffset
          || document.documentElement.scrollLeft
          || document.body.scrollLeft
          || 0;
        this.deltaY = window.pageYOffset
          || document.documentElement.scrollTop
          || document.body.scrollTop
          || 0;
      },

      within: function (element, x, y) {
        if (this.includeScrollOffsets)
          return this.withinIncludingScrolloffsets(element, x, y);
        this.xcomp = x;
        this.ycomp = y;
        this.offset = Element.cumulativeOffset(element);

        return (y >= this.offset[1] &&
          y < this.offset[1] + element.offsetHeight &&
          x >= this.offset[0] &&
          x < this.offset[0] + element.offsetWidth);
      },

      withinIncludingScrolloffsets: function (element, x, y) {
        var offsetcache = Element.cumulativeScrollOffset(element);

        this.xcomp = x + offsetcache[0] - this.deltaX;
        this.ycomp = y + offsetcache[1] - this.deltaY;
        this.offset = Element.cumulativeOffset(element);

        return (this.ycomp >= this.offset[1] &&
          this.ycomp < this.offset[1] + element.offsetHeight &&
          this.xcomp >= this.offset[0] &&
          this.xcomp < this.offset[0] + element.offsetWidth);
      },

      overlap: function (mode, element) {
        if (!mode) return 0;
        if (mode == 'vertical')
          return ((this.offset[1] + element.offsetHeight) - this.ycomp) /
            element.offsetHeight;
        if (mode == 'horizontal')
          return ((this.offset[0] + element.offsetWidth) - this.xcomp) /
            element.offsetWidth;
      },


      cumulativeOffset: Element.Methods.cumulativeOffset,

      positionedOffset: Element.Methods.positionedOffset,

      absolutize: function (element) {
        Position.prepare();
        return Element.absolutize(element);
      },

      relativize: function (element) {
        Position.prepare();
        return Element.relativize(element);
      },

      realOffset: Element.Methods.cumulativeScrollOffset,

      offsetParent: Element.Methods.getOffsetParent,

      page: Element.Methods.viewportOffset,

      clone: function (source, target, options) {
        options = options || {};
        return Element.clonePosition(target, source, options);
      }
    };

    /*--------------------------------------------------------------------------*/

    if (!document.getElementsByClassName) document.getElementsByClassName = function (instanceMethods) {
      function iter(name) {
        return name.blank() ? null : "[contains(concat(' ', @class, ' '), ' " + name + " ')]";
      }

      instanceMethods.getElementsByClassName = Prototype.BrowserFeatures.XPath ?
        function (element, className) {
          className = className.toString().strip();
          var cond = /\s/.test(className) ? $w(className).map(iter).join('') : iter(className);
          return cond ? document._getElementsByXPath('.//*' + cond, element) : [];
        } : function (element, className) {
          className = className.toString().strip();
          var elements = [], classNames = (/\s/.test(className) ? $w(className) : null);
          if (!classNames && !className) return elements;

          var nodes = $(element).getElementsByTagName('*');
          className = ' ' + className + ' ';

          for (var i = 0, child, cn; child = nodes[i]; i++) {
            if (child.className && (cn = ' ' + child.className + ' ') && (cn.include(className) ||
              (classNames && classNames.all(function (name) {
                return !name.toString().blank() && cn.include(' ' + name + ' ');
              }))))
              elements.push(Element.extend(child));
          }
          return elements;
        };

      return function (className, parentElement) {
        return $(parentElement || document.body).getElementsByClassName(className);
      };
    }(Element.Methods);

    /*--------------------------------------------------------------------------*/

    Element.ClassNames = Class.create();
    Element.ClassNames.prototype = {
      initialize: function (element) {
        this.element = $(element);
      },

      _each: function (iterator) {
        this.element.className.split(/\s+/).select(function (name) {
          return name.length > 0;
        })._each(iterator);
      },

      set: function (className) {
        this.element.className = className;
      },

      add: function (classNameToAdd) {
        if (this.include(classNameToAdd)) return;
        this.set($A(this).concat(classNameToAdd).join(' '));
      },

      remove: function (classNameToRemove) {
        if (!this.include(classNameToRemove)) return;
        this.set($A(this).without(classNameToRemove).join(' '));
      },

      toString: function () {
        return $A(this).join(' ');
      }
    };

    Object.extend(Element.ClassNames.prototype, Enumerable);

    /*--------------------------------------------------------------------------*/

    (function () {
      window.Selector = Class.create({
        initialize: function (expression) {
          this.expression = expression.strip();
        },

        findElements: function (rootElement) {
          return Prototype.Selector.select(this.expression, rootElement);
        },

        match: function (element) {
          return Prototype.Selector.match(element, this.expression);
        },

        toString: function () {
          return this.expression;
        },

        inspect: function () {
          return "#<Selector: " + this.expression + ">";
        }
      });

      Object.extend(Selector, {
        matchElements: function (elements, expression) {
          var match = Prototype.Selector.match,
            results = [];

          for (var i = 0, length = elements.length; i < length; i++) {
            var element = elements[i];
            if (match(element, expression)) {
              results.push(Element.extend(element));
            }
          }
          return results;
        },

        findElement: function (elements, expression, index) {
          index = index || 0;
          var matchIndex = 0, element;
          for (var i = 0, length = elements.length; i < length; i++) {
            element = elements[i];
            if (Prototype.Selector.match(element, expression) && index === matchIndex++) {
              return Element.extend(element);
            }
          }
        },

        findChildElements: function (element, expressions) {
          var selector = expressions.toArray().join(', ');
          return Prototype.Selector.select(selector, element || document);
        }
      });
    })();
  </script>
  <script>
    var Scriptaculous = {
      Version: '1.8.1',
      require: function (libraryName) {
        // inserting via DOM fails in Safari 2.0, so brute force approach
        document.write('<script type="text/javascript" src="' + libraryName + '"><\/script>');
      },
      REQUIRED_PROTOTYPE: '1.6.0',
      load: function () {
        function convertVersionString(versionString) {
          var r = versionString.split('.');
          return parseInt(r[0]) * 100000 + parseInt(r[1]) * 1000 + parseInt(r[2]);
        }

        if ((typeof Prototype == 'undefined') ||
          (typeof Element == 'undefined') ||
          (typeof Element.Methods == 'undefined') ||
          (convertVersionString(Prototype.Version) <
            convertVersionString(Scriptaculous.REQUIRED_PROTOTYPE)))
          throw ("script.aculo.us requires the Prototype JavaScript framework >= " +
            Scriptaculous.REQUIRED_PROTOTYPE);

        $A(document.getElementsByTagName("script")).findAll(function (s) {
          return (s.src && s.src.match(/scriptaculous\.js(\?.*)?$/))
        }).each(function (s) {
          var path = s.src.replace(/scriptaculous\.js(\?.*)?$/, '');
          var includes = s.src.match(/\?.*load=([a-z,]*)/);
          (includes ? includes[1] : 'builder,effects,dragdrop,controls,slider,sound').split(',').each(
            function (include) { Scriptaculous.require(path + include + '.js?sversion=2') });
        });
      }
    }

    Scriptaculous.load();
    // script.aculo.us effects.js v1.8.1, Thu Jan 03 22:07:12 -0500 2008

    // Copyright (c) 2005-2007 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)
    // Contributors:
    //  Justin Palmer (http://encytemedia.com/)
    //  Mark Pilgrim (http://diveintomark.org/)
    //  Martin Bialasinki
    // 
    // script.aculo.us is freely distributable under the terms of an MIT-style license.
    // For details, see the script.aculo.us web site: http://script.aculo.us/ 

    // converts rgb() and #xxx to #xxxxxx format,  
    // returns self (or first argument) if not convertable  
    String.prototype.parseColor = function () {
      var color = '#';
      if (this.slice(0, 4) == 'rgb(') {
        var cols = this.slice(4, this.length - 1).split(',');
        var i = 0; do { color += parseInt(cols[i]).toColorPart() } while (++i < 3);
      } else {
        if (this.slice(0, 1) == '#') {
          if (this.length == 4) for (var i = 1; i < 4; i++) color += (this.charAt(i) + this.charAt(i)).toLowerCase();
          if (this.length == 7) color = this.toLowerCase();
        }
      }
      return (color.length == 7 ? color : (arguments[0] || this));
    };

    /*--------------------------------------------------------------------------*/

    Element.collectTextNodes = function (element) {
      return $A($(element).childNodes).collect(function (node) {
        return (node.nodeType == 3 ? node.nodeValue :
          (node.hasChildNodes() ? Element.collectTextNodes(node) : ''));
      }).flatten().join('');
    };

    Element.collectTextNodesIgnoreClass = function (element, className) {
      return $A($(element).childNodes).collect(function (node) {
        return (node.nodeType == 3 ? node.nodeValue :
          ((node.hasChildNodes() && !Element.hasClassName(node, className)) ?
            Element.collectTextNodesIgnoreClass(node, className) : ''));
      }).flatten().join('');
    };

    Element.setContentZoom = function (element, percent) {
      element = $(element);
      element.setStyle({ fontSize: (percent / 100) + 'em' });
      if (Prototype.Browser.WebKit) window.scrollBy(0, 0);
      return element;
    };

    Element.getInlineOpacity = function (element) {
      return $(element).style.opacity || '';
    };

    Element.forceRerendering = function (element) {
      try {
        element = $(element);
        var n = document.createTextNode(' ');
        element.appendChild(n);
        element.removeChild(n);
      } catch (e) { }
    };

    /*--------------------------------------------------------------------------*/

    var Effect = {
      _elementDoesNotExistError: {
        name: 'ElementDoesNotExistError',
        message: 'The specified DOM element does not exist, but is required for this effect to operate'
      },
      Transitions: {
        linear: Prototype.K,
        sinoidal: function (pos) {
          return (-Math.cos(pos * Math.PI) / 2) + 0.5;
        },
        reverse: function (pos) {
          return 1 - pos;
        },
        flicker: function (pos) {
          var pos = ((-Math.cos(pos * Math.PI) / 4) + 0.75) + Math.random() / 4;
          return pos > 1 ? 1 : pos;
        },
        wobble: function (pos) {
          return (-Math.cos(pos * Math.PI * (9 * pos)) / 2) + 0.5;
        },
        pulse: function (pos, pulses) {
          pulses = pulses || 5;
          return (
            ((pos % (1 / pulses)) * pulses).round() == 0 ?
              ((pos * pulses * 2) - (pos * pulses * 2).floor()) :
              1 - ((pos * pulses * 2) - (pos * pulses * 2).floor())
          );
        },
        spring: function (pos) {
          return 1 - (Math.cos(pos * 4.5 * Math.PI) * Math.exp(-pos * 6));
        },
        none: function (pos) {
          return 0;
        },
        full: function (pos) {
          return 1;
        }
      },
      DefaultOptions: {
        duration: 1.0,   // seconds
        fps: 100,   // 100= assume 66fps max.
        sync: false, // true for combining
        from: 0.0,
        to: 1.0,
        delay: 0.0,
        queue: 'parallel'
      },
      tagifyText: function (element) {
        var tagifyStyle = 'position:relative';
        if (Prototype.Browser.IE) tagifyStyle += ';zoom:1';

        element = $(element);
        $A(element.childNodes).each(function (child) {
          if (child.nodeType == 3) {
            child.nodeValue.toArray().each(function (character) {
              element.insertBefore(
                new Element('span', { style: tagifyStyle }).update(
                  character == ' ' ? String.fromCharCode(160) : character),
                child);
            });
            Element.remove(child);
          }
        });
      },
      multiple: function (element, effect) {
        var elements;
        if (((typeof element == 'object') ||
          Object.isFunction(element)) &&
          (element.length))
          elements = element;
        else
          elements = $(element).childNodes;

        var options = Object.extend({
          speed: 0.1,
          delay: 0.0
        }, arguments[2] || {});
        var masterDelay = options.delay;

        $A(elements).each(function (element, index) {
          new effect(element, Object.extend(options, { delay: index * options.speed + masterDelay }));
        });
      },
      PAIRS: {
        'slide': ['SlideDown', 'SlideUp'],
        'blind': ['BlindDown', 'BlindUp'],
        'appear': ['Appear', 'Fade']
      },
      toggle: function (element, effect) {
        element = $(element);
        effect = (effect || 'appear').toLowerCase();
        var options = Object.extend({
          queue: { position: 'end', scope: (element.id || 'global'), limit: 1 }
        }, arguments[2] || {});
        Effect[element.visible() ?
          Effect.PAIRS[effect][1] : Effect.PAIRS[effect][0]](element, options);
      }
    };

    Effect.DefaultOptions.transition = Effect.Transitions.sinoidal;

    /* ------------- core effects ------------- */

    Effect.ScopedQueue = Class.create(Enumerable, {
      initialize: function () {
        this.effects = [];
        this.interval = null;
      },
      _each: function (iterator) {
        this.effects._each(iterator);
      },
      add: function (effect) {
        var timestamp = new Date().getTime();

        var position = Object.isString(effect.options.queue) ?
          effect.options.queue : effect.options.queue.position;

        switch (position) {
          case 'front':
            // move unstarted effects after this effect  
            this.effects.findAll(function (e) { return e.state == 'idle' }).each(function (e) {
              e.startOn += effect.finishOn;
              e.finishOn += effect.finishOn;
            });
            break;
          case 'with-last':
            timestamp = this.effects.pluck('startOn').max() || timestamp;
            break;
          case 'end':
            // start effect after last queued effect has finished
            timestamp = this.effects.pluck('finishOn').max() || timestamp;
            break;
        }

        effect.startOn += timestamp;
        effect.finishOn += timestamp;

        if (!effect.options.queue.limit || (this.effects.length < effect.options.queue.limit))
          this.effects.push(effect);

        if (!this.interval)
          this.interval = setInterval(this.loop.bind(this), 15);
      },
      remove: function (effect) {
        this.effects = this.effects.reject(function (e) { return e == effect });
        if (this.effects.length == 0) {
          clearInterval(this.interval);
          this.interval = null;
        }
      },
      loop: function () {
        var timePos = new Date().getTime();
        for (var i = 0, len = this.effects.length; i < len; i++)
          this.effects[i] && this.effects[i].loop(timePos);
      }
    });

    Effect.Queues = {
      instances: $H(),
      get: function (queueName) {
        if (!Object.isString(queueName)) return queueName;

        return this.instances.get(queueName) ||
          this.instances.set(queueName, new Effect.ScopedQueue());
      }
    };
    Effect.Queue = Effect.Queues.get('global');

    Effect.Base = Class.create({
      position: null,
      start: function (options) {
        function codeForEvent(options, eventName) {
          return (
            (options[eventName + 'Internal'] ? 'this.options.' + eventName + 'Internal(this);' : '') +
            (options[eventName] ? 'this.options.' + eventName + '(this);' : '')
          );
        }
        if (options && options.transition === false) options.transition = Effect.Transitions.linear;
        this.options = Object.extend(Object.extend({}, Effect.DefaultOptions), options || {});
        this.currentFrame = 0;
        this.state = 'idle';
        this.startOn = this.options.delay * 1000;
        this.finishOn = this.startOn + (this.options.duration * 1000);
        this.fromToDelta = this.options.to - this.options.from;
        this.totalTime = this.finishOn - this.startOn;
        this.totalFrames = this.options.fps * this.options.duration;

        eval('this.render = function(pos){ ' +
          'if (this.state=="idle"){this.state="running";' +
          codeForEvent(this.options, 'beforeSetup') +
          (this.setup ? 'this.setup();' : '') +
          codeForEvent(this.options, 'afterSetup') +
          '};if (this.state=="running"){' +
          'pos=this.options.transition(pos)*' + this.fromToDelta + '+' + this.options.from + ';' +
          'this.position=pos;' +
          codeForEvent(this.options, 'beforeUpdate') +
          (this.update ? 'this.update(pos);' : '') +
          codeForEvent(this.options, 'afterUpdate') +
          '}}');

        this.event('beforeStart');
        if (!this.options.sync)
          Effect.Queues.get(Object.isString(this.options.queue) ?
            'global' : this.options.queue.scope).add(this);
      },
      loop: function (timePos) {
        if (timePos >= this.startOn) {
          if (timePos >= this.finishOn) {
            this.render(1.0);
            this.cancel();
            this.event('beforeFinish');
            if (this.finish) this.finish();
            this.event('afterFinish');
            return;
          }
          var pos = (timePos - this.startOn) / this.totalTime,
            frame = (pos * this.totalFrames).round();
          if (frame > this.currentFrame) {
            this.render(pos);
            this.currentFrame = frame;
          }
        }
      },
      cancel: function () {
        if (!this.options.sync)
          Effect.Queues.get(Object.isString(this.options.queue) ?
            'global' : this.options.queue.scope).remove(this);
        this.state = 'finished';
      },
      event: function (eventName) {
        if (this.options[eventName + 'Internal']) this.options[eventName + 'Internal'](this);
        if (this.options[eventName]) this.options[eventName](this);
      },
      inspect: function () {
        var data = $H();
        for (property in this)
          if (!Object.isFunction(this[property])) data.set(property, this[property]);
        return '#<Effect:' + data.inspect() + ',options:' + $H(this.options).inspect() + '>';
      }
    });

    Effect.Parallel = Class.create(Effect.Base, {
      initialize: function (effects) {
        this.effects = effects || [];
        this.start(arguments[1]);
      },
      update: function (position) {
        this.effects.invoke('render', position);
      },
      finish: function (position) {
        this.effects.each(function (effect) {
          effect.render(1.0);
          effect.cancel();
          effect.event('beforeFinish');
          if (effect.finish) effect.finish(position);
          effect.event('afterFinish');
        });
      }
    });

    Effect.Tween = Class.create(Effect.Base, {
      initialize: function (object, from, to) {
        object = Object.isString(object) ? $(object) : object;
        var args = $A(arguments), method = args.last(),
          options = args.length == 5 ? args[3] : null;
        this.method = Object.isFunction(method) ? method.bind(object) :
          Object.isFunction(object[method]) ? object[method].bind(object) :
            function (value) { object[method] = value };
        this.start(Object.extend({ from: from, to: to }, options || {}));
      },
      update: function (position) {
        this.method(position);
      }
    });

    Effect.Event = Class.create(Effect.Base, {
      initialize: function () {
        this.start(Object.extend({ duration: 0 }, arguments[0] || {}));
      },
      update: Prototype.emptyFunction
    });

    Effect.Opacity = Class.create(Effect.Base, {
      initialize: function (element) {
        this.element = $(element);
        if (!this.element) throw (Effect._elementDoesNotExistError);
        // make this work on IE on elements without 'layout'
        if (Prototype.Browser.IE && (!this.element.currentStyle.hasLayout))
          this.element.setStyle({ zoom: 1 });
        var options = Object.extend({
          from: this.element.getOpacity() || 0.0,
          to: 1.0
        }, arguments[1] || {});
        this.start(options);
      },
      update: function (position) {
        this.element.setOpacity(position);
      }
    });

    Effect.Move = Class.create(Effect.Base, {
      initialize: function (element) {
        this.element = $(element);
        if (!this.element) throw (Effect._elementDoesNotExistError);
        var options = Object.extend({
          x: 0,
          y: 0,
          mode: 'relative'
        }, arguments[1] || {});
        this.start(options);
      },
      setup: function () {
        this.element.makePositioned();
        this.originalLeft = parseFloat(this.element.getStyle('left') || '0');
        this.originalTop = parseFloat(this.element.getStyle('top') || '0');
        if (this.options.mode == 'absolute') {
          this.options.x = this.options.x - this.originalLeft;
          this.options.y = this.options.y - this.originalTop;
        }
      },
      update: function (position) {
        this.element.setStyle({
          left: (this.options.x * position + this.originalLeft).round() + 'px',
          top: (this.options.y * position + this.originalTop).round() + 'px'
        });
      }
    });

    // for backwards compatibility
    Effect.MoveBy = function (element, toTop, toLeft) {
      return new Effect.Move(element,
        Object.extend({ x: toLeft, y: toTop }, arguments[3] || {}));
    };

    Effect.Scale = Class.create(Effect.Base, {
      initialize: function (element, percent) {
        this.element = $(element);
        if (!this.element) throw (Effect._elementDoesNotExistError);
        var options = Object.extend({
          scaleX: true,
          scaleY: true,
          scaleContent: true,
          scaleFromCenter: false,
          scaleMode: 'box',        // 'box' or 'contents' or { } with provided values
          scaleFrom: 100.0,
          scaleTo: percent
        }, arguments[2] || {});
        this.start(options);
      },
      setup: function () {
        this.restoreAfterFinish = this.options.restoreAfterFinish || false;
        this.elementPositioning = this.element.getStyle('position');

        this.originalStyle = {};
        ['top', 'left', 'width', 'height', 'fontSize'].each(function (k) {
          this.originalStyle[k] = this.element.style[k];
        }.bind(this));

        this.originalTop = this.element.offsetTop;
        this.originalLeft = this.element.offsetLeft;

        var fontSize = this.element.getStyle('font-size') || '100%';
        ['em', 'px', '%', 'pt'].each(function (fontSizeType) {
          if (fontSize.indexOf(fontSizeType) > 0) {
            this.fontSize = parseFloat(fontSize);
            this.fontSizeType = fontSizeType;
          }
        }.bind(this));

        this.factor = (this.options.scaleTo - this.options.scaleFrom) / 100;

        this.dims = null;
        if (this.options.scaleMode == 'box')
          this.dims = [this.element.offsetHeight, this.element.offsetWidth];
        if (/^content/.test(this.options.scaleMode))
          this.dims = [this.element.scrollHeight, this.element.scrollWidth];
        if (!this.dims)
          this.dims = [this.options.scaleMode.originalHeight,
          this.options.scaleMode.originalWidth];
      },
      update: function (position) {
        var currentScale = (this.options.scaleFrom / 100.0) + (this.factor * position);
        if (this.options.scaleContent && this.fontSize)
          this.element.setStyle({ fontSize: this.fontSize * currentScale + this.fontSizeType });
        this.setDimensions(this.dims[0] * currentScale, this.dims[1] * currentScale);
      },
      finish: function (position) {
        if (this.restoreAfterFinish) this.element.setStyle(this.originalStyle);
      },
      setDimensions: function (height, width) {
        var d = {};
        if (this.options.scaleX) d.width = width.round() + 'px';
        if (this.options.scaleY) d.height = height.round() + 'px';
        if (this.options.scaleFromCenter) {
          var topd = (height - this.dims[0]) / 2;
          var leftd = (width - this.dims[1]) / 2;
          if (this.elementPositioning == 'absolute') {
            if (this.options.scaleY) d.top = this.originalTop - topd + 'px';
            if (this.options.scaleX) d.left = this.originalLeft - leftd + 'px';
          } else {
            if (this.options.scaleY) d.top = -topd + 'px';
            if (this.options.scaleX) d.left = -leftd + 'px';
          }
        }
        this.element.setStyle(d);
      }
    });

    Effect.Highlight = Class.create(Effect.Base, {
      initialize: function (element) {
        this.element = $(element);
        if (!this.element) throw (Effect._elementDoesNotExistError);
        var options = Object.extend({ startcolor: '#ffff99' }, arguments[1] || {});
        this.start(options);
      },
      setup: function () {
        // Prevent executing on elements not in the layout flow
        if (this.element.getStyle('display') == 'none') { this.cancel(); return; }
        // Disable background image during the effect
        this.oldStyle = {};
        if (!this.options.keepBackgroundImage) {
          this.oldStyle.backgroundImage = this.element.getStyle('background-image');
          this.element.setStyle({ backgroundImage: 'none' });
        }
        if (!this.options.endcolor)
          this.options.endcolor = this.element.getStyle('background-color').parseColor('#ffffff');
        if (!this.options.restorecolor)
          this.options.restorecolor = this.element.getStyle('background-color');
        // init color calculations
        this._base = $R(0, 2).map(function (i) { return parseInt(this.options.startcolor.slice(i * 2 + 1, i * 2 + 3), 16) }.bind(this));
        this._delta = $R(0, 2).map(function (i) { return parseInt(this.options.endcolor.slice(i * 2 + 1, i * 2 + 3), 16) - this._base[i] }.bind(this));
      },
      update: function (position) {
        this.element.setStyle({
          backgroundColor: $R(0, 2).inject('#', function (m, v, i) {
            return m + ((this._base[i] + (this._delta[i] * position)).round().toColorPart());
          }.bind(this))
        });
      },
      finish: function () {
        this.element.setStyle(Object.extend(this.oldStyle, {
          backgroundColor: this.options.restorecolor
        }));
      }
    });

    Effect.ScrollTo = function (element) {
      var options = arguments[1] || {},
        scrollOffsets = document.viewport.getScrollOffsets(),
        elementOffsets = $(element).cumulativeOffset(),
        max = (window.height || document.body.scrollHeight) - document.viewport.getHeight();

      if (options.offset) elementOffsets[1] += options.offset;

      return new Effect.Tween(null,
        scrollOffsets.top,
        elementOffsets[1] > max ? max : elementOffsets[1],
        options,
        function (p) { scrollTo(scrollOffsets.left, p.round()) }
      );
    };

    /* ------------- combination effects ------------- */

    Effect.Fade = function (element) {
      element = $(element);
      var oldOpacity = element.getInlineOpacity();
      var options = Object.extend({
        from: element.getOpacity() || 1.0,
        to: 0.0,
        afterFinishInternal: function (effect) {
          if (effect.options.to != 0) return;
          effect.element.hide().setStyle({ opacity: oldOpacity });
        }
      }, arguments[1] || {});
      return new Effect.Opacity(element, options);
    };

    Effect.Appear = function (element) {
      element = $(element);
      var options = Object.extend({
        from: (element.getStyle('display') == 'none' ? 0.0 : element.getOpacity() || 0.0),
        to: 1.0,
        // force Safari to render floated elements properly
        afterFinishInternal: function (effect) {
          effect.element.forceRerendering();
        },
        beforeSetup: function (effect) {
          effect.element.setOpacity(effect.options.from).show();
        }
      }, arguments[1] || {});
      return new Effect.Opacity(element, options);
    };

    Effect.Puff = function (element) {
      element = $(element);
      var oldStyle = {
        opacity: element.getInlineOpacity(),
        position: element.getStyle('position'),
        top: element.style.top,
        left: element.style.left,
        width: element.style.width,
        height: element.style.height
      };
      return new Effect.Parallel(
        [new Effect.Scale(element, 200,
          { sync: true, scaleFromCenter: true, scaleContent: true, restoreAfterFinish: true }),
        new Effect.Opacity(element, { sync: true, to: 0.0 })],
        Object.extend({
          duration: 1.0,
          beforeSetupInternal: function (effect) {
            Position.absolutize(effect.effects[0].element)
          },
          afterFinishInternal: function (effect) {
            effect.effects[0].element.hide().setStyle(oldStyle);
          }
        }, arguments[1] || {})
      );
    };

    Effect.BlindUp = function (element) {
      element = $(element);
      element.makeClipping();
      return new Effect.Scale(element, 0,
        Object.extend({
          scaleContent: false,
          scaleX: false,
          restoreAfterFinish: true,
          afterFinishInternal: function (effect) {
            effect.element.hide().undoClipping();
          }
        }, arguments[1] || {})
      );
    };

    Effect.BlindDown = function (element) {
      element = $(element);
      var elementDimensions = element.getDimensions();
      return new Effect.Scale(element, 100, Object.extend({
        scaleContent: false,
        scaleX: false,
        scaleFrom: 0,
        scaleMode: { originalHeight: elementDimensions.height, originalWidth: elementDimensions.width },
        restoreAfterFinish: true,
        afterSetup: function (effect) {
          effect.element.makeClipping().setStyle({ height: '0px' }).show();
        },
        afterFinishInternal: function (effect) {
          effect.element.undoClipping();
        }
      }, arguments[1] || {}));
    };

    Effect.SwitchOff = function (element) {
      element = $(element);
      var oldOpacity = element.getInlineOpacity();
      return new Effect.Appear(element, Object.extend({
        duration: 0.4,
        from: 0,
        transition: Effect.Transitions.flicker,
        afterFinishInternal: function (effect) {
          new Effect.Scale(effect.element, 1, {
            duration: 0.3, scaleFromCenter: true,
            scaleX: false, scaleContent: false, restoreAfterFinish: true,
            beforeSetup: function (effect) {
              effect.element.makePositioned().makeClipping();
            },
            afterFinishInternal: function (effect) {
              effect.element.hide().undoClipping().undoPositioned().setStyle({ opacity: oldOpacity });
            }
          })
        }
      }, arguments[1] || {}));
    };

    Effect.DropOut = function (element) {
      element = $(element);
      var oldStyle = {
        top: element.getStyle('top'),
        left: element.getStyle('left'),
        opacity: element.getInlineOpacity()
      };
      return new Effect.Parallel(
        [new Effect.Move(element, { x: 0, y: 100, sync: true }),
        new Effect.Opacity(element, { sync: true, to: 0.0 })],
        Object.extend(
          {
            duration: 0.5,
            beforeSetup: function (effect) {
              effect.effects[0].element.makePositioned();
            },
            afterFinishInternal: function (effect) {
              effect.effects[0].element.hide().undoPositioned().setStyle(oldStyle);
            }
          }, arguments[1] || {}));
    };

    Effect.Shake = function (element) {
      element = $(element);
      var options = Object.extend({
        distance: 20,
        duration: 0.5
      }, arguments[1] || {});
      var distance = parseFloat(options.distance);
      var split = parseFloat(options.duration) / 10.0;
      var oldStyle = {
        top: element.getStyle('top'),
        left: element.getStyle('left')
      };
      return new Effect.Move(element,
        {
          x: distance, y: 0, duration: split, afterFinishInternal: function (effect) {
            new Effect.Move(effect.element,
              {
                x: -distance * 2, y: 0, duration: split * 2, afterFinishInternal: function (effect) {
                  new Effect.Move(effect.element,
                    {
                      x: distance * 2, y: 0, duration: split * 2, afterFinishInternal: function (effect) {
                        new Effect.Move(effect.element,
                          {
                            x: -distance * 2, y: 0, duration: split * 2, afterFinishInternal: function (effect) {
                              new Effect.Move(effect.element,
                                {
                                  x: distance * 2, y: 0, duration: split * 2, afterFinishInternal: function (effect) {
                                    new Effect.Move(effect.element,
                                      {
                                        x: -distance, y: 0, duration: split, afterFinishInternal: function (effect) {
                                          effect.element.undoPositioned().setStyle(oldStyle);
                                        }
                                      })
                                  }
                                })
                            }
                          })
                      }
                    })
                }
              })
          }
        });
    };

    Effect.SlideDown = function (element) {
      element = $(element).cleanWhitespace();
      // SlideDown need to have the content of the element wrapped in a container element with fixed height!
      var oldInnerBottom = element.down().getStyle('bottom');
      var elementDimensions = element.getDimensions();
      return new Effect.Scale(element, 100, Object.extend({
        scaleContent: false,
        scaleX: false,
        scaleFrom: window.opera ? 0 : 1,
        scaleMode: { originalHeight: elementDimensions.height, originalWidth: elementDimensions.width },
        restoreAfterFinish: true,
        afterSetup: function (effect) {
          effect.element.makePositioned();
          effect.element.down().makePositioned();
          if (window.opera) effect.element.setStyle({ top: '' });
          effect.element.makeClipping().setStyle({ height: '0px' }).show();
        },
        afterUpdateInternal: function (effect) {
          effect.element.down().setStyle({
            bottom:
              (effect.dims[0] - effect.element.clientHeight) + 'px'
          });
        },
        afterFinishInternal: function (effect) {
          effect.element.undoClipping().undoPositioned();
          effect.element.down().undoPositioned().setStyle({ bottom: oldInnerBottom });
        }
      }, arguments[1] || {})
      );
    };

    Effect.SlideUp = function (element) {
      element = $(element).cleanWhitespace();
      var oldInnerBottom = element.down().getStyle('bottom');
      var elementDimensions = element.getDimensions();
      return new Effect.Scale(element, window.opera ? 0 : 1,
        Object.extend({
          scaleContent: false,
          scaleX: false,
          scaleMode: 'box',
          scaleFrom: 100,
          scaleMode: { originalHeight: elementDimensions.height, originalWidth: elementDimensions.width },
          restoreAfterFinish: true,
          afterSetup: function (effect) {
            effect.element.makePositioned();
            effect.element.down().makePositioned();
            if (window.opera) effect.element.setStyle({ top: '' });
            effect.element.makeClipping().show();
          },
          afterUpdateInternal: function (effect) {
            effect.element.down().setStyle({
              bottom:
                (effect.dims[0] - effect.element.clientHeight) + 'px'
            });
          },
          afterFinishInternal: function (effect) {
            effect.element.hide().undoClipping().undoPositioned();
            effect.element.down().undoPositioned().setStyle({ bottom: oldInnerBottom });
          }
        }, arguments[1] || {})
      );
    };

    // Bug in opera makes the TD containing this element expand for a instance after finish 
    Effect.Squish = function (element) {
      return new Effect.Scale(element, window.opera ? 1 : 0, {
        restoreAfterFinish: true,
        beforeSetup: function (effect) {
          effect.element.makeClipping();
        },
        afterFinishInternal: function (effect) {
          effect.element.hide().undoClipping();
        }
      });
    };

    Effect.Grow = function (element) {
      element = $(element);
      var options = Object.extend({
        direction: 'center',
        moveTransition: Effect.Transitions.sinoidal,
        scaleTransition: Effect.Transitions.sinoidal,
        opacityTransition: Effect.Transitions.full
      }, arguments[1] || {});
      var oldStyle = {
        top: element.style.top,
        left: element.style.left,
        height: element.style.height,
        width: element.style.width,
        opacity: element.getInlineOpacity()
      };

      var dims = element.getDimensions();
      var initialMoveX, initialMoveY;
      var moveX, moveY;

      switch (options.direction) {
        case 'top-left':
          initialMoveX = initialMoveY = moveX = moveY = 0;
          break;
        case 'top-right':
          initialMoveX = dims.width;
          initialMoveY = moveY = 0;
          moveX = -dims.width;
          break;
        case 'bottom-left':
          initialMoveX = moveX = 0;
          initialMoveY = dims.height;
          moveY = -dims.height;
          break;
        case 'bottom-right':
          initialMoveX = dims.width;
          initialMoveY = dims.height;
          moveX = -dims.width;
          moveY = -dims.height;
          break;
        case 'center':
          initialMoveX = dims.width / 2;
          initialMoveY = dims.height / 2;
          moveX = -dims.width / 2;
          moveY = -dims.height / 2;
          break;
      }

      return new Effect.Move(element, {
        x: initialMoveX,
        y: initialMoveY,
        duration: 0.01,
        beforeSetup: function (effect) {
          effect.element.hide().makeClipping().makePositioned();
        },
        afterFinishInternal: function (effect) {
          new Effect.Parallel(
            [new Effect.Opacity(effect.element, { sync: true, to: 1.0, from: 0.0, transition: options.opacityTransition }),
            new Effect.Move(effect.element, { x: moveX, y: moveY, sync: true, transition: options.moveTransition }),
            new Effect.Scale(effect.element, 100, {
              scaleMode: { originalHeight: dims.height, originalWidth: dims.width },
              sync: true, scaleFrom: window.opera ? 1 : 0, transition: options.scaleTransition, restoreAfterFinish: true
            })
            ], Object.extend({
              beforeSetup: function (effect) {
                effect.effects[0].element.setStyle({ height: '0px' }).show();
              },
              afterFinishInternal: function (effect) {
                effect.effects[0].element.undoClipping().undoPositioned().setStyle(oldStyle);
              }
            }, options)
          )
        }
      });
    };

    Effect.Shrink = function (element) {
      element = $(element);
      var options = Object.extend({
        direction: 'center',
        moveTransition: Effect.Transitions.sinoidal,
        scaleTransition: Effect.Transitions.sinoidal,
        opacityTransition: Effect.Transitions.none
      }, arguments[1] || {});
      var oldStyle = {
        top: element.style.top,
        left: element.style.left,
        height: element.style.height,
        width: element.style.width,
        opacity: element.getInlineOpacity()
      };

      var dims = element.getDimensions();
      var moveX, moveY;

      switch (options.direction) {
        case 'top-left':
          moveX = moveY = 0;
          break;
        case 'top-right':
          moveX = dims.width;
          moveY = 0;
          break;
        case 'bottom-left':
          moveX = 0;
          moveY = dims.height;
          break;
        case 'bottom-right':
          moveX = dims.width;
          moveY = dims.height;
          break;
        case 'center':
          moveX = dims.width / 2;
          moveY = dims.height / 2;
          break;
      }

      return new Effect.Parallel(
        [new Effect.Opacity(element, { sync: true, to: 0.0, from: 1.0, transition: options.opacityTransition }),
        new Effect.Scale(element, window.opera ? 1 : 0, { sync: true, transition: options.scaleTransition, restoreAfterFinish: true }),
        new Effect.Move(element, { x: moveX, y: moveY, sync: true, transition: options.moveTransition })
        ], Object.extend({
          beforeStartInternal: function (effect) {
            effect.effects[0].element.makePositioned().makeClipping();
          },
          afterFinishInternal: function (effect) {
            effect.effects[0].element.hide().undoClipping().undoPositioned().setStyle(oldStyle);
          }
        }, options)
      );
    };

    Effect.Pulsate = function (element) {
      element = $(element);
      var options = arguments[1] || {};
      var oldOpacity = element.getInlineOpacity();
      var transition = options.transition || Effect.Transitions.sinoidal;
      var reverser = function (pos) { return transition(1 - Effect.Transitions.pulse(pos, options.pulses)) };
      reverser.bind(transition);
      return new Effect.Opacity(element,
        Object.extend(Object.extend({
          duration: 2.0, from: 0,
          afterFinishInternal: function (effect) { effect.element.setStyle({ opacity: oldOpacity }); }
        }, options), { transition: reverser }));
    };

    Effect.Fold = function (element) {
      element = $(element);
      var oldStyle = {
        top: element.style.top,
        left: element.style.left,
        width: element.style.width,
        height: element.style.height
      };
      element.makeClipping();
      return new Effect.Scale(element, 5, Object.extend({
        scaleContent: false,
        scaleX: false,
        afterFinishInternal: function (effect) {
          new Effect.Scale(element, 1, {
            scaleContent: false,
            scaleY: false,
            afterFinishInternal: function (effect) {
              effect.element.hide().undoClipping().setStyle(oldStyle);
            }
          });
        }
      }, arguments[1] || {}));
    };

    Effect.Morph = Class.create(Effect.Base, {
      initialize: function (element) {
        this.element = $(element);
        if (!this.element) throw (Effect._elementDoesNotExistError);
        var options = Object.extend({
          style: {}
        }, arguments[1] || {});

        if (!Object.isString(options.style)) this.style = $H(options.style);
        else {
          if (options.style.include(':'))
            this.style = options.style.parseStyle();
          else {
            this.element.addClassName(options.style);
            this.style = $H(this.element.getStyles());
            this.element.removeClassName(options.style);
            var css = this.element.getStyles();
            this.style = this.style.reject(function (style) {
              return style.value == css[style.key];
            });
            options.afterFinishInternal = function (effect) {
              effect.element.addClassName(effect.options.style);
              effect.transforms.each(function (transform) {
                effect.element.style[transform.style] = '';
              });
            }
          }
        }
        this.start(options);
      },

      setup: function () {
        function parseColor(color) {
          if (!color || ['rgba(0, 0, 0, 0)', 'transparent'].include(color)) color = '#ffffff';
          color = color.parseColor();
          return $R(0, 2).map(function (i) {
            return parseInt(color.slice(i * 2 + 1, i * 2 + 3), 16)
          });
        }
        this.transforms = this.style.map(function (pair) {
          var property = pair[0], value = pair[1], unit = null;

          if (value.parseColor('#zzzzzz') != '#zzzzzz') {
            value = value.parseColor();
            unit = 'color';
          } else if (property == 'opacity') {
            value = parseFloat(value);
            if (Prototype.Browser.IE && (!this.element.currentStyle.hasLayout))
              this.element.setStyle({ zoom: 1 });
          } else if (Element.CSS_LENGTH.test(value)) {
            var components = value.match(/^([\+\-]?[0-9\.]+)(.*)$/);
            value = parseFloat(components[1]);
            unit = (components.length == 3) ? components[2] : null;
          }

          var originalValue = this.element.getStyle(property);
          return {
            style: property.camelize(),
            originalValue: unit == 'color' ? parseColor(originalValue) : parseFloat(originalValue || 0),
            targetValue: unit == 'color' ? parseColor(value) : value,
            unit: unit
          };
        }.bind(this)).reject(function (transform) {
          return (
            (transform.originalValue == transform.targetValue) ||
            (
              transform.unit != 'color' &&
              (isNaN(transform.originalValue) || isNaN(transform.targetValue))
            )
          )
        });
      },
      update: function (position) {
        var style = {}, transform, i = this.transforms.length;
        while (i--)
          style[(transform = this.transforms[i]).style] =
            transform.unit == 'color' ? '#' +
              (Math.round(transform.originalValue[0] +
                (transform.targetValue[0] - transform.originalValue[0]) * position)).toColorPart() +
              (Math.round(transform.originalValue[1] +
                (transform.targetValue[1] - transform.originalValue[1]) * position)).toColorPart() +
              (Math.round(transform.originalValue[2] +
                (transform.targetValue[2] - transform.originalValue[2]) * position)).toColorPart() :
              (transform.originalValue +
                (transform.targetValue - transform.originalValue) * position).toFixed(3) +
              (transform.unit === null ? '' : transform.unit);
        this.element.setStyle(style, true);
      }
    });

    Effect.Transform = Class.create({
      initialize: function (tracks) {
        this.tracks = [];
        this.options = arguments[1] || {};
        this.addTracks(tracks);
      },
      addTracks: function (tracks) {
        tracks.each(function (track) {
          track = $H(track);
          var data = track.values().first();
          this.tracks.push($H({
            ids: track.keys().first(),
            effect: Effect.Morph,
            options: { style: data }
          }));
        }.bind(this));
        return this;
      },
      play: function () {
        return new Effect.Parallel(
          this.tracks.map(function (track) {
            var ids = track.get('ids'), effect = track.get('effect'), options = track.get('options');
            var elements = [$(ids) || $$(ids)].flatten();
            return elements.map(function (e) { return new effect(e, Object.extend({ sync: true }, options)) });
          }).flatten(),
          this.options
        );
      }
    });

    Element.CSS_PROPERTIES = $w(
      'backgroundColor backgroundPosition borderBottomColor borderBottomStyle ' +
      'borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth ' +
      'borderRightColor borderRightStyle borderRightWidth borderSpacing ' +
      'borderTopColor borderTopStyle borderTopWidth bottom clip color ' +
      'fontSize fontWeight height left letterSpacing lineHeight ' +
      'marginBottom marginLeft marginRight marginTop markerOffset maxHeight ' +
      'maxWidth minHeight minWidth opacity outlineColor outlineOffset ' +
      'outlineWidth paddingBottom paddingLeft paddingRight paddingTop ' +
      'right textIndent top width wordSpacing zIndex');

    Element.CSS_LENGTH = /^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;

    String.__parseStyleElement = document.createElement('div');
    String.prototype.parseStyle = function () {
      var style, styleRules = $H();
      if (Prototype.Browser.WebKit)
        style = new Element('div', { style: this }).style;
      else {
        String.__parseStyleElement.innerHTML = '<div style="' + this + '"></div>';
        style = String.__parseStyleElement.childNodes[0].style;
      }

      Element.CSS_PROPERTIES.each(function (property) {
        if (style[property]) styleRules.set(property, style[property]);
      });

      if (Prototype.Browser.IE && this.include('opacity'))
        styleRules.set('opacity', this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);

      return styleRules;
    };

    if (document.defaultView && document.defaultView.getComputedStyle) {
      Element.getStyles = function (element) {
        var css = document.defaultView.getComputedStyle($(element), null);
        return Element.CSS_PROPERTIES.inject({}, function (styles, property) {
          styles[property] = css[property];
          return styles;
        });
      };
    } else {
      Element.getStyles = function (element) {
        element = $(element);
        var css = element.currentStyle, styles;
        styles = Element.CSS_PROPERTIES.inject({}, function (results, property) {
          results[property] = css[property];
          return results;
        });
        if (!styles.opacity) styles.opacity = element.getOpacity();
        return styles;
      };
    };

    Effect.Methods = {
      morph: function (element, style) {
        element = $(element);
        new Effect.Morph(element, Object.extend({ style: style }, arguments[2] || {}));
        return element;
      },
      visualEffect: function (element, effect, options) {
        element = $(element)
        var s = effect.dasherize().camelize(), klass = s.charAt(0).toUpperCase() + s.substring(1);
        new Effect[klass](element, options);
        return element;
      },
      highlight: function (element, options) {
        element = $(element);
        new Effect.Highlight(element, options);
        return element;
      }
    };

    $w('fade appear grow shrink fold blindUp blindDown slideUp slideDown ' +
      'pulsate shake puff squish switchOff dropOut').each(
        function (effect) {
          Effect.Methods[effect] = function (element, options) {
            element = $(element);
            Effect[effect.charAt(0).toUpperCase() + effect.substring(1)](element, options);
            return element;
          }
        }
      );

    $w('getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles').each(
      function (f) { Effect.Methods[f] = Element[f]; }
    );

    Element.addMethods(Effect.Methods);
    // script.aculo.us controls.js v1.8.1, Thu Jan 03 22:07:12 -0500 2008

    // Copyright (c) 2005-2007 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)
    //           (c) 2005-2007 Ivan Krstic (http://blogs.law.harvard.edu/ivan)
    //           (c) 2005-2007 Jon Tirsen (http://www.tirsen.com)
    // Contributors:
    //  Richard Livsey
    //  Rahul Bhargava
    //  Rob Wills
    // 
    // script.aculo.us is freely distributable under the terms of an MIT-style license.
    // For details, see the script.aculo.us web site: http://script.aculo.us/

    // Autocompleter.Base handles all the autocompletion functionality 
    // that's independent of the data source for autocompletion. This
    // includes drawing the autocompletion menu, observing keyboard
    // and mouse events, and similar.
    //
    // Specific autocompleters need to provide, at the very least, 
    // a getUpdatedChoices function that will be invoked every time
    // the text inside the monitored textbox changes. This method 
    // should get the text for which to provide autocompletion by
    // invoking this.getToken(), NOT by directly accessing
    // this.element.value. This is to allow incremental tokenized
    // autocompletion. Specific auto-completion logic (AJAX, etc)
    // belongs in getUpdatedChoices.
    //
    // Tokenized incremental autocompletion is enabled automatically
    // when an autocompleter is instantiated with the 'tokens' option
    // in the options parameter, e.g.:
    // new Ajax.Autocompleter('id','upd', '/url/', { tokens: ',' });
    // will incrementally autocomplete with a comma as the token.
    // Additionally, ',' in the above example can be replaced with
    // a token array, e.g. { tokens: [',', '\n'] } which
    // enables autocompletion on multiple tokens. This is most 
    // useful when one of the tokens is \n (a newline), as it 
    // allows smart autocompletion after linebreaks.

    if (typeof Effect == 'undefined')
      throw ("controls.js requires including script.aculo.us' effects.js library");

    var Autocompleter = {}
    Autocompleter.Base = Class.create({
      baseInitialize: function (element, update, options) {
        element = $(element)
        this.element = element;
        this.update = $(update);
        this.hasFocus = false;
        this.changed = false;
        this.active = false;
        this.index = 0;
        this.entryCount = 0;
        this.oldElementValue = this.element.value;

        if (this.setOptions)
          this.setOptions(options);
        else
          this.options = options || {};

        var bSetWidth = true;
        if (typeof (this.options.setWidth) != 'undefined')
          bSetWidth = this.options.setWidth;

        this.options.paramName = this.options.paramName || this.element.name;
        this.options.tokens = this.options.tokens || [];
        this.options.frequency = this.options.frequency || 0.4;
        this.options.minChars = this.options.minChars || 1;
        this.options.onShow = this.options.onShow ||
          function (element, update) {
            if (!update.style.position || update.style.position == 'absolute') {
              update.style.position = 'absolute';
              Position.clone(element, update, {
                setHeight: false,
                setWidth: bSetWidth,
                offsetTop: element.offsetHeight
              });
            }
            Effect.Appear(update, { duration: 0.15 });
          };
        this.options.onHide = this.options.onHide ||
          function (element, update) { new Effect.Fade(update, { duration: 0.15 }) };

        if (typeof (this.options.tokens) == 'string')
          this.options.tokens = new Array(this.options.tokens);
        // Force carriage returns as token delimiters anyway
        if (!this.options.tokens.include('\n'))
          this.options.tokens.push('\n');

        this.observer = null;

        this.element.setAttribute('autocomplete', 'off');

        Element.hide(this.update);

        Event.observe(this.element, 'blur', this.onBlur.bindAsEventListener(this));
        Event.observe(this.element, 'keydown', this.onKeyPress.bindAsEventListener(this));
      },

      show: function () {
        if (Element.getStyle(this.update, 'display') == 'none') this.options.onShow(this.element, this.update);
        if (!this.iefix &&
          (Prototype.Browser.IE) &&
          (Element.getStyle(this.update, 'position') == 'absolute')) {
          new Insertion.After(this.update,
            '<iframe id="' + this.update.id + '_iefix" ' +
            'style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" ' +
            'src="javascript:false;" frameborder="0" scrolling="no"></iframe>');
          this.iefix = $(this.update.id + '_iefix');
        }
        if (this.iefix) setTimeout(this.fixIEOverlapping.bind(this), 50);
      },

      fixIEOverlapping: function () {
        Position.clone(this.update, this.iefix, { setTop: (!this.update.style.height) });
        this.iefix.style.zIndex = 1;
        this.update.style.zIndex = 2;
        Element.show(this.iefix);
      },

      hide: function () {
        this.stopIndicator();
        if (Element.getStyle(this.update, 'display') != 'none') this.options.onHide(this.element, this.update);
        if (this.iefix) Element.hide(this.iefix);
      },

      startIndicator: function () {
        if (this.options.indicator) Element.show(this.options.indicator);
      },

      stopIndicator: function () {
        if (this.options.indicator) Element.hide(this.options.indicator);
      },

      onKeyPress: function (event) {
        if (this.active)
          switch (event.keyCode) {
            case Event.KEY_TAB:
            case Event.KEY_RETURN:
              this.selectEntry();
              Event.stop(event);
            case Event.KEY_ESC:
              this.hide();
              this.active = false;
              Event.stop(event);
              return;
            case Event.KEY_LEFT:
            case Event.KEY_RIGHT:
              return;
            case Event.KEY_UP:
              this.markPrevious();
              this.render();
              Event.stop(event);
              return;
            case Event.KEY_DOWN:
              this.markNext();
              this.render();
              Event.stop(event);
              return;
          }
        else
          if (event.keyCode == Event.KEY_TAB || event.keyCode == Event.KEY_RETURN ||
            (Prototype.Browser.WebKit > 0 && event.keyCode == 0)) return;

        this.changed = true;
        this.hasFocus = true;

        if (this.observer) clearTimeout(this.observer);
        this.observer =
          setTimeout(this.onObserverEvent.bind(this), this.options.frequency * 1000);
      },

      activate: function () {
        this.changed = false;
        this.hasFocus = true;
        this.getUpdatedChoices();
      },

      onHover: function (event) {
        var element = Event.findElement(event, 'LI');
        if (this.index != element.autocompleteIndex) {
          this.index = element.autocompleteIndex;
          this.render();
        }
        Event.stop(event);
      },

      onClick: function (event) {
        var element = Event.findElement(event, 'LI');
        this.index = element.autocompleteIndex;
        this.selectEntry();
        this.hide();
      },

      onBlur: function (event) {
        // needed to make click events working
        setTimeout(this.hide.bind(this), 250);
        this.hasFocus = false;
        this.active = false;
      },

      render: function () {
        if (this.entryCount > 0) {
          for (var i = 0; i < this.entryCount; i++)
            this.index == i ?
              Element.addClassName(this.getEntry(i), "selected") :
              Element.removeClassName(this.getEntry(i), "selected");
          if (this.hasFocus) {
            this.show();
            this.active = true;
          }
        } else {
          this.active = false;
          this.hide();
        }
      },

      markPrevious: function () {
        if (this.index > 0) this.index--
        else this.index = this.entryCount - 1;
      },

      markNext: function () {
        if (this.index < this.entryCount - 1) this.index++
        else this.index = 0;
      },

      getEntry: function (index) {
        return (index >= 0 && index <= this.entryCount) ? this.update.firstChild.childNodes[index] : null;
      },

      getCurrentEntry: function () {
        return this.getEntry(this.index);
      },

      selectEntry: function () {
        this.active = false;
        this.updateElement(this.getCurrentEntry());
      },

      updateElement: function (selectedElement) {
        if (this.options.updateElement) {
          this.options.updateElement(selectedElement);
          return;
        }
        if (selectedElement) {
          var value = '';
          if (this.options.select) {
            var nodes = $(selectedElement).select('.' + this.options.select) || [];
            if (nodes.length > 0) value = Element.collectTextNodes(nodes[0], this.options.select);
          } else
            value = Element.collectTextNodesIgnoreClass(selectedElement, 'informal');

          var bounds = this.getTokenBounds();
          if (bounds[0] != -1) {
            var newValue = this.element.value.substr(0, bounds[0]);
            var whitespace = this.element.value.substr(bounds[0]).match(/^\s+/);
            if (whitespace)
              newValue += whitespace[0];
            this.element.value = newValue + value + this.element.value.substr(bounds[1]);
          } else {
            this.element.value = value;
          }
          this.oldElementValue = this.element.value;
          this.element.focus();
        }

        if (this.options.afterUpdateElement)
          this.options.afterUpdateElement(this.element, selectedElement);
      },

      updateChoices: function (choices) {
        if (!this.changed && this.hasFocus) {
          this.update.innerHTML = choices;
          Element.cleanWhitespace(this.update);
          Element.cleanWhitespace(this.update.down());

          if (this.update.firstChild && this.update.down().childNodes) {
            this.entryCount =
              this.update.down().childNodes.length;
            for (var i = 0; i < this.entryCount; i++) {
              var entry = this.getEntry(i);
              entry.autocompleteIndex = i;
              this.addObservers(entry);
            }
          } else {
            this.entryCount = 0;
          }

          this.stopIndicator();
          this.index = (this.options.allowFreeEntry ? -1 : 0);

          if (this.entryCount == 1 && this.options.autoSelect) {
            this.selectEntry();
            this.hide();
          } else {
            this.render();
          }
        }
      },

      addObservers: function (element) {
        Event.observe(element, "mouseover", this.onHover.bindAsEventListener(this));
        Event.observe(element, "click", this.onClick.bindAsEventListener(this));
      },

      onObserverEvent: function () {
        this.changed = false;
        this.tokenBounds = null;
        if (this.getToken().length >= this.options.minChars) {
          this.getUpdatedChoices();
        } else {
          this.active = false;
          this.hide();
        }
        this.oldElementValue = this.element.value;
      },

      getToken: function () {
        var bounds = this.getTokenBounds();
        return this.element.value.substring(bounds[0], bounds[1]).strip();
      },

      getTokenBounds: function () {
        if (null != this.tokenBounds) return this.tokenBounds;
        var value = this.element.value;
        if (value.strip().empty()) return [-1, 0];
        var diff = arguments.callee.getFirstDifferencePos(value, this.oldElementValue);
        var offset = (diff == this.oldElementValue.length ? 1 : 0);
        var prevTokenPos = -1, nextTokenPos = value.length;
        var tp;
        for (var index = 0, l = this.options.tokens.length; index < l; ++index) {
          tp = value.lastIndexOf(this.options.tokens[index], diff + offset - 1);
          if (tp > prevTokenPos) prevTokenPos = tp;
          tp = value.indexOf(this.options.tokens[index], diff + offset);
          if (-1 != tp && tp < nextTokenPos) nextTokenPos = tp;
        }
        return (this.tokenBounds = [prevTokenPos + 1, nextTokenPos]);
      }
    });

    Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos = function (newS, oldS) {
      var boundary = Math.min(newS.length, oldS.length);
      for (var index = 0; index < boundary; ++index)
        if (newS[index] != oldS[index])
          return index;
      return boundary;
    };

    Ajax.Autocompleter = Class.create(Autocompleter.Base, {
      initialize: function (element, update, url, options) {
        this.baseInitialize(element, update, options);
        this.options.asynchronous = true;
        this.options.onComplete = this.onComplete.bind(this);
        this.options.defaultParams = this.options.parameters || null;
        this.url = url;
      },

      getUpdatedChoices: function () {
        this.startIndicator();

        var entry = encodeURIComponent(this.options.paramName) + '=' +
          encodeURIComponent(this.getToken());

        this.options.parameters = this.options.callback ?
          this.options.callback(this.element, entry) : entry;

        if (this.options.defaultParams)
          this.options.parameters += '&' + this.options.defaultParams;

        new Ajax.Request(this.url, this.options);
      },

      onComplete: function (request) {
        this.updateChoices(request.responseText);
      }
    });

    // The local array autocompleter. Used when you'd prefer to
    // inject an array of autocompletion options into the page, rather
    // than sending out Ajax queries, which can be quite slow sometimes.
    //
    // The constructor takes four parameters. The first two are, as usual,
    // the id of the monitored textbox, and id of the autocompletion menu.
    // The third is the array you want to autocomplete from, and the fourth
    // is the options block.
    //
    // Extra local autocompletion options:
    // - choices - How many autocompletion choices to offer
    //
    // - partialSearch - If false, the autocompleter will match entered
    //                    text only at the beginning of strings in the 
    //                    autocomplete array. Defaults to true, which will
    //                    match text at the beginning of any *word* in the
    //                    strings in the autocomplete array. If you want to
    //                    search anywhere in the string, additionally set
    //                    the option fullSearch to true (default: off).
    //
    // - fullSsearch - Search anywhere in autocomplete array strings.
    //
    // - partialChars - How many characters to enter before triggering
    //                   a partial match (unlike minChars, which defines
    //                   how many characters are required to do any match
    //                   at all). Defaults to 2.
    //
    // - ignoreCase - Whether to ignore case when autocompleting.
    //                 Defaults to true.
    //
    // It's possible to pass in a custom function as the 'selector' 
    // option, if you prefer to write your own autocompletion logic.
    // In that case, the other options above will not apply unless
    // you support them.

    Autocompleter.Local = Class.create(Autocompleter.Base, {
      initialize: function (element, update, array, options) {
        this.baseInitialize(element, update, options);
        this.options.array = array;
      },

      getUpdatedChoices: function () {
        this.updateChoices(this.options.selector(this));
      },

      setOptions: function (options) {
        this.options = Object.extend({
          choices: 10,
          partialSearch: true,
          partialChars: 2,
          ignoreCase: true,
          fullSearch: false,
          selector: function (instance) {
            var ret = []; // Beginning matches
            var partial = []; // Inside matches
            var entry = instance.getToken();
            var count = 0;

            for (var i = 0; i < instance.options.array.length &&
              ret.length < instance.options.choices; i++) {

              var elem = instance.options.array[i];
              var foundPos = instance.options.ignoreCase ?
                elem.toLowerCase().indexOf(entry.toLowerCase()) :
                elem.indexOf(entry);

              while (foundPos != -1) {
                if (foundPos == 0 && elem.length != entry.length) {
                  ret.push("<li><strong>" + elem.substr(0, entry.length) + "</strong>" +
                    elem.substr(entry.length) + "</li>");
                  break;
                } else if (entry.length >= instance.options.partialChars &&
                  instance.options.partialSearch && foundPos != -1) {
                  if (instance.options.fullSearch || /\s/.test(elem.substr(foundPos - 1, 1))) {
                    partial.push("<li>" + elem.substr(0, foundPos) + "<strong>" +
                      elem.substr(foundPos, entry.length) + "</strong>" + elem.substr(
                        foundPos + entry.length) + "</li>");
                    break;
                  }
                }

                foundPos = instance.options.ignoreCase ?
                  elem.toLowerCase().indexOf(entry.toLowerCase(), foundPos + 1) :
                  elem.indexOf(entry, foundPos + 1);

              }
            }
            if (partial.length)
              ret = ret.concat(partial.slice(0, instance.options.choices - ret.length))
            return "<ul>" + ret.join('') + "</ul>";
          }
        }, options || {});
      }
    });

    // AJAX in-place editor and collection editor
    // Full rewrite by Christophe Porteneuve <tdd@tddsworld.com> (April 2007).

    // Use this if you notice weird scrolling problems on some browsers,
    // the DOM might be a bit confused when this gets called so do this
    // waits 1 ms (with setTimeout) until it does the activation
    Field.scrollFreeActivate = function (field) {
      setTimeout(function () {
        Field.activate(field);
      }, 1);
    }

    Ajax.InPlaceEditor = Class.create({
      initialize: function (element, url, options) {
        this.url = url;
        this.element = element = $(element);
        this.prepareOptions();
        this._controls = {};
        arguments.callee.dealWithDeprecatedOptions(options); // DEPRECATION LAYER!!!
        Object.extend(this.options, options || {});
        if (!this.options.formId && this.element.id) {
          this.options.formId = this.element.id + '-inplaceeditor';
          if ($(this.options.formId))
            this.options.formId = '';
        }
        if (this.options.externalControl)
          this.options.externalControl = $(this.options.externalControl);
        if (!this.options.externalControl)
          this.options.externalControlOnly = false;
        this._originalBackground = this.element.getStyle('background-color') || 'transparent';
        this.element.title = this.options.clickToEditText;
        this._boundCancelHandler = this.handleFormCancellation.bind(this);
        this._boundComplete = (this.options.onComplete || Prototype.emptyFunction).bind(this);
        this._boundFailureHandler = this.handleAJAXFailure.bind(this);
        this._boundSubmitHandler = this.handleFormSubmission.bind(this);
        this._boundWrapperHandler = this.wrapUp.bind(this);
        this.registerListeners();
      },
      checkForEscapeOrReturn: function (e) {
        if (!this._editing || e.ctrlKey || e.altKey || e.shiftKey) return;
        if (Event.KEY_ESC == e.keyCode)
          this.handleFormCancellation(e);
        else if (Event.KEY_RETURN == e.keyCode)
          this.handleFormSubmission(e);
      },
      createControl: function (mode, handler, extraClasses) {
        var control = this.options[mode + 'Control'];
        var text = this.options[mode + 'Text'];
        if ('button' == control) {
          var btn = document.createElement('input');
          btn.type = 'submit';
          btn.value = text;
          btn.className = 'editor_' + mode + '_button';
          if ('cancel' == mode)
            btn.onclick = this._boundCancelHandler;
          this._form.appendChild(btn);
          this._controls[mode] = btn;
        } else if ('link' == control) {
          var link = document.createElement('a');
          link.href = '#';
          link.appendChild(document.createTextNode(text));
          link.onclick = 'cancel' == mode ? this._boundCancelHandler : this._boundSubmitHandler;
          link.className = 'editor_' + mode + '_link';
          if (extraClasses)
            link.className += ' ' + extraClasses;
          this._form.appendChild(link);
          this._controls[mode] = link;
        }
      },
      createEditField: function () {
        var text = (this.options.loadTextURL ? this.options.loadingText : this.getText());
        var fld;
        if (1 >= this.options.rows && !/\r|\n/.test(this.getText())) {
          fld = document.createElement('input');
          fld.type = 'text';
          var size = this.options.size || this.options.cols || 0;
          if (0 < size) fld.size = size;
        } else {
          fld = document.createElement('textarea');
          fld.rows = (1 >= this.options.rows ? this.options.autoRows : this.options.rows);
          fld.cols = this.options.cols || 40;
        }
        fld.name = this.options.paramName;
        fld.value = text; // No HTML breaks conversion anymore
        fld.className = 'editor_field';
        if (this.options.submitOnBlur)
          fld.onblur = this._boundSubmitHandler;
        this._controls.editor = fld;
        if (this.options.loadTextURL)
          this.loadExternalText();
        this._form.appendChild(this._controls.editor);
      },
      createForm: function () {
        var ipe = this;
        function addText(mode, condition) {
          var text = ipe.options['text' + mode + 'Controls'];
          if (!text || condition === false) return;
          ipe._form.appendChild(document.createTextNode(text));
        };
        this._form = $(document.createElement('form'));
        this._form.id = this.options.formId;
        this._form.addClassName(this.options.formClassName);
        this._form.onsubmit = this._boundSubmitHandler;
        this.createEditField();
        if ('textarea' == this._controls.editor.tagName.toLowerCase())
          this._form.appendChild(document.createElement('br'));
        if (this.options.onFormCustomization)
          this.options.onFormCustomization(this, this._form);
        addText('Before', this.options.okControl || this.options.cancelControl);
        this.createControl('ok', this._boundSubmitHandler);
        addText('Between', this.options.okControl && this.options.cancelControl);
        this.createControl('cancel', this._boundCancelHandler, 'editor_cancel');
        addText('After', this.options.okControl || this.options.cancelControl);
      },
      destroy: function () {
        if (this._oldInnerHTML)
          this.element.innerHTML = this._oldInnerHTML;
        this.leaveEditMode();
        this.unregisterListeners();
      },
      enterEditMode: function (e) {
        if (this._saving || this._editing) return;
        this._editing = true;
        this.triggerCallback('onEnterEditMode');
        if (this.options.externalControl)
          this.options.externalControl.hide();
        this.element.hide();
        this.createForm();
        this.element.parentNode.insertBefore(this._form, this.element);
        if (!this.options.loadTextURL)
          this.postProcessEditField();
        if (e) Event.stop(e);
      },
      enterHover: function (e) {
        if (this.options.hoverClassName)
          this.element.addClassName(this.options.hoverClassName);
        if (this._saving) return;
        this.triggerCallback('onEnterHover');
      },
      getText: function () {
        return this.element.innerHTML;
      },
      handleAJAXFailure: function (transport) {
        this.triggerCallback('onFailure', transport);
        if (this._oldInnerHTML) {
          this.element.innerHTML = this._oldInnerHTML;
          this._oldInnerHTML = null;
        }
      },
      handleFormCancellation: function (e) {
        this.wrapUp();
        if (e) Event.stop(e);
      },
      handleFormSubmission: function (e) {
        var form = this._form;
        var value = $F(this._controls.editor);
        this.prepareSubmission();
        var params = this.options.callback(form, value) || '';
        if (Object.isString(params))
          params = params.toQueryParams();
        params.editorId = this.element.id;
        if (this.options.htmlResponse) {
          var options = Object.extend({ evalScripts: true }, this.options.ajaxOptions);
          Object.extend(options, {
            parameters: params,
            onComplete: this._boundWrapperHandler,
            onFailure: this._boundFailureHandler
          });
          new Ajax.Updater({ success: this.element }, this.url, options);
        } else {
          var options = Object.extend({ method: 'get' }, this.options.ajaxOptions);
          Object.extend(options, {
            parameters: params,
            onComplete: this._boundWrapperHandler,
            onFailure: this._boundFailureHandler
          });
          new Ajax.Request(this.url, options);
        }
        if (e) Event.stop(e);
      },
      leaveEditMode: function () {
        this.element.removeClassName(this.options.savingClassName);
        this.removeForm();
        this.leaveHover();
        this.element.style.backgroundColor = this._originalBackground;
        this.element.show();
        if (this.options.externalControl)
          this.options.externalControl.show();
        this._saving = false;
        this._editing = false;
        this._oldInnerHTML = null;
        this.triggerCallback('onLeaveEditMode');
      },
      leaveHover: function (e) {
        if (this.options.hoverClassName)
          this.element.removeClassName(this.options.hoverClassName);
        if (this._saving) return;
        this.triggerCallback('onLeaveHover');
      },
      loadExternalText: function () {
        this._form.addClassName(this.options.loadingClassName);
        this._controls.editor.disabled = true;
        var options = Object.extend({ method: 'get' }, this.options.ajaxOptions);
        Object.extend(options, {
          parameters: 'editorId=' + encodeURIComponent(this.element.id),
          onComplete: Prototype.emptyFunction,
          onSuccess: function (transport) {
            this._form.removeClassName(this.options.loadingClassName);
            var text = transport.responseText;
            if (this.options.stripLoadedTextTags)
              text = text.stripTags();
            this._controls.editor.value = text;
            this._controls.editor.disabled = false;
            this.postProcessEditField();
          }.bind(this),
          onFailure: this._boundFailureHandler
        });
        new Ajax.Request(this.options.loadTextURL, options);
      },
      postProcessEditField: function () {
        var fpc = this.options.fieldPostCreation;
        if (fpc)
          $(this._controls.editor)['focus' == fpc ? 'focus' : 'activate']();
      },
      prepareOptions: function () {
        this.options = Object.clone(Ajax.InPlaceEditor.DefaultOptions);
        Object.extend(this.options, Ajax.InPlaceEditor.DefaultCallbacks);
        [this._extraDefaultOptions].flatten().compact().each(function (defs) {
          Object.extend(this.options, defs);
        }.bind(this));
      },
      prepareSubmission: function () {
        this._saving = true;
        this.removeForm();
        this.leaveHover();
        this.showSaving();
      },
      registerListeners: function () {
        this._listeners = {};
        var listener;
        $H(Ajax.InPlaceEditor.Listeners).each(function (pair) {
          listener = this[pair.value].bind(this);
          this._listeners[pair.key] = listener;
          if (!this.options.externalControlOnly)
            this.element.observe(pair.key, listener);
          if (this.options.externalControl)
            this.options.externalControl.observe(pair.key, listener);
        }.bind(this));
      },
      removeForm: function () {
        if (!this._form) return;
        this._form.remove();
        this._form = null;
        this._controls = {};
      },
      showSaving: function () {
        this._oldInnerHTML = this.element.innerHTML;
        this.element.innerHTML = this.options.savingText;
        this.element.addClassName(this.options.savingClassName);
        this.element.style.backgroundColor = this._originalBackground;
        this.element.show();
      },
      triggerCallback: function (cbName, arg) {
        if ('function' == typeof this.options[cbName]) {
          this.options[cbName](this, arg);
        }
      },
      unregisterListeners: function () {
        $H(this._listeners).each(function (pair) {
          if (!this.options.externalControlOnly)
            this.element.stopObserving(pair.key, pair.value);
          if (this.options.externalControl)
            this.options.externalControl.stopObserving(pair.key, pair.value);
        }.bind(this));
      },
      wrapUp: function (transport) {
        this.leaveEditMode();
        // Can't use triggerCallback due to backward compatibility: requires
        // binding + direct element
        this._boundComplete(transport, this.element);
      }
    });

    Object.extend(Ajax.InPlaceEditor.prototype, {
      dispose: Ajax.InPlaceEditor.prototype.destroy
    });

    Ajax.InPlaceCollectionEditor = Class.create(Ajax.InPlaceEditor, {
      initialize: function ($super, element, url, options) {
        this._extraDefaultOptions = Ajax.InPlaceCollectionEditor.DefaultOptions;
        $super(element, url, options);
      },

      createEditField: function () {
        var list = document.createElement('select');
        list.name = this.options.paramName;
        list.size = 1;
        this._controls.editor = list;
        this._collection = this.options.collection || [];
        if (this.options.loadCollectionURL)
          this.loadCollection();
        else
          this.checkForExternalText();
        this._form.appendChild(this._controls.editor);
      },

      loadCollection: function () {
        this._form.addClassName(this.options.loadingClassName);
        this.showLoadingText(this.options.loadingCollectionText);
        var options = Object.extend({ method: 'get' }, this.options.ajaxOptions);
        Object.extend(options, {
          parameters: 'editorId=' + encodeURIComponent(this.element.id),
          onComplete: Prototype.emptyFunction,
          onSuccess: function (transport) {
            var js = transport.responseText.strip();
            if (!/^\[.*\]$/.test(js)) // TODO: improve sanity check
              throw 'Server returned an invalid collection representation.';
            this._collection = eval(js);
            this.checkForExternalText();
          }.bind(this),
          onFailure: this.onFailure
        });
        new Ajax.Request(this.options.loadCollectionURL, options);
      },

      showLoadingText: function (text) {
        this._controls.editor.disabled = true;
        var tempOption = this._controls.editor.firstChild;
        if (!tempOption) {
          tempOption = document.createElement('option');
          tempOption.value = '';
          this._controls.editor.appendChild(tempOption);
          tempOption.selected = true;
        }
        tempOption.update((text || '').stripScripts().stripTags());
      },

      checkForExternalText: function () {
        this._text = this.getText();
        if (this.options.loadTextURL)
          this.loadExternalText();
        else
          this.buildOptionList();
      },

      loadExternalText: function () {
        this.showLoadingText(this.options.loadingText);
        var options = Object.extend({ method: 'get' }, this.options.ajaxOptions);
        Object.extend(options, {
          parameters: 'editorId=' + encodeURIComponent(this.element.id),
          onComplete: Prototype.emptyFunction,
          onSuccess: function (transport) {
            this._text = transport.responseText.strip();
            this.buildOptionList();
          }.bind(this),
          onFailure: this.onFailure
        });
        new Ajax.Request(this.options.loadTextURL, options);
      },

      buildOptionList: function () {
        this._form.removeClassName(this.options.loadingClassName);
        this._collection = this._collection.map(function (entry) {
          return 2 === entry.length ? entry : [entry, entry].flatten();
        });
        var marker = ('value' in this.options) ? this.options.value : this._text;
        var textFound = this._collection.any(function (entry) {
          return entry[0] == marker;
        }.bind(this));
        this._controls.editor.update('');
        var option;
        this._collection.each(function (entry, index) {
          option = document.createElement('option');
          option.value = entry[0];
          option.selected = textFound ? entry[0] == marker : 0 == index;
          option.appendChild(document.createTextNode(entry[1]));
          this._controls.editor.appendChild(option);
        }.bind(this));
        this._controls.editor.disabled = false;
        Field.scrollFreeActivate(this._controls.editor);
      }
    });

    //**** DEPRECATION LAYER FOR InPlace[Collection]Editor! ****
    //**** This only  exists for a while,  in order to  let ****
    //**** users adapt to  the new API.  Read up on the new ****
    //**** API and convert your code to it ASAP!            ****

    Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions = function (options) {
      if (!options) return;
      function fallback(name, expr) {
        if (name in options || expr === undefined) return;
        options[name] = expr;
      };
      fallback('cancelControl', (options.cancelLink ? 'link' : (options.cancelButton ? 'button' :
        options.cancelLink == options.cancelButton == false ? false : undefined)));
      fallback('okControl', (options.okLink ? 'link' : (options.okButton ? 'button' :
        options.okLink == options.okButton == false ? false : undefined)));
      fallback('highlightColor', options.highlightcolor);
      fallback('highlightEndColor', options.highlightendcolor);
    };

    Object.extend(Ajax.InPlaceEditor, {
      DefaultOptions: {
        ajaxOptions: {},
        autoRows: 3,                                // Use when multi-line w/ rows == 1
        cancelControl: 'link',                      // 'link'|'button'|false
        cancelText: 'cancel',
        clickToEditText: 'Click to edit',
        externalControl: null,                      // id|elt
        externalControlOnly: false,
        fieldPostCreation: 'activate',              // 'activate'|'focus'|false
        formClassName: 'inplaceeditor-form',
        formId: null,                               // id|elt
        highlightColor: '#ffff99',
        highlightEndColor: '#ffffff',
        hoverClassName: '',
        htmlResponse: true,
        loadingClassName: 'inplaceeditor-loading',
        loadingText: 'Loading...',
        okControl: 'button',                        // 'link'|'button'|false
        okText: 'ok',
        paramName: 'value',
        rows: 1,                                    // If 1 and multi-line, uses autoRows
        savingClassName: 'inplaceeditor-saving',
        savingText: 'Saving...',
        size: 0,
        stripLoadedTextTags: false,
        submitOnBlur: false,
        textAfterControls: '',
        textBeforeControls: '',
        textBetweenControls: ''
      },
      DefaultCallbacks: {
        callback: function (form) {
          return Form.serialize(form);
        },
        onComplete: function (transport, element) {
          // For backward compatibility, this one is bound to the IPE, and passes
          // the element directly.  It was too often customized, so we don't break it.
          new Effect.Highlight(element, {
            startcolor: this.options.highlightColor, keepBackgroundImage: true
          });
        },
        onEnterEditMode: null,
        onEnterHover: function (ipe) {
          ipe.element.style.backgroundColor = ipe.options.highlightColor;
          if (ipe._effect)
            ipe._effect.cancel();
        },
        onFailure: function (transport, ipe) {
          alert('Error communication with the server: ' + transport.responseText.stripTags());
        },
        onFormCustomization: null, // Takes the IPE and its generated form, after editor, before controls.
        onLeaveEditMode: null,
        onLeaveHover: function (ipe) {
          ipe._effect = new Effect.Highlight(ipe.element, {
            startcolor: ipe.options.highlightColor, endcolor: ipe.options.highlightEndColor,
            restorecolor: ipe._originalBackground, keepBackgroundImage: true
          });
        }
      },
      Listeners: {
        click: 'enterEditMode',
        keydown: 'checkForEscapeOrReturn',
        mouseover: 'enterHover',
        mouseout: 'leaveHover'
      }
    });

    Ajax.InPlaceCollectionEditor.DefaultOptions = {
      loadingCollectionText: 'Loading options...'
    };

    // Delayed observer, like Form.Element.Observer, 
    // but waits for delay after last key input
    // Ideal for live-search fields

    Form.Element.DelayedObserver = Class.create({
      initialize: function (element, delay, callback) {
        this.delay = delay || 0.5;
        this.element = $(element);
        this.callback = callback;
        this.timer = null;
        this.lastValue = $F(this.element);
        Event.observe(this.element, 'keyup', this.delayedListener.bindAsEventListener(this));
      },
      delayedListener: function (event) {
        if (this.lastValue == $F(this.element)) return;
        if (this.timer) clearTimeout(this.timer);
        this.timer = setTimeout(this.onTimerEvent.bind(this), this.delay * 1000);
        this.lastValue = $F(this.element);
      },
      onTimerEvent: function () {
        this.timer = null;
        this.callback(this.element, $F(this.element));
      }
    });
    // script.aculo.us slider.js v1.8.1, Thu Jan 03 22:07:12 -0500 2008

    // Copyright (c) 2005-2007 Marty Haught, Thomas Fuchs 
    //
    // script.aculo.us is freely distributable under the terms of an MIT-style license.
    // For details, see the script.aculo.us web site: http://script.aculo.us/

    if (!Control) var Control = {};

    // options:
    //  axis: 'vertical', or 'horizontal' (default)
    //
    // callbacks:
    //  onChange(value)
    //  onSlide(value)
    Control.Slider = Class.create({
      initialize: function (handle, track, options) {
        var slider = this;

        if (Object.isArray(handle)) {
          this.handles = handle.collect(function (e) { return $(e) });
        } else {
          this.handles = [$(handle)];
        }

        this.track = $(track);
        this.options = options || {};

        this.axis = this.options.axis || 'horizontal';
        this.increment = this.options.increment || 1;
        this.step = parseInt(this.options.step || '1');
        this.range = this.options.range || $R(0, 1);

        this.value = 0; // assure backwards compat
        this.values = this.handles.map(function () { return 0 });
        this.spans = this.options.spans ? this.options.spans.map(function (s) { return $(s) }) : false;
        this.options.startSpan = $(this.options.startSpan || null);
        this.options.endSpan = $(this.options.endSpan || null);

        this.restricted = this.options.restricted || false;

        this.maximum = this.options.maximum || this.range.end;
        this.minimum = this.options.minimum || this.range.start;

        // Will be used to align the handle onto the track, if necessary
        this.alignX = parseInt(this.options.alignX || '0');
        this.alignY = parseInt(this.options.alignY || '0');

        this.trackLength = this.maximumOffset() - this.minimumOffset();

        this.handleLength = this.isVertical() ?
          (this.handles[0].offsetHeight != 0 ?
            this.handles[0].offsetHeight : this.handles[0].style.height.replace(/px$/, "")) :
          (this.handles[0].offsetWidth != 0 ? this.handles[0].offsetWidth :
            this.handles[0].style.width.replace(/px$/, ""));

        this.active = false;
        this.dragging = false;
        this.disabled = false;

        if (this.options.disabled) this.setDisabled();

        // Allowed values array
        this.allowedValues = this.options.values ? this.options.values.sortBy(Prototype.K) : false;
        if (this.allowedValues) {
          this.minimum = this.allowedValues.min();
          this.maximum = this.allowedValues.max();
        }

        this.eventMouseDown = this.startDrag.bindAsEventListener(this);
        this.eventMouseUp = this.endDrag.bindAsEventListener(this);
        this.eventMouseMove = this.update.bindAsEventListener(this);

        // Initialize handles in reverse (make sure first handle is active)
        this.handles.each(function (h, i) {
          i = slider.handles.length - 1 - i;
          slider.setValue(parseFloat(
            (Object.isArray(slider.options.sliderValue) ?
              slider.options.sliderValue[i] : slider.options.sliderValue) ||
            slider.range.start), i);
          h.makePositioned().observe("mousedown", slider.eventMouseDown);
        });

        this.track.observe("mousedown", this.eventMouseDown);
        document.observe("mouseup", this.eventMouseUp);
        document.observe("mousemove", this.eventMouseMove);

        this.initialized = true;
      },
      dispose: function () {
        var slider = this;
        Event.stopObserving(this.track, "mousedown", this.eventMouseDown);
        Event.stopObserving(document, "mouseup", this.eventMouseUp);
        Event.stopObserving(document, "mousemove", this.eventMouseMove);
        this.handles.each(function (h) {
          Event.stopObserving(h, "mousedown", slider.eventMouseDown);
        });
      },
      setDisabled: function () {
        this.disabled = true;
      },
      setEnabled: function () {
        this.disabled = false;
      },
      getNearestValue: function (value) {
        if (this.allowedValues) {
          if (value >= this.allowedValues.max()) return (this.allowedValues.max());
          if (value <= this.allowedValues.min()) return (this.allowedValues.min());

          var offset = Math.abs(this.allowedValues[0] - value);
          var newValue = this.allowedValues[0];
          this.allowedValues.each(function (v) {
            var currentOffset = Math.abs(v - value);
            if (currentOffset <= offset) {
              newValue = v;
              offset = currentOffset;
            }
          });
          return newValue;
        }
        if (value > this.range.end) return this.range.end;
        if (value < this.range.start) return this.range.start;
        return value;
      },
      setValue: function (sliderValue, handleIdx) {
        if (!this.active) {
          this.activeHandleIdx = handleIdx || 0;
          this.activeHandle = this.handles[this.activeHandleIdx];
          this.updateStyles();
        }
        handleIdx = handleIdx || this.activeHandleIdx || 0;
        if (this.initialized && this.restricted) {
          if ((handleIdx > 0) && (sliderValue < this.values[handleIdx - 1]))
            sliderValue = this.values[handleIdx - 1];
          if ((handleIdx < (this.handles.length - 1)) && (sliderValue > this.values[handleIdx + 1]))
            sliderValue = this.values[handleIdx + 1];
        }
        sliderValue = this.getNearestValue(sliderValue);
        this.values[handleIdx] = sliderValue;
        this.value = this.values[0]; // assure backwards compat

        this.handles[handleIdx].style[this.isVertical() ? 'top' : 'left'] =
          this.translateToPx(sliderValue);

        this.drawSpans();
        if (!this.dragging || !this.event) this.updateFinished();
      },
      setValueBy: function (delta, handleIdx) {
        this.setValue(this.values[handleIdx || this.activeHandleIdx || 0] + delta,
          handleIdx || this.activeHandleIdx || 0);
      },
      translateToPx: function (value) {
        return Math.round(
          ((this.trackLength - this.handleLength) / (this.range.end - this.range.start)) *
          (value - this.range.start)) + "px";
      },
      translateToValue: function (offset) {
        return ((offset / (this.trackLength - this.handleLength) *
          (this.range.end - this.range.start)) + this.range.start);
      },
      getRange: function (range) {
        var v = this.values.sortBy(Prototype.K);
        range = range || 0;
        return $R(v[range], v[range + 1]);
      },
      minimumOffset: function () {
        return (this.isVertical() ? this.alignY : this.alignX);
      },
      maximumOffset: function () {
        return (this.isVertical() ?
          (this.track.offsetHeight != 0 ? this.track.offsetHeight :
            this.track.style.height.replace(/px$/, "")) - this.alignY :
          (this.track.offsetWidth != 0 ? this.track.offsetWidth :
            this.track.style.width.replace(/px$/, "")) - this.alignX);
      },
      isVertical: function () {
        return (this.axis == 'vertical');
      },
      drawSpans: function () {
        var slider = this;
        if (this.spans)
          $R(0, this.spans.length - 1).each(function (r) { slider.setSpan(slider.spans[r], slider.getRange(r)) });
        if (this.options.startSpan)
          this.setSpan(this.options.startSpan,
            $R(0, this.values.length > 1 ? this.getRange(0).min() : this.value));
        if (this.options.endSpan)
          this.setSpan(this.options.endSpan,
            $R(this.values.length > 1 ? this.getRange(this.spans.length - 1).max() : this.value, this.maximum));
      },
      setSpan: function (span, range) {
        if (this.isVertical()) {
          span.style.top = this.translateToPx(range.start);
          span.style.height = this.translateToPx(range.end - range.start + this.range.start);
        } else {
          span.style.left = this.translateToPx(range.start);
          span.style.width = this.translateToPx(range.end - range.start + this.range.start);
        }
      },
      updateStyles: function () {
        this.handles.each(function (h) { Element.removeClassName(h, 'selected') });
        Element.addClassName(this.activeHandle, 'selected');
      },
      startDrag: function (event) {
        if (Event.isLeftClick(event)) {
          if (!this.disabled) {
            this.active = true;

            var handle = Event.element(event);
            var flInverseZoom = 1 / (document.body.style.zoom || 1);
            var pointer = [Event.pointerX(event) * flInverseZoom, Event.pointerY(event) * flInverseZoom];
            var track = handle;
            if (track == this.track) {
              var offsets = Position.cumulativeOffset(this.track);
              this.event = event;
              this.setValue(this.translateToValue(
                (this.isVertical() ? pointer[1] - offsets[1] : pointer[0] - offsets[0]) - (this.handleLength / 2)
              ));
              var offsets = Position.cumulativeOffset(this.activeHandle);
              this.offsetX = (pointer[0] - offsets[0]);
              this.offsetY = (pointer[1] - offsets[1]);
            } else {
              // find the handle (prevents issues with Safari)
              while ((this.handles.indexOf(handle) == -1) && handle.parentNode)
                handle = handle.parentNode;

              if (this.handles.indexOf(handle) != -1) {
                this.activeHandle = handle;
                this.activeHandleIdx = this.handles.indexOf(this.activeHandle);
                this.updateStyles();

                var offsets = Position.cumulativeOffset(this.activeHandle);
                this.offsetX = (pointer[0] - offsets[0]);
                this.offsetY = (pointer[1] - offsets[1]);
              }
            }
          }
          Event.stop(event);
        }
      },
      update: function (event) {
        if (this.active) {
          if (!this.dragging) this.dragging = true;
          this.draw(event);
          if (Prototype.Browser.WebKit) window.scrollBy(0, 0);
          Event.stop(event);
        }
      },
      draw: function (event) {
        var flInverseZoom = 1 / (document.body.style.zoom || 1);
        var pointer = [Event.pointerX(event) * flInverseZoom, Event.pointerY(event) * flInverseZoom];
        var offsets = Position.cumulativeOffset(this.track);
        pointer[0] -= this.offsetX + offsets[0];
        pointer[1] -= this.offsetY + offsets[1];
        this.event = event;
        this.setValue(this.translateToValue(this.isVertical() ? pointer[1] : pointer[0]));
        if (this.initialized && this.options.onSlide)
          this.options.onSlide(this.values.length > 1 ? this.values : this.value, this);
      },
      endDrag: function (event) {
        if (this.active && this.dragging) {
          this.finishDrag(event, true);
          Event.stop(event);
        }
        this.active = false;
        this.dragging = false;
      },
      finishDrag: function (event, success) {
        this.active = false;
        this.dragging = false;
        this.updateFinished();
      },
      updateFinished: function () {
        if (this.initialized && this.options.onChange)
          this.options.onChange(this.values.length > 1 ? this.values : this.value, this);
        this.event = null;
      }
    });
    // script.aculo.us dragdrop.js v1.8.1, Thu Jan 03 22:07:12 -0500 2008

    // Copyright (c) 2005-2007 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)
    //           (c) 2005-2007 Sammi Williams (http://www.oriontransfer.co.nz, sammi@oriontransfer.co.nz)
    //
    // script.aculo.us is freely distributable under the terms of an MIT-style license.
    // For details, see the script.aculo.us web site: http://script.aculo.us/

    if (Object.isUndefined(Effect))
      throw ("dragdrop.js requires including script.aculo.us' effects.js library");

    var Droppables = {
      drops: [],

      remove: function (element) {
        this.drops = this.drops.reject(function (d) { return d.element == $(element) });
      },

      add: function (element) {
        element = $(element);
        var options = Object.extend({
          greedy: true,
          hoverclass: null,
          tree: false
        }, arguments[1] || {});

        // cache containers
        if (options.containment) {
          options._containers = [];
          var containment = options.containment;
          if (Object.isArray(containment)) {
            containment.each(function (c) { options._containers.push($(c)) });
          } else {
            options._containers.push($(containment));
          }
        }

        if (options.accept) options.accept = [options.accept].flatten();

        Element.makePositioned(element); // fix IE
        options.element = element;

        this.drops.push(options);
      },

      findDeepestChild: function (drops) {
        deepest = drops[0];

        for (i = 1; i < drops.length; ++i)
          if (Element.isParent(drops[i].element, deepest.element))
            deepest = drops[i];

        return deepest;
      },

      isContained: function (element, drop) {
        var containmentNode;
        if (drop.tree) {
          containmentNode = element.treeNode;
        } else {
          containmentNode = element.parentNode;
        }
        return drop._containers.detect(function (c) { return containmentNode == c });
      },

      isAffected: function (point, element, drop) {
        return (
          (drop.element != element) &&
          ((!drop._containers) ||
            this.isContained(element, drop)) &&
          ((!drop.accept) ||
            (Element.classNames(element).detect(
              function (v) { return drop.accept.include(v) }))) &&
          Position.within(drop.element, point[0], point[1]));
      },

      deactivate: function (drop) {
        if (drop.hoverclass)
          Element.removeClassName(drop.element, drop.hoverclass);
        this.last_active = null;
      },

      activate: function (drop) {
        if (drop.hoverclass)
          Element.addClassName(drop.element, drop.hoverclass);
        this.last_active = drop;
      },

      show: function (point, element) {
        if (!this.drops.length) return;
        var drop, affected = [];

        this.drops.each(function (drop) {
          if (Droppables.isAffected(point, element, drop))
            affected.push(drop);
        });

        if (affected.length > 0)
          drop = Droppables.findDeepestChild(affected);

        if (this.last_active && this.last_active != drop) this.deactivate(this.last_active);
        if (drop) {
          Position.within(drop.element, point[0], point[1]);
          if (drop.onHover)
            drop.onHover(element, drop.element, Position.overlap(drop.overlap, drop.element));

          if (drop != this.last_active) Droppables.activate(drop);
        }
      },

      fire: function (event, element) {
        if (!this.last_active) return;
        Position.prepare();

        var flInverseZoom = 1 / (document.body.style.zoom || 1);
        if (this.isAffected([Event.pointerX(event) * flInverseZoom, Event.pointerY(event) * flInverseZoom], element, this.last_active))
          if (this.last_active.onDrop) {
            this.last_active.onDrop(element, this.last_active.element, event);
            return true;
          }
      },

      reset: function () {
        if (this.last_active)
          this.deactivate(this.last_active);
      }
    }

    var Draggables = {
      drags: [],
      observers: [],

      register: function (draggable) {
        if (this.drags.length == 0) {
          this.eventMouseUp = this.endDrag.bindAsEventListener(this);
          this.eventMouseMove = this.updateDrag.bindAsEventListener(this);
          this.eventKeypress = this.keyPress.bindAsEventListener(this);

          Event.observe(document, "mouseup", this.eventMouseUp);
          Event.observe(document, "mousemove", this.eventMouseMove);
          Event.observe(document, "keypress", this.eventKeypress);
        }
        this.drags.push(draggable);
      },

      unregister: function (draggable) {
        this.drags = this.drags.reject(function (d) { return d == draggable });
        if (this.drags.length == 0) {
          Event.stopObserving(document, "mouseup", this.eventMouseUp);
          Event.stopObserving(document, "mousemove", this.eventMouseMove);
          Event.stopObserving(document, "keypress", this.eventKeypress);
        }
      },

      activate: function (draggable) {
        if (draggable.options.delay) {
          this._timeout = setTimeout(function () {
            Draggables._timeout = null;
            window.focus();
            Draggables.activeDraggable = draggable;
          }.bind(this), draggable.options.delay);
        } else {
          window.focus(); // allows keypress events if window isn't currently focused, fails for Safari
          this.activeDraggable = draggable;
        }
      },

      deactivate: function () {
        this.activeDraggable = null;
      },

      updateDrag: function (event) {
        if (!this.activeDraggable) return;
        var flInverseZoom = 1 / (document.body.style.zoom || 1);
        var pointer = [Event.pointerX(event) * flInverseZoom, Event.pointerY(event) * flInverseZoom];
        // Mozilla-based browsers fire successive mousemove events with
        // the same coordinates, prevent needless redrawing (moz bug?)
        if (this._lastPointer && (this._lastPointer.inspect() == pointer.inspect())) return;
        this._lastPointer = pointer;

        this.activeDraggable.updateDrag(event, pointer);
      },

      endDrag: function (event) {
        if (this._timeout) {
          clearTimeout(this._timeout);
          this._timeout = null;
        }
        if (!this.activeDraggable) return;
        this._lastPointer = null;
        this.activeDraggable.endDrag(event);
        this.activeDraggable = null;
      },

      keyPress: function (event) {
        if (this.activeDraggable)
          this.activeDraggable.keyPress(event);
      },

      addObserver: function (observer) {
        this.observers.push(observer);
        this._cacheObserverCallbacks();
      },

      removeObserver: function (element) {  // element instead of observer fixes mem leaks
        this.observers = this.observers.reject(function (o) { return o.element == element });
        this._cacheObserverCallbacks();
      },

      notify: function (eventName, draggable, event) {  // 'onStart', 'onEnd', 'onDrag'
        if (this[eventName + 'Count'] > 0)
          this.observers.each(function (o) {
            if (o[eventName]) o[eventName](eventName, draggable, event);
          });
        if (draggable.options[eventName]) draggable.options[eventName](draggable, event);
      },

      _cacheObserverCallbacks: function () {
        ['onStart', 'onEnd', 'onDrag'].each(function (eventName) {
          Draggables[eventName + 'Count'] = Draggables.observers.select(
            function (o) { return o[eventName]; }
          ).length;
        });
      }
    }

    /*--------------------------------------------------------------------------*/

    var Draggable = Class.create({
      initialize: function (element) {
        var defaults = {
          handle: false,
          reverteffect: function (element, top_offset, left_offset) {
            var dur = Math.sqrt(Math.abs(top_offset ^ 2) + Math.abs(left_offset ^ 2)) * 0.02;
            new Effect.Move(element, {
              x: -left_offset, y: -top_offset, duration: dur,
              queue: { scope: '_draggable', position: 'end' }
            });
          },
          endeffect: function (element) {
            var toOpacity = Object.isNumber(element._opacity) ? element._opacity : 1.0;
            new Effect.Opacity(element, {
              duration: 0.2, from: 0.7, to: toOpacity,
              queue: { scope: '_draggable', position: 'end' },
              afterFinish: function () {
                Draggable._dragging[element] = false
              }
            });
          },
          zindex: 1000,
          revert: false,
          quiet: false,
          scroll: false,
          scrollSensitivity: 20,
          scrollSpeed: 15,
          snap: false,  // false, or xy or [x,y] or function(x,y){ return [x,y] }
          delay: 0
        };

        if (!arguments[1] || Object.isUndefined(arguments[1].endeffect))
          Object.extend(defaults, {
            starteffect: function (element) {
              element._opacity = Element.getOpacity(element);
              Draggable._dragging[element] = true;
              new Effect.Opacity(element, { duration: 0.2, from: element._opacity, to: 0.7 });
            }
          });

        var options = Object.extend(defaults, arguments[1] || {});

        this.element = $(element);

        if (options.handle && Object.isString(options.handle))
          this.handle = this.element.down('.' + options.handle, 0);

        if (!this.handle) this.handle = $(options.handle);
        if (!this.handle) this.handle = this.element;

        if (options.scroll && !options.scroll.scrollTo && !options.scroll.outerHTML) {
          options.scroll = $(options.scroll);
          this._isScrollChild = Element.childOf(this.element, options.scroll);
        }

        Element.makePositioned(this.element); // fix IE

        this.options = options;
        this.dragging = false;

        this.eventMouseDown = this.initDrag.bindAsEventListener(this);
        Event.observe(this.handle, "mousedown", this.eventMouseDown);

        Draggables.register(this);
      },

      destroy: function () {
        Event.stopObserving(this.handle, "mousedown", this.eventMouseDown);
        Draggables.unregister(this);
      },

      currentDelta: function () {
        return ([
          parseInt(Element.getStyle(this.element, 'left') || '0'),
          parseInt(Element.getStyle(this.element, 'top') || '0')]);
      },

      initDrag: function (event) {
        if (!Object.isUndefined(Draggable._dragging[this.element]) &&
          Draggable._dragging[this.element]) return;
        if (Event.isLeftClick(event)) {
          // abort on form elements, fixes a Firefox issue
          var src = Event.element(event);
          if ((tag_name = src.tagName.toUpperCase()) && (
            tag_name == 'INPUT' ||
            tag_name == 'SELECT' ||
            tag_name == 'OPTION' ||
            tag_name == 'BUTTON' ||
            tag_name == 'TEXTAREA')) return;

          var flInverseZoom = 1 / (document.body.style.zoom || 1);
          var pointer = [Event.pointerX(event) * flInverseZoom, Event.pointerY(event) * flInverseZoom];
          var pos = Position.cumulativeOffset(this.element);
          this.offset = [0, 1].map(function (i) { return (pointer[i] - pos[i]) });

          Draggables.activate(this);
          Event.stop(event);
        }
      },

      startDrag: function (event) {
        this.dragging = true;
        if (!this.delta)
          this.delta = this.currentDelta();

        if (this.options.zindex) {
          this.originalZ = parseInt(Element.getStyle(this.element, 'z-index') || '');
          this.element.style.zIndex = this.options.zindex;
        }

        if (this.options.ghosting) {
          this._clone = this.element.cloneNode(true);
          this.element._originallyAbsolute = (this.element.getStyle('position') == 'absolute');
          if (!this.element._originallyAbsolute)
            Position.absolutize(this.element);
          this.element.parentNode.insertBefore(this._clone, this.element);
        }

        if (this.options.scroll) {
          if (this.options.scroll == window) {
            var where = this._getWindowScroll(this.options.scroll);
            this.originalScrollLeft = where.left;
            this.originalScrollTop = where.top;
          } else {
            this.originalScrollLeft = this.options.scroll.scrollLeft;
            this.originalScrollTop = this.options.scroll.scrollTop;
          }
        }

        Draggables.notify('onStart', this, event);

        if (this.options.starteffect) this.options.starteffect(this.element);
      },

      updateDrag: function (event, pointer) {
        if (!this.dragging) this.startDrag(event);

        if (!this.options.quiet) {
          Position.prepare();
          Droppables.show(pointer, this.element);
        }

        Draggables.notify('onDrag', this, event);

        this.draw(pointer);
        if (this.options.change) this.options.change(this);

        if (this.options.scroll) {
          this.stopScrolling();

          var p;
          if (this.options.scroll == window) {
            with (this._getWindowScroll(this.options.scroll)) { p = [left, top, left + width, top + height]; }
          } else {
            p = Position.page(this.options.scroll);
            p[0] += this.options.scroll.scrollLeft + Position.deltaX;
            p[1] += this.options.scroll.scrollTop + Position.deltaY;
            p.push(p[0] + this.options.scroll.offsetWidth);
            p.push(p[1] + this.options.scroll.offsetHeight);
          }
          var speed = [0, 0];
          if (pointer[0] < (p[0] + this.options.scrollSensitivity)) speed[0] = pointer[0] - (p[0] + this.options.scrollSensitivity);
          if (pointer[1] < (p[1] + this.options.scrollSensitivity)) speed[1] = pointer[1] - (p[1] + this.options.scrollSensitivity);
          if (pointer[0] > (p[2] - this.options.scrollSensitivity)) speed[0] = pointer[0] - (p[2] - this.options.scrollSensitivity);
          if (pointer[1] > (p[3] - this.options.scrollSensitivity)) speed[1] = pointer[1] - (p[3] - this.options.scrollSensitivity);
          this.startScrolling(speed);
        }

        // fix AppleWebKit rendering
        if (Prototype.Browser.WebKit) window.scrollBy(0, 0);

        Event.stop(event);
      },

      finishDrag: function (event, success) {
        this.dragging = false;

        if (this.options.quiet) {
          Position.prepare();
          var flInverseZoom = 1 / (document.body.style.zoom || 1);
          var pointer = [Event.pointerX(event) * flInverseZoom, Event.pointerY(event) * flInverseZoom];
          Droppables.show(pointer, this.element);
        }

        if (this.options.ghosting) {
          if (!this.element._originallyAbsolute)
            Position.relativize(this.element);
          delete this.element._originallyAbsolute;
          Element.remove(this._clone);
          this._clone = null;
        }

        var dropped = false;
        if (success) {
          dropped = Droppables.fire(event, this.element);
          if (!dropped) dropped = false;
        }
        if (dropped && this.options.onDropped) this.options.onDropped(this.element);
        Draggables.notify('onEnd', this, event);

        var revert = this.options.revert;
        if (revert && Object.isFunction(revert)) revert = revert(this.element);

        var d = this.currentDelta();
        if (revert && this.options.reverteffect) {
          if (dropped == 0 || revert != 'failure')
            this.options.reverteffect(this.element,
              d[1] - this.delta[1], d[0] - this.delta[0]);
        } else {
          this.delta = d;
        }

        if (this.options.zindex)
          this.element.style.zIndex = this.originalZ;

        if (this.options.endeffect)
          this.options.endeffect(this.element);

        Draggables.deactivate(this);
        Droppables.reset();
      },

      keyPress: function (event) {
        if (event.keyCode != Event.KEY_ESC) return;
        this.finishDrag(event, false);
        Event.stop(event);
      },

      endDrag: function (event) {
        if (!this.dragging) return;
        this.stopScrolling();
        this.finishDrag(event, true);
        Event.stop(event);
      },

      draw: function (point) {
        var pos = Position.cumulativeOffset(this.element);
        if (this.options.ghosting) {
          var r = Position.realOffset(this.element);
          pos[0] += r[0] - Position.deltaX;
          pos[1] += r[1] - Position.deltaY;
        }

        var d = this.currentDelta();

        pos[0] -= d[0];
        pos[1] -= d[1];

        if (this.options.scroll && (this.options.scroll != window && this._isScrollChild)) {
          pos[0] -= this.options.scroll.scrollLeft - this.originalScrollLeft;
          pos[1] -= this.options.scroll.scrollTop - this.originalScrollTop;
        }

        var p = [0, 1].map(function (i) {
          return (point[i] - pos[i] - this.offset[i])
        }.bind(this));

        if (this.options.snap) {
          if (Object.isFunction(this.options.snap)) {
            p = this.options.snap(p[0], p[1], this);
          } else {
            if (Object.isArray(this.options.snap)) {
              p = p.map(function (v, i) {
                return (v / this.options.snap[i]).round() * this.options.snap[i]
              }.bind(this))
            } else {
              p = p.map(function (v) {
                return (v / this.options.snap).round() * this.options.snap
              }.bind(this))
            }
          }
        }

        var style = this.element.style;
        if ((!this.options.constraint) || (this.options.constraint == 'horizontal'))
          style.left = p[0] + "px";
        if ((!this.options.constraint) || (this.options.constraint == 'vertical'))
          style.top = p[1] + "px";

        if (style.visibility == "hidden") style.visibility = ""; // fix gecko rendering
      },

      stopScrolling: function () {
        if (this.scrollInterval) {
          clearInterval(this.scrollInterval);
          this.scrollInterval = null;
          Draggables._lastScrollPointer = null;
        }
      },

      startScrolling: function (speed) {
        if (!(speed[0] || speed[1])) return;
        this.scrollSpeed = [speed[0] * this.options.scrollSpeed, speed[1] * this.options.scrollSpeed];
        this.lastScrolled = new Date();
        this.scrollInterval = setInterval(this.scroll.bind(this), 10);
      },

      scroll: function () {
        var current = new Date();
        var delta = current - this.lastScrolled;
        this.lastScrolled = current;
        if (this.options.scroll == window) {
          with (this._getWindowScroll(this.options.scroll)) {
            if (this.scrollSpeed[0] || this.scrollSpeed[1]) {
              var d = delta / 1000;
              this.options.scroll.scrollTo(left + d * this.scrollSpeed[0], top + d * this.scrollSpeed[1]);
            }
          }
        } else {
          this.options.scroll.scrollLeft += this.scrollSpeed[0] * delta / 1000;
          this.options.scroll.scrollTop += this.scrollSpeed[1] * delta / 1000;
        }

        Position.prepare();
        Droppables.show(Draggables._lastPointer, this.element);
        Draggables.notify('onDrag', this);
        if (this._isScrollChild) {
          Draggables._lastScrollPointer = Draggables._lastScrollPointer || $A(Draggables._lastPointer);
          Draggables._lastScrollPointer[0] += this.scrollSpeed[0] * delta / 1000;
          Draggables._lastScrollPointer[1] += this.scrollSpeed[1] * delta / 1000;
          if (Draggables._lastScrollPointer[0] < 0)
            Draggables._lastScrollPointer[0] = 0;
          if (Draggables._lastScrollPointer[1] < 0)
            Draggables._lastScrollPointer[1] = 0;
          this.draw(Draggables._lastScrollPointer);
        }

        if (this.options.change) this.options.change(this);
      },

      _getWindowScroll: function (w) {
        var T, L, W, H;
        with (w.document) {
          if (w.document.documentElement && documentElement.scrollTop) {
            T = documentElement.scrollTop;
            L = documentElement.scrollLeft;
          } else if (w.document.body) {
            T = body.scrollTop;
            L = body.scrollLeft;
          }
          if (w.innerWidth) {
            W = w.innerWidth;
            H = w.innerHeight;
          } else if (w.document.documentElement && documentElement.clientWidth) {
            W = documentElement.clientWidth;
            H = documentElement.clientHeight;
          } else {
            W = body.offsetWidth;
            H = body.offsetHeight
          }
        }
        return { top: T, left: L, width: W, height: H };
      }
    });

    Draggable._dragging = {};

    /*--------------------------------------------------------------------------*/

    var SortableObserver = Class.create({
      initialize: function (element, observer) {
        this.element = $(element);
        this.observer = observer;
        this.lastValue = Sortable.serialize(this.element);
      },

      onStart: function () {
        this.lastValue = Sortable.serialize(this.element);
      },

      onEnd: function () {
        Sortable.unmark();
        if (this.lastValue != Sortable.serialize(this.element))
          this.observer(this.element)
      }
    });

    var Sortable = {
      SERIALIZE_RULE: /^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,

      sortables: {},

      _findRootElement: function (element) {
        while (element.tagName.toUpperCase() != "BODY") {
          if (element.id && Sortable.sortables[element.id]) return element;
          element = element.parentNode;
        }
      },

      options: function (element) {
        element = Sortable._findRootElement($(element));
        if (!element) return;
        return Sortable.sortables[element.id];
      },

      destroy: function (element) {
        var s = Sortable.options(element);

        if (s) {
          Draggables.removeObserver(s.element);
          s.droppables.each(function (d) { Droppables.remove(d) });
          s.draggables.invoke('destroy');

          delete Sortable.sortables[s.element.id];
        }
      },

      create: function (element) {
        element = $(element);
        var options = Object.extend({
          element: element,
          tag: 'li',       // assumes li children, override with tag: 'tagname'
          dropOnEmpty: false,
          tree: false,
          treeTag: 'ul',
          overlap: 'vertical', // one of 'vertical', 'horizontal'
          constraint: 'vertical', // one of 'vertical', 'horizontal', false
          containment: element,    // also takes array of elements (or id's); or false
          handle: false,      // or a CSS class
          only: false,
          delay: 0,
          hoverclass: null,
          ghosting: false,
          quiet: false,
          scroll: false,
          scrollSensitivity: 20,
          scrollSpeed: 15,
          format: this.SERIALIZE_RULE,

          // these take arrays of elements or ids and can be
          // used for better initialization performance
          elements: false,
          handles: false,

          onChange: Prototype.emptyFunction,
          onUpdate: Prototype.emptyFunction
        }, arguments[1] || {});

        // clear any old sortable with same element
        this.destroy(element);

        // build options for the draggables
        var options_for_draggable = {
          revert: true,
          quiet: options.quiet,
          scroll: options.scroll,
          scrollSpeed: options.scrollSpeed,
          scrollSensitivity: options.scrollSensitivity,
          delay: options.delay,
          ghosting: options.ghosting,
          constraint: options.constraint,
          handle: options.handle
        };

        if (options.starteffect)
          options_for_draggable.starteffect = options.starteffect;

        if (options.reverteffect)
          options_for_draggable.reverteffect = options.reverteffect;
        else
          if (options.ghosting) options_for_draggable.reverteffect = function (element) {
            element.style.top = 0;
            element.style.left = 0;
          };

        if (options.endeffect)
          options_for_draggable.endeffect = options.endeffect;

        if (options.zindex)
          options_for_draggable.zindex = options.zindex;

        // build options for the droppables
        var options_for_droppable = {
          overlap: options.overlap,
          containment: options.containment,
          tree: options.tree,
          hoverclass: options.hoverclass,
          onHover: Sortable.onHover
        }

        var options_for_tree = {
          onHover: Sortable.onEmptyHover,
          overlap: options.overlap,
          containment: options.containment,
          hoverclass: options.hoverclass
        }

        // fix for gecko engine
        Element.cleanWhitespace(element);

        options.draggables = [];
        options.droppables = [];

        // drop on empty handling
        if (options.dropOnEmpty || options.tree) {
          Droppables.add(element, options_for_tree);
          options.droppables.push(element);
        }

        (options.elements || this.findElements(element, options) || []).each(function (e, i) {
          var handle = options.handles ? $(options.handles[i]) :
            (options.handle ? $(e).select('.' + options.handle)[0] : e);
          options.draggables.push(
            new Draggable(e, Object.extend(options_for_draggable, { handle: handle })));
          Droppables.add(e, options_for_droppable);
          if (options.tree) e.treeNode = element;
          options.droppables.push(e);
        });

        if (options.tree) {
          (Sortable.findTreeElements(element, options) || []).each(function (e) {
            Droppables.add(e, options_for_tree);
            e.treeNode = element;
            options.droppables.push(e);
          });
        }

        // keep reference
        this.sortables[element.id] = options;

        // for onupdate
        Draggables.addObserver(new SortableObserver(element, options.onUpdate));

      },

      // return all suitable-for-sortable elements in a guaranteed order
      findElements: function (element, options) {
        return Element.findChildren(
          element, options.only, options.tree ? true : false, options.tag);
      },

      findTreeElements: function (element, options) {
        return Element.findChildren(
          element, options.only, options.tree ? true : false, options.treeTag);
      },

      onHover: function (element, dropon, overlap) {
        if (Element.isParent(dropon, element)) return;

        if (overlap > .33 && overlap < .66 && Sortable.options(dropon).tree) {
          return;
        } else if (overlap > 0.5) {
          Sortable.mark(dropon, 'before');
          if (dropon.previousSibling != element) {
            var oldParentNode = element.parentNode;
            element.style.visibility = "hidden"; // fix gecko rendering
            dropon.parentNode.insertBefore(element, dropon);
            if (dropon.parentNode != oldParentNode)
              Sortable.options(oldParentNode).onChange(element);
            Sortable.options(dropon.parentNode).onChange(element);
          }
        } else {
          Sortable.mark(dropon, 'after');
          var nextElement = dropon.nextSibling || null;
          if (nextElement != element) {
            var oldParentNode = element.parentNode;
            element.style.visibility = "hidden"; // fix gecko rendering
            dropon.parentNode.insertBefore(element, nextElement);
            if (dropon.parentNode != oldParentNode)
              Sortable.options(oldParentNode).onChange(element);
            Sortable.options(dropon.parentNode).onChange(element);
          }
        }
      },

      onEmptyHover: function (element, dropon, overlap) {
        var oldParentNode = element.parentNode;
        var droponOptions = Sortable.options(dropon);

        if (!Element.isParent(dropon, element)) {
          var index;

          var children = Sortable.findElements(dropon, { tag: droponOptions.tag, only: droponOptions.only });
          var child = null;

          if (children) {
            var offset = Element.offsetSize(dropon, droponOptions.overlap) * (1.0 - overlap);

            for (index = 0; index < children.length; index += 1) {
              if (offset - Element.offsetSize(children[index], droponOptions.overlap) >= 0) {
                offset -= Element.offsetSize(children[index], droponOptions.overlap);
              } else if (offset - (Element.offsetSize(children[index], droponOptions.overlap) / 2) >= 0) {
                child = index + 1 < children.length ? children[index + 1] : null;
                break;
              } else {
                child = children[index];
                break;
              }
            }
          }

          dropon.insertBefore(element, child);

          Sortable.options(oldParentNode).onChange(element);
          droponOptions.onChange(element);
        }
      },

      unmark: function () {
        if (Sortable._marker) Sortable._marker.hide();
      },

      mark: function (dropon, position) {
        // mark on ghosting only
        var sortable = Sortable.options(dropon.parentNode);
        if (sortable && !sortable.ghosting) return;

        if (!Sortable._marker) {
          Sortable._marker =
            ($('dropmarker') || Element.extend(document.createElement('DIV'))).
              hide().addClassName('dropmarker').setStyle({ position: 'absolute' });
          document.getElementsByTagName("body").item(0).appendChild(Sortable._marker);
        }
        var offsets = Position.cumulativeOffset(dropon);
        Sortable._marker.setStyle({ left: offsets[0] + 'px', top: offsets[1] + 'px' });

        if (position == 'after')
          if (sortable.overlap == 'horizontal')
            Sortable._marker.setStyle({ left: (offsets[0] + dropon.clientWidth) + 'px' });
          else
            Sortable._marker.setStyle({ top: (offsets[1] + dropon.clientHeight) + 'px' });

        Sortable._marker.show();
      },

      _tree: function (element, options, parent) {
        var children = Sortable.findElements(element, options) || [];

        for (var i = 0; i < children.length; ++i) {
          var match = children[i].id.match(options.format);

          if (!match) continue;

          var child = {
            id: encodeURIComponent(match ? match[1] : null),
            element: element,
            parent: parent,
            children: [],
            position: parent.children.length,
            container: $(children[i]).down(options.treeTag)
          }

          /* Get the element containing the children and recurse over it */
          if (child.container)
            this._tree(child.container, options, child)

          parent.children.push(child);
        }

        return parent;
      },

      tree: function (element) {
        element = $(element);
        var sortableOptions = this.options(element);
        var options = Object.extend({
          tag: sortableOptions.tag,
          treeTag: sortableOptions.treeTag,
          only: sortableOptions.only,
          name: element.id,
          format: sortableOptions.format
        }, arguments[1] || {});

        var root = {
          id: null,
          parent: null,
          children: [],
          container: element,
          position: 0
        }

        return Sortable._tree(element, options, root);
      },

      /* Construct a [i] index for a particular node */
      _constructIndex: function (node) {
        var index = '';
        do {
          if (node.id) index = '[' + node.position + ']' + index;
        } while ((node = node.parent) != null);
        return index;
      },

      sequence: function (element) {
        element = $(element);
        var options = Object.extend(this.options(element), arguments[1] || {});

        return $(this.findElements(element, options) || []).map(function (item) {
          return item.id.match(options.format) ? item.id.match(options.format)[1] : '';
        });
      },

      setSequence: function (element, new_sequence) {
        element = $(element);
        var options = Object.extend(this.options(element), arguments[2] || {});

        var nodeMap = {};
        this.findElements(element, options).each(function (n) {
          if (n.id.match(options.format))
            nodeMap[n.id.match(options.format)[1]] = [n, n.parentNode];
          n.parentNode.removeChild(n);
        });

        new_sequence.each(function (ident) {
          var n = nodeMap[ident];
          if (n) {
            n[1].appendChild(n[0]);
            delete nodeMap[ident];
          }
        });
      },

      serialize: function (element) {
        element = $(element);
        var options = Object.extend(Sortable.options(element), arguments[1] || {});
        var name = encodeURIComponent(
          (arguments[1] && arguments[1].name) ? arguments[1].name : element.id);

        if (options.tree) {
          return Sortable.tree(element, arguments[1]).children.map(function (item) {
            return [name + Sortable._constructIndex(item) + "[id]=" +
              encodeURIComponent(item.id)].concat(item.children.map(arguments.callee));
          }).flatten().join('&');
        } else {
          return Sortable.sequence(element, arguments[1]).map(function (item) {
            return name + "[]=" + encodeURIComponent(item);
          }).join('&');
        }
      }
    }

    // Returns true if child is contained within element
    Element.isParent = function (child, element) {
      if (!child.parentNode || child == element) return false;
      if (child.parentNode == element) return true;
      return Element.isParent(child.parentNode, element);
    }

    Element.findChildren = function (element, only, recursive, tagName) {
      if (!element.hasChildNodes()) return null;
      tagName = tagName.toUpperCase();
      if (only) only = [only].flatten();
      var elements = [];
      $A(element.childNodes).each(function (e) {
        if (e.tagName && e.tagName.toUpperCase() == tagName &&
          (!only || (Element.classNames(e).detect(function (v) { return only.include(v) }))))
          elements.push(e);
        if (recursive) {
          var grandchildren = Element.findChildren(e, only, recursive, tagName);
          if (grandchildren) elements.push(grandchildren);
        }
      });

      return (elements.length > 0 ? elements.flatten() : []);
    }

    Element.offsetSize = function (element, type) {
      return element['offset' + ((type == 'vertical' || type == 'height') ? 'Height' : 'Width')];
    }

  </script>
  <script>



    function RegisterSteamOnWebPanelShownHandler(f) {
      $J(document).on('visibilitychange', function () {
        if (document.visibilityState === "visible")
          f();
      });
    }

    function RegisterSteamOnWebPanelHiddenHandler(f) {
      $J(document).on('visibilitychange', function () {
        if (document.visibilityState === "hidden")
          f();
      });
    }





    function RefreshNotificationArea() {
      // the new way - updates both the old envelope and responsive menu
      UpdateNotificationCounts();
    }

    function vIE() {
      return (navigator.appName == 'Microsoft Internet Explorer') ? parseFloat((new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})")).exec(navigator.userAgent)[1]) : -1;
    }

    function checkAbuseSub(elForm) {
      if (!$J(elForm).find('input[name=abuseType]:checked').length) {
        alert('Please select a reason for reporting abuse');
        return false;
      }

      CModal.DismissActiveModal();

      var params = $J(elForm).serializeArray();
      params.push({ name: 'json', value: 1 });

      $J.post('https://steamcommunity.com/actions/ReportAbuse/', params).done(function () {
        ShowAlertDialog('Thank You!', 'Thank you for reporting offensive content and helping to keep Steam clean and friendly.');
      }).fail(function () {
        ShowAlertDialog('Report Violation', 'There was a problem saving your report.  Please try again later.');
      });
      return false;
    }



    var g_whiteListedDomains = [
      "steampowered.com",
      "steamgames.com",
      "steamcommunity.com",
      "valvesoftware.com",
      "youtube.com",
      "youtu.be",
      "live.com",
      "msn.com",
      "myspace.com",
      "facebook.com",
      "hi5.com",
      "wikipedia.org",
      "orkut.com",
      "blogger.com",
      "friendster.com",
      "fotolog.net",
      "google.fr",
      "baidu.com",
      "microsoft.com",
      "shacknews.com",
      "bbc.co.uk",
      "cnn.com",
      "foxsports.com",
      "pcmag.com",
      "nytimes.com",
      "flickr.com",
      "amazon.com",
      "veoh.com",
      "pcgamer.com",
      "metacritic.com",
      "fileplanet.com",
      "gamespot.com",
      "gametap.com",
      "ign.com",
      "kotaku.com",
      "xfire.com",
      "pcgames.gwn.com",
      "gamezone.com",
      "gamesradar.com",
      "digg.com",
      "engadget.com",
      "gizmodo.com",
      "gamesforwindows.com",
      "xbox.com",
      "cnet.com",
      "l4d.com",
      "teamfortress.com",
      "tf2.com",
      "half-life2.com",
      "aperturescience.com",
      "dayofdefeat.com",
      "dota2.com",
      "playdota.com",
      "kickstarter.com",
      "gamingheads.com",
      "reddit.com",
      "counter-strike.net",
      "imgur.com"
    ];

    function getHostname(str) {
      var re = new RegExp('^(steam://openurl(_external)?/)?(f|ht)tps?://([^@/?#]*@)?([^/#?]+)', 'im');
      return str.trim().match(re)[5].toString();
    }

    function AlertNonSteamSite(elem) {
      var url = elem.href;
      var hostname = getHostname(url);
      if (hostname) {
        hostname = hostname.toLowerCase();
        for (var i = 0; i < g_whiteListedDomains.length; ++i) {
          var index = hostname.lastIndexOf(g_whiteListedDomains[i]);
          if (index != -1 && index == (hostname.length - g_whiteListedDomains[i].length)
            && (index == 0 || hostname.charAt(index - 1) == '.')) {
            return true;
          }
        }
        return confirm('Note: the URL you have clicked on is not an official Steam web site.\n\n'
          + url.replace(new RegExp('^steam://openurl(_external)?/'), '') + '\n\n'
          + 'If this web site asks for your user name or password, do not enter that information. You could lose your Steam account and all your games!\n'
          + 'Are you sure you want to visit this page? Click OK to continue at your own risk.\n');
      }

      ShowAlertDialog('', 'The URL is badly formed.');
      return false;
    }

    var lastFilters = new Object();
    function FilterListFast(target, str) {
      var lastFilter = lastFilters[target];
      if (!lastFilter)
        lastFilter = '';

      str = str.toLowerCase();
      if (str == lastFilter)
        return false;

      var expanding = false;
      var contracting = false;
      if (str.length > lastFilter.length && str.startsWith(lastFilter))
        expanding = true;
      if (!str || str.length < lastFilter.length && lastFilter.startsWith(str))
        contracting = true;

      var strParts = str.split(/\W/);

      var elemTarget = $(target);
      var elemParent = elemTarget.parentNode;
      elemParent.removeChild(elemTarget);

      var rgChildren = elemTarget.childNodes;
      for (var i = 0; i < rgChildren.length; i++) {
        var child = rgChildren[i];
        if (child.nodeType != child.ELEMENT_NODE)
          continue;
        if (expanding && child.style.display == 'none' || contracting && child.style.display != 'none')
          continue;
        if (!child.lcText)
          child.lcText = (child.innerText || child.textContent).toLowerCase();

        var text = child.lcText;
        var show = true;
        for (var iPart = 0; show && iPart < strParts.length; iPart++)
          if (!text.include(strParts[iPart]))
            show = false;

        if (show)
          child.style.display = '';
        else
          child.style.display = 'none';
      }
      lastFilters[target] = str;
      elemParent.appendChild(elemTarget);
      return true;
    }


    // goes into fullscreen, returning false if the browser doesn't support it
    function requestFullScreen(element) {
      // Supports most browsers and their versions.
      var requestMethod = element.requestFullScreen || element.webkitRequestFullScreen || element.mozRequestFullScreen || element.msRequestFullScreen;

      if (requestMethod) {
        // Native full screen.
        requestMethod.call(element);
        return true;
      }

      return false;
    }

    function exitFullScreen() {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      }
      else if (document.mozCancelFullScreen) {
        document.mozCancelFullScreen();
      }
      else if (document.webkitCancelFullScreen) {
        document.webkitCancelFullScreen();
      }
    }

    function RecordAJAXPageView(url) {
      if (typeof ga != "undefined" && ga) {
        var rgURLs = ['https://steamcommunity.com', 'https://steamcommunity.com'];
        for (var i = 0; i < rgURLs.length; ++i) {
          var baseURL = rgURLs[i];
          var idx = url.indexOf(baseURL);
          if (idx != -1) {
            url = url.substring(idx + baseURL.length);
          }
          ga('send', 'pageview', url);
          return;
        }
      }
    }

    var g_SNR = false;
    var g_strLanguage = 'english';

    // given an array of impressions as strings, this will handle joining them all together into a singular string, but enforcing that it doesn't
    // go above the cookie size limit which can otherwise cause users to become stuck since the page requests will start failing
    function JoinImpressionsUpToLimit(rgImpressions) {
      //cookies generally can go up to 4k bytes, but we can have problems when we start getting that close, so cut it off earlier
      var nRemainingLen = 3200;
      var result = '';
      for (var i = 0; i < rgImpressions.length; i++) {
        var impression = String(rgImpressions[i]);
        var nImpressionLen = encodeURIComponent(impression + '|').length;

        //did we run out of room in our list?
        if (nRemainingLen < nImpressionLen)
          break;

        //add the separator if not the first entry
        if (result !== '')
          result += '|';

        //add our impression and remove that space from what is available
        result += impression;
        nRemainingLen -= nImpressionLen;
      }

      return result;
    }

    function RecordAppImpression(appid, snr) {
      if (appid == 0 || !snr)
        return;

      if (typeof g_bAllowAppImpressions == 'undefined' || !g_bAllowAppImpressions) {
        return;
      }

      var strImpressions = V_GetCookie("app_impressions");
      var rgImpressions = strImpressions && strImpressions.length != 0 ? strImpressions.split("|") : [];


      var strImpressionData = appid + '@' + snr;
      rgImpressions.push(strImpressionData);

      V_SetCookie("app_impressions", JoinImpressionsUpToLimit(rgImpressions));
    }


    // doesn't properly handle cookies with ; in them (needs to look for escape char)
    function GetCookie(strCookieName) {
      var rgMatches = document.cookie.match('(^|; )' + strCookieName + '=([^;]*)');
      if (rgMatches && rgMatches[2])
        return rgMatches[2];
      else
        return null;
    }

    function SetCookie(strCookieName, strValue, expiryInDays, path) {
      if (!expiryInDays)
        expiryInDays = 0;
      if (!path)
        path = '/';

      var dateExpires = new Date();
      dateExpires.setTime(dateExpires.getTime() + 1000 * 60 * 60 * 24 * expiryInDays);
      document.cookie = strCookieName + '=' + strValue + '; expires=' + dateExpires.toGMTString() + ';path=' + path;
    }

    // included data: strCode, eCurrencyCode, strSymbol, bSymbolIsPrefix, bWholeUnitsOnly
    g_rgCurrencyData = { "USD": { "strCode": "USD", "eCurrencyCode": 1, "strSymbol": "$", "bSymbolIsPrefix": true, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": "" }, "GBP": { "strCode": "GBP", "eCurrencyCode": 2, "strSymbol": "\u00a3", "bSymbolIsPrefix": true, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": "" }, "EUR": { "strCode": "EUR", "eCurrencyCode": 3, "strSymbol": "\u20ac", "bSymbolIsPrefix": false, "bWholeUnitsOnly": false, "strDecimalSymbol": ",", "strThousandsSeparator": " ", "strSymbolAndNumberSeparator": "" }, "CHF": { "strCode": "CHF", "eCurrencyCode": 4, "strSymbol": "CHF", "bSymbolIsPrefix": true, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": " ", "strSymbolAndNumberSeparator": " " }, "RUB": { "strCode": "RUB", "eCurrencyCode": 5, "strSymbol": "p\u0443\u0431.", "bSymbolIsPrefix": false, "bWholeUnitsOnly": true, "strDecimalSymbol": ",", "strThousandsSeparator": "", "strSymbolAndNumberSeparator": " " }, "BRL": { "strCode": "BRL", "eCurrencyCode": 7, "strSymbol": "R$", "bSymbolIsPrefix": true, "bWholeUnitsOnly": false, "strDecimalSymbol": ",", "strThousandsSeparator": ".", "strSymbolAndNumberSeparator": " " }, "JPY": { "strCode": "JPY", "eCurrencyCode": 8, "strSymbol": "\u00a5", "bSymbolIsPrefix": true, "bWholeUnitsOnly": true, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": " " }, "NOK": { "strCode": "NOK", "eCurrencyCode": 9, "strSymbol": "kr", "bSymbolIsPrefix": false, "bWholeUnitsOnly": false, "strDecimalSymbol": ",", "strThousandsSeparator": ".", "strSymbolAndNumberSeparator": " " }, "IDR": { "strCode": "IDR", "eCurrencyCode": 10, "strSymbol": "Rp", "bSymbolIsPrefix": true, "bWholeUnitsOnly": true, "strDecimalSymbol": ".", "strThousandsSeparator": " ", "strSymbolAndNumberSeparator": " " }, "MYR": { "strCode": "MYR", "eCurrencyCode": 11, "strSymbol": "RM", "bSymbolIsPrefix": true, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": "" }, "PHP": { "strCode": "PHP", "eCurrencyCode": 12, "strSymbol": "P", "bSymbolIsPrefix": true, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": "" }, "SGD": { "strCode": "SGD", "eCurrencyCode": 13, "strSymbol": "S$", "bSymbolIsPrefix": true, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": "" }, "THB": { "strCode": "THB", "eCurrencyCode": 14, "strSymbol": "\u0e3f", "bSymbolIsPrefix": true, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": "" }, "VND": { "strCode": "VND", "eCurrencyCode": 15, "strSymbol": "\u20ab", "bSymbolIsPrefix": false, "bWholeUnitsOnly": true, "strDecimalSymbol": ",", "strThousandsSeparator": ".", "strSymbolAndNumberSeparator": "" }, "KRW": { "strCode": "KRW", "eCurrencyCode": 16, "strSymbol": "\u20a9", "bSymbolIsPrefix": true, "bWholeUnitsOnly": true, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": " " }, "TRY": { "strCode": "TRY", "eCurrencyCode": 17, "strSymbol": "TL", "bSymbolIsPrefix": false, "bWholeUnitsOnly": false, "strDecimalSymbol": ",", "strThousandsSeparator": ".", "strSymbolAndNumberSeparator": " " }, "UAH": { "strCode": "UAH", "eCurrencyCode": 18, "strSymbol": "\u20b4", "bSymbolIsPrefix": false, "bWholeUnitsOnly": true, "strDecimalSymbol": ",", "strThousandsSeparator": " ", "strSymbolAndNumberSeparator": "" }, "MXN": { "strCode": "MXN", "eCurrencyCode": 19, "strSymbol": "Mex$", "bSymbolIsPrefix": true, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": " " }, "CAD": { "strCode": "CAD", "eCurrencyCode": 20, "strSymbol": "CDN$", "bSymbolIsPrefix": true, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": " " }, "AUD": { "strCode": "AUD", "eCurrencyCode": 21, "strSymbol": "A$", "bSymbolIsPrefix": true, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": " " }, "NZD": { "strCode": "NZD", "eCurrencyCode": 22, "strSymbol": "NZ$", "bSymbolIsPrefix": true, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": " " }, "PLN": { "strCode": "PLN", "eCurrencyCode": 6, "strSymbol": "z\u0142", "bSymbolIsPrefix": false, "bWholeUnitsOnly": false, "strDecimalSymbol": ",", "strThousandsSeparator": " ", "strSymbolAndNumberSeparator": "" }, "CNY": { "strCode": "CNY", "eCurrencyCode": 23, "strSymbol": "\u00a5", "bSymbolIsPrefix": true, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": " " }, "INR": { "strCode": "INR", "eCurrencyCode": 24, "strSymbol": "\u20b9", "bSymbolIsPrefix": true, "bWholeUnitsOnly": true, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": " " }, "CLP": { "strCode": "CLP", "eCurrencyCode": 25, "strSymbol": "CLP$", "bSymbolIsPrefix": true, "bWholeUnitsOnly": true, "strDecimalSymbol": ",", "strThousandsSeparator": ".", "strSymbolAndNumberSeparator": " " }, "PEN": { "strCode": "PEN", "eCurrencyCode": 26, "strSymbol": "S\/.", "bSymbolIsPrefix": true, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": "" }, "COP": { "strCode": "COP", "eCurrencyCode": 27, "strSymbol": "COL$", "bSymbolIsPrefix": true, "bWholeUnitsOnly": true, "strDecimalSymbol": ",", "strThousandsSeparator": ".", "strSymbolAndNumberSeparator": " " }, "ZAR": { "strCode": "ZAR", "eCurrencyCode": 28, "strSymbol": "R", "bSymbolIsPrefix": true, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": " ", "strSymbolAndNumberSeparator": " " }, "HKD": { "strCode": "HKD", "eCurrencyCode": 29, "strSymbol": "HK$", "bSymbolIsPrefix": true, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": " " }, "TWD": { "strCode": "TWD", "eCurrencyCode": 30, "strSymbol": "NT$", "bSymbolIsPrefix": true, "bWholeUnitsOnly": true, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": " " }, "SAR": { "strCode": "SAR", "eCurrencyCode": 31, "strSymbol": "SR", "bSymbolIsPrefix": false, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": " " }, "AED": { "strCode": "AED", "eCurrencyCode": 32, "strSymbol": "AED", "bSymbolIsPrefix": false, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": " " }, "SEK": { "strCode": "SEK", "eCurrencyCode": 33, "strSymbol": "kr", "bSymbolIsPrefix": false, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": " " }, "ARS": { "strCode": "ARS", "eCurrencyCode": 34, "strSymbol": "ARS$", "bSymbolIsPrefix": true, "bWholeUnitsOnly": false, "strDecimalSymbol": ",", "strThousandsSeparator": ".", "strSymbolAndNumberSeparator": " " }, "ILS": { "strCode": "ILS", "eCurrencyCode": 35, "strSymbol": "\u20aa", "bSymbolIsPrefix": true, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": "" }, "BYN": { "strCode": "BYN", "eCurrencyCode": 36, "strSymbol": "Br", "bSymbolIsPrefix": true, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": "" }, "KZT": { "strCode": "KZT", "eCurrencyCode": 37, "strSymbol": "\u20b8", "bSymbolIsPrefix": false, "bWholeUnitsOnly": true, "strDecimalSymbol": ",", "strThousandsSeparator": " ", "strSymbolAndNumberSeparator": "" }, "KWD": { "strCode": "KWD", "eCurrencyCode": 38, "strSymbol": "KD", "bSymbolIsPrefix": false, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": " " }, "QAR": { "strCode": "QAR", "eCurrencyCode": 39, "strSymbol": "QR", "bSymbolIsPrefix": false, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": " " }, "CRC": { "strCode": "CRC", "eCurrencyCode": 40, "strSymbol": "\u20a1", "bSymbolIsPrefix": true, "bWholeUnitsOnly": true, "strDecimalSymbol": ",", "strThousandsSeparator": ".", "strSymbolAndNumberSeparator": "" }, "UYU": { "strCode": "UYU", "eCurrencyCode": 41, "strSymbol": "$U", "bSymbolIsPrefix": true, "bWholeUnitsOnly": true, "strDecimalSymbol": ",", "strThousandsSeparator": ".", "strSymbolAndNumberSeparator": "" }, "BGN": { "strCode": "BGN", "eCurrencyCode": 42, "strSymbol": "\u043b\u0432", "bSymbolIsPrefix": false, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": " " }, "HRK": { "strCode": "HRK", "eCurrencyCode": 43, "strSymbol": "kn", "bSymbolIsPrefix": false, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": " " }, "CZK": { "strCode": "CZK", "eCurrencyCode": 44, "strSymbol": "K\u010d", "bSymbolIsPrefix": false, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": " " }, "DKK": { "strCode": "DKK", "eCurrencyCode": 45, "strSymbol": "kr.", "bSymbolIsPrefix": false, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": " " }, "HUF": { "strCode": "HUF", "eCurrencyCode": 46, "strSymbol": "Ft", "bSymbolIsPrefix": false, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": " " }, "RON": { "strCode": "RON", "eCurrencyCode": 47, "strSymbol": "lei", "bSymbolIsPrefix": false, "bWholeUnitsOnly": false, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": " " }, "RMB": { "strCode": "RMB", "eCurrencyCode": 9000, "strSymbol": "\u5200\u5e01", "bSymbolIsPrefix": false, "bWholeUnitsOnly": true, "strDecimalSymbol": ".", "strThousandsSeparator": "", "strSymbolAndNumberSeparator": " " }, "NXP": { "strCode": "NXP", "eCurrencyCode": 9001, "strSymbol": "\uc6d0", "bSymbolIsPrefix": false, "bWholeUnitsOnly": true, "strDecimalSymbol": ".", "strThousandsSeparator": ",", "strSymbolAndNumberSeparator": "" } };


    // takes an integer
    function v_currencyformat(valueInCents, currencyCode, countryCode) {
      var currencyFormat = (valueInCents / 100).toFixed(2);

      if (g_rgCurrencyData[currencyCode]) {
        var currencyData = g_rgCurrencyData[currencyCode];
        if (IsCurrencyWholeUnits(currencyCode)) {
          currencyFormat = currencyFormat.replace('.00', '');
        }

        if (currencyData.strDecimalSymbol != '.') {
          currencyFormat = currencyFormat.replace('.', currencyData.strDecimalSymbol);
        }

        var currencyReturn = IsCurrencySymbolBeforeValue(currencyCode) ?
          GetCurrencySymbol(currencyCode) + currencyData.strSymbolAndNumberSeparator + currencyFormat
          : currencyFormat + currencyData.strSymbolAndNumberSeparator + GetCurrencySymbol(currencyCode);

        if (currencyCode == 'USD' && typeof (countryCode) != 'undefined' && countryCode != 'US') {
          return currencyReturn + ' USD';
        }
        else if (currencyCode == 'EUR') {
          return currencyReturn.replace(',00', ',--');
        }
        else {
          return currencyReturn;
        }
      }
      else {
        return currencyFormat + ' ' + currencyCode;
      }
    }


    function IsCurrencySymbolBeforeValue(currencyCode) {
      return g_rgCurrencyData[currencyCode] && g_rgCurrencyData[currencyCode].bSymbolIsPrefix;
    }

    function IsCurrencyWholeUnits(currencyCode) {
      return g_rgCurrencyData[currencyCode] && g_rgCurrencyData[currencyCode].bWholeUnitsOnly && currencyCode != 'RUB';
    }

    // Return the symbol to use for a currency
    function GetCurrencySymbol(currencyCode) {
      return g_rgCurrencyData[currencyCode] ? g_rgCurrencyData[currencyCode].strSymbol : currencyCode + ' ';
    }

    function GetCurrencyCode(currencyId) {
      for (var code in g_rgCurrencyData) {
        if (g_rgCurrencyData[code].eCurrencyCode == currencyId)
          return code;
      }
      return 'Unknown';
    }

    function GetAvatarURLFromHash(hash, size) {
      var strURL = 'https://avatars.cloudflare.steamstatic.com/' + hash;

      if (size == 'full')
        strURL += '_full.jpg';
      else if (size == 'medium')
        strURL += '_medium.jpg';
      else
        strURL += '.jpg';

      return strURL;
    }




    // need to hold on to this so it doesn't get lost when we remove() the dialog element
    var g_AbuseModalContents = null;
    function ShowAbuseDialog() {
      if (!g_AbuseModalContents)
        g_AbuseModalContents = $J('#reportAbuseModalContents');

      if (g_AbuseModalContents) {
        var Modal = ShowDialog('Report Violation', g_AbuseModalContents);
      }
    }

    function StandardCommunityBan(steamid, elemLink) {
      $J.get('https://steamcommunity.com/actions/communitybandialog', { 'sessionID': g_sessionID, 'steamID': steamid })
        .done(function (data) {
          var $Content = $J(data);
          var Modal = ShowConfirmDialog("Community Ban", $Content, 'Submit'
          ).done(function () {

            var $Form = $Content.find('form#community_ban_form');

            $J.post("https://steamcommunity.com/actions/StandardCommunityBan", $Form.serialize())
              .done(function (data) {
                if (!$J.isEmptyObject(elemLink)) {
                  $J(elemLink).replaceWith('<span style="color: red;">Banned</span>');
                }
                else {
                  location.reload();
                }

              }).fail(function (jqxhr) {
                // jquery doesn't parse json on fail
                var data = V_ParseJSON(jqxhr.responseText);
                ShowAlertDialog('Community Ban & Delete Comments', 'Failed with error message: ' + data.success);
              });
          });

        }).fail(function (data) {
          ShowAlertDialog('Community Ban & Delete Comments', 'You do not have permissions to view this or you are not logged in.');
        });

    }

    function ReportProfile(steamID) {
      var $Content = $J('<div class="group_invite_throbber"><img src="https://community.cloudflare.steamstatic.com/public/images/login/throbber.gif"></div>');
      var $Modal = ShowDialog(null, $Content);
      var sURL = 'https://steamcommunity.com/actions/ReportProfile/' + steamID;
      $J.ajax({
        url: sURL,
        type: 'GET'
      }).done(function (data) {
        var $DialogHTML = $J(data);
        $Content.replaceWith($DialogHTML);
        $Modal.SetMaxHeight('850');
      });
    }

    function CEmoticonPopup($EmoticonButton, $Textarea, strBaseURL) {
      this.m_$EmoticonButton = $EmoticonButton;
      this.m_$TextArea = $Textarea;
      this.m_strBaseURL = strBaseURL || 'https://steamcommunity.com';

      if (CEmoticonPopup.sm_deferEmoticonsLoaded == null)
        CEmoticonPopup.sm_deferEmoticonsLoaded = new jQuery.Deferred();

      this.m_bVisible = false;
      this.m_$Popup = null;

      var _this = this;
      this.m_$EmoticonButton.one('mouseenter', function () { _this.LoadEmoticons(); });
      this.m_$EmoticonButton.click(function () { _this.LoadEmoticons(); CEmoticonPopup.sm_deferEmoticonsLoaded.done(function () { _this.OnButtonClick(); }) });
      this.m_fnOnDocumentClick = function () { _this.DismissPopup(); };
    }

    CEmoticonPopup.sm_rgEmoticons = [];
    CEmoticonPopup.sm_bEmoticonsLoaded = false;
    CEmoticonPopup.sm_deferEmoticonsLoaded = null;

    CEmoticonPopup.prototype.LoadEmoticons = function () {
      if (CEmoticonPopup.sm_bEmoticonsLoaded)
        return;

      CEmoticonPopup.sm_bEmoticonsLoaded = true;
      CEmoticonPopup.sm_rgEmoticons = [];
      $J.get(this.m_strBaseURL + '/actions/EmoticonList')
        .done(function (data) {
          if (data)
            CEmoticonPopup.sm_rgEmoticons = data;
        }).always(function () { CEmoticonPopup.sm_deferEmoticonsLoaded.resolve() });
    };

    CEmoticonPopup.prototype.OnButtonClick = function () {
      if (this.m_bVisible) {
        this.DismissPopup();
      }
      else {
        if (!this.m_$Popup)
          this.BuildPopup();
        else
          PositionEmoticonHover(this.m_$Popup, this.m_$EmoticonButton);

        this.m_$EmoticonButton.addClass('focus');
        this.m_$Popup.stop();
        this.m_$Popup.fadeIn('fast');
        this.m_bVisible = true;

        if (window.UseSmallScreenMode && window.UseSmallScreenMode()) {
          // scroll such that the emoticon button is just above the popup window we're showing at the bottom of the screen
          // 	the 10 pixels represents the popup being positioned 5px from the bottom of the screen, and 5px between the popup and button
          $J(window).scrollTop(this.m_$EmoticonButton.offset().top - $J(window).height() + this.m_$Popup.height() + this.m_$EmoticonButton.height() + 10);
        }

        var _this = this;
        window.setTimeout(function () { $J(document).one('click.EmoticonPopup', _this.m_fnOnDocumentClick) }, 0);
      }
    };

    CEmoticonPopup.prototype.DismissPopup = function () {
      this.m_$Popup.fadeOut('fast');
      this.m_$EmoticonButton.removeClass('focus');
      this.m_bVisible = false;

      $J(document).off('click.EmoticonPopup');
    };

    CEmoticonPopup.prototype.BuildPopup = function () {
      this.m_$Popup = $J('<div/>', { 'class': 'emoticon_popup_ctn' });

      var $PopupInner = $J('<div/>', { 'class': 'emoticon_popup' });
      this.m_$Popup.append($PopupInner);
      var $Content = $J('<div/>', { 'class': 'emoticon_popup_content' });
      $PopupInner.append($Content);

      for (var i = 0; i < CEmoticonPopup.sm_rgEmoticons.length; i++) {
        var strEmoticonName = CEmoticonPopup.sm_rgEmoticons[i].replace(/:/g, '');
        var strEmoticonURL = 'https://community.cloudflare.steamstatic.com/economy/emoticon/' + strEmoticonName;

        var $Emoticon = $J('<div/>', { 'class': 'emoticon_option', 'data-emoticon': strEmoticonName });
        var $Img = $J('<img/>', { 'src': strEmoticonURL, 'class': 'emoticon' });
        $Emoticon.append($Img);

        $Emoticon.click(this.GetEmoticonClickClosure(strEmoticonName));

        $Content.append($Emoticon);
      }

      $J(document.body).append(this.m_$Popup);
      PositionEmoticonHover(this.m_$Popup, this.m_$EmoticonButton);
    };

    CEmoticonPopup.prototype.GetEmoticonClickClosure = function (strEmoticonName) {
      var _this = this;
      var strTextToInsert = ':' + strEmoticonName + ':';
      return function () {
        var elTextArea = _this.m_$TextArea[0];
        if (elTextArea) {
          var nSelectionStart = elTextArea.selectionStart;
          elTextArea.value = elTextArea.value.substr(0, nSelectionStart) + strTextToInsert + elTextArea.value.substr(nSelectionStart);
          elTextArea.selectionStart = nSelectionStart + strTextToInsert.length;
        }

        _this.m_$TextArea.focus();

        _this.DismissPopup();

        if (window.DismissEmoticonHover)
          window.setTimeout(DismissEmoticonHover, 1);
      };
    };

    function PositionEmoticonHover($Hover, $Target) {
      // we position fixed in CSS for responsive mode
      if (window.UseSmallScreenMode && window.UseSmallScreenMode()) {
        $Hover.css('left', '').css('top', '');
        return;
      }

      $Hover.css('visibility', 'hidden');
      $Hover.show();

      var offset = $Target.offset();
      $Hover.css('left', offset.left + 'px');
      $Hover.css('top', offset.top + 'px');

      var $HoverBox = $Hover.children('.emoticon_popup');
      var $HoverArrowLeft = $Hover.children('.miniprofile_arrow_left');
      var $HoverArrowRight = $Hover.children('.miniprofile_arrow_right');

      var nWindowScrollTop = $J(window).scrollTop();
      var nWindowScrollLeft = $J(window).scrollLeft();
      var nViewportWidth = $J(window).width();
      var nViewportHeight = $J(window).height();

      var $HoverArrow = $HoverArrowRight;
      var nBoxRightViewport = (offset.left - nWindowScrollLeft) + $Target.outerWidth() + $HoverBox.width();
      var nSpaceRight = nViewportWidth - nBoxRightViewport;
      var nSpaceLeft = offset.left - $Hover.width();
      if (nSpaceLeft > 0 || nSpaceLeft > nSpaceRight) {
        $Hover.css('left', (offset.left - $Hover.width() - 12) + 'px');
        $HoverArrowLeft.hide();
        $HoverArrowRight.show();
      }
      else {
        $Hover.css('left', (offset.left + $Target.outerWidth()) + 'px');
        $HoverArrow = $HoverArrowLeft;
        $HoverArrowLeft.show();
        $HoverArrowRight.hide();
      }

      var nTopAdjustment = 0;

      if ($Target.height() < 48)
        nTopAdjustment = Math.floor($Target.height() / 2) - 12;
      var nDesiredHoverTop = offset.top - 0 + nTopAdjustment;
      $Hover.css('top', nDesiredHoverTop + 'px');

      // see if the hover is cut off by the bottom of the window, and bump it up if neccessary
      var nTargetTopViewport = (offset.top - nWindowScrollTop) + nTopAdjustment;
      if (nTargetTopViewport + $HoverBox.height() + 35 > nViewportHeight) {
        var nViewportAdjustment = ($HoverBox.height() + 35) - (nViewportHeight - nTargetTopViewport);

        var nViewportAdjustedHoverTop = offset.top - nViewportAdjustment;
        $Hover.css('top', nViewportAdjustedHoverTop + 'px');

        // arrow is normally offset 30pixels.  we move it down the same distance we moved the hover up, so it is "fixed" to where it was initially
        $HoverArrow.css('top', (30 + nDesiredHoverTop - nViewportAdjustedHoverTop) + 'px');
      }
      else {
        $HoverArrow.css('top', '');
      }

      $Hover.hide();
      $Hover.css('visibility', '');
    }


    function InitEconomyHovers(strEconomyCSSURL, strEconomyCommonJSURL, strEconomyJSURL) {
      var $Hover = $J('<div/>', { 'class': 'economyitem_hover' });
      var $HoverContent = $J('<div/>', { 'class': 'economyitem_hover_content' });
      $Hover.append($HoverContent);
      $Hover.hide();

      var fnOneTimeEconomySetup = function () {
        $J(document.body).append($Hover);

        if (typeof UserYou == 'undefined') {
          var css = document.createElement("link");
          css.setAttribute("rel", "stylesheet");
          css.setAttribute("type", "text/css");
          css.setAttribute("href", strEconomyCSSURL);
          var js1 = document.createElement("script");
          js1.setAttribute("type", "text/javascript");
          js1.setAttribute("src", strEconomyCommonJSURL);
          var js2 = document.createElement("script");
          js2.setAttribute("type", "text/javascript");
          js2.setAttribute("src", strEconomyJSURL);
          var head = $J('head')[0];
          head.appendChild(css);
          head.appendChild(js1);
          head.appendChild(js2);
        }
      };

      var fnDataFactory = function (key) {
        var rgItemKey = key.split('/');
        if (rgItemKey.length >= 3 && rgItemKey.length <= 5) {
          if (fnOneTimeEconomySetup) {
            fnOneTimeEconomySetup();
            fnOneTimeEconomySetup = null;
          }

          // pop amount off the end first if it's present
          var nAmount;
          var strLastEntry = rgItemKey[rgItemKey.length - 1];
          if (strLastEntry && strLastEntry.length > 2 && strLastEntry.substr(0, 2) == 'a:') {
            nAmount = strLastEntry.substr(2);
            rgItemKey.pop();
          }

          var strURL = null;
          var appid = rgItemKey[0];
          if (appid == 'classinfo') {
            // class info style
            appid = rgItemKey[1];
            var classid = rgItemKey[2];
            var instanceid = (rgItemKey.length > 3 ? rgItemKey[3] : 0);
            strURL = 'economy/itemclasshover/' + appid + '/' + classid + '/' + instanceid;
            strURL += '?content_only=1&l=english';
          }
          else {
            // real asset
            var contextid = rgItemKey[1];
            var assetid = rgItemKey[2];
            var strURL = 'economy/itemhover/' + appid + '/' + contextid + '/' + assetid;
            strURL += '?content_only=1&omit_owner=1&l=english';
            if (rgItemKey.length == 4 && rgItemKey[3]) {
              var strOwner = rgItemKey[3];
              if (strOwner.indexOf('id:') == 0)
                strURL += '&o_url=' + strOwner.substr(3);
              else
                strURL += '&o=' + strOwner;
            }
          }
          if (nAmount && nAmount > 1)
            strURL += '&amount=' + nAmount;
          return new CDelayedAJAXData(strURL, 100);
        }
        else
          return null;
      };

      var rgCallbacks = BindAJAXHovers($Hover, $HoverContent, {
        fnDataFactory: fnDataFactory,
        strDataName: 'economy-item',
        strURLMatch: 'itemhover'
      });
    }

    function ShowTradeOffer(tradeOfferID, rgParams) {
      var strParams = '';
      if (rgParams)
        strParams = '?' + $J.param(rgParams);

      var strKey = (tradeOfferID == 'new' ? 'NewTradeOffer' + rgParams['partner'] : 'TradeOffer' + tradeOfferID);

      var winHeight = 1120;
      if (Steam.BIsUserInSteamClient() && Steam.GetClientPackageVersion() < 1407800248) {
        // workaround for client break when the popup window is too tall for the screen.  Try and pick a height that will fit here.
        var nClientChromePX = 92;
        if (window.screen.availHeight && window.screen.availHeight - nClientChromePX < winHeight)
          winHeight = window.screen.availHeight - nClientChromePX;
      }

      var strURL = 'https://steamcommunity.com/tradeoffer/' + tradeOfferID + '/' + strParams;
      if (Steam.BIsUserInSteamMobileApp()) {
        window.location = strURL;
      }
      else {
        var winOffer = window.open(strURL, strKey, 'height=' + winHeight + ',width=1028,resize=yes,scrollbars=yes');

        winOffer.focus();
      }
    }

    function Logout() {
      PostToURLWithSession('https://steamcommunity.com/login/logout/');
    }

    function ChangeLanguage(strTargetLanguage, bStayOnPage) {
      var Modal = ShowBlockingWaitDialog('Change language', '');
      $J.post('https://steamcommunity.com/actions/SetLanguage/', { language: strTargetLanguage, sessionid: g_sessionID })
        .done(function () {
          if (bStayOnPage)
            Modal.Dismiss();
          else {
            if (g_steamID)
              window.location = 'https://store.steampowered.com/account/languagepreferences/';
            else if (window.location.href.match(/[?&]l=/))
              window.location = window.location.href.replace(/([?&])l=[^&]*&?/, '$1');
            else
              window.location.reload();
          }
        }).fail(function () {
          Modal.Dismiss();
          ShowAlertDialog('Change language', 'There was a problem communicating with the Steam servers.  Please try again later.');
        });
    }

    var g_ContentDescriptorPreferences = [3, 4];
    var g_UGCWithNoBlur = {};
    var g_bLoadedUGCWithNoBlur = false;
    var g_UGCSkipAdultContentCheckForAppID = false;

    function LoadUGCWithNoBlur() {
      if (g_bLoadedUGCWithNoBlur) {
        return;
      }

      var strUGCNoBlur = WebStorage.GetLocal('rgUGCNoBlur', false);
      if (strUGCNoBlur != null) {
        g_UGCWithNoBlur = JSON.parse(strUGCNoBlur);
      }
    }

    function SaveUGCWithNoBlur() {
      var keys = Object.keys(g_UGCWithNoBlur);
      var maxKeys = 1000;
      if (keys.length >= maxKeys) {
        var rgTemp = [];
        for (var i = 0; i < keys.length; ++i) {
          var key = keys[i];
          var value = g_UGCWithNoBlur[key];
          rgTemp.push({ v: value['timestamp'], k: key });
        }
        rgTemp.sort(function (a, b) {
          if (a.v > b.v) { return 1; }
          if (a.v < b.v) { return -1; }
          return 0;
        });

        var delta = rgTemp.length - maxKeys;
        for (var i = 0; i < rgTemp.length && i < delta; ++i) {
          var a = rgTemp[i];
          delete g_UGCWithNoBlur[a.k];
        }
      }
      WebStorage.SetLocal('rgUGCNoBlur', JSON.stringify(g_UGCWithNoBlur), false);
    }

    function ApplyAdultContentPreferences() {
      LoadUGCWithNoBlur();

      var elementsWithAdultContent = $J('[data-descids]');
      if (elementsWithAdultContent.length == 0) {
        return;
      }

      for (var i = 0; i < elementsWithAdultContent.length; ++i) {
        var e = $J(elementsWithAdultContent[i]);
        ApplyAdultContentPreferencesHelper(e, g_ContentDescriptorPreferences, false);
      }
    }

    function ReapplyAdultContentPreferences() {
      var elementsWithAdultContent = $J('[data-descids]');
      if (elementsWithAdultContent.length == 0) {
        return;
      }

      for (var i = 0; i < elementsWithAdultContent.length; ++i) {
        var e = $J(elementsWithAdultContent[i]);
        ApplyAdultContentPreferencesHelper(e, g_ContentDescriptorPreferences, true);
      }
    }


    function EditContentDescriptors(publishedfileid, callback) {
      $J.get('https://steamcommunity.com/sharedfiles/ajaxeditcontentdescriptors/', { publishedfileid: publishedfileid })
        .done(function (json) {
          if (json.success == 1) {
            var content = $J(json.html);
            var dialog = ShowConfirmDialog('Update Content Descriptors', content);

            dialog.done(function () {
              var rgCheckboxes = $J("input:checkbox", content);

              var add = [];
              var remove = [];

              for (var i = 0; i < rgCheckboxes.length; ++i) {
                let checkbox = rgCheckboxes[i];
                if (checkbox.checked && !checkbox.disabled) {
                  add.push(checkbox.value);
                }
                else {
                  remove.push(checkbox.value);
                }
              }

              if (add.length == 0 && remove.length == 0)
                return;

              $J.post(
                'https://steamcommunity.com/sharedfiles/ajaxupdatecontentdescriptors/',
                { sessionid: g_sessionID, publishedfileid: publishedfileid, add: add, remove: remove },
              ).done(function (json) {
                if (json.success == 1) {
                  if (callback) {
                    callback(publishedfileid);
                  }
                  else {
                    window.location.reload();
                  }
                }
                else {
                  ShowAlertDialog('Update Content Descriptors', 'There was a problem updating the content descriptors for this item: ' + json.success);
                }
              });
            });
          }
        });
    }

    function HandleRelatedContentDescriptors($topContainer, $elem, bAnimate) {
      var checked = $elem.prop("checked") && !$elem.attr("disabled");
      var descid = $elem.val();
      var $container = $elem.closest('[data-parentdescid]');
      var parentDescID = $container.data('parentdescid');
      var childrenDescriptors = $topContainer.find('[data-parentdescid="' + descid + '"]');

      if (checked) {
        // check all ancestors
        if (parentDescID) {
          var $parentElem = $topContainer.find('#descriptor_' + parentDescID);
          $parentElem.prop('checked', true);
          HandleRelatedContentDescriptors($topContainer, $parentElem, bAnimate);
        }
      }
      else {
        childrenDescriptors.each(function () {
          var child = $J(this);
          child.find('input[type="checkbox"]').each(function () {
            $J(this).prop("checked", false);
            HandleRelatedContentDescriptors($topContainer, $J(this), bAnimate);
          });
        });
      }
    }

    // override where necessary
    function HandleNewDynamicLink(newDynamicLinkElement) {
      if (newDynamicLinkElement.hasClass("has_adult_content")) {
        ApplyAdultContentPreferencesHelper(newDynamicLinkElement, g_ContentDescriptorPreferences, false);
      }
    }

    function UGCAdultContentPreferencesMenu(elSource) {
      var $El = $J(this);
      var $elSource = $J(elSource.parentNode);
      $El.empty();

      var appid = $elSource.data('appid');
      var publishedFileID = $elSource.data('publishedfileid');

      // preferences
      {
        var fnViewPreferences = function () {
          top.location.href = 'https://store.steampowered.com//account/preferences/#CommunityContentPreferences';
          return true;
        };
        var $elViewPreferences = $J('<div/>').click(fnViewPreferences).text('Edit Preferences').addClass('option');
        $El.append($elViewPreferences);
      }
    }

    function ApplyAdultContentPreferencesHelper(e, rgContentDescriptorsToExclude, bForce) {
      if (!bForce && e.data('processed_adult_content')) {
        return;
      }

      if ((typeof (g_bViewingOwnProfile) != 'undefined') && g_bViewingOwnProfile) {
        e.removeClass('has_adult_content');
        return;
      }

      e.data('processed_adult_content', true);

      var bIsAnchor = e.is('a');

      var publishedFileID = e.data('publishedfileid');
      var bCountryDisallowed = e.data('adult-disallowed');
      var rgContentDescriptorIDs = e.data('descids') ?? [];
      var appid = e.data('appid');
      var bForceDeBlur = (publishedFileID && g_UGCWithNoBlur.hasOwnProperty(publishedFileID)) || (appid && g_UGCSkipAdultContentCheckForAppID == appid);

      var filteredArray = rgContentDescriptorIDs.filter(function (descid) { return rgContentDescriptorsToExclude.indexOf(descid) !== -1; });
      var bHasExcludedContent = filteredArray.length != 0;

      if (bForceDeBlur || !bHasExcludedContent) {
        e.removeClass('has_adult_content');
      }
      else if (bHasExcludedContent) {
        e.addClass('has_adult_content');
      }

      if (e.data('ugclinktextonly') === 1 || bCountryDisallowed) {

      }
      else {
        // widget
        {
          var $elMenu = $J('<div></div>', { 'class': 'ugc_options' }).append($J('<div>'));
          $elMenu.v_tooltip({
            'tooltipClass': 'ugc_options_tooltip',
            'location': 'bottom left',
            'offsetY': -20,
            'useClickEvent': true,
            'useMouseEnterEvent': false,
            'preventDefault': true,
            'stopPropagation': true,
            func: UGCAdultContentPreferencesMenu
          });
          e.append($elMenu);
        }

        // warning
        if (e.width() > 100 && !e.hasClass('ugc_show_warning_image') && !e.hasClass('dynamiclink_box')) {
          var $elWarning = $J('<div></div>', {
            'class': 'ugc_warning'
          });
          if (e.width() > 350) {
            $elWarning.addClass("large");
          }

          if (e.height() > 125) {
            e.addClass("ugc_show_warning_image");
          }
          else {
            $elWarning.append($J('<div>', { 'class': 'ugc_warning_image' }));
          }

          $elWarning.append($J('<span>', { 'text': 'Content may not be appropriate based on your preferences ' }));

          var $elOptions = $J('<div></div>');
          var $elViewOption = $J('<div></div>', {
            'class': 'ugc_inline_option',
            'text': 'View Content'
          });
          $elViewOption.click(function (event) {
            event.preventDefault();
            event.stopPropagation();
            if (bIsAnchor && !e.hasClass("modalContentLink")) {
              top.location.href = e[0].href;
            }
            else {
              e.removeClass('has_adult_content');
              e.click();
              e.addClass('has_adult_content');
            }
            return false;
          });
          $elOptions.append($elViewOption);
          $elOptions.append("&nbsp;|&nbsp;");
          var $elPreferencesOption = $J('<div></div>', {
            'class': 'ugc_inline_option',
            'text': 'Edit Preferences'
          });
          $elPreferencesOption.click(function (event) {
            event.stopPropagation();
            top.location.href = 'https://store.steampowered.com/account/preferences';
            return false;
          });
          $elOptions.append($elPreferencesOption);

          $elWarning.append($elOptions);

          e.append($elWarning);
        }
        else {
          e.addClass("ugc_show_warning_image");
        }
      }
    }





    function abuseSSDescripCheck() {
      var chkd_inap = $('abuseType1').checked;
      var chkd_cprt = $('abuseType5').checked;
      if (chkd_inap) {
        $('abuseDescriptionLabel').setStyle({ color: '#777777', fontStyle: 'italic' });
        $('abuseDescriptionArea').disable();
        $('abuseDescriptionArea').clear();
      }
      else if (chkd_cprt) {
        $('abuseDescriptionLabel').setStyle({ color: '#898989', fontStyle: 'normal' });
        $('abuseDescriptionArea').enable();
        $('abuseDescriptionArea').focus();
      }
    }






    function BindOnHashChange(fnCallback) {
      if ('onhashchange' in window) {
        Event.observe(window, 'hashchange', function (e) { fnCallback(this.location.hash); });
      }
      else {
        new LocationHashObserver(null, 0.1, function (el, hash) { fnCallback(hash); });
      }
    }

    LocationHashObserver = Class.create(Abstract.TimedObserver, {
      getValue: function () {
        return window.location.hash;
      }
    });


    var CAutoSizingTextArea = Class.create({
      m_elTextArea: null,
      m_nMinHeight: 20,
      m_nMaxHeight: 500,
      m_cCurrentSize: Number.MAX_VALUE,
      m_fnChangeCallback: null,
      m_nTextAreaPadding: null,

      initialize: function (elTextArea, nMinHeight, fnChangeCallback) {
        this.m_elTextArea = elTextArea;
        var _this = this;
        $J(this.m_elTextArea).on('keyup blur click paste cut', function (e) {
          if (e.type == 'paste' || e.type == 'blur')
            _this.OnPasteText();
          else
            _this.OnTextInput();
        });
        this.m_elTextArea.style.overflow = 'hidden';

        this.m_cEntryLength = Number.MAX_VALUE;
        this.m_nMinHeight = nMinHeight || 20;
        this.m_fnChangeCallback = fnChangeCallback || null;

        this.m_elTextArea.style.height = this.m_nMinHeight + 'px';

        this.OnTextInput();
      },

      CalculatePadding: function () {
        // briefly empty the text area and set the height so we can see how much padding there is
        var strContents = this.m_elTextArea.value;
        this.m_elTextArea.value = '';
        this.m_elTextArea.style.height = this.m_nMinHeight + 'px';
        this.m_nTextAreaPadding = this.m_elTextArea.scrollHeight - this.m_nMinHeight;
        this.m_elTextArea.value = strContents;
      },

      OnPasteText: function () {
        this.OnTextInput.bind(this).defer();
      },

      OnTextInput: function () {
        var iScrollOffset = undefined;
        var cNewLength = this.m_elTextArea.value.length;

        // we delay this until first input as some values get reported incorrectly if the element isn't visible.
        if (this.m_nTextAreaPadding === null && $J(this.m_elTextArea).is(':visible'))
          this.CalculatePadding();

        // force a resize
        if (cNewLength < this.m_cEntryLength) {
          // when we shrink this box, we might scroll the window.  Remember where we are so we can jump back
          iScrollOffset = window.scrollY;
          this.m_elTextArea.style.height = this.m_nMinHeight + 'px';
        }

        if (this.m_elTextArea.scrollHeight > this.m_nMaxHeight) {
          this.m_elTextArea.style.height = this.m_nMaxHeight + 'px';
          this.m_elTextArea.style.overflow = 'auto';
        }
        else if (this.m_elTextArea.scrollHeight != this.m_elTextArea.getHeight()) {
          var nHeight = Math.max(this.m_elTextArea.scrollHeight, this.m_nMinHeight);
          this.m_elTextArea.style.height = (nHeight - this.m_nTextAreaPadding) + 'px';

          if (this.m_elTextArea.style.overflow == 'auto')
            this.m_elTextArea.style.overflow = 'hidden';
        }

        if (this.m_fnChangeCallback)
          this.m_fnChangeCallback(this.m_elTextArea);

        if (iScrollOffset)
          window.scrollTo(window.scrollX, iScrollOffset);

        this.m_cEntryLength = cNewLength;
      }
    });





    function UpdateParameterInCurrentURL(strParamName, strParamValue, rgRemoveParameters) {
      var path = window.location.pathname;
      var query = window.location.search;
      var params = {};
      if (query && query.length > 2)
        params = $J.deparam(query.substr(1));

      if (strParamValue === null)
        delete params[strParamName];
      else
        params[strParamName] = strParamValue;

      // comment thread specific
      if (rgRemoveParameters)
        for (var i = 0; i < rgRemoveParameters.length; i++)
          delete params[rgRemoveParameters[i]];

      query = $J.param(params);

      return path + (query ? '?' + query : '');
    }


    var g_rgCommentThreads = {};
    function InitializeCommentThread(type, name, rgCommentData, url, nQuoteBoxHeight) {
      // see if we have a custom comment thread class for this type
      var commentclass = CCommentThread;
      if (window['CCommentThread' + type])
        commentclass = window['CCommentThread' + type];

      g_rgCommentThreads[name] = new commentclass(type, name, rgCommentData, url, nQuoteBoxHeight);
    }

    function BindCommentThreadSubscribeButtons(type, owner, gidfeature, gidfeature2, btnSubscribe, btnUnsubscribe) {
      var CommentThread = FindCommentThread(type, owner, gidfeature, gidfeature2);
      if (CommentThread)
        CommentThread.BindSubscribeButtons(btnSubscribe, btnUnsubscribe);
    }

    function FindCommentThread(type, owner, gidFeature, gidFeature2) {
      for (var key in g_rgCommentThreads) {
        if (g_rgCommentThreads[key].BMatches(type, owner, gidFeature, gidFeature2))
          return g_rgCommentThreads[key];
      }
      return null;
    }

    var CCommentThread = Class.create({

      m_strName: null,
      m_strCommentThreadType: null,
      m_rgCommentData: null,
      m_strActionURL: null,
      m_elTextArea: null,
      m_cPageSize: null,
      m_nQuoteBoxHeight: 40,

      m_cTotalCount: 0,
      m_iCurrentPage: 0,
      m_cMaxPages: 0,
      m_cDropdownPages: 0,
      m_bLoading: false,
      m_bLoadingUserHasUpVoted: false,
      m_cUpVotes: 0,

      m_bIncludeRaw: false,
      m_rgRawCommentCache: null,
      m_bHasPaging: true,
      m_bTrackNavigation: false,	// should we track navigation in the URL?

      // these vars are id's we'll update when values change
      m_votecountID: null,
      m_voteupID: null,
      m_commentcountID: null,

      m_oTextAreaSizer: null,

      m_bSubscribed: null,
      m_$SubscribeCheckbox: null,

      initialize: function (type, name, rgCommentData, url, nQuoteBoxHeight) {
        this.m_strName = name;
        this.m_strCommentThreadType = type;
        this.m_rgCommentData = rgCommentData;
        this.m_strActionURL = url;
        this.m_nQuoteBoxHeight = nQuoteBoxHeight;

        var start = rgCommentData['start'] ? rgCommentData['start'] : 0;

        this.m_cTotalCount = rgCommentData['total_count'];
        this.m_cPageSize = rgCommentData['pagesize'];
        this.m_iCurrentPage = Math.floor(start / this.m_cPageSize);
        this.m_cMaxPages = Math.ceil(this.m_cTotalCount / this.m_cPageSize);
        this.m_bLoadingUserHasUpVoted = rgCommentData['has_upvoted'];
        this.m_cUpVotes = rgCommentData['upvotes'];
        this.m_votecountID = rgCommentData['votecountid'];
        this.m_voteupID = rgCommentData['voteupid'];
        this.m_commentcountID = rgCommentData['commentcountid'];

        this.m_bSubscribed = rgCommentData['subscribed'];

        this.m_bHasPaging = !rgCommentData['no_paging'];
        this.m_bTrackNavigation = !!rgCommentData['track_navigation'];


        var strPrefix = 'commentthread_' + this.m_strName;
        this.m_elTextArea = $(strPrefix + '_textarea');

        if (rgCommentData['comments_raw']) {
          this.m_bIncludeRaw = true;
          this.m_rgRawCommentCache = rgCommentData['comments_raw'];
          rgCommentData['comments_raw'] = undefined;
        }

        if (this.m_elTextArea) {
          var elSaveButton = $('commentthread_' + this.m_strName + '_submit_container');
          var iMinHeight = this.m_nQuoteBoxHeight;
          if (this.m_strName.startsWith('Profile_'))
            iMinHeight = 20;

          this.m_oTextAreaSizer = new CAutoSizingTextArea(this.m_elTextArea, iMinHeight, this.OnTextInput.bind(this, elSaveButton));
        }

        var _this = this;

        if (this.m_bHasPaging) {
          $(strPrefix + '_pagebtn_prev').observe('click', this.OnPagingButtonClick.bindAsEventListener(this, this.PrevPage));
          $(strPrefix + '_fpagebtn_prev').observe('click', this.OnPagingButtonClick.bindAsEventListener(this, this.PrevPage));
          $(strPrefix + '_pagebtn_next').observe('click', this.OnPagingButtonClick.bindAsEventListener(this, this.NextPage));
          $(strPrefix + '_fpagebtn_next').observe('click', this.OnPagingButtonClick.bindAsEventListener(this, this.NextPage));

          if (this.m_bTrackNavigation && window.history && window.history.pushState) {
            window.history.replaceState({ comment_thread_page: this.m_iCurrentPage }, '');

            $J(window).on('popstate', function (e) {
              var oState = e.originalEvent.state;

              if (oState && typeof oState.comment_thread_page != 'undefined')
                _this.GoToPage(oState.comment_thread_page);
            });
          }
        }

        var elForm = $(strPrefix + '_form');
        if (elForm) {
          elForm.observe('submit', this.OnSubmit.bind(this));
        }

        var elSubmit = $(strPrefix + '_submit');
        if (elSubmit) {
          elSubmit.observe('click', this.OnSubmit.bind(this));
        }

        var elAutosubscribe = $(strPrefix + '_autosubscribe');
        if (elAutosubscribe) {
          // initialize check state based on preferences
          elAutosubscribe.checked = this.m_bSubscribed || GetValueLocalStorage('forum_autosubscribe', false);
          elAutosubscribe.observe('change', this.OnAutosubscribeToggle.bind(this));
        }

        var elSubscribe = $(strPrefix + '_subscribe');
        var elUnsubscribe = $(strPrefix + '_unsubscribe');
        if (elSubscribe && elUnsubscribe) {
          this.BindSubscribeButtons(elSubscribe, elUnsubscribe);
        }

        this.m_$SubscribeCheckbox = $J('#' + strPrefix + '_subscribe_checkbox');
        this.m_$SubscribeCheckbox.click(function () {
          if (_this.m_$SubscribeCheckbox.hasClass('waiting'))
            return;

          if (_this.m_bSubscribed)
            _this.Unsubscribe(function () { }, function () { ShowAlertDialog('Subscribe to thread', 'There was a problem updating your subscription.  Please try again later.'); });
          else
            _this.Subscribe(function () { }, function () { ShowAlertDialog('Subscribe to thread', 'There was a problem updating your subscription.  Please try again later.'); });
        });

        this.UpdatePagingDisplay();
        this.HighlightComment();
      },

      HighlightComment: function () {
        var urlParams = new URLSearchParams(window.location.search);
        var gidComment = urlParams.get('gidcommenthighlight');
        if (gidComment) {
          $J("#comment_" + gidComment).addClass('highlighted');
          setTimeout(function () { $J("#comment_" + gidComment)[0].scrollIntoView(); }, 500);
        }
      },

      BMatches: function (strType, steamidOwner, gidFeature, gidFeature2) {
        return this.m_strCommentThreadType == strType && this.m_rgCommentData['owner'] == steamidOwner &&
          this.m_rgCommentData['feature'] == gidFeature && this.m_rgCommentData['feature2'] == gidFeature2;
      },

      CheckTextAreaSize: function () {
        this.m_oTextAreaSizer.OnTextInput();
      },

      OnTextInput: function (elSaveButton, elTextArea) {
        if (elSaveButton) {
          var strPrepoulatedText = $J(this.m_elTextArea).data('prepopulated-text');
          var bEnteredText = elTextArea.value.length > 0;

          if (bEnteredText && strPrepoulatedText && !$J(this.m_elTextArea).data('replaced-prepopulated-text')) {
            strPrepoulatedText = v_trim(strPrepoulatedText).replace(/[\n\r]/g, '');
            var strEnteredText = v_trim(elTextArea.value).replace(/[\n\r]/g, '');

            bEnteredText = strPrepoulatedText != strEnteredText;

            // save so we don't have to keep doing this check as they enter more text.
            if (bEnteredText)
              $J(this.m_elTextArea).data('replaced-prepopulated-text', true);
          }

          if (bEnteredText)
            elSaveButton.show();
          else
            elSaveButton.hide();
        }
      },

      GetActionURL: function (action) {
        var url = this.m_strActionURL + action + '/';
        url += this.m_rgCommentData['owner'] + '/';
        url += this.m_rgCommentData['feature'] + '/';
        return url;
      },

      ParametersWithDefaults: function (params) {
        if (!params)
          params = {};

        params['count'] = this.m_cPageSize;
        params['sessionid'] = g_sessionID;

        if (this.m_rgCommentData['extended_data'])
          params['extended_data'] = this.m_rgCommentData['extended_data'];

        if (this.m_rgCommentData['feature2'])
          params['feature2'] = this.m_rgCommentData['feature2'];

        if (this.m_rgCommentData['oldestfirst'])
          params['oldestfirst'] = true;

        if (this.m_rgCommentData['newestfirstpagination'])
          params['newestfirstpagination'] = true;

        if (this.m_rgCommentData['lastvisit'])
          params['lastvisit'] = this.m_rgCommentData['lastvisit'];

        if (this.m_bIncludeRaw)
          params['include_raw'] = true;


        return params;
      },

      OnSubmit: function () {
        if (this.m_bLoading)
          return;

        var strPrepoulatedText = $J(this.m_elTextArea).data('prepopulated-text');
        if (strPrepoulatedText && v_trim(strPrepoulatedText).replace(/[\n\r]/g, '') == v_trim(this.m_elTextArea.value).replace(/[\n\r]/g, '')) {
          ShowAlertDialog('', 'Please enter a comment to post.');
          return;
        }

        var params = this.ParametersWithDefaults({
          comment: this.m_elTextArea.value
        });

        this.m_bLoading = true;
        new Ajax.Request(this.GetActionURL('post'), {
          method: 'post',
          parameters: params,
          onSuccess: this.OnResponseAddComment.bind(this, ++this.m_nRenderAjaxSequenceNumber),
          onFailure: this.OnFailureDisplayError.bind(this),
          onComplete: this.OnAJAXComplete.bind(this)
        });

        var elAutosubscribe = $('commentthread_' + this.m_strName + '_autosubscribe');
        if (elAutosubscribe && elAutosubscribe.checked && !this.m_bSubscribed)
          this.Subscribe();

        return false;
      },

      DeleteComment: function (gidComment, bUndelete, fnOnSuccess) {
        if (this.m_bLoading)
          return;

        var params = this.ParametersWithDefaults({
          gidcomment: gidComment,
          start: this.m_cPageSize * this.m_iCurrentPage
        });

        if (bUndelete)
          params.undelete = 1;

        this.m_bLoading = true;
        new Ajax.Request(this.GetActionURL('delete'), {
          method: 'post',
          parameters: params,
          onSuccess: fnOnSuccess ? fnOnSuccess : this.OnResponseDeleteComment.bind(this, ++this.m_nRenderAjaxSequenceNumber),
          onFailure: this.OnFailureDisplayError.bind(this),
          onComplete: this.OnAJAXComplete.bind(this)
        });
      },

      MarkSpam: function (gidComment, authorAccountID, fnOnSuccess) {
        if (this.m_bLoading)
          return;

        var params = this.ParametersWithDefaults({
          gidcomment: gidComment,
          author_accountid: authorAccountID,
          start: this.m_cPageSize * this.m_iCurrentPage
        });

        var thread = this;

        var dialog = ShowConfirmDialog('Mark Suspicious', 'This will give a community ban to the author, add this comment as training data so we can flag these kinds of comments automatically, and clear out all the author\'s comments.  Are you sure this is what you want to do?', 'Mark Suspicious');
        dialog.done(function () {
          thread.m_bLoading = true;
          new Ajax.Request(thread.GetActionURL('markspam'), {
            method: 'post',
            parameters: params,
            onSuccess: fnOnSuccess ? fnOnSuccess : thread.OnResponseDeleteComment.bind(thread, ++thread.m_nRenderAjaxSequenceNumber),
            onFailure: thread.OnFailureDisplayError.bind(thread),
            onComplete: thread.OnAJAXComplete.bind(thread)
          });
        });
      },

      ClearContentCheckFlag: function (gidComment, fnOnSuccess) {
        if (this.m_bLoading)
          return;

        var params = this.ParametersWithDefaults({
          gidcomment: gidComment,
          start: this.m_cPageSize * this.m_iCurrentPage
        });

        var thread = this;

        var dialog = ShowConfirmDialog('Clear Bannable Content Flag', 'This will clear the bannable content check flag on this comment and cannot be undone. Are you sure this is what you want to do?', 'Clear Bannable Content Flag');
        dialog.done(function () {
          thread.m_bLoading = true;
          new Ajax.Request(thread.GetActionURL('clearcontentcheckflag'), {
            method: 'post',
            parameters: params,
            onSuccess: fnOnSuccess ? fnOnSuccess : thread.OnResponseDeleteComment.bind(thread, ++thread.m_nRenderAjaxSequenceNumber),
            onFailure: thread.OnFailureDisplayError.bind(thread),
            onComplete: thread.OnAJAXComplete.bind(thread)
          });
        });
      },

      HideAndReport: function (gidComment, bHide, fnOnSuccess) {
        if (this.m_bLoading)
          return;

        var params = this.ParametersWithDefaults({
          gidcomment: gidComment,
          hide: bHide,
          start: this.m_cPageSize * this.m_iCurrentPage
        });

        this.m_bLoading = true;
        new Ajax.Request(this.GetActionURL('hideandreport'), {
          method: 'post',
          parameters: params,
          onSuccess: fnOnSuccess ? fnOnSuccess : this.OnResponseHideAndReportComment.bind(this, ++this.m_nRenderAjaxSequenceNumber),
          onFailure: this.OnFailureDisplayError.bind(this),
          onComplete: this.OnAJAXComplete.bind(this)
        });
      },

      OnResponseHideAndReportComment: function (nAjaxSequenceNumber, transport) {
        if (transport.responseJSON && transport.responseJSON.success)
          this.OnResponseRenderComments(CCommentThread.RENDER_GOTOCOMMENT, nAjaxSequenceNumber, transport);
        else
          this.OnFailureDisplayError(transport);
      },

      DisplayEditComment: function (gidComment) {
        var elForm = $('editcommentform_' + gidComment);
        var elTextarea = $('comment_edit_text_' + gidComment);

        var elContent = $('comment_content_' + gidComment);
        elContent.hide();

        if (elContent.next('.forum_audit'))
          elContent.next('.forum_audit').hide();

        $('comment_edit_' + gidComment).show();
        $('comment_edit_' + gidComment + '_error').update('');

        if (!elTextarea.value || elTextarea.value.length == 0)
          elTextarea.value = this.m_rgRawCommentCache[gidComment].text;

        if (!elForm.m_bEventsBound) {
          new CAutoSizingTextArea(elTextarea, 40);
          elForm.observe('submit', this.SubmitEditComment.bind(this, elForm));
          elForm.observe('reset', this.HideEditComment.bind(this, gidComment));
          elForm.m_bEventsBound = true;
        }
      },

      VoteUp: function () {
        if (this.m_bLoading)
          return;

        var params = this.ParametersWithDefaults({
          vote: this.m_bLoadingUserHasUpVoted ? 0 : 1	// flip our vote
        });

        this.m_bLoading = true;
        new Ajax.Request(this.GetActionURL('voteup'), {
          method: 'post',
          parameters: params,
          onSuccess: this.OnResponseVoteUp.bind(this, ++this.m_nRenderAjaxSequenceNumber),
          onFailure: this.OnFailureDisplayError.bind(this),
          onComplete: this.OnAJAXComplete.bind(this)
        });
      },

      UpdateAnswer: function (gidComment, bExisting) {
        // see if it's on the current page
        if (this.m_bLoading)
          return;

        if (!gidComment) {
          $modal = ShowConfirmDialog('Remove As Answer', 'Are you sure you want to unmark this post as the answer to this thread? You can update this at any time.', 'Remove As Answer');
        }
        else {
          var strModalBody = 'You are about to mark this post as the answer to this thread. This will indicate that the original post has been answered and link to this specific post. You can remove this or indicate a different post as the answer at any time if you change your mind.';
          if (bExisting)
            strModalBody = 'A different post is already selected as the answer to this thread. Would you like to choose this post as the new answer?';

          $modal = ShowConfirmDialog('Mark As Answer', strModalBody, 'Choose Answer');
          $modal.SetMaxWidth(500);
        }

        var _$this = this;

        $modal.done(function () {

          var params = _$this.ParametersWithDefaults({
            gidcommentanswer: gidComment
          });

          _$this.m_bLoading = true;
          new Ajax.Request(_$this.GetActionURL('updateanswer'), {
            method: 'post',
            parameters: params,
            onSuccess: function () {
              window.location.hash = 'c' + gidComment;
              window.location.reload();
            },
            onFailure: function (transport) {
              if (transport.responseJSON && transport.responseJSON.success) {
                var strError = 'There was an issue updating this topic answer. Error: ' + transport.responseJSON.success;
                if (transport.responseJSON.success == 15) {
                  strError = 'You do not have permission to update this topic\'s answer.'
                }

                ShowAlertDialog('Error', strError);
              }
            },
            onComplete: _$this.OnAJAXComplete.bind(_$this)
          });
        });

      },

      GetRawComment: function (gidComment) {
        return this.m_rgRawCommentCache[gidComment];
      },

      GetCommentTextEntryElement: function () {
        return this.m_elTextArea;
      },

      HideEditComment: function (gidComment) {
        $('comment_content_' + gidComment).show();
        $('comment_edit_' + gidComment).hide();
      },

      OnResponseEditComment: function (gidComment, nAjaxSequenceNumber, transport) {
        if (transport.responseJSON && transport.responseJSON.success) {
          // no need to hide because render will replace our whole element
          this.OnResponseRenderComments(CCommentThread.RENDER_DELETEDPOST, nAjaxSequenceNumber, transport);	//display the updated comment thread
        }
        else {
          this.OnEditFailureDisplayError(gidComment, transport);
        }
      },

      OnEditFailureDisplayError: function (gidComment, transport) {
        this.DisplayError($('comment_edit_' + gidComment + '_error'), transport);
      },

      SubmitEditComment: function (elForm) {
        if (this.m_bLoading)
          return false;

        var gidComment = elForm.elements['gidcomment'].value;
        var strComment = elForm.elements['comment'].value;

        var params = this.ParametersWithDefaults({
          gidcomment: gidComment,
          comment: strComment,
          start: this.m_cPageSize * this.m_iCurrentPage
        });

        this.m_bLoading = true;
        new Ajax.Request(this.GetActionURL('edit'), {
          method: 'post',
          parameters: params,
          onSuccess: this.OnResponseEditComment.bind(this, gidComment, ++this.m_nRenderAjaxSequenceNumber),
          onFailure: this.OnEditFailureDisplayError.bind(this, gidComment),
          onComplete: this.OnAJAXComplete.bind(this)
        });
        return false;
      },

      OnAJAXComplete: function () {
        this.m_bLoading = false;
      },

      OnPagingButtonClick: function (event, fnToExecute) {
        event.stop();
        fnToExecute.call(this);
      },

      NextPage: function () {
        if (this.m_iCurrentPage < this.m_cMaxPages - 1)
          this.GoToPage(this.m_iCurrentPage + 1);
      },

      PrevPage: function () {
        if (this.m_iCurrentPage > 0)
          this.GoToPage(this.m_iCurrentPage - 1);
      },

      m_nRenderAjaxSequenceNumber: 0,
      GoToPage: function (iPage, eRenderReason) {
        if (iPage >= this.m_cMaxPages || iPage < 0 || (iPage == this.m_iCurrentPage && !this.m_bLoading))
          return;

        var params = this.ParametersWithDefaults({
          start: this.m_cPageSize * iPage,
          totalcount: this.m_cTotalCount
        });

        this.m_bLoading = true;
        new Ajax.Request(this.GetActionURL('render'), {
          method: 'post',
          parameters: params,
          onSuccess: this.OnResponseRenderComments.bind(this, eRenderReason || CCommentThread.RENDER_GOTOPAGE, ++this.m_nRenderAjaxSequenceNumber),
          onComplete: this.OnAJAXComplete.bind(this)
        });
      },

      GoToPageWithComment: function (gidComment, eRenderReason) {
        // see if it's on the current page
        if (this.m_bLoading || $('comment_' + gidComment))
          return;

        // nope, load
        var params = this.ParametersWithDefaults({
          gidComment: gidComment
        });

        new Ajax.Request(this.GetActionURL('render'), {
          method: 'post',
          parameters: params,
          onSuccess: this.OnResponseRenderComments.bind(this, eRenderReason || CCommentThread.RENDER_GOTOCOMMENT, ++this.m_nRenderAjaxSequenceNumber),
          onComplete: this.OnAJAXComplete.bind(this)
        });
      },

      OnResponseAddComment: function (nAjaxSequenceNumber, transport) {
        if (transport.responseJSON && transport.responseJSON.success) {
          $('commentthread_' + this.m_strName + '_entry_error').hide();
          this.m_elTextArea.value = '';
          this.CheckTextAreaSize();
          this.OnResponseRenderComments(CCommentThread.RENDER_NEWPOST, nAjaxSequenceNumber, transport);	//display the updated comment thread

          if ($('commentthread_' + this.m_strName + '_subscribeoptions'))
            $('commentthread_' + this.m_strName + '_subscribeoptions').show();
        }
        else {
          this.OnFailureDisplayError(transport);
        }
      },

      OnResponseDeleteComment: function (nAjaxSequenceNumber, transport) {
        if (transport.responseJSON && transport.responseJSON.success)
          this.OnResponseRenderComments(CCommentThread.RENDER_DELETEDPOST, nAjaxSequenceNumber, transport);
        else
          this.OnFailureDisplayError(transport);
      },

      OnResponseVoteUp: function (nAjaxSequenceNumber, transport) {
        if (transport.responseJSON && transport.responseJSON.success) {
          this.OnResponseRenderComments(CCommentThread.RENDER_GOTOCOMMENT, nAjaxSequenceNumber, transport);
          this.m_bLoadingUserHasUpVoted = !this.m_bLoadingUserHasUpVoted;	// we can switch this to getting from the response after 8/24/2012
          this.m_cUpVotes = transport.responseJSON.upvotes;

          if (this.m_votecountID && $(this.m_votecountID) && transport.responseJSON.votetext) {
            $(this.m_votecountID).innerHTML = transport.responseJSON.votetext;
          }

          if (this.m_voteupID && $(this.m_voteupID)) {
            if (this.m_bLoadingUserHasUpVoted)
              $(this.m_voteupID).addClassName('active');
            else
              $(this.m_voteupID).removeClassName('active');
          }
        }
        else
          this.OnFailureDisplayError(transport);
      },

      OnFailureDisplayError: function (transport) {
        this.DisplayError($('commentthread_' + this.m_strName + '_entry_error'), transport);
      },

      DisplayError: function (elError, transport) {
        var strMessage = 'Sorry, some kind of error has occurred: ';
        if (transport.responseJSON && transport.responseJSON.error)
          strMessage += transport.responseJSON.error;
        else
          strMessage += 'There was an error communicating with the network. Please try again later.';

        elError.update(strMessage);
        elError.show();
      },

      OnResponseRenderComments: function (eRenderReason, nAjaxSequenceNumber, transport) {
        if (this.m_nRenderAjaxSequenceNumber != nAjaxSequenceNumber)
          return;

        if (transport.responseJSON) {
          var response = transport.responseJSON;
          this.m_cTotalCount = response.total_count;
          this.m_cMaxPages = Math.ceil(response.total_count / response.pagesize);
          this.m_iCurrentPage = Math.floor(response.start / response.pagesize);

          if (response.comments_raw)
            this.m_rgRawCommentCache = response.comments_raw;

          if (this.m_commentcountID && $(this.m_commentcountID))
            $(this.m_commentcountID).innerHTML = this.m_cTotalCount;

          if (this.m_cTotalCount <= response.start && this.m_iCurrentPage > 0) {
            // this page is no logner valid, flip back a page (deferred so that the AJAX handler exits and reset m_bLoading)
            this.GoToPage.bind(this, this.m_iCurrentPage - 1).defer();
            return;
          }

          if (this.m_bTrackNavigation && window.history && window.history.pushState) {
            var params = window.location.search.length ? $J.deparam(window.location.search.substr(1)) : {};
            if ((!params['ctp'] && this.m_iCurrentPage != 0) || (params['ctp'] && params['ctp'] != this.m_iCurrentPage + 1)) {
              var fnStateUpdate = window.history.pushState.bind(window.history);
              var url = UpdateParameterInCurrentURL('ctp', this.m_iCurrentPage == 0 ? null : this.m_iCurrentPage + 1, ['tscn']);
              if (eRenderReason == CCommentThread.RENDER_GOTOPAGE_HASHCHANGE || eRenderReason == CCommentThread.RENDER_GOTOCOMMENT_HASHCHANGE) {
                fnStateUpdate = window.history.replaceState.bind(window.history);
                if (eRenderReason == CCommentThread.RENDER_GOTOCOMMENT_HASHCHANGE)
                  url += window.location.hash;
              }
              fnStateUpdate({ comment_thread_page: this.m_iCurrentPage }, '', url);
            }
          }

          this.DoTransitionToNewPosts(response, eRenderReason);

          // if we're viewing the most recent page of comments, refresh notifications
          if ((!this.m_rgCommentData['oldestfirst'] && this.m_iCurrentPage == 0) ||
            this.m_rgCommentData['oldestfirst'] && (this.m_iCurrentPage + 1) * this.m_cPageSize > this.m_cTotalCount) {
            RefreshNotificationArea();
          }

          this.UpdatePagingDisplay();
        }
      },

      DoTransitionToNewPosts: function (response, eRenderReason) {
        var strNewHTML = response.comments_html;

        var elPosts = $('commentthread_' + this.m_strName + '_posts');
        var elContainer = $('commentthread_' + this.m_strName + '_postcontainer');
        elContainer.style.height = elContainer.getHeight() + 'px';
        elContainer.style.overflow = 'hidden';

        var bNewPost = (eRenderReason == CCommentThread.RENDER_NEWPOST);

        if (bNewPost && this.m_cTotalCount <= this.m_cPageSize && !this.m_rgCommentData['oldestfirst'] && !this.m_rgCommentData['newestfirstpagination']) {
          elContainer.style.position = 'relative';
          elPosts.style.position = 'absolute';
          elPosts.style.left = '0px';
          elPosts.style.right = '0px';
          elPosts.style.bottom = '0px';
        }
        else {
          elPosts.style.position = 'static';
        }

        elPosts.update(strNewHTML);

        ScrollToIfNotInView($('commentthread_' + this.m_strName + '_area'), 40, 20);

        if (elContainer.effect)
          elContainer.effect.cancel();

        (function () {
          elContainer.effect = new Effect.Morph(elContainer, { style: 'height: ' + elPosts.getHeight() + 'px', duration: 0.25, afterFinish: function () { elPosts.style.position = 'static'; elContainer.style.height = 'auto'; elContainer.style.overflow = ''; } });
        }).defer();
      },

      UpdatePagingDisplay: function () {
        if (!this.m_bHasPaging)
          return;

        var strPrefix = 'commentthread_' + this.m_strName;

        // this element not displayed on the forum topic page
        $(strPrefix + '_totalcount') && $(strPrefix + '_totalcount').update(v_numberformat(this.m_cTotalCount));

        var rgPagingControls = [strPrefix + '_page', strPrefix + '_fpage'];
        for (var i = 0; i < rgPagingControls.length; i++) {
          var strPagePrefix = rgPagingControls[i];

          // these elements are displayed on the forum topic page
          $(strPagePrefix + 'total') && $(strPagePrefix + 'total').update(v_numberformat(this.m_cTotalCount));
          $(strPagePrefix + 'start') && $(strPagePrefix + 'start').update(v_numberformat(this.m_iCurrentPage * this.m_cPageSize + 1));
          $(strPagePrefix + 'end') && $(strPagePrefix + 'end').update(Math.min((this.m_iCurrentPage + 1) * this.m_cPageSize, this.m_cTotalCount));

          if ($(strPagePrefix + 'ctn')) {
            if (this.m_cTotalCount > 0)
              $(strPagePrefix + 'ctn').show();
            else
              $(strPagePrefix + 'ctn').hide();
          }


          if (this.m_cMaxPages <= 1) {
            $(strPagePrefix + 'controls').hide();
          }
          else {
            $(strPagePrefix + 'controls').show();
            if (this.m_iCurrentPage > 0) {
              $(strPagePrefix + 'btn_prev').removeClassName('disabled');
              if (this.m_bTrackNavigation)
                $(strPagePrefix + 'btn_prev').href = UpdateParameterInCurrentURL('ctp', this.m_iCurrentPage == 1 ? null : this.m_iCurrentPage, ['tscn']);
            }
            else {
              $(strPagePrefix + 'btn_prev').addClassName('disabled');
              if (this.m_bTrackNavigation)
                $(strPagePrefix + 'btn_prev').href = 'javascript:void(0);';
            }

            if (this.m_iCurrentPage < this.m_cMaxPages - 1) {
              $(strPagePrefix + 'btn_next').removeClassName('disabled');
              if (this.m_bTrackNavigation)
                $(strPagePrefix + 'btn_next').href = UpdateParameterInCurrentURL('ctp', this.m_iCurrentPage + 2, ['tscn']);
            }
            else {
              $(strPagePrefix + 'btn_next').addClassName('disabled');
              if (this.m_bTrackNavigation)
                $(strPagePrefix + 'btn_next').href = 'javascript:void(0);';
            }

            var elPageLinks = $(strPagePrefix + 'links');
            elPageLinks.update('');
            // we always show first, last, + 3 page links closest to current page
            var cPageLinksAheadBehind = 2;
            var firstPageLink = Math.max(this.m_iCurrentPage - cPageLinksAheadBehind, 1);
            var lastPageLink = Math.min(this.m_iCurrentPage + (cPageLinksAheadBehind * 2) + (firstPageLink - this.m_iCurrentPage), this.m_cMaxPages - 2);

            if (lastPageLink - this.m_iCurrentPage < cPageLinksAheadBehind)
              firstPageLink = Math.max(this.m_iCurrentPage - (cPageLinksAheadBehind * 2) + (lastPageLink - this.m_iCurrentPage), 1);

            this.AddPageLink(elPageLinks, 0);
            if (firstPageLink != 1)
              elPageLinks.insert(' ... ');

            for (var iPage = firstPageLink; iPage <= lastPageLink; iPage++) {
              this.AddPageLink(elPageLinks, iPage);
            }

            if (lastPageLink != this.m_cMaxPages - 2)
              elPageLinks.insert(' ... ');
            this.AddPageLink(elPageLinks, this.m_cMaxPages - 1);
          }

          // update the dropdown list with the total.
          var $DropdownCtn = $J('#' + strPagePrefix + 'dropdown');
          var $Select = $DropdownCtn.children('select');

          if (true) {
            if (!$Select.length) {
              $Select = $J('<select/>');
              var _this = this;
              $Select.change(function () {
                var $Select = $J(this);
                _this.GoToPage($Select.val());
              });
              $DropdownCtn.append($Select);
            }

            $Select.empty();

            // we always show first, last, + 3 page links closest to current page
            var fnAddPageDropdown = function (iDropdownPage) {
              $Select.append($J('<option/>', { 'value': iDropdownPage }).text(iDropdownPage >= 999 ? v_numberformat(iDropdownPage + 1) : iDropdownPage + 1));
            };

            var cPageLinksAheadBehind = 10;
            var firstPageLink = Math.max(this.m_iCurrentPage - cPageLinksAheadBehind, 1);
            var lastPageLink = Math.min(this.m_iCurrentPage + (cPageLinksAheadBehind * 2) + (firstPageLink - this.m_iCurrentPage), this.m_cMaxPages - 2);

            if (lastPageLink - this.m_iCurrentPage < cPageLinksAheadBehind)
              firstPageLink = Math.max(this.m_iCurrentPage - (cPageLinksAheadBehind * 2) + (lastPageLink - this.m_iCurrentPage), 1);

            fnAddPageDropdown(0);
            if (firstPageLink != 1)
              $Select.append($J('<option/>', { 'value': '', 'disabled': 1 }).text('...'));

            for (var iPage = firstPageLink; iPage <= lastPageLink; iPage++) {
              fnAddPageDropdown(iPage);
            }

            if (lastPageLink != this.m_cMaxPages - 2)
              $Select.append($J('<option/>', { 'value': '', 'disabled': 1 }).text('...'));
            fnAddPageDropdown(this.m_cMaxPages - 1);
          }

          $Select.val(this.m_iCurrentPage);
        }

        this.m_cDropdownPages = this.m_cMaxPages;
      },

      AddPageLink: function (elPageLinks, iPage) {
        var el;
        if (this.m_bTrackNavigation)
          el = new Element('a', { 'class': 'commentthread_pagelink', 'href': UpdateParameterInCurrentURL('ctp', iPage + 1, ['tscn']) });
        else
          el = new Element('span', { 'class': 'commentthread_pagelink' });

        el.update((iPage + 1));

        var fnGoToPage = this.GoToPage.bind(this, iPage);

        if (iPage == this.m_iCurrentPage)
          el.addClassName('active');
        else
          el.observe('click', function (e) { e.stop(); fnGoToPage(); });

        elPageLinks.insert(el);
        elPageLinks.insert(' ');
      },

      Subscribe: function (fnOnSuccess, fnOnFail) {
        var params = this.ParametersWithDefaults();
        this.m_$SubscribeCheckbox.addClass('waiting');

        var _this = this;
        $J.post(this.GetActionURL('subscribe'), params)
          .done(function () {
            _this.OnSubscriptionChange(true, fnOnSuccess);
          })
          .fail(fnOnFail)
          .always(function () { _this.m_$SubscribeCheckbox.removeClass('waiting') });
      },

      Unsubscribe: function (fnOnSuccess, fnOnFail) {
        var params = this.ParametersWithDefaults();
        this.m_$SubscribeCheckbox.addClass('waiting');

        var _this = this;
        $J.post(this.GetActionURL('unsubscribe'), params)
          .done(function () {
            _this.OnSubscriptionChange(false, fnOnSuccess);
          })
          .fail(fnOnFail)
          .always(function () { _this.m_$SubscribeCheckbox.removeClass('waiting') });
      },

      m_rgSubscriptionUpdateHandlers: null,

      BindSubscribeButtons: function (elBtnSubscribe, elBtnUnsubscribe) {
        var _this = this;

        if (!this.m_rgSubscriptionUpdateHandlers)
          this.m_rgSubscriptionUpdateHandlers = [];

        this.m_rgSubscriptionUpdateHandlers.push(function () {
          if (_this.m_bSubscribed) {
            $J(elBtnSubscribe).hide();
            $J(elBtnUnsubscribe).show();
          }
          else {
            $J(elBtnSubscribe).show();
            $J(elBtnUnsubscribe).hide();
          }
        });

        $J(elBtnSubscribe).click(function () {
          _this.Subscribe(function () {
            ShowAlertDialog('Subscribe to thread', 'You\'ll receive a comment notification whenever someone replies to this thread.');
          }, function () {
            ShowAlertDialog('Subscribe to thread', 'There was a problem updating your subscription.  Please try again later.');
          });
        });

        $J(elBtnUnsubscribe).click(function () {
          _this.Unsubscribe(function () {
            ShowAlertDialog('Unsubscribe from thread', 'You\'ll no longer receive comment notifications from this thread.');
          }, function () {
            ShowAlertDialog('Unsubscribe from thread', 'There was a problem updating your subscription.  Please try again later.');
          });
        });

        this.UpdateSubscriptionDisplay();
      },

      OnSubscriptionChange: function (bSubscribed, fnProxy, transport) {
        this.m_bSubscribed = bSubscribed;

        if (fnProxy)
          fnProxy(transport);

        this.UpdateSubscriptionDisplay();
      },

      UpdateSubscriptionDisplay: function () {
        if (this.m_rgSubscriptionUpdateHandlers && this.m_rgSubscriptionUpdateHandlers.length) {
          for (var i = 0; i < this.m_rgSubscriptionUpdateHandlers.length; i++)
            (this.m_rgSubscriptionUpdateHandlers[i])();
        }

        if (this.m_bSubscribed)
          this.m_$SubscribeCheckbox.addClass('checked');
        else
          this.m_$SubscribeCheckbox.removeClass('checked');

        var elForumSubscribe = $('forum_subscribe_' + this.m_rgCommentData['feature2']);
        var elForumUnsubscribe = $('forum_unsubscribe_' + this.m_rgCommentData['feature2']);
        if (elForumSubscribe && elForumUnsubscribe) {
          if (this.m_bSubscribed) {
            elForumSubscribe.hide();
            elForumUnsubscribe.show();
          }
          else {
            elForumSubscribe.show();
            elForumUnsubscribe.hide();
          }
        }
      },

      OnAutosubscribeToggle: function () {
        var elAutosubscribe = $('commentthread_' + this.m_strName + '_autosubscribe');
        if (elAutosubscribe) {
          if (elAutosubscribe.checked)
            SetValueLocalStorage('forum_autosubscribe', true);
          else
            UnsetValueLocalStorage('forum_autosubscribe');
        }
      }

    });
    CCommentThread.RENDER_NEWPOST = 1;
    CCommentThread.RENDER_GOTOPAGE = 2;
    CCommentThread.RENDER_GOTOCOMMENT = 3;
    CCommentThread.RENDER_DELETEDPOST = 4;
    CCommentThread.RENDER_GOTOPAGE_HASHCHANGE = 5;
    CCommentThread.RENDER_GOTOCOMMENT_HASHCHANGE = 6;

    // static accessor
    CCommentThread.DeleteComment = function (id, gidcomment) {
      if (g_rgCommentThreads[id])
        g_rgCommentThreads[id].DeleteComment(gidcomment);
    };
    CCommentThread.UnDeleteComment = function (id, gidcomment) {
      if (g_rgCommentThreads[id])
        g_rgCommentThreads[id].DeleteComment(gidcomment, true);
    };
    CCommentThread.MarkSpam = function (id, gidcomment, authorAccountID) {
      if (g_rgCommentThreads[id])
        g_rgCommentThreads[id].MarkSpam(gidcomment, authorAccountID);
    };
    CCommentThread.ClearContentCheckFlag = function (id, gidcomment) {
      if (g_rgCommentThreads[id])
        g_rgCommentThreads[id].ClearContentCheckFlag(gidcomment);
    };
    // static accessor
    CCommentThread.EditComment = function (id, gidcomment) {
      if (g_rgCommentThreads[id])
        g_rgCommentThreads[id].DisplayEditComment(gidcomment);
    };
    // static accessor
    CCommentThread.VoteUp = function (id) {
      if (g_rgCommentThreads[id])
        g_rgCommentThreads[id].VoteUp();
    };
    // static accessor
    CCommentThread.UpdateAnswer = function (id, gidcomment, bExisting) {
      if (g_rgCommentThreads[id])
        g_rgCommentThreads[id].UpdateAnswer(gidcomment, bExisting);
    };
    CCommentThread.FormattingHelpPopup = function (strCommentThreadType) {
      $J.get('https://steamcommunity.com/comment/' + strCommentThreadType + '/formattinghelp', { ajax: 1 }).done(function (data) {
        ShowAlertDialog('Text Formatting', data);
      });
    };
    CCommentThread.ShowDeletedComment = function (id, gidcomment) {
      var elComment = $('comment_' + gidcomment);
      var elDeletedComment = $('deleted_comment_' + gidcomment);
      elComment.show();
      elDeletedComment.hide();
    };
    CCommentThread.HideAndReport = function (id, gidcomment, bHide) {
      if (g_rgCommentThreads[id])
        g_rgCommentThreads[id].HideAndReport(gidcomment, bHide);
    };
    CCommentThread.ShowHiddenComment = function (id, gidcomment) {
      var elComment = $('comment_' + gidcomment);
      var elHiddenComment = $('hidden_comment_' + gidcomment);
      elComment.show();
      elHiddenComment.hide();
    };


    function levenshtein(a, b) {
      var alen = a.length;
      var blen = b.length;
      if (alen === 0) return blen;
      if (blen === 0) return alen;
      var tmp, i, j, prev, val, row, ma, mb, mc, md, bprev;

      if (alen > blen) {
        tmp = a;
        a = b;
        b = tmp;
      }

      row = new Int8Array(alen + 1);
      // init the row
      for (i = 0; i <= alen; i++) {
        row[i] = i;
      }

      // fill in the rest
      for (i = 1; i <= blen; i++) {
        prev = i;
        bprev = b[i - 1]
        for (j = 1; j <= alen; j++) {
          if (bprev === a[j - 1]) {
            val = row[j - 1];
          } else {
            ma = prev + 1;
            mb = row[j] + 1;
            mc = ma - ((ma - mb) & ((mb - ma) >> 7));
            md = row[j - 1] + 1;
            val = mc - ((mc - md) & ((md - mc) >> 7));
          }
          row[j - 1] = prev;
          prev = val;
        }
        row[alen] = prev;
      }
      return row[alen];
    };


    CGameSelector = Class.create({
      bHaveSuggestions: false,
      elInput: null,
      elSuggestionsCtn: null,
      elSuggestions: null,
      fnOnClick: null,

      elFocus: null,
      nAppIDFocus: 0,

      initialize: function (elInput, elSuggestionsCtn, elSuggestions, fnOnClick) {
        this.elInput = elInput;
        this.elSuggestionsCtn = elSuggestionsCtn;
        this.elSuggestions = elSuggestions;

        if (!this.elSuggestions && !this.elSuggestionsCtn) {
          // build them
          this.elSuggestions = new Element('div', { 'class': 'shadow_content popup_body popup_menu' });
          this.elSuggestionsCtn = new Element('div', { 'class': 'popup_block', style: 'display: none; z-index: 1200;' });
          this.elSuggestionsCtn.update('<div class="shadow_ul"></div><div class="shadow_top"></div><div class="shadow_ur"></div><div class="shadow_left"></div><div class="shadow_right"></div><div class="shadow_bl"></div><div class="shadow_bottom"></div><div class="shadow_br"></div>');
          this.elSuggestionsCtn.insert({ bottom: this.elSuggestions });
          $(document.body).appendChild(this.elSuggestionsCtn);
        }

        this.fnOnClick = function (Selector, rgAppData) { Selector.HideSuggestions(); fnOnClick(Selector, rgAppData); };

        new Form.Element.Observer(elInput, 0.2, this.OnGameSelectTextEntry.bind(this));
        elInput.observe('blur', this.HideSuggestions.bind(this));
        elInput.observe('focus', this.ShowSuggestions.bind(this));
        elInput.observe('keydown', this.OnGameSelectKeyDown.bindAsEventListener(this, elInput));
      },

      ShowSuggestions: function () {
        if (!this.elSuggestionsCtn.visible() && this.bHaveSuggestions) {
          AlignMenu(this.elInput, this.elSuggestionsCtn, 'left', 'bottom', true);
          ShowWithFade(this.elSuggestionsCtn);
        }
      },

      HideSuggestions: function () {
        HideWithFade(this.elSuggestionsCtn);
      },

      OnGameSelectTextEntry: function (elInput, value) {
        if (value) {
          new Ajax.Request('https://steamcommunity.com/actions/SearchApps/' + encodeURIComponent(value), {
            method: 'get',
            onSuccess: this.ReceiveGameSelectResponse.bind(this, value)
          });
        }
        else {
          this.elSuggestions.update('');
          this.bHaveSuggestions = false;
        }
      },

      OnGameSelectKeyDown: function (event, elem) {
        if (event.keyCode == Event.KEY_ESC) {
          this.HideSuggestions();
        }
        else if (this.bHaveSuggestions) {
          var elNewSuggestion = null;

          if (event.keyCode == Event.KEY_RETURN) {
            if (this.elFocus) {
              this.elFocus.fnOnSelect();
              event.stop();
            }
          }
          else if (event.keyCode == Event.KEY_UP) {
            if (this.elFocus)
              elNewSuggestion = this.elFocus.previous();
            if (!elNewSuggestion)
              elNewSuggestion = this.elSuggestions.select(":last-child")[0];
          }
          else if (event.keyCode == Event.KEY_DOWN) {
            if (this.elFocus)
              elNewSuggestion = this.elFocus.next();
            if (!elNewSuggestion)
              elNewSuggestion = this.elSuggestions.childElements()[0];
          }

          if (elNewSuggestion)
            this.SetFocus(elNewSuggestion);
        }
      },

      ReceiveGameSelectResponse: function (value, transport) {
        if (this.elInput.value == value) {

          var json = transport.responseJSON;
          this.UpdateListWithOptions(json);

        }
      },

      UpdateListWithOptions: function (rgOptions) {
        this.elSuggestions.update('');
        this.elFocus = null;
        if (rgOptions && rgOptions.length) {
          for (var i = 0; i < rgOptions.length; i++) {
            var elSuggestion = new Element('div', { 'class': 'game_suggestion popup_menu_item' });
            $J(elSuggestion).text(rgOptions[i].name);

            elSuggestion.appid = rgOptions[i].appid;
            elSuggestion.fnOnSelect = this.fnOnClick.bind(null, this, rgOptions[i]);
            elSuggestion.observe('click', elSuggestion.fnOnSelect);
            elSuggestion.observe('mouseover', this.SetFocus.bind(this, elSuggestion));

            this.elSuggestions.insert({ bottom: elSuggestion });

            if (this.nAppIDFocus == elSuggestion.appid)
              this.SetFocus(elSuggestion);
          }
          this.bHaveSuggestions = true;
          this.ShowSuggestions();
        }
        else {
          this.bHaveSuggestions = false;
          this.HideSuggestions();
        }
      },


      SetFocus: function (elSuggestion) {
        if (this.elFocus)
          this.elFocus.removeClassName('focus');

        this.elFocus = elSuggestion;
        this.nAppIDFocus = elSuggestion.appid;
        elSuggestion.addClassName('focus');
      }


    });

    CGameSelectorWorkshopGames = Class.create(CGameSelector, {
      OnGameSelectTextEntry: function (elInput, value) {
        if (value) {
          new Ajax.Request('https://steamcommunity.com/workshop/ajaxfindworkshops/?searchText=' + encodeURIComponent(value), {
            method: 'get',
            onSuccess: this.ReceiveGameSelectResponse.bind(this, value)
          });
        }
        else {
          this.elSuggestions.update('');
          this.bHaveSuggestions = false;
        }
      }
    });

    CGameSelectorOwnedGames = Class.create(CGameSelector, {

      m_bOwnedGamesReady: false,

      initialize: function ($super, elInput, elSuggestionsCtn, elSuggestions, fnOnClick) {
        $super(elInput, elSuggestionsCtn, elSuggestions, fnOnClick);
        CGameSelectorOwnedGames.LoadOwnedGames(this.OnOwnedGamesReady.bind(this));
      },

      OnOwnedGamesReady: function () {
        this.m_bOwnedGamesReady = true;
        this.OnGameSelectTextEntry(this.elInput, this.elInput.value);
      },

      OnGameSelectTextEntry: function (elInput, value) {
        if (value) {
          if (!this.m_bOwnedGamesReady) {
            this.elSuggestions.update('<div style="text-align: center; width: 200px; padding: 5px 0;"><img src="https://community.cloudflare.steamstatic.com/public/images/login/throbber.gif"></div>');
            this.bHaveSuggestions = true;
            this.ShowSuggestions();
          }
          else {
            var strSearchString = value.toLocaleLowerCase();
            var rgTerms = strSearchString.split(' ');
            var rgRegex = [];
            for (var iTerm = 0; iTerm < rgTerms.length; iTerm++) {
              var term = V_EscapeRegExp(rgTerms[iTerm], 'i');
              rgRegex.push(new RegExp(term));
            }
            var rgMatchingGames = [];
            for (var i = 0; i < CGameSelectorOwnedGames.s_rgOwnedGames.length; i++) {
              var game = CGameSelectorOwnedGames.s_rgOwnedGames[i];
              if (!game.name || !game.name_normalized)
                continue;

              var bMatch = true;
              for (var iRegex = 0; iRegex < rgRegex.length; iRegex++) {
                var regex = rgRegex[iRegex];
                if (!game.name_normalized.match(regex) && !game.name.match(regex)) {
                  bMatch = false;
                  break;
                }
              }
              if (bMatch) {
                game.levenshtein = levenshtein(game.name.toLocaleLowerCase(), strSearchString);
                rgMatchingGames.push(game);
              }
            }

            rgMatchingGames.sort(function (a, b) {
              if (a.levenshtein == b.levenshtein) {
                return a.name.localeCompare(b.name);
              }
              return a.levenshtein - b.levenshtein;
            });

            rgMatchingGames = rgMatchingGames.slice(0, 10);

            this.UpdateListWithOptions(rgMatchingGames);
          }
        }
        else {
          this.elSuggestions.update('');
          this.bHaveSuggestions = false;
        }
      }

    });

    CGameSelectorOwnedGames.s_rgOwnedGames = null;
    CGameSelectorOwnedGames.s_bLoadInFlight = false;
    CGameSelectorOwnedGames.s_rgOwnedGamesReadyCallbacks = [];
    CGameSelectorOwnedGames.s_rgParams = {};
    CGameSelectorOwnedGames.AreOwnedGamesLoaded = function () {
      return CGameSelectorOwnedGames.s_rgOwnedGames != null;
    };
    CGameSelectorOwnedGames.NormalizeGameNames = function (rgOwnedGames) {
      var regexNormalize = new RegExp(/[\s.-:!?,']+/g);
      for (var i = 0; i < rgOwnedGames.length; i++) {
        var game = rgOwnedGames[i];
        game.name_normalized = game.name.replace(regexNormalize, '').toLowerCase();
      }
    };
    CGameSelectorOwnedGames.LoadOwnedGames = function (fnCallback) {
      if (!CGameSelectorOwnedGames.AreOwnedGamesLoaded()) {
        CGameSelectorOwnedGames.s_rgOwnedGamesReadyCallbacks.push(fnCallback);

        if (CGameSelectorOwnedGames.s_bLoadInFlight)
          return;

        CGameSelectorOwnedGames.s_bLoadInFlight = true;
        var rgParams = CGameSelectorOwnedGames.s_rgParams;
        rgParams['sessionid'] = g_sessionID;

        new Ajax.Request('https://steamcommunity.com/actions/GetOwnedApps/', {
          method: 'get',
          parameters: rgParams,
          onSuccess: function (transport) {
            CGameSelectorOwnedGames.s_rgOwnedGames = transport.responseJSON || [];

            CGameSelectorOwnedGames.NormalizeGameNames(CGameSelectorOwnedGames.s_rgOwnedGames);
          },
          onFailure: function () {
            CGameSelectorOwnedGames.s_rgOwnedGames = [];
          },
          onComplete: function () {
            for (var i = 0; i < CGameSelectorOwnedGames.s_rgOwnedGamesReadyCallbacks.length; i++) {
              CGameSelectorOwnedGames.s_rgOwnedGamesReadyCallbacks[i]();
            }
          }
        });
      }
      else {
        // data is already ready
        fnCallback();
      }
    };

    CGameSelectorProfileShowcaseGames = Class.create(CGameSelectorOwnedGames, {
      initialize: function ($super, elInput, elSuggestionsCtn, elSuggestions, fnOnClick, rgFilteredGames) {
        CGameSelectorOwnedGames.s_rgParams['for_showcase'] = 1;
        if (rgFilteredGames) {
          CGameSelectorOwnedGames.s_rgOwnedGames = rgFilteredGames;
          CGameSelectorOwnedGames.NormalizeGameNames(CGameSelectorOwnedGames.s_rgOwnedGames);
        }
        $super(elInput, elSuggestionsCtn, elSuggestions, fnOnClick);
      },
    });

    function TargetIsChild(event, selector) {
      var evt = event || window.event;
      var reltarget = evt.relatedTarget || evt.toElement;
      if (!reltarget || !$(reltarget).up(selector))
        return false;
      return true;
    }

    function addEvent(el, ev, fn, useCapture) {
      if (el.addEventListener) {
        el.addEventListener(ev, fn, useCapture);
      }
      else if (el.attachEvent) {
        var ret = el.attachEvent("on" + ev, fn);
        return ret;
      }
      else {
        el["on" + ev] = fn;
      }
    }

    function createQuery2(postUrl, returnFn, postData) {
      var uid = Math.round(Math.random() * 100000);
      var rUid = "requester" + uid;
      eval(rUid + " = new xHttpQuery_Post();");
      eval(rUid + ".postUrl = postUrl;");
      eval(rUid + ".returnFn = returnFn;");
      eval(rUid + ".postData = postData;");
      eval(rUid + ".selfRef = \"" + rUid + "\";");
      eval(rUid + ".doRequest();");
    }

    var updateInProgress = false;
    function xHttpQuery_Post() {
      this.postUrl = '';
      this.selfRef = '';
      this.postData = '';
      this.dataEncoded = false;
      this.returnFn = false;
      this.doRequest = function () {
        if (updateInProgress == true) {
          setTimeout(this.selfRef + ".doRequest()", 200);
          return;
        }
        if (this.dataEncoded == false) {
          var pairs = [];
          var regexp = /%20/g;
          for (var name in this.postData) {
            var value = this.postData[name].toString();
            var pair = encodeURIComponent(name).replace(regexp, '+') + '=' + encodeURIComponent(value).replace(regexp, '+');
            pairs.push(pair);
          }
          this.postData = pairs.join('&');
          this.dataEncoded = true;
        }
        updateInProgress = true;
        // req is intentionally a global.  The contract for this function is that the callers look at the "req" global in their callback to see results.
        if (window.XMLHttpRequest) {
          req = new XMLHttpRequest();
        }
        else if (window.ActiveXObject) {
          req = new ActiveXObject("Microsoft.XMLHTTP");
        }
        if (req) {
          req.open("POST", this.postUrl, true);
          req.onreadystatechange = this.returnFn;
          req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
          req.setRequestHeader("Content-Length", this.postData.length);
          req.send(this.postData);
        }
      }
    }

    function winDim(wh, vs) {
      if (window.innerWidth) // most browsers - ff, safari, etc
      {
        return (wh == 'w' ? (vs == 'v' ? window.innerWidth : window.pageXOffset) : (vs == 'v' ? window.innerHeight : window.pageYOffset));
      }
      else if (document.documentElement && document.documentElement.clientWidth) // ie strict
      {
        return (wh == 'w' ? (vs == 'v' ? document.documentElement.clientWidth : document.documentElement.scrollLeft) : (vs == 'v' ? document.documentElement.clientHeight : document.documentElement.scrollTop));
      }
      else // ie normal
      {
        return (wh == 'w' ? (vs == 'v' ? document.body.clientWidth : document.body.scrollLeft) : (vs == 'v' ? document.body.clientHeight : document.body.scrollTop));
      }
    }

    function getGoodElement(el, nn, cn, next) {
      if (next == 1) {
        el = el.parentNode;
      }
      while (el.nodeName && el.nodeName.toLowerCase() != nn && el.nodeName.toLowerCase() != "body") {
        el = el.parentNode;
      }
      var thisClass = ' ' + el.className + ' ';
      if (el.nodeName && el.nodeName.toLowerCase() != "body" && thisClass.indexOf(' ' + cn + ' ') == -1) {
        return getGoodElement(el, nn, cn, 1);
      }
      else if (thisClass.indexOf(' ' + cn + ' ') != -1) {
        return el;
      }
      return false;
    }
    function addGameActions() {
      if (!document.getElementsByTagName) {
        return;
      }
      var pageDivs = document.getElementsByTagName("div");
      for (var x = 0; x < pageDivs.length; x++) {
        var tempClassName = " " + pageDivs[x].className + " ";
        var tempParentClassName = " " + pageDivs[x].parentNode.className + " ";
        if (tempClassName.indexOf(" gameContainer ") != -1 || tempParentClassName.indexOf(" gameContainer ") != -1) {
          addEvent(pageDivs[x], "mouseover", listItem_hilite, false);
          addEvent(pageDivs[x], "mouseout", listItem_lolite, false);
          addEvent(pageDivs[x], "click", listItem_toggle, false);
        }
      }
    }

    function getPopPos(e, pw, ph, offset) {
      var w = winDim('w', 'v');
      var h = winDim('h', 'v');
      var sl = winDim('w', 's');
      var st = winDim('h', 's');
      // mouse x/y within viewport
      var vmX = e.clientX;
      var vmY = e.clientY;
      // mouse x/y within document
      var smX = vmX + sl;
      var smY = vmY + st;
      var l = (pw > vmX) ? (smX + offset) : (smX - pw - offset);
      var t = (ph > vmY) ? (smY + offset) : (smY - ph - offset);
      var popTL = new Array(t, l);
      return popTL;
    }

    var keepTooltip = false;
    function tooltipCreate(tipEl, e) {
      var ttEl = document.getElementById('tooltip');
      if (ttEl) {
        ttEl.parentNode.removeChild(ttEl);
      }
      ttEl = document.createElement('div');
      ttEl.id = 'tooltip';
      ttEl.style.position = 'absolute';
      ttEl.appendChild(tipEl);
      document.getElementsByTagName('body')[0].appendChild(ttEl);
      var tipTL = getPopPos(e, ttEl.clientWidth, ttEl.clientHeight, 6);
      ttEl.style.top = tipTL[0] + 'px';
      ttEl.style.left = tipTL[1] + 'px';
    }

    function tooltipDestroy(go) {
      if (go != 1) {
        setTimeout("tooltipDestroy(1)", 10);
      }
      else {
        var ttEl = document.getElementById('tooltip');
        if (ttEl) {
          ttEl.parentNode.removeChild(ttEl);
        }
      }
    }

    function getElement(elementId) {
      var elem;
      if (document.getElementById) // standard compliant method
        elem = document.getElementById(elementId);
      else if (document.all) // old msie versions
        elem = document.all[elementId];
      else
        elem = false;

      return elem;
    }

    function setImage(elementId, strImage) {
      var imageElem = getElement(elementId);
      if (!imageElem)
        return;

      imageElem.src = strImage;
    }

    function iSwapFullURL(imgID, newImg) {
      var newImgPath = newImg;
      setImage(imgID, newImgPath);
    }

    function iSwap(imgID, newImg) {
      var newImgPath = "https://community.cloudflare.steamstatic.com/public/images/" + newImg;
      setImage(imgID, newImgPath);
    }


    function ListenToIFrameMessage(callbackFunc) {
      // Respond to a posted message from our sub-frame
      var eventMethodAlias = (window.addEventListener) ? "addEventListener" : "attachEvent";
      var eventMethod = window[eventMethodAlias];
      var messageEvent = (eventMethod === "attachEvent") ? "onmessage" : "message";

      eventMethod(messageEvent, callbackFunc, false);
    }

    var gSharePopup = null;
    var gShareRequestURL = null;
    function ShowSharePublishedFilePopup(publishedFileID, appID) {
      gShareRequestURL = "https://steamcommunity.com/sharedfiles/shareonsteam/?id=" + publishedFileID + '&appid=' + appID;

      var shareURL = "https://steamcommunity.com/sharedfiles/filedetails/?id=" + publishedFileID;
      var baseSocialShareURL = "https://steamcommunity.com/sharedfiles/share/?id=" + publishedFileID;
      ShowSharePopup(shareURL, baseSocialShareURL);
    }

    function ShowShareNewsPostPopup(gid, appid) {
      gShareRequestURL = "https://steamcommunity.com/news/shareonsteam/" + gid + "?appid=" + appid;

      var baseSocialShareURL = "https://steamcommunity.com/news/sharepost/" + gid;
      var shareURL = "https://steamcommunity.com/news/post/" + gid;
      ShowSharePopup(shareURL, baseSocialShareURL);
    }

    function ShowShareClanAnnouncementPopup(groupId, gid) {
      gShareRequestURL = "https://steamcommunity.com/gid/" + groupId + "/announcements/shareonsteam/" + gid;

      var baseSocialShareURL = "https://steamcommunity.com/gid/" + groupId + "/announcements/share/" + gid;
      var shareURL = "https://steamcommunity.com/gid/" + groupId + "/announcements/detail/" + gid;
      ShowSharePopup(shareURL, baseSocialShareURL);
    }

    function ShowSharePopup(url, baseSocialShareURL) {
      var appendQueryParam = baseSocialShareURL.indexOf("?") != -1 ? '&' : '?';

      $("SharePopupLink_Facebook").href = baseSocialShareURL + appendQueryParam + "site=facebook&t=" + Math.random();
      $("SharePopupLink_Twitter").href = baseSocialShareURL + appendQueryParam + "site=twitter";
      $("SharePopupLink_Reddit").href = baseSocialShareURL + appendQueryParam + "site=reddit";

      $("SharePopupInput").value = url;

      gSharePopup = ShowDialog('Share', $('SharePopup'));
      gSharePopup.SetRemoveContentOnDismissal(false);
      $('SharePopup').show();
    }

    var gShareOnSteamDialog = null;
    function ShareOnSteam() {
      gSharePopup.Dismiss();
      gSharePopup = null;

      $('ShareOnSteamDialogContents').hide();
      new Ajax.Updater("ShareOnSteamDialogContents", gShareRequestURL, { evalScripts: true, onLoaded: function () { ShowWithFade($('ShareOnSteamDialogContents')); } });
      $('ShareOnSteamDialog').show();

      var deferred = new jQuery.Deferred();
      var fnCancel = function () { CloseShareOnSteamDialog(); deferred.resolve(); };

      gShareOnSteamDialog = _BuildDialog('Share', $('ShareOnSteamDialog'), [], fnCancel, null);
      deferred.always(function () { gShareOnSteamDialog.Dismiss(); });
      gShareOnSteamDialog.Show();

      // attach the deferred's events to the modal
      deferred.promise(gShareOnSteamDialog);

      gShareOnSteamDialog.SetRemoveContentOnDismissal(false);
    }


    function CloseShareOnSteamDialog() {
      gShareOnSteamDialog.Dismiss();
    }

    function ShareContentToUserStatus(text, urlToShare, appID, posturl) {
      text += '\n\n' + urlToShare;
      new Ajax.Request(posturl, {
        insertion: Insertion.Bottom,
        method: 'post',
        parameters: { sessionid: g_sessionID, status_text: text, appid: appID },
        onSuccess: function (transport) {
          CloseShareOnSteamDialog();
          ShowAlertDialog('Share', 'The status update has been posted to your Friends Activity.');
        },
        onFailure: function (transport) {
          ShowAlertDialog('Share', 'There was a problem sharing the status update.  Please try again later.');
        }
      });
    }






  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script>

    Steam = {
      sm_bInitialized: false,
      sm_bUserInClient: false,
      sm_bUserInGameOverlay: false,
      sm_bUserInTenfootBrowser: false,
      sm_bUserInMobileChat: false,
      sm_bUserInMobileApp: false,

      BIsUserInSteamClient: function () {
        if (!Steam.sm_bInitialized)
          Steam.Init();

        return Steam.sm_bUserInClient;
      },

      BIsUserInGameOverlay: function () {
        if (!Steam.sm_bInitialized)
          Steam.Init();

        return Steam.sm_bUserInGameOverlay
      },

      BIsUserInSteamTenfootBrowser: function () {
        if (!Steam.sm_bInitialized)
          Steam.Init();

        return Steam.sm_bUserInTenfootBrowser;
      },

      BIsUserInClientOrOverlay: function () {
        if (!Steam.sm_bInitialized)
          Steam.Init();

        return Steam.sm_bUserInClient || Steam.sm_bUserInGameOverlay;
      },

      BIsUserInSteamMobileChat: function () {
        if (!Steam.sm_bInitialized)
          Steam.Init();

        return Steam.sm_bUserInMobileChat;
      },

      BIsUserInSteamMobileApp: function () {
        if (!Steam.sm_bInitialized)
          Steam.Init();

        return Steam.sm_bUserInMobileApp;
      },

      GetClientPackageVersion: function () {
        if (!Steam.BIsUserInClientOrOverlay())
          return 0;

        if (typeof navigator != 'undefined' && navigator.userAgent) {
          var matches = navigator.userAgent.match(/Valve Steam [^\/]*\/([0-9]*)/);
          if (matches && matches.length == 2)
            return matches[1];
        }

        return 0;
      },

      Init: function () {
        var fnCheckAgent = function (strUAMatch, strURLParam) {
          if (window.location.href.match('[?&]' + strURLParam + '='))
            return true;

          if (typeof navigator != 'undefined' && navigator.userAgent && navigator.userAgent.indexOf(strUAMatch) != -1)
            return true;

          return false;
        };

        Steam.sm_bUserInTenfootBrowser = fnCheckAgent('Valve Steam Tenfoot', 'force_tenfoot_client_view');
        Steam.sm_bUserInGameOverlay = fnCheckAgent('Valve Steam GameOverlay', 'force_overlay_view');
        Steam.sm_bUserInClient = Steam.sm_bUserInTenfootBrowser || fnCheckAgent('Valve Steam Client', 'force_client_view');
        Steam.sm_bUserInMobileChat = fnCheckAgent('Valve Steam Mobile Chat', 'force_mobile_chat_view');
        Steam.sm_bUserInMobileApp = fnCheckAgent('Valve Steam App', 'force_mobile_app_view');

        Steam.sm_bInitialized = true;
      },

      LinkInNewWindow: function ($A) {
        if (Steam.BIsUserInSteamClient() && !Steam.BIsUserInSteamTenfootBrowser())
          $A.attr('href', 'steam://openurl_external/' + $A.attr('href'));
        else
          $A.attr('target', '_blank');
      }
    };

    function OpenFriendChat(steamid, accountid) {
      if (Steam.BIsUserInClientOrOverlay()) {
        window.location = 'steam://friends/message/' + steamid;
      }
      else if (Steam.BIsUserInSteamMobileChat()) {
        window.location = 'steamchatmobile://friend/' + steamid;
      }
      else if (Steam.BIsUserInSteamMobileApp()) {
        window.location = 'https://steamcommunity.com/chat/friend/' + steamid;
      }
      else if (typeof ClientConnectionAPI !== 'undefined') {
        ClientConnectionAPI.OpenFriendChatDialog(steamid).then(function (result) {
          if (!result.success) {
            PromptContinueToWebChat(result, function () {
              OpenFriendChatInWebChat(steamid, accountid);
            }, 'steam://friends/message/' + steamid);
          }
        });
      }
      else {
        OpenFriendChatInWebChat(steamid, accountid);
      }
    }

    function OpenFriendChatInWebChat(steamid, accountid) {
      LaunchWebChat({ friend: accountid }, { command: 'ShowFriendChatDialog', steamid: steamid });
    }

    function OpenGroupChat(steamid) {
      if (Steam.BIsUserInSteamMobileChat()) {
        window.location = 'steamchatmobile://group/' + steamid;
      }
      else if (Steam.BIsUserInSteamMobileApp()) {
        window.location = 'https://steamcommunity.com/chat/group/' + steamid;
      }
      else if (!Steam.BIsUserInClientOrOverlay() && typeof ClientConnectionAPI !== 'undefined') {
        ClientConnectionAPI.OpenFriendChatDialog(steamid).then(function (result) {
          if (!result.success) {
            PromptContinueToWebChat(result, function () {
              LaunchWebChat(null, { command: 'ShowFriendChatDialog', steamid: steamid });
            }, 'steam://friends/joinchat/' + steamid);
          }
        });
      }
      else {
        window.location = 'steam://friends/joinchat/' + steamid;
      }
    }

    function PromptContinueToWebChat(result, fnLaunchWebchat, steamURL) {
      ShowConfirmDialog('Got Steam?', 'We couldn\'t find Steam running on your machine.  Would you like to launch web chat?',
        'Use web chat', null, 'Get Steam').done(function (choice) {
          if (choice == 'OK')
            fnLaunchWebchat();
          else
            window.location = 'https://store.steampowered.com/about/'
        });
    }


    // proto functions used to accept an id or an element.
    // This can be used to migrate them to returning jquery instead of proto-wrapped element
    function $JFromIDOrElement(elem) {
      if (elem instanceof jQuery)
        return elem;
      else if (typeof elem == 'string')
        return $J('#' + elem.replace(/\./, '\\.'));
      else
        return $J(elem);
    }

    /**	Show a popup dialog like confirm(), with two buttons.  Clicking ok resolves with done(), cancel or closing the window resolves with fail()
     *
     * @param strTitle			Title bar text
     * @param strDescription	Message text
     * @param strOKButton		Text to show on OK button (default "OK")
     * @param strCancelButton	Text to show on Cancel button (default "Cancel")
     * @param strSecondaryActionButton	Add a secondary ok button (three buttons total).  Resolves with done() like OK but passes 'SECONDARY' as argument to handler
     * @returns CModal
     */
    function ShowConfirmDialog(strTitle, strDescription, strOKButton, strCancelButton, strSecondaryActionButton, rgModalParams) {
      if (!strOKButton)
        strOKButton = 'OK';
      if (!strCancelButton)
        strCancelButton = 'Cancel';

      var deferred = new jQuery.Deferred();
      var fnOK = function () { deferred.resolve('OK'); };
      var fnSecondary = function () { deferred.resolve('SECONDARY'); };
      var fnCancel = function (bWasCancelButton) { deferred.reject(bWasCancelButton); };

      var rgButtons = [];

      var $OKButton = _BuildDialogButton(strOKButton, true);
      $OKButton.click(fnOK);
      rgButtons.push($OKButton);

      if (strSecondaryActionButton) {
        var $SecondaryActionButton = _BuildDialogButton(strSecondaryActionButton, false, { strClassName: ' btn_darkblue_white_innerfade btn_medium' });
        $SecondaryActionButton.click(fnSecondary);
        rgButtons.push($SecondaryActionButton);
      }

      var $CancelButton = _BuildDialogButton(strCancelButton);
      $CancelButton.click(function () { fnCancel(true); });
      rgButtons.push($CancelButton);

      var Modal = _BuildDialog(strTitle, strDescription, rgButtons, fnCancel, rgModalParams);
      Modal.Show();

      _BindOnEnterKeyPressForDialog(Modal, deferred, fnOK);

      deferred.always(function () { Modal.Dismiss(); });
      // attach the deferred's events to the modal
      deferred.promise(Modal);

      return Modal;
    }

    /**	Show a dialog with a single button, like alert().  Button click or closing the modal resolve deferred with done().
     *
     * @param strTitle			Title bar text
     * @param strDescription	Message text
     * @param strOKButton		Text on the OK button ("OK" by default)
     * @returns CModal
     */
    function ShowAlertDialog(strTitle, strDescription, strOKButton, rgModalParams) {
      if (!strOKButton)
        strOKButton = 'OK';

      var deferred = new jQuery.Deferred();
      var fnOK = function (bWasCancelButton) { deferred.resolve(bWasCancelButton); };

      var $OKButton = _BuildDialogButton(strOKButton);
      $OKButton.click(function () { fnOK(true); });

      var Modal = _BuildDialog(strTitle, strDescription, [$OKButton], fnOK, rgModalParams);
      deferred.always(function () { Modal.Dismiss(); });
      Modal.Show();

      _BindOnEnterKeyPressForDialog(Modal, deferred, fnOK);

      // attach the deferred's events to the modal
      deferred.promise(Modal);

      return Modal;

    }

    /**	Show a popup dialog.  Has no buttons.  Closing the dialog resolves deferred with done().
     *
     * @param strTitle			Title bar text
     * @param strDescription	Message text
     * @param rgModalParams		See CModal
     * @returns CModal
     */
    function ShowDialog(strTitle, strDescription, rgModalParams) {
      var deferred = new jQuery.Deferred();
      var fnOK = function () { deferred.resolve(); };

      var Modal = _BuildDialog(strTitle, strDescription, [], fnOK, rgModalParams);
      deferred.always(function () { Modal.Dismiss(); });
      Modal.Show();

      // attach the deferred's events to the modal
      deferred.promise(Modal);

      return Modal;
    }

    /**
     * Show a dialog, but take the arguments as an object a la React.
     * @returns CModal
     */
    function ShowPromptDialogWithProps(rgParams) {
      let { strOKButton, strCancelButton, strTitle, strDescription, defaultValue, inputType, inputMaxSize, bNoPromiseDismiss } = rgParams;
      if (!strOKButton)
        strOKButton = 'OK';
      if (!strCancelButton)
        strCancelButton = 'Cancel';
      if (!inputType)
        inputType = 'text';

      var $Body = $J('<form/>');
      var $Input = $J('<input/>', { type: inputType, 'class': '' }).val(defaultValue);
      if (inputMaxSize) {
        $Input.attr('maxlength', inputMaxSize);
      }
      $Body.append($J('<div/>', { 'class': 'newmodal_prompt_description' }).append(strDescription));
      $Body.append($J('<div/>', { 'class': 'newmodal_prompt_input gray_bevel for_text_input fullwidth' }).append($Input));

      var deferred = new jQuery.Deferred();
      var fnOK = function () { deferred.resolve($Input.val()); };
      var fnCancel = function () { deferred.reject(); };

      $Body.submit(function (event) { event.preventDefault(); fnOK(); });

      var elButtonLabel = $J('<span/>').text(strOKButton);
      var $OKButton = $J('<button/>', { type: 'submit', 'class': 'btn_green_white_innerfade btn_medium' }).append(elButtonLabel);
      $OKButton.click(fnOK);
      var $CancelButton = _BuildDialogButton(strCancelButton);
      $CancelButton.click(fnCancel);

      var Modal = _BuildDialog(strTitle, $Body, [$OKButton, $CancelButton], fnCancel);
      if (!bNoPromiseDismiss)
        deferred.always(function () { Modal.Dismiss(); });

      Modal.Show();

      $Input.focus();

      // attach the deferred's events to the modal
      deferred.promise(Modal);

      return Modal;
    }

    /**
     * A wrapper around ShowDialogPrompt to be compatible with existing code. Prefer ShowPromptDialogWithProps instead.
     * @returns CModal
     */
    function ShowPromptDialog(strTitle, strDescription, strOKButton, strCancelButton, rgModalParams, defaultValue) {
      let rgParams = {};
      if (rgModalParams)
        Object.assign(rgParams, rgModalParams);
      rgParams.strTitle = strTitle;
      rgParams.strDescription = strDescription;
      rgParams.strOKButton = strOKButton;
      rgParams.strCancelButton = strCancelButton;
      rgParams.defaultValue = defaultValue;
      return ShowPromptDialogWithProps(rgParams);
    }

    /**
     * @returns CModal
     */
    function ShowPromptWithTextAreaDialog(strTitle, strInitialText, strOKButton, strCancelButton, textAreaMaxLength, strDescription) {
      if (!strOKButton)
        strOKButton = 'OK';
      if (!strCancelButton)
        strCancelButton = 'Cancel';

      var $Body = $J('<form/>');
      var $TextArea = $J('<textarea/>', { 'class': 'newmodal_prompt_textarea' });
      $TextArea.text(strInitialText);
      if (textAreaMaxLength) {
        $TextArea.attr('maxlength', textAreaMaxLength);
        $TextArea.bind("keyup change",
          function () {
            var str = $J(this).val();
            var mx = parseInt($J(this).attr('maxlength'));
            if (str.length > mx) {
              $J(this).val(str.substr(0, mx));
              return false;
            }
          }
        );
      }

      if (strDescription) {
        $Body.append($J('<div/>', { 'class': 'newmodal_prompt_with_textarea newmodal_prompt_description' }).text(strDescription));
      }

      $Body.append($J('<div/>', { 'class': 'newmodal_prompt_with_textarea gray_bevel fullwidth' }).append($TextArea));

      var deferred = new jQuery.Deferred();
      var fnOK = function () { deferred.resolve($TextArea.val()); };
      var fnCancel = function () { deferred.reject(); };

      $Body.submit(function (event) { event.preventDefault(); fnOK(); });

      var elButtonLabel = $J('<span/>').text(strOKButton);
      var $OKButton = $J('<button/>', { type: 'submit', 'class': 'btn_green_white_innerfade btn_medium' }).append(elButtonLabel);
      $OKButton.click(fnOK);
      var $CancelButton = _BuildDialogButton(strCancelButton);
      $CancelButton.click(fnCancel);

      var Modal = _BuildDialog(strTitle, $Body, [$OKButton, $CancelButton], fnCancel);
      deferred.always(function () { Modal.Dismiss(); });
      Modal.Show();

      $TextArea.focus();

      // attach the deferred's events to the modal
      deferred.promise(Modal);

      return Modal;
    }

    /**
     * @returns CModal
     */
    function ShowEditablePrompt(strTitle, obj, onOk, onCancel) {
      strEditButton = 'Edit';
      strOKButton = 'OK';
      strCancelButton = 'Cancel';

      var $Body = $J('<form/>');
      var $TextArea = $J('<textarea/>', { 'class': 'newmodal_prompt_textarea', 'id': 'json_window' });
      $TextArea[0].readOnly = true;
      $TextArea.text(JSON.stringify(obj, null, 2));
      $Body.append($J('<div/>', { 'class': 'newmodal_prompt_with_textarea gray_bevel fullwidth ' }).append($TextArea));

      $Body.submit(function (event) { event.preventDefault(); fnOK(); });

      var elButtonLabel = $J('<span/>').text(strOKButton);
      var deferredAction = new jQuery.Deferred();

      var editButtonLabel = $J('<span/>').text(strEditButton);
      var $EditButton = $J('<button/>', { type: 'button', 'class': 'btn_darkred_white_innerfade btn_medium' }).append(editButtonLabel);
      $EditButton.click(function () {
        $EditButton[0].disable();
        $OKButton[0].enable();
        $TextArea[0].readOnly = false;
        $TextArea.focus();
      })

      var $OKButton = $J('<button/>', { type: 'submit', 'class': 'btn_green_white_innerfade btn_medium' }).append(elButtonLabel);
      $OKButton.click(function () { deferredAction.resolve($TextArea.val()); });
      $OKButton[0].disabled = true;

      fnCancel = function () { deferredAction.reject(); };
      var $CancelButton = _BuildDialogButton(strCancelButton);
      $CancelButton.click(fnCancel);

      var Modal = _BuildDialog(strTitle, $Body, [$EditButton, $OKButton, $CancelButton], fnCancel);
      deferredAction.always(function () { Modal.Dismiss(); });

      if (onOk)
        deferredAction.done(onOk);
      if (onCancel)
        deferredAction.fail(onCancel);

      Modal.Show();

      $TextArea.focus();

      // attach the deferred's events to the modal
      deferredAction.promise(Modal);

      return Modal;
    }

    /**
     * @returns CModal
     */
    function ShowBlockingWaitDialog(strTitle, strDescription) {
      var deferred = new jQuery.Deferred();
      var fnOK = function () { deferred.resolve(); };

      var container = $J('<div/>', { 'class': 'waiting_dialog_container' });
      var throbber = $J('<div/>', { 'class': 'waiting_dialog_throbber' });
      container.append(throbber);
      container.append(strDescription);
      if (!strDescription) {
        container.addClass('waiting_dialog_centered');
      }

      var Modal = _BuildDialog(strTitle, container, [], fnOK, { bExplicitDismissalOnly: true });
      deferred.always(function () { Modal.Dismiss(); });
      Modal.Show();

      // attach the deferred's events to the modal
      deferred.promise(Modal);

      return Modal;
    }

    function _BindOnEnterKeyPressForDialog(Modal, deferred, fnOnEnter) {
      var fnOnKeyUp = function (event) {
        if (Modal.BIsActiveModal() && !event.isDefaultPrevented() && event.which == 13 && (!event.target || event.target.nodeName != 'TEXTAREA'))
          fnOnEnter();
      };
      $J(document).on('keyup.SharedConfirmDialog', fnOnKeyUp);
      deferred.always(function () { $J(document).off('keyup.SharedConfirmDialog'); });
    }

    /**
     * @returns CModal
     * @private
     */
    function _BuildDialog(strTitle, strDescription, rgButtons, fnOnCancel, rgModalParams) {
      var $Dialog = $J('<div/>', { 'class': 'newmodal' });
      var $CloseButton = $J('<div/>', { 'class': 'newmodal_close', 'data-panel': '{"focusable":true,"clickOnActivate":true}' });
      var $Header = ($J('<div/>', { 'class': 'newmodal_header' }));
      var $TopBar = ($J('<div/>', { 'class': 'modal_top_bar' }));
      if (strTitle)
        $Header.append($CloseButton).append($J('<div/>', { 'class': 'title_text' }).text(strTitle));
      if (rgModalParams && rgModalParams.strSubTitle) {
        var $SubTitle = (rgModalParams.strSubTitle);
        $Header.append($J('<div/>', { 'class': 'subtitle_text' }).text($SubTitle))
      }
      $Header = $J('<div/>', { 'class': 'newmodal_header_border' }).append($Header);
      $Dialog.append($TopBar).append($Header);
      var $Content = $J('<div/>', { 'class': 'newmodal_content' });
      $Content.append($J('<div/>').append(strDescription));

      if (rgButtons.length > 0) {
        var $Buttons = $J('<div/>', { 'class': 'newmodal_buttons', 'data-panel': '{"flow-children":"row"}' });
        $Content.append($Buttons);
        for (var i = 0; i < rgButtons.length; i++) {
          var $Button = rgButtons[i];
          if (i == 0)
            $Button.attr('data-panel', '{"autoFocus":true,"focusable":true,"clickOnActivate":true}');
          else
            $Button.attr('data-panel', '{"focusable":true,"clickOnActivate":true}');
          $Buttons.append($Button);
        }
      }

      $Dialog.append($J('<div/>', { 'class': 'newmodal_content_border' }).append($Content));

      if (rgModalParams && rgModalParams.bExplicitDismissalOnly)
        $CloseButton.hide();

      var Modal = new CModal($Dialog, rgModalParams);
      if (fnOnCancel) {
        Modal.OnDismiss(fnOnCancel);
        $CloseButton.click(function () { Modal.Dismiss(); });
      }

      // on responsive pages, the 'newmodal' element covers the whole viewable area (so that we can control scrolling
      // if the modal is very tall).  If the modal doesn't cover the whole area, we dismiss on clicks to this background
      //	area
      if (Modal.m_fnBackgroundClick) {
        $Dialog.click(function (e) { if (e.target == this) Modal.m_fnBackgroundClick(); });
      }

      Modal.SetRemoveContentOnDismissal(true);

      return Modal;
    }

    function _BuildDialogButton(strText, bActive, rgOptions) {
      if (!rgOptions)
        rgOptions = {};

      var strClassName = bActive ? 'btn_green_steamui btn_medium' : 'btn_grey_steamui btn_medium';
      if (rgOptions.strClassName)
        strClassName = rgOptions.strClassName;

      var elButtonLabel = $J('<span/>').html(strText);
      var elButton = $J('<div/>', { 'class': strClassName }).append(elButtonLabel);
      return elButton;
    }

    /**	Implemented for Gamepad: show content in a fullscreen, borderless, modal which gets navigation support.
     *  Used on the app details page to show screenshots in full screen.
     *  Closing the dialog resolves deferred with done().
     *
     * @returns CModal
     */
    function GPShowFullScreenModal(content) {
      var deferred = new jQuery.Deferred();
      var fnOK = function () { deferred.resolve(); };

      var Modal = _BuilGPFullScreenModal(content, fnOK);
      deferred.always(function () { Modal.Dismiss(); });
      Modal.Show();

      // attach the deferred's events to the modal
      deferred.promise(Modal);

      return Modal;
    }

    function _BuilGPFullScreenModal(content, fnOnCancel) {
      var $Dialog = $J('<div/>').append($J('<div/>', { 'style': 'display:flex' }).append(content));
      var Modal = new CModal($Dialog);

      Modal.SetRemoveContentOnDismissal(true);
      if (fnOnCancel) {
        Modal.OnDismiss(fnOnCancel);
      }

      return Modal;
    }

    /* modal params:
      bExplicitDismissalOnly - by default, clicking outside of the modal dismisses it.  Set this to true to override that behavior
      bIgnoreResizeEvents - don't resize the modal when the window resizes
     */

    function CModal($Content, rgParams) {
      rgParams = rgParams || {};

      this.m_$Content = $Content;
      this.m_bVisible = false;

      this.m_bIgnoreResizeEvents = rgParams.bIgnoreResizeEvents;
      this.m_fnSizing = null;
      this.m_fnBackgroundClick = null;
      this.m_fnOnResize = null;
      this.m_bDismissOnBackgroundClick = !rgParams.bExplicitDismissalOnly;
      this.m_nMaxWidth = rgParams.nMaxWidth || 0;
      this.m_nMaxHeight = rgParams.nMaxHeight || 0;

      this.m_fnOnDismiss = null;
      this.m_fnGPOnCloseModal = null;
      this.m_bRemoveContentOnDismissal = false;

      this.m_nInitialOffsetTop = $J(window).scrollTop();
      this.m_nInitialOffsetLeft = $J(window).scrollLeft();
      this.m_$Content.css('position', 'fixed');
      this.m_$Content.css('z-index', 1000);

      /* default gamepad behavior is B button closes the dialog */
      if (!this.m_$Content.attr('panel'))
        this.m_$Content.attr('data-panel', '{"onCancelButton":"CModal.DismissActiveModal()"}');

      this.m_$StandardContent = null;
      this.m_$SizedContent = null;
      this.OnContentChanged();	//this will look for StandardContent and SizedContent in the modal body


      var _modal = this;
      this.m_fnBackgroundClick = function () { if (_modal.BIsActiveModal() && _modal.m_bDismissOnBackgroundClick) { _modal.Dismiss(); } };
      this.m_fnOnEscapeKeyPress = function (event) { if (_modal.BIsActiveModal() && event.which == 27) _modal.m_fnBackgroundClick(); };
      this.m_fnSizing = function () { _modal.AdjustSizing(); };

      /* make sure the content is parented correctly */
      $J(document.body).append(this.m_$Content);
    }

    CModal.prototype.OnDismiss = function (fn) {
      this.m_fnOnDismiss = fn;
    };

    CModal.prototype.OnResize = function (fn) {
      this.m_fnOnResize = fn;
    };

    /**
     * @returns jQuery
     */
    CModal.prototype.GetContent = function () {
      return this.m_$Content;
    };

    CModal.prototype.GetBoundOnResizeEvent = function () {
      // in case someone outside needs to tell the modal to resize on certain events (eg images or iframes loading in the modal)
      return this.m_fnSizing;
    };

    CModal.prototype.OnContentChanged = function () {
      // make sure we're holding the right elements
      this.m_$StandardContent = this.m_$Content.find('.newmodal_content');
      if (!this.m_$StandardContent.length)
        this.m_$StandardContent = this.m_$Content;
      this.m_$SizedContent = this.m_$Content.find('.newmodal_sized_content');
    };

    CModal.prototype.SetRemoveContentOnDismissal = function (bRemoveContent) {
      this.m_bRemoveContentOnDismissal = bRemoveContent;
    };

    CModal.prototype.SetDismissOnBackgroundClick = function (bDismissOnBackgroundClick) {
      this.m_bDismissOnBackgroundClick = bDismissOnBackgroundClick;
    };

    CModal.prototype.SetMaxWidth = function (nMaxWidth) {
      this.m_nMaxWidth = nMaxWidth;
      if (this.m_bVisible)
        this.AdjustSizing();
    };

    CModal.prototype.SetMaxHeight = function (nMaxHeight) {
      this.m_nMaxHeight = nMaxHeight;
      if (this.m_bVisible)
        this.AdjustSizing();
    };

    CModal.prototype.AdjustSizing = function (duration) {
      if (!this.m_$Content)
        return;

      var bResponsiveScreen = window.UseTouchFriendlyMode && UseTouchFriendlyMode();
      var bUseTabletScreenMode = window.UseTabletScreenMode && window.UseTabletScreenMode();

      var nViewportWidth = document.compatMode === 'BackCompat' ? document.body.clientWidth : $J(window).width();
      var nViewportHeight = document.compatMode === 'BackCompat' ? document.body.clientHeight : $J(window).height();

      var nMaxWidth = Math.max(nViewportWidth - (bResponsiveScreen ? 24 : 80), bResponsiveScreen ? 200 : 500);
      var nMaxHeight = Math.floor(nViewportHeight - 120);

      if (this.m_nMaxWidth && nMaxWidth > this.m_nMaxWidth) {
        nMaxWidth = this.m_nMaxWidth;
      }

      if (this.m_nMaxHeight && nMaxHeight > this.m_nMaxHeight) {
        nMaxHeight = this.m_nMaxHeight;
      }

      // if the modal has a 'newmodal_sized_content' div, it wants to be the max height, so set it now
      //	before we compute height	( "- 18" is a fudge for a possible horizontal scrollbar )
      this.m_$SizedContent.css('min-height', (nMaxHeight - 18) + 'px');
      if (this.m_fnOnResize) {
        this.m_fnOnResize(nMaxWidth - 40, nMaxHeight);
      }

      if (!duration) {
        // set sizes right away so we can calculate a good left and top
        this.m_$Content.css('max-width', nMaxWidth + 'px');
        if (!bResponsiveScreen) {
          this.m_$StandardContent.css('max-height', nMaxHeight + 'px');
        }
        else {
          this.m_$StandardContent.css('max-height', '');
        }
      }

      var nContentWidth = this.m_$Content.width();
      var nContentHeight = this.m_$Content.height();
      var nLeft = Math.max(Math.floor((nViewportWidth - nContentWidth) / 2), 12);
      var nTop = Math.max(Math.floor((nViewportHeight - nContentHeight) / 2), 12);

      // only use absolute position on mobile screens
      if (bResponsiveScreen && !bUseTabletScreenMode) {
        nLeft += this.m_nInitialOffsetLeft;
        nTop += this.m_nInitialOffsetTop;
        this.m_$Content.css('position', 'absolute');
      }
      else {
        this.m_$Content.css('position', 'fixed');
      }

      if (duration) {
        this.m_$Content.animate({ 'max-width': nMaxWidth, left: nLeft, top: nTop }, duration);
        this.m_$StandardContent.animate({ 'max-height': nMaxHeight }, duration);
      }
      else {
        this.m_$Content.css('left', nLeft);
        this.m_$Content.css('top', nTop);
      }
    };

    CModal.prototype.Show = function () {
      if (this.m_bVisible)
        return;

      CModal.ShowModalBackground();

      if (!this.m_bIgnoreResizeEvents) {
        $J(window).on('resize', null, this.m_fnSizing);
      }
      CModal.s_$Background.on('click.CModal', this.m_fnBackgroundClick);
      $J(document).on('keyup.CModal', this.m_fnOnEscapeKeyPress);

      this.AdjustSizing();

      // if we're in gamepad, notify gamepad navigation of the modal
      if (typeof GPOnShowingModalWindow === "function")
        this.m_fnGPOnCloseModal = GPOnShowingModalWindow(this.m_$Content.get(0));

      this.m_$Content.show();

      // resize as any child image elements load in.
      this.m_$Content.find('img').load(this.m_fnSizing);

      this.m_bVisible = true;
      CModal.PushActiveModal(this);

      var _this = this;
      if (typeof GPNavFocusChild !== 'undefined')
        window.setTimeout(function () { GPNavFocusChild(_this.m_$Content) }, 1);
    };

    CModal.prototype.Dismiss = function () {
      if (!this.m_bVisible)
        return;

      this.m_bVisible = false;

      // tell gamepad navigation we're closing this modal
      if (this.m_fnGPOnCloseModal) {
        this.m_fnGPOnCloseModal();
        this.m_fnGPOnCloseModal = null;
      }

      this.m_$Content.hide();

      if (!this.m_bIgnoreResizeEvents) {
        $J(window).off('resize', null, this.m_fnSizing);
      }

      if (this.m_fnOnDismiss)
        this.m_fnOnDismiss();

      if (this.m_bRemoveContentOnDismissal) {
        this.m_$Content.remove();
        this.m_$Content = null;
      }

      CModal.PopActiveModal(this);
      if (!CModal.s_rgModalStack.length) {
        CModal.s_$Background.off('click.CModal', this.m_fnBackgroundClick);
        $J(document).off('keyup.CModal', this.m_fnOnEscapeKeyPress);
        CModal.HideModalBackground();
      }
    };

    CModal.prototype.BIsActiveModal = function () {
      return CModal.s_rgModalStack.length && CModal.s_rgModalStack[CModal.s_rgModalStack.length - 1] == this;
    };

    /* static */
    CModal.ShowModalBackground = function () {
      if (!CModal.s_$Background) {
        CModal.s_$Background = $J('<div/>', { 'class': 'newmodal_background' });
        CModal.s_$Background.css('opacity', 0);
        $J(document.body).append(CModal.s_$Background);
      }
      CModal.s_$Background.stop();	// stop running animations
      CModal.s_$Background.fadeTo(200, 0.8);
    };

    CModal.HideModalBackground = function () {
      if (CModal.s_$Background) {
        CModal.s_$Background.stop();	// stop running animations
        CModal.s_$Background.fadeOut(200, 0);
      }
    };

    CModal.s_rgModalStack = [];
    CModal.GetActiveModal = function () {
      if (CModal.s_rgModalStack.length)
        return CModal.s_rgModalStack[CModal.s_rgModalStack.length - 1];
      else
        return null;
    };
    CModal.DismissActiveModal = function () {
      if (CModal.s_rgModalStack.length)
        CModal.s_rgModalStack[CModal.s_rgModalStack.length - 1].Dismiss();
    };

    CModal.PushActiveModal = function (Modal) {
      for (var i = 0; i < CModal.s_rgModalStack.length; i++) {
        // push below background
        CModal.s_rgModalStack[i].m_$Content.css('z-index', 899);
      }
      CModal.s_rgModalStack.push(Modal);
    };

    CModal.PopActiveModal = function (Modal) {
      for (var i = 0; i < CModal.s_rgModalStack.length; i++) {
        if (CModal.s_rgModalStack[i] == Modal) {
          CModal.s_rgModalStack.splice(i, 1);
          break;
        }
      }

      if (CModal.s_rgModalStack.length)
        CModal.s_rgModalStack[CModal.s_rgModalStack.length - 1].m_$Content.css('z-index', 1000);
    };

    // this will set the right headers for a cross-domain request to community
    function GetDefaultCommunityAJAXParams(path, method) {
      var rgParams = { url: 'https://steamcommunity.com/' + path };
      if (method)
        rgParams.type = method;

      // if this js file was hosted off the store, add CORS request headers
      if (window.location.href.indexOf('https://steamcommunity.com/') != 0) {
        rgParams.crossDomain = true;
        rgParams.xhrFields = { withCredentials: true };
      }
      return rgParams;
    }

    function CrossDomainPost(url, params) {
      return $J.ajax({
        type: 'post',
        url: url,
        data: params,
        crossDomain: true,
        xhrFields: { withCredentials: true }
      });
    }

    // spped of the miniprofile fading in and out
    var MINIPROFILE_ANIM_SPEED = 150;
    // how long the mouse must remain over an element before we'll make an AJAX call
    var MINIPROFILE_DELAY_BEFORE_AJAX = 100;
    // the delay before we'll show the hover, must be longer than DELAY_BEFORE_AJAX
    var MINIPROFILE_DELAY_BEFORE_SHOW = 250;

    function CDelayedAJAXData(strURL, msDelayBeforeAJAX) {
      this.m_$Data = null;
      this.m_bAJAXFailed = false;
      this.m_timerDelayedAJAX = null;
      this.m_bAJAXRequestMade = false;
      this.m_msDelayBeforeAJAX = msDelayBeforeAJAX;
      this.m_strURL = strURL;

      this.m_fnOnAJAXComplete = null;
    }

    CDelayedAJAXData.prototype.GetAJAXParams = function () {
      return GetDefaultCommunityAJAXParams(this.m_strURL, 'GET');
    };

    CDelayedAJAXData.prototype.QueueAjaxRequestIfNecessary = function () {
      if (!this.m_$Data && !this.m_bAJAXRequestMade) {
        var _this = this;
        this.m_timerDelayedAJAX = window.setTimeout(function () {
          _this.m_timerDelayedAJAX = null;
          _this.m_bAJAXRequestMade = true;
          var rgAJAXParams = _this.GetAJAXParams();
          $J.ajax(rgAJAXParams)
            .done(function (data) {
              _this.m_$Data = $J(data);
              if (_this.m_fnOnAJAXComplete)
                _this.m_fnOnAJAXComplete();
            }).fail(function () {
              _this.m_bAJAXFailed = true;
            });
        }, this.m_msDelayBeforeAJAX);
      }
    };

    CDelayedAJAXData.prototype.CancelAJAX = function () {
      if (this.m_timerDelayedAJAX)
        window.clearTimeout(this.m_timerDelayedAJAX);

      this.m_fnOnAJAXComplete = null;
    };

    CDelayedAJAXData.prototype.RunWhenAJAXReady = function (fnOnReady) {
      if (this.m_$Data)
        fnOnReady();
      else if (!this.m_bAJAXFailed) {
        this.m_fnOnAJAXComplete = fnOnReady;
        this.QueueAjaxRequestIfNecessary();
      }
      // if ajax failed we will not call fnOnReady
    };

    CDelayedAJAXData.prototype.Show = function ($HoverContent) {
      $HoverContent.children().detach();
      $HoverContent.append(this.m_$Data);
    };

    // time the cookie preferences popup waits before appearing
    var COOKIE_PREFERENCES_POPUP_DELAY = 4000;

    function InitCookiePreferencesPopup() {

      var $popupDialog = $J('#cookiePrefPopup');
      if ($popupDialog.length == 0) {
        $AllowURL = encodeURI('https://store.steampowered.com/' + 'account/ajaxsetcookiepreferences');

        var $CPopupContent = $J("<style>\r\n.replyButton {\r\n\twidth: 100%;\r\n    text-align: center;\r\n    margin-bottom: 4px;\r\n}\r\n\r\n.buttonGroup {\r\n\tflex: 18%;\r\n\tmargin-left: 20px;\r\n\tmargin-right: 0px;\r\n}\r\n.cookieMessage {\r\n\tflex: 85%; \r\n\tmargin: auto;\r\n}\r\n.popupTextTitle {\r\n\tpadding-bottom: 10px;\r\n    font-size: 13px;\r\n    line-height: 17px;\r\n    color: #c6d4df;\r\n}\r\n.popupTextTitle a {\r\n    text-decoration: underline;\r\n}\r\n.cookiepreferences_popup {\r\n\tdisplay: none;\r\n\tposition: fixed;\r\n\tbottom: 0;\r\n\twidth: 100%;\r\n\tz-index: 2000;\r\n\tpadding-top: 10px;\r\n}\r\n.cookiepreferences_popup_content {\r\n\tdisplay: flex;\r\n    box-sizing: border-box;\r\n\twidth: 90%;\r\n\tmargin: auto;\r\n\tmargin-bottom: 20px;\r\n\tmargin-top: 20px;\r\n\tpadding: 16px 16px 10px 16px;\r\n    max-width: 980px;\r\n\tbackground: linear-gradient(90.85deg, #333840 0.58%, #25282E 74.92%);\r\n\tbox-shadow: 0px 0px 10px #000000;\r\n    border-left: 2px solid #00CCFF;\r\n}\r\n@media all and (max-width: 910px) {\r\n    body.responsive_page .cookiepreferences_popup_content {\r\n        flex-direction: column;\r\n    }\r\n    body.responsive_page .cookiepreferences_popup_content .cookieMessage {\r\n        margin-bottom: 20px;\r\n    }\r\n    body.responsive_page .cookiepreferences_popup_content .buttonGroup {\r\n        flex-direction: row;\r\n        margin-left: 0px;\r\n    }\r\n    body.responsive_page .cookiepreferences_popup_content .buttonGroup .replyButton {\r\n        width: unset;\r\n    }\r\n}\r\n<\/style>\r\n\r\n<div id=\"cookiePrefPopup\" class=\"cookiepreferences_popup\">\r\n\t<div class=\"cookiepreferences_popup_content\">\r\n\t\t<div class=\"cookieMessage\">\r\n\t\t\t<div class=\"popupTextTitle\">Do you mind if we use optional cookies to provide you personalized content and to analyze site traffic?<\/div>\r\n\t\t\t<div class=\"popupTextTitle\">We don't use a lot of cookies; you can see and manage them at any time on our <a href=\"https:\/\/store.steampowered.com\/account\/cookiepreferences\">Cookie Settings page<\/a>. If you click 'Accept All,' you consent to the use of cookies on Steam websites. Learn more about cookies in our <a href=\"https:\/\/store.steampowered.com\/privacy_agreement\">Privacy Policy<\/a>.<\/div>\r\n\t\t<\/div>\r\n\t\t<div class=\"buttonGroup\">\r\n\t\t\t<div id=\"acceptAllButton\" class=\"btn_blue_steamui btn_medium replyButton\"><span>Accept All<\/span><\/div>\r\n\t\t\t<div id=\"rejectAllButton\" class=\"btn_grey_steamui btn_medium replyButton\"><span>Reject All<\/span><\/div>\r\n\t\t<\/div>\r\n\t<\/div>\r\n<\/div>\r\n");

        var $onAcceptButton = $CPopupContent.find('#acceptAllButton');
        var $onRejectButton = $CPopupContent.find('#rejectAllButton');

        if ($onAcceptButton.length == 0 || $onRejectButton.length == 0) {
          // template appears broken
          console.error("unable to display preferences popup");
          return;
        }

        var fnPostPreference = function (bAllowChoice) {
          $J.ajax({
            type: "POST",
            url: $AllowURL,
            data: { bAllow: bAllowChoice, sessionid: g_sessionID },
            crossDomain: true,
            xhrFields: { withCredentials: true }
          }).done(function (data) {
            if (data && data.transfer_urls && data.transfer_params) {
              for (var i = 0; i < data.transfer_urls.length; i++) {
                $J.ajax({
                  type: "POST",
                  url: data.transfer_urls[i],
                  data: { transfer_params: data.transfer_params },
                  crossDomain: true,
                  xhrFields: { withCredentials: true }
                });
              }
            }
          });
          $J('#cookiePrefPopup').hide();

        }

        $onAcceptButton.on('click', '', function () {
          fnPostPreference(1);
        });

        $onRejectButton.on('click', '', function () {
          fnPostPreference(0);
        });

        $J('body').append($CPopupContent);

        timerCookiePopup = window.setTimeout(function () {
          $J("#cookiePrefPopup").show();
        }, COOKIE_PREFERENCES_POPUP_DELAY);
      }
    }

    // The /miniprofile/ is cacheable. We need to specify the origin URL of the request to avoid CORS see cl 5773210
    function InitMiniprofileHovers(origin) {
      var $Hover = $J('<div/>', { 'class': 'miniprofile_hover' });
      var $HoverContent = $J('<div/>', { 'class': 'miniprofile_hover_inner shadow_content' });

      $Hover.append($J('<div class="shadow_ul"></div><div class="shadow_top"></div><div class="shadow_ur"></div><div class="shadow_left"></div><div class="shadow_right"></div><div class="shadow_bl"></div><div class="shadow_bottom"></div><div class="shadow_br"></div>'), $HoverContent);

      $Hover.hide();
      $J(document.body).append($Hover);

      var fnDataFactory = function (key) {
        // key is either a number (accountid) or a string of "accountid_appid"
        var rgKey = typeof key === "string" ? key.split(/_/) : [key];
        var strURL = 'miniprofile/' + rgKey[0];

        if (rgKey[1]) {
          strURL += '?appid=' + rgKey[1];

          if (origin) {
            strURL += '&origin=' + origin;
          }
        }
        else if (origin) {
          strURL += '?origin=' + origin;
        }

        return new CDelayedAJAXData(strURL, MINIPROFILE_DELAY_BEFORE_AJAX);
      };

      var fnReadKey = function ($Target) {
        var appid = $Target.parents('[data-miniprofile-appid]').first().data('miniprofile-appid');
        if (appid) {
          return $Target.data('miniprofile') + '_' + appid;
        }
        else {
          return $Target.data('miniprofile')
        }
      };

      var rgCallbacks = BindAJAXHovers($Hover, $HoverContent, {
        fnDataFactory: fnDataFactory,
        fnPositionHover: PositionMiniprofileHover,
        fnReadKey: fnReadKey,
        strDataName: 'miniprofile',
        strURLMatch: 'miniprofile'
      });
    }

    function _RegisterAJAXHoverHideFunction(fnHide) {
      if (typeof g_rgfnHideAJAXHover == 'undefined') {
        g_rgfnHideAJAXHover = [];
        $J(window).blur(HideAJAXHovers);
      }

      g_rgfnHideAJAXHover.push(fnHide);
    }

    function HideAJAXHovers() {
      if (typeof g_rgfnHideAJAXHover != 'undefined') {
        for (var i = 0; i < g_rgfnHideAJAXHover.length; i++)
          g_rgfnHideAJAXHover[i]();
      }
    }

    function BindAJAXHovers($Hover, $HoverContent, oParams) {
      var fnDataFactory = oParams.fnDataFactory;
      var fnPositionHover = oParams.fnPositionHover || PositionMiniprofileHover;
      var strDataName = oParams.strDataName;
      var strURLMatch = oParams.strURLMatch;
      var fnReadKey = function ($Element) { return $Element.data(strDataName); };
      if (oParams.fnReadKey)
        fnReadKey = oParams.fnReadKey;
      var strSelector = oParams.strSelector || '[data-' + strDataName + ']';
      var nDelayBeforeShow = oParams.nDelayBeforeShow || MINIPROFILE_DELAY_BEFORE_SHOW;

      // indexed by accountid
      var rgHoverData = {};
      var HoverTarget = null;
      var timerHover = null;

      var fnOnHover = function ($Target, key) {

        var bHoverVisible = ($Hover.css('display') != 'none');

        var HoverData = rgHoverData[key];
        if (!HoverData) {
          HoverData = rgHoverData[key] = fnDataFactory(key);
        }

        if (HoverTarget == HoverData && bHoverVisible) {
          //really only want to do this while fading out
          $Hover.stop();
          fnPositionHover($Hover, $Target);
          $Hover.show();	// PositionMiniprofile toggles visibility
          $Hover.fadeTo(MINIPROFILE_ANIM_SPEED, 1.0);
        }
        else if (!timerHover || HoverData != HoverTarget) {
          // this is the new target
          if (HoverTarget && HoverTarget != HoverData)
            HoverTarget.CancelAJAX();
          HoverTarget = HoverData;

          if (timerHover) {
            window.clearTimeout(timerHover);
            timerHover = null;
          }

          HoverData.QueueAjaxRequestIfNecessary();

          timerHover = window.setTimeout(function () {
            window.clearTimeout(timerHover);
            timerHover = null;

            HoverData.RunWhenAJAXReady(function () {
              HoverData.Show($HoverContent);
              $Hover.stop();
              $Hover.css('opacity', ''); //clean up jquery animation
              fnPositionHover($Hover, $Target);
              $Hover.fadeIn(MINIPROFILE_ANIM_SPEED);
              var videoElem = $Hover.find('video');
              if (videoElem.length != 0) {
                var playPromise = videoElem[0].play();
                if (playPromise) {
                  playPromise.catch(function (e) {
                  });
                }
              }
            });
          }, nDelayBeforeShow);
        }
      };

      var fnCancelHover = function (key) {
        var bHoverVisible = ($Hover.css('display') != 'none');

        if (key) {
          var HoverData = rgHoverData[key];
          if (HoverData) {
            HoverData.CancelAJAX();
          }
        }

        if (timerHover) {
          window.clearTimeout(timerHover);
          timerHover = null;
        }

        if (bHoverVisible) {
          $Hover.stop();
          $Hover.fadeOut(MINIPROFILE_ANIM_SPEED);
        }
      };

      var strEventNamespace = 'AjaxHover' + strDataName;
      $J(document).on('mouseenter.' + strEventNamespace + ' touchend.' + strEventNamespace, strSelector, function (e) {
        var $Target = $J(this);
        fnOnHover($Target, fnReadKey($Target));

        // Prevent click if we're sticky
        if (typeof $Target.data('stickyhover') !== 'undefined') {
          e.preventDefault();
        }
      });
      $J(document).on('click.' + strEventNamespace + ' mouseleave.' + strEventNamespace, strSelector, function (e) {
        var $Target = $J(this);

        // Cancel if we're not sticky
        if (typeof $Target.data('stickyhover') == 'undefined') {
          fnCancelHover();
        }
      });
      // Cancel when clicking/touching elsewhere regardless if sticky
      $J(document).on('click', null, fnCancelHover);

      // register this hover so HideAJAXHovers() can hide it when invoked
      _RegisterAJAXHoverHideFunction(fnCancelHover);

      return {
        fnCancelHover: fnCancelHover
      };
    }

    function PositionMiniprofileHover($Hover, $Target, oParams) {
      if (!oParams)
        oParams = {};
      var bPreferRightSide = oParams.bPreferRightSide || false;
      var nPxArrowOverlap = (oParams.nPxArrowOverlap != undefined) ? oParams.nPxArrowOverlap : 2;

      $Hover.css('visibility', 'hidden');
      $Hover.show();

      var offset = $Target.offset();
      $Hover.css('left', offset.left + 'px');
      $Hover.css('top', offset.top + 'px');

      var $HoverBox = $Hover.children('.shadow_content');
      if (!$HoverBox.length)
        $HoverBox = $J($Hover.children()[0]);

      var $HoverArrowLeft = $Hover.children('.hover_arrow.left');
      var $HoverArrowRight = $Hover.children('.hover_arrow.right');

      var nWindowScrollTop = $J(window).scrollTop();
      var nWindowScrollLeft = $J(window).scrollLeft();
      var nViewportWidth = $J(window).width();
      var nViewportHeight = $J(window).height();

      var $HoverArrow = $HoverArrowRight;
      var nBoxRightViewport = (offset.left - nWindowScrollLeft) + $Target.outerWidth() + $HoverBox.width() + 14;
      var nSpaceRight = nViewportWidth - nBoxRightViewport;
      var nSpaceLeft = offset.left - $Hover.width();
      if (((nSpaceLeft > 0 || nSpaceLeft > nSpaceRight) && !bPreferRightSide) || (bPreferRightSide && nSpaceRight < 14 && nSpaceLeft > nSpaceRight)) {
        $Hover.css('left', (offset.left - $Hover.width() + nPxArrowOverlap + 3) + 'px');
        $HoverArrowLeft.hide();
        $HoverArrowRight.show();
      }
      else {
        $Hover.css('left', (offset.left + $Target.outerWidth() - nPxArrowOverlap) + 'px');
        $HoverArrow = $HoverArrowLeft;
        $HoverArrowLeft.show();
        $HoverArrowRight.hide();
      }

      var nTopAdjustment = 0;

      if ($Target.height() < 48)
        nTopAdjustment = Math.floor($Target.height() / 2) - 24;
      var nDesiredHoverTop = offset.top - 15 + nTopAdjustment;
      $Hover.css('top', nDesiredHoverTop + 'px');

      // see if the hover is cut off by the bottom of the window, and bump it up if neccessary
      var nTargetTopViewport = (offset.top - nWindowScrollTop) + nTopAdjustment;
      if (nTargetTopViewport + $HoverBox.height() + 35 > nViewportHeight) {
        var nViewportAdjustment = ($HoverBox.height() + 35) - (nViewportHeight - nTargetTopViewport);

        // if the hover has the "in-game" block at the bottom, we need to have more space at the bottom of the hover
        //	so that the arrow will appear in the blue part of the hover.  This means the game info may be off-screen below.
        var bHaveInGameInfo = $HoverBox.find('.miniprofile_ingame').length > 0;
        var nHoverBoxBottomMinimum = (bHaveInGameInfo ? 78 : 24);	// the minimum amount of space we need below the arrow
        nViewportAdjustment = Math.min($HoverBox.height() - nHoverBoxBottomMinimum, nViewportAdjustment);

        var nViewportAdjustedHoverTop = offset.top - nViewportAdjustment;
        $Hover.css('top', nViewportAdjustedHoverTop + 'px');

        // arrow is normally offset 30pixels.  we move it down the same distance we moved the hover up, so it is "fixed" to where it was initially
        $HoverArrow.css('top', (30 + nDesiredHoverTop - nViewportAdjustedHoverTop) + 'px');
      }
      else {
        $HoverArrow.css('top', '');
      }

      $Hover.hide();
      $Hover.css('visibility', '');
    }


    /* Emoticon hovers */

    function CEmoticonDelayedAJAXData(strEmoticonName, msDelayBeforeAJAX) {
      CDelayedAJAXData.apply(this, ['economy/emoticonhover/' + strEmoticonName + '/jsonp.js', msDelayBeforeAJAX]);
      this.m_strEmoticonName = strEmoticonName;
    }

    // subclass CDelayedAJAXData so we can request via JSONP
    CEmoticonDelayedAJAXData.prototype = new CDelayedAJAXData;
    CEmoticonDelayedAJAXData.prototype.constructor = CEmoticonDelayedAJAXData;

    CEmoticonDelayedAJAXData.prototype.GetAJAXParams = function () {
      return {
        url: 'https://community.cloudflare.steamstatic.com/' + this.m_strURL,
        dataType: 'jsonp',
        jsonpCallback: 'OnLoadEmoticon_' + this.m_strEmoticonName,	//consistent name for cachability
        cache: true,
        data: { l: 'english' }
      }
    };

    function InitEmoticonHovers() {
      var $Hover = $J('<div/>', { 'class': 'emoticon_hover' });
      var $HoverContent = $J('<div/>', { 'class': 'emoticon_hover_content' });
      $Hover.append($HoverContent, $J('<div/>', { 'class': 'hover_arrow left emoticon_hover_arrow' }), $J('<div/>', { 'class': 'hover_arrow right emoticon_hover_arrow' }));
      $Hover.hide();

      var fnOneTimeEmoticonSetup = function () {
        $J(document.body).append($Hover);
      };

      var fnReadKey = function ($Element) {
        if ($Element.data('emoticon')) {
          return $Element.data('emoticon');
        }
        else if ($Element.attr('src')) {
          var rgMatches = $Element.attr('src').match('emoticon/(.*)$');
          if (rgMatches && rgMatches[1]) {
            var strEmoticon = rgMatches[1];
            if (strEmoticon.length > 1) {
              if (strEmoticon[0] == ':')
                strEmoticon = strEmoticon.substr(1);
              if (strEmoticon[strEmoticon.length - 1] == ':')
                strEmoticon = strEmoticon.substr(0, strEmoticon.length - 1);
            }
            return strEmoticon;
          }
        }

        return null;
      };

      var fnDataFactory = function (key) {
        if (fnOneTimeEmoticonSetup) {
          fnOneTimeEmoticonSetup();
          fnOneTimeEmoticonSetup = null;
        }

        return new CEmoticonDelayedAJAXData(key, 50);
      };

      var rgCallbacks = BindAJAXHovers($Hover, $HoverContent, {
        fnDataFactory: fnDataFactory,
        fnPositionHover: function ($Hover, $Target) {
          PositionMiniprofileHover($Hover, $Target, {
            bPreferRightSide: true,
            nPxArrowOverlap: 0
          });
          //slide it down a little for emoticon option popup
          if ($Target.hasClass('emoticon_option'))
            $Hover.css('top', parseInt($Hover.css('top')) + 5);
        },
        fnReadKey: fnReadKey,
        strSelector: 'img.emoticon',
        strURLMatch: 'emoticonhover',
        nDelayBeforeShow: 50
      });

      window.DismissEmoticonHover = rgCallbacks.fnCancelHover;
    }

    function V_EscapeRegExp(str) {
      return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    function V_EscapeHTML(str) {
      return String(str).replace(/&/g, '&amp;').replace(/["]/g, '&quot;').replace(/[']/g, '&#39;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    }

    function v_trim(str) {
      if (str.trim)
        return str.trim();
      else {
        return str.replace(/^\s+/, '').replace(/\s+$/, '');
      }
    }

    function V_ParseJSON(str) {
      if (typeof JSON == 'object' && JSON.parse)
        return JSON.parse(str);	// built-in / json2.js
      else
        str.evalJSON();				// prototype
    }

    function V_ToJSON(object) {
      if (typeof JSON == 'object' && JSON.stringify)
        return JSON.stringify(object);	// built-in / json2.js
      else
        Object.toJSON(object);				// prototype
    }

    function V_IsJSON(str) {
      try {
        if (typeof JSON == 'object' && JSON.parse) {
          var o = JSON.parse(str);
          if (o !== null)
            return true;

        } else {
          return str.isJSON();
        }
      }
      catch (e) { }
      return false;
    }


    function V_GetCookie(strCookieName) {
      var rgMatches = document.cookie.match('(^|; )' + strCookieName + '=([^;]*)');
      if (rgMatches && rgMatches[2])
        return rgMatches[2];
      else
        return null;
    }


    function V_GetDecodedCookie(strCookieName) {
      var value = V_GetCookie(strCookieName);
      return value && decodeURIComponent(value);
    }

    function V_SetCookie(strCookieName, strValue, expiryInDays, path) {
      if (!path)
        path = '/';

      var strDate = '';

      if (typeof expiryInDays != 'undefined' && expiryInDays) {
        var dateExpires = new Date();
        dateExpires.setTime(dateExpires.getTime() + 1000 * 60 * 60 * 24 * expiryInDays);
        strDate = '; expires=' + dateExpires.toGMTString();
      }

      document.cookie = strCookieName + '=' + strValue + strDate + ';path=' + path;
    }

    function _GetStorageFromCookie() {
      var oStorage = {};

      var strStorageJSON = V_GetCookie('storage');
      if (strStorageJSON) {
        try {
          oStorage = V_ParseJSON(decodeURIComponent(strStorageJSON));
        }
        catch (e) {
          oStorage = {};
        }
      }

      return oStorage;
    }

    function BInsideIFrame() {
      try {
        return window.self !== window.top;
      }
      catch (e) {
        return true;
      }
    }

    function SetValueLocalStorage(strPreferenceName, value) {
      if (!BInsideIFrame() && window.localStorage) {
        window.localStorage[strPreferenceName] = value;
      }
      else {
        var oStorage = _GetStorageFromCookie();

        oStorage[strPreferenceName] = value;

        V_SetCookie('storage', encodeURIComponent(V_ToJSON(oStorage)), 365)
      }
    }

    function UnsetValueLocalStorage(strPreferenceName) {
      if (!BInsideIFrame() && window.localStorage) {
        delete window.localStorage[strPreferenceName];
      }
      else {
        var oStorage = _GetStorageFromCookie();

        delete oStorage[strPreferenceName];

        V_SetCookie('storage', encodeURIComponent(V_ToJSON(oStorage)), 365)
      }
    }

    function GetValueLocalStorage(strPreferenceName, defaultValue) {
      if (!BInsideIFrame() && window.localStorage) {
        return window.localStorage[strPreferenceName] || defaultValue;
      }
      else {
        var oStorage = _GetStorageFromCookie();

        return oStorage[strPreferenceName] || defaultValue;
      }
    }

    function DynamicLink_PlayYouTubeVideoInline(elem, videoid) {
      var el = $J(elem);
      var youtubeurl = location.protocol + '//www.youtube.com/embed/' + videoid + '?showinfo=0&autohide=1&fs=1&hd=1&modestbranding=1&rel=0&showsearch=0&wmode=direct&autoplay=1';
      var wrapper = $J('<div/>', { 'class': 'dynamiclink_youtubeviewvideo' });
      var embed_wrapper = $J('<div/>', { 'class': 'dynamiclink_youtubeviewvideoembedded', 'frameborder': '0' });
      var iframeContent = $J('<iframe/>', { 'frameborder': '0', src: youtubeurl, 'allowfullscreen': '' });
      if (el.length) {
        embed_wrapper.append(iframeContent);
        wrapper.append(embed_wrapper);
        el.after(wrapper);
        el.remove();
      }
    }

    function DynamicLink_PlayVimeoVideoInline(elem, videoid) {
      var el = $J(elem);
      var videourl = 'https://player.vimeo.com/video/' + videoid + '?badge=0&autopause=0&autoplay=1&player_id=0';
      var wrapper = $J('<div/>', { 'class': 'dynamiclink_youtubeviewvideo' });
      var embed_wrapper = $J('<div/>', { 'class': 'dynamiclink_youtubeviewvideoembedded', 'frameborder': '0' });
      var iframeContent = $J('<iframe/>', { 'frameborder': '0', src: videourl, webkitallowfullscreen: '', mozallowfullscreen: '', allowfullscreen: '' });
      if (el.length) {
        embed_wrapper.append(iframeContent);
        wrapper.append(embed_wrapper);
        el.after(wrapper);
        el.remove();
      }
    }

    function DynamicLink_ShowSketchfabModelInline(elem, details) {
      var url = "https://sketchfab.com/models/" + details.modelid + "/embed?autostart=1";
      var el = $J(elem);
      var wrapper = $J('<div/>', { 'class': 'dynamiclink_sketchfabmodelembedded', 'frameborder': '0' });
      var iframeContent = $J('<iframe/>', { 'frameborder': '0', "mozallowfullscreen": true, "webkitallowfullscreen": true, src: url });
      if (el.length) {
        wrapper.append(iframeContent);
        el.after(wrapper);
        el.remove();
      }
    }

    function ReplaceDynamicLink(id, strHTML) {
      var el = $J('#' + id);
      if (el.length && strHTML.length > 0) {
        var newEl = $J(strHTML);
        el.after(newEl);
        el.remove();

        if (typeof window['HandleNewDynamicLink'] === "function") {
          HandleNewDynamicLink(newEl);
        }
      }
    }

    function ShowBannedDynamicLink(el) {
      el = $J(el);
      if (el.length > 0) {
        var bannedContentURL = el.data('bannedurl');
        var link = $J("<a>", { href: bannedContentURL, text: bannedContentURL });
        el.html(link);
        el.attr('onclick', '');
      }
    }



    function CScrollOffsetWatcher(el, fnCallback) {
      this.m_$Element = $J(el);
      this.nOffsetTop = this.m_$Element.offset().top;
      this.nBufferHeight = 500;

      this.nOffsetTopTrigger = this.nOffsetTop - this.nBufferHeight;

      this.fnOnHit = fnCallback;

      CScrollOffsetWatcher.RegisterWatcher(this);
    }

    CScrollOffsetWatcher.prototype.SetBufferHeight = function (nHeight) {
      this.nBufferHeight = nHeight;
      this.Recalc();
    };

    CScrollOffsetWatcher.prototype.Recalc = function () {
      this.nOffsetTop = this.m_$Element.offset().top;
      this.nOffsetTopTrigger = this.nOffsetTop - this.nBufferHeight;
    };

    CScrollOffsetWatcher.sm_rgWatchers = [];
    CScrollOffsetWatcher.m_nTimeoutInitialLoad = 0;
    CScrollOffsetWatcher.RegisterWatcher = function (Watcher) {
      var bHadWatchers = CScrollOffsetWatcher.sm_rgWatchers.length > 0;

      // keep the list sorted by offset trigger
      var iInsertionPoint;
      for (iInsertionPoint = CScrollOffsetWatcher.sm_rgWatchers.length; iInsertionPoint > 0; iInsertionPoint--) {
        if (Watcher.nOffsetTopTrigger > CScrollOffsetWatcher.sm_rgWatchers[iInsertionPoint - 1].nOffsetTopTrigger)
          break;
      }
      CScrollOffsetWatcher.sm_rgWatchers.splice(iInsertionPoint, 0, Watcher);

      if (!bHadWatchers) {
        $J(window).on('scroll.ScrollOffsetWatcher', CScrollOffsetWatcher.OnScroll);

        var nRecalcTimer = 0;
        $J(window).on('resize.ScrollOffsetWatcher', function () {
          if (nRecalcTimer)
            window.clearTimeout(nRecalcTimer);
          nRecalcTimer = window.setTimeout(CScrollOffsetWatcher.ForceRecalc, 500);
        });
      }

      // use a 1ms timeout to roll these together as much as possible on page load
      if (!CScrollOffsetWatcher.m_nTimeoutInitialLoad)
        CScrollOffsetWatcher.m_nTimeoutInitialLoad = window.setTimeout(function () { CScrollOffsetWatcher.OnScroll(); CScrollOffsetWatcher.m_nTimeoutInitialLoad = 0; }, 1);
    };

    CScrollOffsetWatcher.ForceRecalc = function () {
      for (var i = 0; i < CScrollOffsetWatcher.sm_rgWatchers.length; i++) {
        CScrollOffsetWatcher.sm_rgWatchers[i].Recalc();
      }

      CScrollOffsetWatcher.OnScroll();
    };

    CScrollOffsetWatcher.OnScroll = function () {
      var supportPageOffset = window.pageYOffset !== undefined;
      var isCSS1Compat = ((document.compatMode || "") === "CSS1Compat");

      var nScrollY = supportPageOffset ? window.pageYOffset : isCSS1Compat ? document.documentElement.scrollTop : document.body.scrollTop;
      var nOffsetBottom = nScrollY + window.innerHeight;

      for (let i = CScrollOffsetWatcher.sm_rgWatchers.length - 1; i >= 0; i--) {
        var Watcher = CScrollOffsetWatcher.sm_rgWatchers[i];
        if (nOffsetBottom > Watcher.nOffsetTopTrigger) {
          // make sure the page hasn't changed and we really need to show content
          Watcher.Recalc();
          if (nOffsetBottom > Watcher.nOffsetTopTrigger) {
            Watcher.fnOnHit();
            CScrollOffsetWatcher.sm_rgWatchers.splice(i, 1);
          }
        }
      }

      if (CScrollOffsetWatcher.sm_rgWatchers.length === 0) {
        $J(window).off('scroll.ScrollOffsetWatcher');
        $J(window).off('resize.ScrollOffsetWatcher');
      }
    };

    function LoadImageGroupOnScroll(elTarget, strGroup) {
      var $Element = $J('#' + elTarget);
      if ($Element.length)
        new CScrollOffsetWatcher($Element, function () { LoadDelayedImages(strGroup); });
    }

    function LoadDelayedImages(group) {
      if (typeof g_rgDelayedLoadImages != 'undefined' && g_rgDelayedLoadImages[group]) {
        var rgURLs = g_rgDelayedLoadImages[group];
        for (var i = 0; i < rgURLs.length; i++) {
          $J('#delayedimage_' + group + '_' + i).attr('src', rgURLs[i]);
        }

        g_rgDelayedLoadImages[group] = false;
      }
    }

    WebStorage = {
      GetLocal: function (key, bSessionOnly) {
        var type = (bSessionOnly) ? 'session' : 'local';

        if (!window[type + 'Storage'])
          return WebStorage.GetCookie(key);

        var storage = window[type + 'Storage'];
        var value;
        try {
          value = storage.getItem(key);
        } catch (err) {
          // storage.getItem can throw SecurityError based on user's browser setting.
          value = null;
        }

        try {
          value = V_ParseJSON(value);
        } catch (err) {
          return null;
        }

        if (value == null) {
          // Check if we have the value stored in a cookie instead. If so, move that to LS and remove the cookie
          value = V_GetCookie(key);
          if (value != null) {
            WebStorage.SetLocal(key, value, bSessionOnly);
            WebStorage.ClearCookie(key);
          }
        }
        return value;
      },
      GetLocalSession: function (key) {
        return WebStorage.GetLocal(key, true);
      },
      SetLocal: function (key, value, bSessionOnly) {
        var type = (bSessionOnly) ? 'session' : 'local';

        if (!window[type + 'Storage'])
          return WebStorage.SetCookie(key, value, (bSessionOnly) ? null : 365);

        value = V_ToJSON(value);

        var storage = window[type + 'Storage'];
        storage.setItem(key, value);
      },
      SetLocalSession: function (key, value) {
        WebStorage.SetLocal(key, value, true);
      },
      GetCookie: function (key) {
        var keyValue = V_GetCookie(key);
        if (keyValue)
          keyValue = decodeURIComponent(keyValue);

        return V_IsJSON(keyValue) ? V_ParseJSON(keyValue) : keyValue;
      },
      SetCookie: function (key, value, duration) {
        value = encodeURIComponent(V_ToJSON(value));
        V_SetCookie(key, value, duration);
      },
      ClearCookie: function (key) {
        WebStorage.SetCookie(key, null, -1);
      },
      RemoveLocal: function (key, bSessionOnly) {
        var type = (bSessionOnly) ? 'session' : 'local';

        if (!window[type + 'Storage'])
          return WebStorage.ClearCookie(key);

        var storage = window[type + 'Storage'];

        storage.removeItem(key);
      }
    };

    // takes an integer
    function v_numberformat(n, decimals, strDecimalSymbol, strThousandsSeperator) {
      if (typeof strDecimalSymbol == 'undefined' && typeof strThousandsSeperator == 'undefined' && typeof Number != 'undefined' && typeof Number.toLocaleString != 'undefined') {
        var options = {};
        if (typeof decimals != 'undefined' && decimals !== 0) {
          options.minimumFractionDigits = decimals;
          options.maximumFractionDigits = decimals;
        }

        var num = new Number(n);
        try {
          return num.toLocaleString(false, options);
        }
        catch (e) {
          return num.toString();
        }
      }

      var str = '' + (n ? n : 0);
      var len = str.indexOf('.');
      if (len == -1)
        len = str.length;
      var out = '';
      for (var i = 0; i < len; i++) {
        var c = str.charAt(i);
        out += c;
        if (i < len - 1 && (len - i - 1) % 3 == 0 && c != '-')
          out += (typeof strThousandsSeperator == 'undefined' ? ',' : strThousandsSeperator);
      }
      if ((len < str.length || decimals) && typeof decimals != 'undefined' && decimals !== 0) {
        len++;
        out += (typeof strDecimalSymbol == 'undefined' ? ',' : strDecimalSymbol);
        for (var i = 0; i < (decimals ? decimals : str.length - len); i++) {
          if (len + i < str.length)
            out += str.charAt(len + i);
          else
            out += '0';
        }
      }

      return out;
    }


    function v_shuffle(rgArray) {
      for (var i = 0; i < rgArray.length; i++) {
        var iSwap = Math.floor(Math.random() * (rgArray.length - i) + i);
        if (iSwap != i) {
          var temp = rgArray[iSwap];
          rgArray[iSwap] = rgArray[i];
          rgArray[i] = temp;
        }
      }

      return rgArray;
    }


    function UpdateFormattedNumber(element, delta) {
      var $Element = $J(element);
      $Element.text(v_numberformat(parseInt($Element.text().replace(/,/, '')) + delta));
    }

    function RateAnnouncement(rateURL, gid, bVoteUp, clanID) {
      if (bVoteUp && $J('#VoteUpBtn_' + gid).hasClass("btn_active")) {
        return;
      }
      if (!bVoteUp && $J('#VoteDownBtn_' + gid).hasClass("btn_active")) {
        return;
      }

      rateURL = rateURL + gid;
      $J.post(rateURL, {
        'voteup': bVoteUp,
        'clanid': clanID,
        'sessionid': g_sessionID
      }
      ).done(function (json) {

        var votesUpCount = $J('#VotesUpCount_' + gid);
        if (votesUpCount) {
          var increment = 0;
          if (bVoteUp) {
            increment = 1;
          }
          else if ($J('#VoteUpBtn_' + gid).hasClass('btn_active')) {
            increment = -1;
          }
          UpdateFormattedNumber(votesUpCount, increment);

          if (parseInt(votesUpCount.html().replace(/,/g, '')) == 0) {
            $J('#VotesUpCountContainer_' + gid).hide();
          }
          else {
            $J('#VotesUpCountContainer_' + gid).show();
          }
        }

        if (bVoteUp) {
          $J('#VoteUpBtn_' + gid).addClass("btn_active");
          $J('#VoteDownBtn_' + gid).removeClass("btn_active");
        }
        else {
          $J('#VoteDownBtn_' + gid).addClass("btn_active");
          $J('#VoteUpBtn_' + gid).removeClass("btn_active");
        }



      })
        .fail(function (jqxhr) {
          var responseJSON = jqxhr.responseText.evalJSON();
          switch (responseJSON.success) {
            case 21:
              ShowAlertDialog('Error', 'You must be logged in to perform that action.');
              break;
            case 24:
              ShowAlertDialog('Error',
                'Your account does not meet the requirements to use this feature. <a class="whiteLink" href="https://help.steampowered.com/en/wizard/HelpWithLimitedAccount"  rel="noreferrer">Visit Steam Support</a> for more information.'
              );
              break;
            case 15:
              ShowAlertDialog('Error', 'You do not have permission to perform that action.');
              break;
            default:
              ShowAlertDialog('Error', 'There was an error encountered while processing your request: ' + responseJSON.success);
              break;
          }
        });
      return false;
    }

    function GetResponsiveHeaderFixedOffsetAdjustment() {
      // for responsive pages - we need to adjust for the menu
      var $ResponsiveHeader = $J('.responsive_header:visible');
      if ($ResponsiveHeader.length && $ResponsiveHeader.css('position') == 'fixed')
        return $ResponsiveHeader.outerHeight();
      else
        return 0;
    }

    /* Scroll to an element if it's not already in view.  If it's at the bottom of the viewport, then it will be
     scrolled to the top if less than nRequiredPixelsToShow are visible (defaults to the height of the element)
     */
    function ScrollToIfNotInView(elem, nRequiredPixelsToShow, nSpacingBefore, nAnimationSpeed) {
      var $Elem = $JFromIDOrElement(elem);

      if (typeof nSpacingBefore == 'undefined')
        nSpacingBefore = 0;

      // for responsive pages - we need to adjust for the menu
      nSpacingBefore += GetResponsiveHeaderFixedOffsetAdjustment();

      var elemTop = $Elem.offset().top;
      var nViewportOffsetTop = elemTop - $J(window).scrollTop();
      var bNeedToScroll = false;
      if (nViewportOffsetTop < 0) {
        bNeedToScroll = true;
      }
      else {
        if (!nRequiredPixelsToShow)
          nRequiredPixelsToShow = $Elem.outerHeight();

        var nViewportOffsetBottom = nViewportOffsetTop + nRequiredPixelsToShow;

        if (nViewportOffsetBottom > $J(window).height())
          bNeedToScroll = true;
      }

      if (bNeedToScroll) {
        if (nSpacingBefore)
          nViewportOffsetTop -= nSpacingBefore;

        if (typeof nAnimationSpeed != 'undefined')
          $J('html, body').animate({ scrollTop: nViewportOffsetTop }, nAnimationSpeed);
        else
          window.scrollBy(0, nViewportOffsetTop);
      }
    }


    function CAjaxInfiniteScrollingControls(rgSearchData, url) {
      this.m_strActionURL = null;
      this.m_cPageSize = null;
      this.m_strElementPrefix = "";
      this.m_strClassPrefix = "";
      this.m_StrRowsId = "";
      this.m_rgStaticParams = null;

      this.m_bLoading = false;

      this.m_fnPreRequestHandler = null;
      this.m_fnResponseHandler = null;
      this.m_fnPageChangingHandler = null;
      this.m_fnPageChangedHandler = null;
      this.m_fnRawScrollHandler = null;

      this.m_LoadingDialog = null;
      this.m_bRestoringScrollTop = false;

      this.m_strActionURL = url;

      this.m_strQuery = rgSearchData['query'];
      this.m_cTotalCount = rgSearchData['total_count'];
      this.m_iCurrentPage = rgSearchData['page'] || 0;
      this.m_cPageSize = rgSearchData['pagesize'];
      this.m_cMaxPages = Math.ceil(this.m_cTotalCount / this.m_cPageSize);

      this.m_iTriggerHeight = rgSearchData['trigger_height'] || 750;	// How many px from the bottom should we trigger a page load.

      this.m_iCooldownTime = 0;       // ms from the epoch when we can next update.
      this.m_iCooldownInterval = 200; // Minimum time (in ms) between updates

      if (rgSearchData['prefix'])
        this.m_strElementPrefix = rgSearchData['prefix'];

      // Rows element name that's updated when we scroll.
      this.m_StrRowsId = this.m_strElementPrefix + 'Rows';

      if (rgSearchData['class_prefix'])
        this.m_strClassPrefix = rgSearchData['class_prefix'];

      // We want our handlers to get a copy of our infiniteScroll object when they're called, so we save it
      // into a var and build a closure around it.
      var thisControl = this;

      // By saving the bound scroll-handler to a variable, we can then unload it when our search
      // options are upadated.
      this.m_fnRawScrollHandler = function () { thisControl.OnScroll() };
      $J(document).scroll(this.m_fnRawScrollHandler);

      // If we have a _scroll_top element, then set our OnUnload handler.
      if ($J("#" + this.m_strElementPrefix + '_scroll_top').length)
        window.addEventListener('beforeunload', function () { thisControl.OnUnload() });

      // Optional: Dynamic data returned from the last request, to provided to the next request. Lets them
      // being stringed together with some memory
      this.m_rgDynamicData = null;

      this.RestoreScrollTop(true);
    }

    CAjaxInfiniteScrollingControls.prototype.DoneRestoreScrollTop = function () {
      this.ClearLoadingDialog();
      this.m_bRestoringScrollTop = false;
    };

    CAjaxInfiniteScrollingControls.prototype.ClearLoadingDialog = function () {
      if (this.m_LoadingDialog) {
        this.m_LoadingDialog.Dismiss();
        this.m_LoadingDialog = null;
      }
    };

    // Stops this infinite scroll handler.
    CAjaxInfiniteScrollingControls.prototype.Stop = function () {
      // Clear loading notifiers.
      this.ClearLoadingDialog();
      this.HideThrobber();

      // Clear scheduled scroll, if there is one.
      if (this.m_oScheduledScroll)
        clearTimeout(this.m_oScheduledScroll);

      // Unhook scroll handler.
      $J(document).off("scroll", this.m_fnRawScrollHandler);

      // TODO: Do we need to call or clear BeforeUnload?
    };

    CAjaxInfiniteScrollingControls.prototype.RestoreScrollTop = function (bForce) {
      this.m_bRestoringScrollTop |= bForce;
      if (!this.m_bRestoringScrollTop) {
        return;
      }
      var scrollTopPrevious = parseInt($J("#" + this.m_strElementPrefix + '_scroll_top').val());
      if (scrollTopPrevious) {
        var viewport = document.viewport.getDimensions(); // Gets the viewport as an object literal
        var windowHeight = viewport.height; // Usable window height
        var bodyHeight = $(document.body).getHeight();

        // done?
        if (scrollTopPrevious < bodyHeight - windowHeight) {
          this.DoneRestoreScrollTop();
          window.scrollTo(0, scrollTopPrevious);
        }
        else {
          if (this.m_LoadingDialog == null) {
            this.m_LoadingDialog = ShowBlockingWaitDialog('Please Wait', 'Returning to where you were last on this page...');
          }
          window.scrollTo(0, scrollTopPrevious);
        }
      }
    };

    CAjaxInfiniteScrollingControls.prototype.OnUnload = function () {
      var scrollOffset = document.viewport.getScrollOffsets();
      var scrollTop = scrollOffset.top;
      $J("#" + this.m_strElementPrefix + '_scroll_top').val(scrollTop);
    };

    CAjaxInfiniteScrollingControls.prototype.OnScroll = function () {
      if (this.m_bLoading)
        return;

      var iNow = new Date().getTime();

      // How soon can we scroll?
      var iScrollWait = this.m_iCooldownTime - iNow;

      // If we haven't reached our cooldown, do nothing.
      if (iScrollWait > 0) {
        // console.log("InfiniScrolling too fast; engaging throttle");

        // Schedule a scroll event for when they would be allowed to scroll. Without this, the
        // user needs to jiggle their scrollbar.
        if (this.m_oScheduledScroll == null) {
          this.m_oScheduledScroll = setTimeout(this.m_fnRawScrollHandler, iScrollWait);
          this.ShowThrobber(); // Show throbber while waiting to begin load.
        }

        return;
      }

      this.m_oScheduledScroll = null;

      // The bottom of our screen is equal to how far we've scrolled, plus the height of our window.
      var nCurrentScroll = $J(window).scrollTop() + $J(window).height();

      var rows = $J('#' + this.m_StrRowsId);
      var offset = rows.offset();

      // The bottom of our content is the height of our results, plus its offset from the top of the page.
      // We want to trigger a load this.m_iTriggerHeight before the user sees that.
      var nTriggerPoint = rows.height() + offset.top - this.m_iTriggerHeight;

      if (nCurrentScroll > nTriggerPoint) {
        this.m_iCooldownTime = iNow + this.m_iCooldownInterval;

        this.NextPage();
      }
    };

    CAjaxInfiniteScrollingControls.prototype.GetActionURL = function (action) {
      var url = this.m_strActionURL + action + '/';
      return url;
    };

    CAjaxInfiniteScrollingControls.prototype.SetPreRequestHandler = function (fnHandler) {
      this.m_fnPreRequestHandler = fnHandler;
    };

    CAjaxInfiniteScrollingControls.prototype.SetResponseHandler = function (fnHandler) {
      this.m_fnResponseHandler = fnHandler;
    };

    CAjaxInfiniteScrollingControls.prototype.SetPageChangingHandler = function (fnHandler) {
      this.m_fnPageChangingHandler = fnHandler;
    };

    CAjaxInfiniteScrollingControls.prototype.SetPageChangedHandler = function (fnHandler) {
      this.m_fnPageChangedHandler = fnHandler;
    };

    CAjaxInfiniteScrollingControls.prototype.SetStaticParameters = function (rgParams) {
      this.m_rgStaticParams = rgParams;
    };

    CAjaxInfiniteScrollingControls.prototype.OnAJAXComplete = function () {
      this.m_bLoading = false;
    };

    CAjaxInfiniteScrollingControls.prototype.NextPage = function () {
      if (this.m_iCurrentPage < this.m_cMaxPages - 1) {
        this.LoadPage(this.m_iCurrentPage + 1);
      }
      else {
        // We're reached the end of our results!
        this.Stop();
      }

    };

    CAjaxInfiniteScrollingControls.prototype.LoadPage = function (iPage, bForce) {
      if (typeof (bForce) == 'undefined' || !bForce) {
        if (this.m_bLoading || iPage >= this.m_cMaxPages || iPage < 0) {
          return false;
        }
        else if (iPage == this.m_iCurrentPage) {
          this.RestoreScrollTop(false);
        }
      }

      var params = {
        query: this.m_strQuery,
        start: this.m_cPageSize * iPage,
        count: this.m_cPageSize,
        dynamic_data: this.m_rgDynamicData,
      };

      if (this.m_rgStaticParams != null) {
        for (var sParamName in this.m_rgStaticParams) {

          if (typeof sParamName != "string")
            continue;

          var typeOfParam = typeof this.m_rgStaticParams[sParamName];

          if (typeOfParam != "string" && typeOfParam != "number" && typeOfParam != "boolean")
            continue;

          params[sParamName] = this.m_rgStaticParams[sParamName];
        }
      }

      if (this.m_fnPageChangingHandler != null)
        this.m_fnPageChangingHandler(iPage);

      if (this.m_fnPreRequestHandler != null)
        this.m_fnPreRequestHandler(params);

      this.ShowThrobber();

      this.m_bLoading = true;

      new Ajax.Request(this.GetActionURL(''), {
        method: 'get',
        parameters: params,
        onSuccess: this.OnResponseRenderResults.bind(this),
        onComplete: this.OnAJAXComplete.bind(this)
      });

      return true;
    };

    CAjaxInfiniteScrollingControls.prototype.GetThrobber = function () {
      // NB: This is using prototype, *not* jQuery, hence the lack of 'J'.
      return $(this.m_strElementPrefix + '_loading');
    };

    CAjaxInfiniteScrollingControls.prototype.HideThrobber = function () {
      var throbber = this.GetThrobber();

      if (throbber)
        throbber.hide();
    };

    CAjaxInfiniteScrollingControls.prototype.ShowThrobber = function () {
      var throbber = this.GetThrobber();

      if (throbber)
        throbber.show();
    };

    CAjaxInfiniteScrollingControls.prototype.OnResponseRenderResults = function (transport) {

      if (transport.responseJSON && transport.responseJSON.success) {
        this.HideThrobber();

        if (typeof RecordAJAXPageView !== "undefined") {
          RecordAJAXPageView(transport.request.url);
        }

        var response = transport.responseJSON;
        this.m_cTotalCount = response.total_count;
        this.m_cMaxPages = Math.ceil(response.total_count / this.m_cPageSize);
        this.m_iCurrentPage = Math.floor(response.start / this.m_cPageSize);

        if (this.m_iCurrentPage != 0 && this.m_cTotalCount <= response.start) {
          // this page is no longer valid, flip back a page (deferred so that the AJAX handler exits and reset m_bLoading)
          this.DoneRestoreScrollTop();
          return;
        }

        var elResults = $(this.m_StrRowsId);

        elResults.insert(response.results_html);

        this.m_rgDynamicData = (response.dynamic_data) ? response.dynamic_data : null;

        if (this.m_fnResponseHandler != null) {
          this.m_fnResponseHandler(response);
        }

        if (this.m_fnPageChangedHandler != null)
          this.m_fnPageChangedHandler(this.m_iCurrentPage, elResults);

        this.m_bLoading = false;
        if (this.m_iCurrentPage < this.m_cMaxPages - 1) {
          this.RestoreScrollTop(false);
        }
        else {
          this.DoneRestoreScrollTop();
        }
      }
      else {
        this.DoneRestoreScrollTop();
      }
    };

    function CAjaxPagingControls(rgSearchData, url) {
      this.m_strActionURL = null;
      this.m_cPageSize = null;
      this.m_strElementPrefix = "";
      this.m_strClassPrefix = "";
      this.m_rgStaticParams = null;

      this.m_strQuery = null;
      this.m_cTotalCount = 0;
      this.m_iCurrentPage = 0;
      this.m_cMaxPages = 0;
      this.m_bLoading = false;

      this.m_fnPreRequestHandler = null;
      this.m_fnResponseHandler = null;
      this.m_fnPageChangingHandler = null;
      this.m_fnPageChangedHandler = null;


      this.m_strActionURL = url;

      this.m_strQuery = rgSearchData['query'];
      this.m_cTotalCount = rgSearchData['total_count'];
      this.m_iCurrentPage = 0;
      this.m_cPageSize = rgSearchData['pagesize'];
      this.m_cMaxPages = Math.ceil(this.m_cTotalCount / this.m_cPageSize);
      this.m_strDefaultAction = typeof rgSearchData['action'] != 'undefined' ? rgSearchData['action'] : 'render';
      this.m_rgAvailableSizes = [];

      if (rgSearchData['prefix'])
        this.m_strElementPrefix = rgSearchData['prefix'];

      if (rgSearchData['class_prefix'])
        this.m_strClassPrefix = rgSearchData['class_prefix'];

      $(this.m_strElementPrefix + '_btn_prev').observe('click', this.PrevPage.bind(this));
      $(this.m_strElementPrefix + '_btn_next').observe('click', this.NextPage.bind(this));
      var elPageSizeCtn = $(this.m_strElementPrefix + '_paging_size_ctn');
      for (var i = 0; elPageSizeCtn && i < $(elPageSizeCtn).children.length; ++i) {
        $(this.m_strElementPrefix + '_paging_size_' + i).observe('click', this.OnChangeSize.bind(this));

        this.m_rgAvailableSizes.push($(elPageSizeCtn).children[i].dataset.size);
      }

      this.UpdatePagingDisplay();
    }

    CAjaxPagingControls.prototype.GetActionURL = function (action) {
      var url = action ? this.m_strActionURL + action + '/' : this.m_strActionURL;
      return url;
    };

    CAjaxPagingControls.prototype.SetPreRequestHandler = function (fnHandler) {
      this.m_fnPreRequestHandler = fnHandler;
    };

    CAjaxPagingControls.prototype.SetResponseHandler = function (fnHandler) {
      this.m_fnResponseHandler = fnHandler;
    };

    CAjaxPagingControls.prototype.SetPageChangingHandler = function (fnHandler) {
      this.m_fnPageChangingHandler = fnHandler;
    };

    CAjaxPagingControls.prototype.SetPageChangedHandler = function (fnHandler) {
      this.m_fnPageChangedHandler = fnHandler;
    };

    CAjaxPagingControls.prototype.SetStaticParameters = function (rgParams) {
      this.m_rgStaticParams = rgParams;
    };

    CAjaxPagingControls.prototype.OnAJAXComplete = function () {
      this.m_bLoading = false;
    };

    CAjaxPagingControls.prototype.OnChangeSize = function (event) {
      if (event.target && event.target.dataset.size != this.m_cPageSize) {
        this.m_cPageSize = event.target.dataset.size;
        this.GoToPage(0, true);
      }
    };

    CAjaxPagingControls.prototype.NextPage = function () {
      if (this.m_iCurrentPage < this.m_cMaxPages - 1)
        this.GoToPage(this.m_iCurrentPage + 1);
    };

    CAjaxPagingControls.prototype.PrevPage = function () {
      if (this.m_iCurrentPage > 0)
        this.GoToPage(this.m_iCurrentPage - 1);
    };

    CAjaxPagingControls.prototype.GoToPage = function (iPage, bForce) {
      if (typeof (bForce) == 'undefined' || !bForce) {
        if (this.m_bLoading || iPage >= this.m_cMaxPages || iPage < 0 || iPage == this.m_iCurrentPage)
          return false;
      }

      var params = {
        query: this.m_strQuery,
        start: this.m_cPageSize * iPage,
        count: this.m_cPageSize
      };

      if (this.m_rgStaticParams != null) {
        for (var sParamName in this.m_rgStaticParams) {
          if (typeof sParamName != "string")
            continue;

          params[sParamName] = this.m_rgStaticParams[sParamName];
        }
      }

      if (this.m_fnPageChangingHandler != null)
        this.m_fnPageChangingHandler(iPage);

      if (this.m_fnPreRequestHandler != null)
        this.m_fnPreRequestHandler(params);

      this.m_bLoading = true;
      new Ajax.Request(this.GetActionURL(this.m_strDefaultAction), {
        method: 'get',
        parameters: params,
        onSuccess: this.OnResponseRenderResults.bind(this),
        onComplete: this.OnAJAXComplete.bind(this)
      });

      return true;
    };

    CAjaxPagingControls.prototype.OnResponseRenderResults = function (transport) {
      if (transport.responseJSON && transport.responseJSON.success) {
        if (typeof RecordAJAXPageView !== "undefined") {
          RecordAJAXPageView(transport.request.url);
        }

        var response = transport.responseJSON;
        this.m_cTotalCount = response.total_count;
        this.m_cMaxPages = Math.ceil(response.total_count / this.m_cPageSize);
        this.m_iCurrentPage = Math.floor(response.start / this.m_cPageSize);

        if (this.m_iCurrentPage != 0 && this.m_cTotalCount <= response.start) {
          // this page is no longer valid, flip back a page (deferred so that the AJAX handler exits and reset m_bLoading)
          this.GoToPage.bind(this, this.m_iCurrentPage - 1).defer();

          return;
        }

        var elResults = $(this.m_strElementPrefix + 'Rows');

        if (elResults)
          elResults.update(response.results_html);

        if (this.m_fnResponseHandler != null)
          this.m_fnResponseHandler(response);

        this.UpdatePagingDisplay();

        ScrollToIfNotInView($(this.m_strElementPrefix + 'Table'), 40);
      }
    };

    CAjaxPagingControls.prototype.UpdatePagingDisplay = function () {
      var elemNoResults = $(this.m_strElementPrefix + '_no_results');
      if (this.m_cTotalCount == 0) {
        $(this.m_strElementPrefix + '_ctn').hide();
        if (elemNoResults)
          elemNoResults.show();
      }
      else {
        $(this.m_strElementPrefix + '_ctn').show();
        if (elemNoResults)
          elemNoResults.hide();

        $(this.m_strElementPrefix + '_total').update(v_numberformat(this.m_cTotalCount));
        $(this.m_strElementPrefix + '_start').update(v_numberformat(this.m_iCurrentPage * this.m_cPageSize + 1));
        $(this.m_strElementPrefix + '_end').update(Math.min((this.m_iCurrentPage + 1) * this.m_cPageSize, this.m_cTotalCount));
      }

      if (this.m_rgAvailableSizes && this.m_rgAvailableSizes.length > 0) {
        if (this.m_cTotalCount <= this.m_rgAvailableSizes[0]) {
          $(this.m_strElementPrefix + '_per_page_ctn').hide();
        }
        else {
          $(this.m_strElementPrefix + '_per_page_ctn').show();
        }
      }

      if (this.m_cMaxPages <= 1) {
        $(this.m_strElementPrefix + '_controls').hide();
      }
      else {
        $(this.m_strElementPrefix + '_controls').show();
        if (this.m_iCurrentPage > 0)
          $(this.m_strElementPrefix + '_btn_prev').removeClassName('disabled');
        else
          $(this.m_strElementPrefix + '_btn_prev').addClassName('disabled');

        if (this.m_iCurrentPage < this.m_cMaxPages - 1)
          $(this.m_strElementPrefix + '_btn_next').removeClassName('disabled');
        else
          $(this.m_strElementPrefix + '_btn_next').addClassName('disabled');

        var elPageLinks = $(this.m_strElementPrefix + '_links');
        elPageLinks.update('');
        // we always show first, last, + 3 page links closest to current page
        var cPageLinksAheadBehind = 2;
        var firstPageLink = Math.max(this.m_iCurrentPage - cPageLinksAheadBehind, 1);
        var lastPageLink = Math.min(this.m_iCurrentPage + (cPageLinksAheadBehind * 2) + (firstPageLink - this.m_iCurrentPage), this.m_cMaxPages - 2);

        if (lastPageLink - this.m_iCurrentPage < cPageLinksAheadBehind)
          firstPageLink = Math.max(this.m_iCurrentPage - (cPageLinksAheadBehind * 2) + (lastPageLink - this.m_iCurrentPage), 1);

        this.AddPageLink(elPageLinks, 0);
        if (firstPageLink != 1)
          elPageLinks.insert(' ... ');

        for (var iPage = firstPageLink; iPage <= lastPageLink; iPage++) {
          this.AddPageLink(elPageLinks, iPage);
        }

        if (lastPageLink != this.m_cMaxPages - 2)
          elPageLinks.insert(' ... ');
        this.AddPageLink(elPageLinks, this.m_cMaxPages - 1);
      }

      if (this.m_rgAvailableSizes.indexOf(this.m_cPageSize) > -1) {
        for (var i = 0; i < this.m_rgAvailableSizes.length; ++i) {
          var elSizeItem = $(this.m_strElementPrefix + '_paging_size_' + i);
          if (elSizeItem.dataset.size == this.m_cPageSize) {
            elSizeItem.addClassName('size_selected');
          }
          else {
            elSizeItem.removeClassName('size_selected');
          }
        }
      }

      if (this.m_fnPageChangedHandler != null)
        this.m_fnPageChangedHandler(this.m_iCurrentPage);
    };

    CAjaxPagingControls.prototype.AddPageLink = function (elPageLinks, iPage) {
      var el = new Element('span', { 'class': (this.m_strClassPrefix != "" ? this.m_strClassPrefix : this.m_strElementPrefix) + '_paging_pagelink' });
      el.update((iPage + 1) + ' ');

      if (iPage == this.m_iCurrentPage)
        el.addClassName('active');
      else
        el.observe('click', this.GoToPage.bind(this, iPage));

      elPageLinks.insert(el);
    };


    function CSlider($Container, $Grabber, args) {
      this.m_$Container = $Container;
      this.m_$Grabber = $Grabber || $Container.find('.handle');
      this.m_nMinVal = args.min || 0;
      this.m_nMaxVal = args.max || 100;
      this.m_nIncrement = args.increment || 1;
      this.m_nValue = args.value || 0;
      this.m_fnOnChange = args.fnOnChange || function (value, bInDrag) { };

      this.m_$Grabber.css('position', 'absolute');
      this.CalcRatios();
      this.SetValue(this.m_nValue);

      var fnGetPageX = function (event) {
        if (event.type.indexOf('touch') == 0) {
          var TouchEvent = event.originalEvent;
          var rgTouches = TouchEvent ? TouchEvent.touches : null;
          if (!rgTouches || rgTouches.length < 1)
            return event.pageX || 0;	//probably wrong
          return rgTouches[0].pageX || 0;
        }
        else {
          return event.pageX || 0;
        }
      };

      var _this = this;
      this.m_$Container.on('mousedown touchstart', function (event) {
        _this.CalcRatios();

        if (!_this.m_$Grabber.is(event.target)) {
          // jump the grabber to this position and start the drag
          var nPosition = fnGetPageX(event) - _this.m_$Container.offset().left;
          // we want the grabber centered under the mosue if possible
          nPosition -= Math.floor(_this.m_$Grabber.width() / 2);
          var nNewPosition = Math.min(Math.max(nPosition, 0), _this.m_nWidth);

          _this.m_$Grabber.css('left', nNewPosition + 'px');
          _this.m_nValue = nNewPosition / _this.m_flRatio;
          if (_this.m_nIncrement > 1 && _this.m_nValue < _this.m_nMaxVal) {
            //_this.m_nValue += _this.m_nIncrement - 1;
            _this.m_nValue = parseInt(_this.m_nValue / _this.m_nIncrement) * _this.m_nIncrement;
          }

          _this.m_fnOnChange(_this.m_nValue, true);
        }
        var nInitialPosition = parseInt(_this.m_$Grabber.css('left'));
        var nStartDragX = fnGetPageX(event);

        $J(document).on('mousemove.CSlider touchmove.CSlider', function (event) {
          var nDelta = fnGetPageX(event) - nStartDragX;

          var nNewPosition = Math.min(Math.max(nInitialPosition + nDelta, 0), _this.m_nWidth);

          _this.m_$Grabber.css('left', nNewPosition + 'px');
          _this.m_nValue = nNewPosition / _this.m_flRatio;
          if (_this.m_nIncrement > 1 && _this.m_nValue < _this.m_nMaxVal) {
            //_this.m_nValue += _this.m_nIncrement - 1;
            _this.m_nValue = parseInt(_this.m_nValue / _this.m_nIncrement) * _this.m_nIncrement;
          }

          _this.m_fnOnChange(_this.m_nValue, true);
        });
        $J(document).on('mouseup.CSlider touchend.CSlider', function (event) {
          $J(document).off('.CSlider');
          _this.m_fnOnChange(_this.m_nValue, false);
        });

        event.preventDefault();
      });
    }

    CSlider.prototype.CalcRatios = function () {
      var nGrabberWidth = this.m_$Grabber.width();
      this.m_nWidth = this.m_$Container.width() - nGrabberWidth;

      this.m_flRatio = this.m_nWidth / (this.m_nMaxVal - this.m_nMinVal);
    };

    CSlider.prototype.SetValue = function (nValue, nAnimationSpeed) {
      this.m_nValue = Math.min(Math.max(nValue, this.m_nMinVal), this.m_nMaxVal);

      var nNewPosition = Math.floor((this.m_nValue - this.m_nMinVal) * this.m_flRatio);

      this.m_$Grabber.stop();
      if (nAnimationSpeed)
        this.m_$Grabber.animate({ left: nNewPosition }, nAnimationSpeed);
      else
        this.m_$Grabber.css('left', nNewPosition + 'px');
    };

    CSlider.prototype.GetValue = function () {
      return this.m_nValue;
    };

    CSlider.prototype.GetMin = function () {
      return this.m_nMinVal;
    };

    CSlider.prototype.GetMax = function () {
      return this.m_nMaxVal;
    };

    CSlider.prototype.SetRange = function (nMinVal, nMaxVal, nValue) {
      this.m_nMinVal = nMinVal;
      this.m_nMaxVal = nMaxVal;
      if (typeof nValue != 'undefined')
        this.m_nValue = nValue;
      this.CalcRatios();
      this.SetValue(this.m_nValue);
    };

    CSlider.prototype.SetIncrement = function (nIncrement) {
      this.m_nIncrement = nIncrement;
    };

    function CScrollSlider($Scroll, $Container, $Grabber, args) {
      this.m_$Scroll = $Scroll;
      this.m_$SliderCtn = $Container;

      var $Slider = $Container.children('.slider');

      this.m_Slider = new CSlider($Slider.length ? $Slider : $Container, $Grabber, { fnOnChange: $J.proxy(this.OnSliderChange, this) });

      this.m_$Scroll.css('overflowX', 'scroll');
      // add momentum on iOS
      this.m_$Scroll.css('-webkit-overflow-scrolling', 'touch');

      var _this = this;
      var bDidInitialRecalc = false;
      this.m_$Scroll.on('scroll.ScrollSlider', function () {
        if (!bDidInitialRecalc) {
          // we don't want to do this all the time, but on some browsers the first call to
          //	update ranges is too early and values don't compute correctly.
          _this.UpdateRanges();
          bDidInitialRecalc = true;
        }
        _this.m_Slider.SetValue(_this.m_$Scroll.scrollLeft());
      });
      $J(window).on('resize.ScrollSlider', function () {
        _this.UpdateRanges();
      });
      this.m_$Scroll.on('v_contentschanged', function () {
        _this.UpdateRanges();
      });

      this.UpdateRanges();
    }

    CScrollSlider.prototype.SetValue = function (value, nAnimationSpeed) {
      if (nAnimationSpeed) {
        this.m_$Scroll.stop().animate({ 'scrollLeft': value }, nAnimationSpeed);
      }
      else {
        this.m_$Scroll.stop().scrollLeft(value);
      }
    };

    CScrollSlider.prototype.GetValue = function () {
      return this.m_Slider.GetValue();
    };

    CScrollSlider.prototype.UpdateRanges = function () {
      var nParentWidth = this.m_$Scroll.width();
      var nScrollWidth = this.m_$Scroll[0].scrollWidth;

      if (nScrollWidth <= nParentWidth) {
        this.m_$SliderCtn.hide();
      }
      else {
        this.m_Slider.SetRange(0, nScrollWidth - nParentWidth, this.m_$Scroll.scrollLeft());
        this.m_$SliderCtn.show();
      }
    };

    CScrollSlider.prototype.OnSliderChange = function (value, bInDrag) {
      this.m_$Scroll.stop().scrollLeft(value);
    };

    function IsValidEmailAddress(email) {
      var email_regex = /^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i;
      return (email != '' && email_regex.test(email));
    }


    (function ($) {
      $.deparam = function (params, coerce) {
        var obj = {},
          coerce_types = { 'true': !0, 'false': !1, 'null': null };

        $.each(params.replace(/\+/g, ' ').split('&'), function (j, v) {
          var param = v.split('='),
            key = decodeURIComponent(param[0]),
            val,
            cur = obj,
            i = 0,

            keys = key.split(']['),
            keys_last = keys.length - 1;

          if (/\[/.test(keys[0]) && /\]$/.test(keys[keys_last])) {
            keys[keys_last] = keys[keys_last].replace(/\]$/, '');

            keys = keys.shift().split('[').concat(keys);

            keys_last = keys.length - 1;
          } else {
            keys_last = 0;
          }

          if (param.length === 2) {
            val = decodeURIComponent(param[1]);

            if (coerce) {
              val = val && !isNaN(val) ? +val              // number
                : val === 'undefined' ? undefined         // undefined
                  : coerce_types[val] !== undefined ? coerce_types[val] // true, false, null
                    : val;                                                // string
            }

            if (keys_last) {
              for (; i <= keys_last; i++) {
                key = keys[i] === '' ? cur.length : keys[i];
                cur = cur[key] = i < keys_last
                  ? cur[key] || (keys[i + 1] && isNaN(keys[i + 1]) ? {} : [])
                  : val;
              }

            } else {

              if ($.isArray(obj[key])) {
                obj[key].push(val);

              } else if (obj[key] !== undefined) {
                obj[key] = [obj[key], val];

              } else {
                obj[key] = val;
              }
            }

          } else if (key) {
            obj[key] = coerce
              ? undefined
              : '';
          }
        });

        return obj;
      };
    })(jQuery);

    /**
     * Generic search field that handles:
     * 1.) Showing default text if the input field is empty
     * 2.) When the input field gets focus, the text field clears
     * 3.) Adding CSS class to the input field when it is default text
     * 4.) When the user presses return/enter in  the field
     *
     * Call ClearIfDefaultValue() before submitting the form
     */
    function SearchFieldWithText(elemID, defaultSearchText, onEnterFunc, defaultTextCSSClass) {
      var elem = $(elemID);

      this.elem = elem;
      this.defaultSearchText = defaultSearchText;
      this.defaultTextCSSClass = defaultTextCSSClass;
      this.onEnterFunc = onEnterFunc;

      Event.observe(elem, 'click', this.handleClickOrFocus.bind(this));
      Event.observe(elem, 'focus', this.handleClickOrFocus.bind(this));
      Event.observe(elem, 'blur', this.handleBlur.bind(this));
      Event.observe(elem, 'keypress', this.handleKeypress.bind(this));
      Event.observe(elem.form, 'submit', this.ClearIfDefaultValue.bind(this));

      this.handleBlur();
    }

    SearchFieldWithText.prototype.handleClickOrFocus = function () {
      if (this.elem.value == this.defaultSearchText) {
        this.elem.value = '';
        if (this.defaultTextCSSClass)
          this.elem.removeClassName(this.defaultTextCSSClass);
      }
    };

    SearchFieldWithText.prototype.handleBlur = function () {
      if (this.elem.value == '') {
        this.elem.value = this.defaultSearchText;
        if (this.defaultTextCSSClass)
          this.elem.addClassName(this.defaultTextCSSClass);
      }
    };

    SearchFieldWithText.prototype.handleKeypress = function () {
      if (!this.onEnterFunc)
        return;

      var keyCode = null;
      if (event.which) {
        keyCode = event.which;
      }
      else if (event.keyCode) {
        keyCode = evt.keyCode;
      }
      if (13 == keyCode) {
        this.onEnterFunc();
      }
    };

    SearchFieldWithText.prototype.ClearIfDefaultValue = function () {
      if (this.elem.value == this.defaultSearchText) {
        this.elem.value = '';
      }
    };


    function CWebAPI(strWebAPIHost, strSecureWebAPIHost, strOAuth2Token) {
      this.m_strHost = strWebAPIHost;
      this.m_strSecureWebAPIHost = strSecureWebAPIHost;
      this.m_strOAuth2Token = strOAuth2Token;
    }

    CWebAPI.prototype.BuildURL = function (strInterface, strMethod, bSecure, strVersion) {
      if (!strVersion)
        strVersion = 'v0001';

      var strURL = (bSecure ? this.m_strSecureWebAPIHost : this.m_strHost);
      strURL += strInterface + '/' + strMethod + '/' + strVersion + '/';

      return strURL;
    };

    CWebAPI.prototype.ExecJSONP = function (strInterface, strMethod, rgParams, bSecure, strVersion, cTimeoutSecs) {
      rgParams.access_token = this.m_strOAuth2Token;

      var rgJQueryParams = {
        url: this.BuildURL(strInterface, strMethod, bSecure, strVersion),
        dataType: 'jsonp',
        jsonp: 'jsonp', data: rgParams
      };

      if (cTimeoutSecs)
        rgJQueryParams['timeout'] = cTimeoutSecs * 1000;

      return $J.ajax(rgJQueryParams);

      /*
      // using jsonp plugin instead of built-in jquery jsonp handling.  this library supposedly
      //	works around the firefox "waiting for host..." issue, but it doesn't work.
      return $J.jsonp({
        url: this.BuildURL( strInterface, strMethod, bSecure, strVersion ),
        callbackParameter: 'jsonp',				data: rgParams
      });
      */
    };

    // Send a "beacon", which is specifically intended for use in OnUnload events (as outsdanding AJAX/JSONP requests may be cancelled)
    // as of sept 2015, only chrome and firefox support this, no iOS or IE support.  Check for support before calling.
    // Beacons are (per spec) always a POST request, and always include CORS headers.  WebAPI respondes properly to CORS for Valve domains.
    CWebAPI.prototype.ExecBeacon = function (strInterface, strMethod, rgParams, bSecure, strVersion) {
      rgParams.access_token = this.m_strOAuth2Token;

      var fdParams = new FormData();
      for (var key in rgParams)
        fdParams.append(key, rgParams[key]);

      navigator.sendBeacon(this.BuildURL(strInterface, strMethod, bSecure, strVersion), fdParams);
    };


    CWebAPI.prototype.ExecPOST = function (strInterface, strMethod, rgParams, bSecure, strVersion) {
      rgParams.access_token = this.m_strOAuth2Token;
      rgParams.format = 'json';

      return $J.ajax({
        url: this.BuildURL(strInterface, strMethod, bSecure, strVersion),
        type: 'POST',
        data: rgParams
      });
    };

    // register some events to dismiss popup (ie, user clicking elsewhere on the window, escape)
    //   cleans up event binds afterwards.  clicks to children of "elemIgnore" will not dismiss popup
    function RegisterPopupDismissal(dismissFunc, elemIgnore) {
      var $Ignore = $JFromIDOrElement(elemIgnore);
      // delay registration by one frame so that we don't catch the event that triggered this popup.
      window.setTimeout(function () {
        $J(document).on('click.RegisterPopupDismissal keydown.RegisterPopupDismissal', function (event) {

          if (event.keyCode && event.keyCode != 27 /* KEY_ESC */) {
            return;
          }
          var elem = $J(event.target);

          if ($Ignore.length && $J.contains($Ignore[0], elem[0]))
            return;

          dismissFunc();
          UnregisterPopupDismissal(elemIgnore);
        });

        // support gamepad B button to dismiss
        $Ignore.on('vgp_oncancel', function (event) {
          dismissFunc();
          UnregisterPopupDismissal(elemIgnore);

          event.stopPropagation();
          event.preventDefault();
        });
      }, 1);
    }

    /* Cleanup function for the above RegisterPopupDismissal()
       This needs to be accessible to popup owners so they can call this if they're closing the popup */
    function UnregisterPopupDismissal(elemIgnore) {
      $J(document).off('.RegisterPopupDismissal');

      if (elemIgnore) {
        // unregister gamepad B button press handling
        $JFromIDOrElement(elemIgnore).off('vgp_oncancel');
      }
    }


    function ShowMenu(elemLink, elemPopup, align, valign, bLinkHasBorder) {
      var $Popup = $JFromIDOrElement(elemPopup);

      // If we're in tablet screen mode put the menu content in a modal dialog
      var bUseTabletScreenMode = window.UseTabletScreenMode && window.UseTabletScreenMode();
      if (bUseTabletScreenMode) {
        // detach this element and when the dialog closes re-attach to the document body
        $Popup.detach();
        var originalPopupPosition = $Popup.css('position');
        $Popup.css('position', 'static'); // clear possible absolute positioning
        $Popup.show();

        ShowDialog('', $Popup).always(
          function () {
            // save it away again for later
            $Popup.hide();
            $Popup.css('position', originalPopupPosition); // restore positioning
            $J(document.body).append($Popup);
          }
        );

        return;
      }

      var $Link = $JFromIDOrElement(elemLink);
      if ($Link.hasClass('focus')) {
        HideMenu(elemLink, elemPopup);
        return;
      }

      AlignMenu($Link, $Popup, align, valign, bLinkHasBorder);

      ShowWithFade($Popup);
      $Link.addClass('focus');
      RegisterPopupDismissal(function () { HideMenu(elemLink, elemPopup); }, $Popup);

      // If we use this control on gamepad (haven't found an example yet we're going to keep) then we'll need to
      // add calling: GPOnShowingModalWindow( $Popup[0] ).  See shared_responsive_adapter.js for example
    }

    function HideMenu(elemLink, elemPopup) {
      var $Link = $JFromIDOrElement(elemLink);
      var $Popup = $JFromIDOrElement(elemPopup);

      $Link.data('menu-active', false);
      HideWithFade($Popup);
      $Link.removeClass('focus');

      UnregisterPopupDismissal(elemPopup);
    }

    function HideMenuFast(elemLink, elemPopup) {
      var $Link = $JFromIDOrElement(elemLink);
      var $Popup = $JFromIDOrElement(elemPopup);

      $Popup.hide();
      $Link.removeClass('focus');

      UnregisterPopupDismissal(elemPopup);
    }


    function RegisterFlyout(elemLink, elemPopup, align, valign, bLinkHasBorder) {
      var $Link = $JFromIDOrElement(elemLink);
      var $Popup = $JFromIDOrElement(elemPopup);

      $Link.on('mouseenter', function (event) {
        FlyoutMenu($Link, $Popup, align, valign, bLinkHasBorder);
      });

      $Link.add($Popup).on('mouseleave', function (event) {
        HideFlyoutMenu(event, $Link, $Popup);
      });
    }

    function UseSmallScreenMenu() {
      // the new mobile app uses the small screen menu regardless of screen size
      return (window.UseSmallScreenMode && window.UseSmallScreenMode()) || (window.UseNewMobileAppMode && window.UseNewMobileAppMode());
    }

    function FlyoutMenu(elemLink, elemPopup, align, valign, bLinkHasBorder, elemAlternateAlignTo) {
      var $Link = $JFromIDOrElement(elemLink);
      var $Popup = $JFromIDOrElement(elemPopup);

      if (!$Popup.is(':visible') || $Popup.css('opacity') < 1.0) {
        if ($Popup.hasClass('responsive_slidedown') && UseSmallScreenMenu()) {
          $Popup.stop().slideDown();
        }
        else {
          // Responsive mode calls slideDown, which applies position: relative to the element and we need to clear it.
          // This will only happen if the user interacted with the menu in the responsive mode, then resized
          // their window to be large and hovered the elements.
          $Popup.css({ position: '' });
          AlignMenu($Link, $Popup, align, valign, bLinkHasBorder, elemAlternateAlignTo || null);
          ShowWithFade($Popup);
        }

        $Link.addClass('focus');
      }

    }

    function HideFlyoutMenu(event, elemLink, elemPopup) {
      var $Link = $JFromIDOrElement(elemLink);
      var $Popup = $JFromIDOrElement(elemPopup);

      if (!$Link.hasClass('focus'))
        return;

      if (event) {
        var reltarget = $J(event.relatedTarget);
        if (!reltarget.length ||
          ($Link.length && $J.contains($Link[0], reltarget[0])) ||
          ($Popup.length && $J.contains($Popup[0], reltarget[0])) ||
          $Link.is(reltarget))
          return;
      }
      // start hiding in a little bit, have to let the fade in animation start before we can cancel it

      if ($Popup.hasClass('responsive_slidedown') && UseSmallScreenMenu())
        $Popup.stop().slideUp();
      else
        window.setTimeout(function () { HideWithFade($Popup); }, 33);

      $Link.removeClass('focus');
      $J(document).off('.FlyoutDismiss');
    }

    function AlignMenu(elemLink, elemPopup, align, valign, bLinkHasBorder, elemAlternateAlignTo) {
      var align = align ? align : 'left';

      // alternate align to is used to align the genre menu on the store; it's only used for horizontal alignment,
      // trying to align to it vertically messes up responsive view.
      var $LinkVertical = $JFromIDOrElement(elemLink);
      var $LinkHorizontal = elemAlternateAlignTo ? $JFromIDOrElement(elemAlternateAlignTo) : $LinkVertical;

      var $Popup = $JFromIDOrElement(elemPopup);


      var offsetLinkVertical = $LinkVertical.offset();
      var offsetLinkHorizontal = $LinkHorizontal.offset();
      var nWindowScrollTop = $J(window).scrollTop();
      var nViewportHeight = $J(window).height();

      var nLinkViewportTop = offsetLinkVertical.top - nWindowScrollTop;

      // add a little bit of padding so we don't position it flush to an edge if possible
      var nPopupHeight = $Popup.height() + 8;

      if (!valign) {
        //if there's not enough room between our spot and the top of the document, we definitely want to drop down
        if (nWindowScrollTop + offsetLinkVertical.top < nPopupHeight) {
          valign = 'bottom';
        }
        else {
          var nSpaceAbove = nLinkViewportTop;
          var nSpaceBelow = nViewportHeight - (nLinkViewportTop + $LinkVertical.height());
          //otherwise we only want to drop down if we've got enough space below us (measured based on view area)
          // or if there's not enough space above to pop in either direction and there's more space below
          if (nSpaceBelow > nPopupHeight || (nSpaceAbove < nPopupHeight && nSpaceBelow > nSpaceAbove))
            valign = 'bottom';
          else
            valign = 'top';

        }
      }

      var borderpx = bLinkHasBorder ? 1 : 0;
      var shadowpx = $Popup.hasClass('popup_block_new') ? 0 : 12;
      var offsetLeft = 0;

      if (align == 'left') {
        //elemPopup.style.left = ( elemLink.positionedOffset()[0] - 12 ) + 'px';
        offsetLeft = -shadowpx - borderpx;
      }
      else if (align == 'right') {
        //elemPopup.style.left = ( elemLink.positionedOffset()[0] + elemLink.getWidth() - elemPopup.getWidth() + 13 ) + 'px';
        offsetLeft = $LinkHorizontal.outerWidth() - $Popup.outerWidth() + shadowpx + borderpx;
      }
      else if (align == 'leftsubmenu') {
        //elemPopup.style.left = ( elemLink.positionedOffset()[0] - elemPopup.getWidth() + 12 ) + 'px';
        offsetLeft = -$Popup.outerWidth() + shadowpx - borderpx;
      }
      else if (align == 'rightsubmenu') {
        //elemPopup.style.left = ( elemLink.positionedOffset()[0] + elemLink.getWidth() - 12 ) + 'px';
        offsetLeft = $LinkHorizontal.outerWidth() - shadowpx + 2 * borderpx;
      }

      var offsetTop = 0;
      if (valign == 'bottom') {
        //elemPopup.style.top = ( elemLink.positionedOffset()[1] + elemLink.getHeight() - 12 ) + 'px';
        offsetTop = $LinkVertical.outerHeight() - shadowpx;
      }
      else if (valign == 'top') {
        //elemPopup.style.top = ( elemLink.positionedOffset()[1] - elemPopup.getHeight() + 12 ) + 'px';
        offsetTop = -$Popup.outerHeight() + shadowpx;
      }
      else if (valign == 'bottomsubmenu') {
        //elemPopup.style.top = ( elemLink.positionedOffset()[1] - 12 ) + 'px';
        offsetTop = -shadowpx;
      }


      var bPopupHidden = !$Popup.is(':visible');

      if (bPopupHidden) {
        // IE can't do this with display: none elements
        $Popup.css('visibility', 'hidden');
        $Popup.show();
      }

      $Popup.offset({
        top: Math.max(offsetLinkVertical.top + offsetTop, 0),
        left: Math.max(offsetLinkHorizontal.left + offsetLeft, 0)
      });

      if (bPopupHidden) {
        // restore visibility
        $Popup.hide();
        $Popup.css('visibility', 'visible');
      }
    }

    function BindAutoFlyoutEvents() {
      var fnShowFlyout = function ($Tab, bIsHover, bTakeFocus) {
        var $Content = $J('#' + $Tab.data('flyout'));
        var bResponsiveSlidedownMenu = UseSmallScreenMenu() && $Content.hasClass('responsive_slidedown');

        if (!$Content.length || $Content.data('flyout-event-running') ||
          (bIsHover && bResponsiveSlidedownMenu))
          return;

        $Content.data('flyout-event-running', true);
        window.setTimeout(function () { $Content.data('flyout-event-running', false); }, 1);

        if ($Content.is(':visible')) {
          if (!bIsHover)
            HideFlyoutMenu(null, $Tab, $Content);

          return;
        }

        if (!$Content.data('flyout-events-bound')) {
          $Content.on('mouseleave.Flyout', function (e) {
            if (UseSmallScreenMenu() && $Content.hasClass('responsive_slidedown'))
              return;

            if ($Tab.is(e.relatedTarget) || $J.contains($Tab[0], e.relatedTarget))
              return;

            HideFlyoutMenu(null, $Tab, $Content);
          });

          $Content.add($Tab).on('vgp_oncancel', function (e) {
            HideFlyoutMenu(null, $Tab, $Content);
            if (typeof GPNavFocusChild != 'undefined')
              GPNavFocusChild($Tab);
          });

          $Content.on('vgp_onblur', function (e) {
            var node = e.originalEvent.detail.focusedNode;
            console.log(node);
            if (!node || !$J.contains(e.currentTarget, node.Element))
              HideFlyoutMenu(null, $Tab, $Content);
          });

          $Content.data('flyout-events-bound', true);
        }


        FlyoutMenu($Tab, $Content, $Tab.data('flyout-align'), $Tab.data('flyout-valign'), false, $Tab.data('flyout-align-to-element'));

        if (bTakeFocus && typeof GPNavFocusChild !== 'undefined') {
          window.setTimeout(function () {
            console.log('Request focus in', $Content[0]);
            GPNavFocusChild($Content);
          }, 5);
        }

        if (window.UseTouchFriendlyMode && window.UseTouchFriendlyMode()) {
          window.setTimeout(function () {
            $J(document).on('click.FlyoutDismiss', function (e) {
              if ($J.contains($Content[0], e.target) || $Content.is(e.target))
                return;

              HideFlyoutMenu(null, $Tab, $Content);
              e.preventDefault();
            });
          }, 1);
        }
      };

      $J(document).on('mouseenter.Flyout click.Flyout', '.flyout_tab', function (e) {
        var $Tab = $J(this);
        var msDelay = $Tab.data('flyout-delay');

        var bIsHover = e.type == 'mouseenter';

        if (!bIsHover || !msDelay) {
          fnShowFlyout($Tab, bIsHover);
        }
        else if (!$Tab.data('iFlyoutInterval')) {
          var fnCleanupFlyoutInterval = function () {
            $Tab.removeData('iFlyoutInterval');
            $Tab.off('mouseleave.FlyoutCancel');
          }
          $Tab.on('mouseleave.FlyoutCancel', function (e) {
            window.clearTimeout($Tab.data('iFlyoutInterval'));
            fnCleanupFlyoutInterval();
          });
          $Tab.data('iFlyoutInterval', window.setTimeout(function () {
            fnCleanupFlyoutInterval();
            fnShowFlyout($Tab, bIsHover);
          }, msDelay));
        }

      });

      $J(document).on('mouseleave.Flyout', '.flyout_tab', function (e) {
        var $Tab = $J(this);
        var $Content = $J('#' + $Tab.data('flyout'));
        var bResponsiveSlidedownMenu = UseSmallScreenMenu() && $Content.hasClass('responsive_slidedown');

        if (!$Content.length || $Content.data('flyout-event-running') || bResponsiveSlidedownMenu ||
          $Content.is(e.relatedTarget) || $J.contains($Content[0], e.relatedTarget))
          return;

        if ($Content.is(':visible')) {
          HideFlyoutMenu(null, $Tab, $Content);

          return;
        }
      });

      $J(document).on('vgp_onok', '.flyout_tab', function (e) {
        fnShowFlyout($J(this), false, true);
        e.stopPropagation();
      });
    }

    function PollOnUserActionAfterInterval(strNamespace, nPollInterval, fnCallback, nPollImmediateInterval) {
      var bCallbackInvoked = false;
      var tsLastUserAction = $J.now();
      var fnInvokeCallbackOnNextUserAction;

      var strEvents = ['touchstart', 'mousemove', 'focus', 'scroll', ''].join('.' + strNamespace + ' ');

      var fnDoPoll = function () {
        if (!bCallbackInvoked)
          fnCallback();
        bCallbackInvoked = true;
        fnInvokeCallbackOnNextUserAction();
      };

      fnInvokeCallbackOnNextUserAction = function () {
        window.setTimeout(function () {
          bCallbackInvoked = false;
          if (nPollImmediateInterval && $J.now() <= tsLastUserAction + nPollImmediateInterval) {
            fnDoPoll();
          }
          else {
            $J(window).on(strEvents, function () {
              $J(window).off('.' + strNamespace);
              tsLastUserAction = $J.now();
              fnDoPoll();
            });
          }
        }, nPollInterval);
      };

      fnInvokeCallbackOnNextUserAction();
    }

    var DELAY_BETWEEN_NOTIFICATION_COUNT_POLLS_MS = 60 * 1000;
    function EnableNotificationCountPolling() {
      PollOnUserActionAfterInterval('NotificationCountPoll', DELAY_BETWEEN_NOTIFICATION_COUNT_POLLS_MS, UpdateNotificationCounts);
    }

    function UpdateNotificationCounts() {
      if (window.RefreshSteamNotifications)
        window.RefreshSteamNotifications();
    }

    function PostToURLWithSession(url, rgParams) {
      var $Form = $J('<form/>', { 'action': url, 'method': 'POST' });

      // site must set this js var or pass to this function
      if (typeof g_sessionID != 'undefined')
        $Form.append($J('<input/>', { 'type': 'hidden', 'name': 'sessionid', 'value': g_sessionID }));

      if (rgParams) {
        for (var name in rgParams)
          $Form.append($J('<input/>', { 'type': 'hidden', 'name': name, 'value': rgParams[name] }));
      }
      $Form.appendTo('body');
      $Form.submit();
    }


    function ShowWithFade(elem, speed) {
      var $Elem = $JFromIDOrElement(elem);

      $Elem.stop();
      $Elem.fadeTo(speed || 200, 1.0);	//fadeTo rather than fadeIn in case it was already in a fade
    }

    function HideWithFade(elem, speed) {
      var $Elem = $JFromIDOrElement(elem);

      $Elem.stop();
      $Elem.fadeOut(speed || 200);
    }


    function LaunchWebChat(params, paramsFriendsUI) {
      var winChat = window.open('', 'SteamWebChat', 'height=790,width=1015,resize=yes,scrollbars=yes');
      if (!winChat) {
        // popup blocked - this sometimes happens when chat is initiated from the store.  just roll with it.
        return;
      }

      var bNewPopup = false;
      var bCrossOrigin = false;

      try {
        bNewPopup = (winChat.location == 'about:blank');
      }
      catch (e) {
        // cross-origin exception on http pages etc
        bCrossOrigin = true;
      }

      if (bNewPopup) {
        if (params)
          SetValueLocalStorage('rgChatStartupParam', V_ToJSON(params));

        if (paramsFriendsUI) {
          var fnBoundMessageListener = function (event) {
            if (event.source == winChat && event.data == "FriendsUIReady" &&
              event.origin == 'https://steamcommunity.com') {
              winChat.postMessage(paramsFriendsUI, 'https://steamcommunity.com/');
              window.removeEventListener('message', fnBoundMessageListener);
            }
          };
          window.addEventListener('message', fnBoundMessageListener);
        }

        // created a new window, set the url
        winChat.location = 'https://steamcommunity.com/chat/';
      }
      else {
        if (params && !bCrossOrigin && winChat.OnWebchatLaunchURL)
          winChat.OnWebchatLaunchURL(params);

        if (paramsFriendsUI)
          winChat.postMessage(paramsFriendsUI, 'https://steamcommunity.com/');
      }
      winChat.focus();
    }

    function ShowSupportAlerts(url) {
      window.open(url, 'SupportAlerts', 'height=700,width=700,resize=yes,scrollbars=yes');
    }

    function UnlockFamilyView(strURL) {
      window.location = strURL;
    }

    function LockFamilyView(bStore) {

      var urlFirst = '';
      var urlSecond = '';
      if (bStore) {
        urlFirst = 'https://store.steampowered.com/';
        urlSecond = 'https://steamcommunity.com/';
      }
      else {
        urlFirst = 'https://steamcommunity.com/';
        urlSecond = 'https://store.steampowered.com/';
      }

      ShowConfirmDialog('Return to Family View',
        'Are you sure you want to return to Family View?',
        'Return to Family View'
      ).done(function () {
        ShowBlockingWaitDialog('Return to Family View');

        CrossDomainPost(urlFirst + '/parental/ajaxlock', {}).then(function () {
          $J.when(
            CrossDomainPost('https://checkout.steampowered.com/parental/ajaxlock', {}),
            CrossDomainPost('https://steam.tv/parental/ajaxlock', {}),
            CrossDomainPost(urlSecond + 'parental/ajaxlock', {})
          ).always(function () {
            window.location = urlFirst;
          });
        });
      });
    }

    function setTimezoneCookies() {
      var now = new Date();
      var expire = new Date();

      // One year expiration, this way we don't need to wait at least one page
      // load to have accurate timezone info each session, but only each time the user
      // comes with cleared cookies
      expire.setTime(now.getTime() + 3600000 * 24 * 365);
      var tzOffset = now.getTimezoneOffset() * -1 * 60;
      var isDST = 0;

      var sameSite = '';
      if (window.location.protocol == 'https')
        sameSite = '; Secure; SameSite=None;'
      document.cookie = "timezoneOffset=" + tzOffset + "," + isDST + ";expires=" + expire.toGMTString() + ";path=/" + sameSite;
    }

    function FlushStyleChanges(element) {
      $J(element).css('opacity');
    }

    var k_EScrollbarDirectionVertical = 1;
    var k_EScrollbarDirectionHorizontal = 2;

    window.VScrollbar = function (eleTarget, eleHandle, direction) {
      this.m_eleHandle = eleHandle;
      this.m_eleTarget = eleTarget;

      var instance = this;

      var propOffset, propSize, propOuterSize, propDimension, propPage, directionInvert, propOffsetEvent;

      if (direction == k_EScrollbarDirectionVertical) {
        propOffset = 'top';
        propSize = 'height';
        propOuterSize = 'outerHeight';
        propDimension = 'y';
        propPage = 'pageY';
        propOffsetEvent = 'offsetY';
      } else if (direction == k_EScrollbarDirectionHorizontal) {
        propOffset = 'left';
        propSize = 'width';
        propOuterSize = 'outerWidth';
        propDimension = 'x';
        propPage = 'pageX';
        propOffsetEvent = 'offsetX';

        this.m_eleTarget.first().css({ 'white-space': 'nowrap' });
      }

      // Set up some CSS properties we need
      this.m_eleHandle.css({ position: 'absolute' });
      if (this.m_eleHandle.parent().css('position') == 'static')
        this.m_eleHandle.parent().css({ position: 'relative' }); // Needs to be relative or absolute, only set it if we didn't do it in CSS
      this.m_eleTarget.css({ position: 'relative', float: 'left' });
      this.m_eleTarget.css(propOffset, '0px');
      this.m_eleTarget.addClass('animating');
      this.m_eleTarget.parent().addClass('v_scrollbar_target');
      this.m_eleTarget.parent().css({ position: 'relative', overflow: 'hidden' });
      this.m_nDesiredPosition = 0;
      this.m_flPercent = 0;


      var funcUpdate = function (bDisableTransitions) {
        var bScrolled = true;
        if (instance.m_eleTarget[propSize]() - instance.m_eleTarget.parent()[propSize]() <= 0) {
          instance.m_eleHandle.parent().addClass('disabled');
          instance.m_flPercent = 0;
          bScrolled = false;
        } else
          instance.m_eleHandle.parent().removeClass('disabled');

        if (instance.m_flPercent < 0)
          instance.m_flPercent = 0;

        if (instance.m_flPercent > 1)
          instance.m_flPercent = 1;


        var percent = instance.m_flPercent;

        if (bDisableTransitions)
          instance.DisableTransitions();

        instance.m_nDesiredPosition = -percent * (instance.m_eleTarget[propSize]() - instance.m_eleTarget.parent()[propSize]());

        // Update container
        instance.m_eleTarget[0].style[propOffset] = instance.m_nDesiredPosition + 'px';

        // Update scroll handle
        var handleMax = instance.m_eleHandle.parent()[propSize]() - instance.m_eleHandle[propOuterSize]();
        instance.m_eleHandle[0].style[propOffset] = (percent * handleMax) + 'px';

        if (bDisableTransitions)
          instance.EnableTransitions();

        return bScrolled;
      };

      var funcMouseMove = function (event) {
        var localDimension = event[propPage] - instance.m_eleHandle.parent().offset()[propOffset];
        var localMax = instance.m_eleHandle.parent()[propSize]() - instance.m_eleHandle[propOuterSize]();

        var percent = localDimension / localMax;
        instance.m_flPercent = percent;

        if (funcUpdate(true))
          event.preventDefault();


      };

      $J(eleTarget).bind('mousewheel DOMMouseScroll', function (event) {
        var delta = event.originalEvent.wheelDelta || event.originalEvent.detail * -12;

        var localY = instance.m_nDesiredPosition * -1;
        var localMax = instance.m_eleTarget[propOuterSize]() - instance.m_eleTarget.parent()[propSize]();

        if (localY <= 0 && delta > 0 || localY == localMax && delta < 0)
          return;

        localY -= delta;

        if (localY < 0) localY = 0;
        if (localY > localMax) localY = localMax;

        var percent = localY / localMax;

        instance.m_flPercent = percent;

        if (funcUpdate())
          event.preventDefault();
      });

      $J(eleHandle.parent()).bind('click', function (event) {
        var localY = instance.m_eleTarget.position()[propOffset] * -1;
        var localMax = instance.m_eleTarget[propOuterSize]() - instance.m_eleTarget.parent()[propSize]();

        var step = instance.m_eleTarget.parent()[propSize]();

        if (event[propOffsetEvent] < instance.m_eleHandle.position()[propOffset])
          step *= -1;

        localY += step;

        if (localY < 0) localY = 0;
        if (localY > localMax) localY = localMax;

        var percent = localY / localMax;

        instance.m_flPercent = percent;

        if (funcUpdate())
          event.preventDefault();
      });

      eleHandle.mousedown(function (event) {
        $J(window).bind('mousemove.scroll', funcMouseMove);
        event.stopPropagation();
      });

      eleHandle.click(function (event) {
        event.stopPropagation();
      });

      $J(window).mouseup(function (event) {
        $J(window).unbind('mousemove.scroll');
        event.stopPropagation();
      });

      // Resets scroll position to 0 and updates the window. Useful when adding/removing elements or resizing the scroll area
      this.Reset = function () {
        instance.m_flPercent = 0;

        return funcUpdate(true);
      };

      // Ensures target element is visible. This is taken from position() (NOT OFFSET) so the element must be a direct child of the scroll area
      this.EnsureVisible = function (ele) {
        var $ele = $J(ele);
        var eleSize = $ele[propOuterSize](true);
        var minEdge = $ele.position()[propOffset] - (eleSize * 0.5);
        var maxEdge = minEdge + (eleSize * 2);


        var viewportMax = instance.m_eleTarget[propOuterSize]() - instance.m_eleTarget.parent()[propSize]();
        var viewportSize = instance.m_eleTarget.parent()[propSize]();
        var viewportPosition = instance.m_eleTarget.position()[propOffset] * -1;

        if (viewportPosition > minEdge)
          instance.m_flPercent = minEdge / viewportMax;
        else if ((viewportPosition + viewportSize) < maxEdge)
          instance.m_flPercent = (maxEdge - viewportSize) / viewportMax;

        return funcUpdate();
      };

      this.EnableTransitions = function () {
        instance.m_eleTarget.addClass('animating');
      };

      this.DisableTransitions = function () {
        instance.m_eleTarget.removeClass('animating');
      };

      funcUpdate(true);


    };

    function InitAutoComplete(elInput, fnSearch, fnOnChange) {
      return new CAutoComplete(elInput, fnSearch, fnOnChange);
    }

    function CAutoComplete(elInput, fnSearch, fnOnChange) {
      this.m_bSuppresseNextKeyUp = false;
      this.m_hSearchTimeout = 0;
      this.m_strLastSearch = '';

      this.m_$Input = $J(elInput);
      this.m_fnSearch = fnSearch;
      this.m_fnOnChange = fnOnChange;

      var strName = this.m_$Input.attr('name');
      if (!strName)
        strName = 'unknown';

      strName = strName + '_autocomplete';

      this.m_$Popup = $J('<div class="' + strName + '"></div>');
      this.m_$Popup.css('width', this.m_$Input.outerWidth() + 'px');
      this.m_$Input.after(this.m_$Popup);
      this.m_$Popup.hide();

      var _this = this;
      this.m_$Input.on('keydown.autocomplete', function (event) { _this.OnInputKeyDown(event); });
      this.m_$Input.on('keyup.autocomplete', function (event) { _this.OnInputKeyUp(event); });
      this.m_$Input.on('blur.autocomplete', function (event) { _this.OnInputBlur(event); });
      this.m_$Input.on('change input paste', function (event) { _this.OnInputChange(event); });

      this.m_$Popup.on('mousedown.autocomplete', function (event) { _this.m_$Popup.data('mousedown', true); });
      this.m_$Popup.on('mouseup.autocomplete', function (event) { _this.m_$Popup.data('mousedown', false); });
    }

    CAutoComplete.KEY_ENTER = 13;
    CAutoComplete.KEY_UP = 38;
    CAutoComplete.KEY_DOWN = 40;

    CAutoComplete.prototype.OnInputChange = function (event) {
      if (this.m_fnOnChange)
        this.m_fnOnChange(this.m_$Input, null);

      if (this.m_hSearchTimeout == 0) {
        var _this = this;
        var fnDoSearch = function () {
          _this.m_hSearchTimeout = 0;
          var strSearch = _this.m_$Input.val();
          if (strSearch == _this.m_strLastSearch)
            return;

          _this.m_strLastSearch = strSearch;
          _this.m_fnSearch(_this.m_$Input, strSearch, function ($Contents) { _this.SetPopupContents($Contents); });
        };

        this.m_hSearchTimeout = window.setTimeout(fnDoSearch, 300);
      }
    }

    CAutoComplete.prototype.SetPopupContents = function ($Contents) {
      if (!$Contents) {
        this.ClosePopup();
        return;
      }

      this.m_$Popup.html('');
      this.m_$Popup.append($Contents);

      var _this = this;
      this.m_$Popup.children().on('click.autocomplete', function (event) { _this.SelectSuggestion($J(this)); });
      this.m_$Popup.show();
    }

    CAutoComplete.prototype.OnInputBlur = function (event) {
      if (!this.m_$Popup.data('mousedown'))
        this.ClosePopup();
    }

    CAutoComplete.prototype.SelectSuggestion = function ($Suggestion) {
      if ($Suggestion.length == 0)
        return;

      this.m_$Input.val($Suggestion.data('suggestion'));
      if (this.m_fnOnChange)
        this.m_fnOnChange(this.m_$Input, $Suggestion);

      this.ClosePopup();
      this.m_$Input.focus();
    }

    CAutoComplete.prototype.ClosePopup = function () {
      if (this.m_hSearchTimeout != 0) {
        window.clearTimeout(this.m_hSearchTimeout);
        this.m_hSearchTimeout = 0;
      }

      this.m_strLastSearch = '';
      this.m_$Popup.hide();
    }

    CAutoComplete.prototype.OnInputKeyDown = function (event) {
      var $CurSuggestion = this.m_$Popup.children('.focus');
      var $NewSuggestion = $J();

      if (event.keyCode == CAutoComplete.KEY_ENTER) {
        this.SelectSuggestion($CurSuggestion);
        this.m_bSuppressNextKeyUp = true;
        event.preventDefault();
        return;
      }

      if (event.keyCode == CAutoComplete.KEY_UP || event.keyCode == CAutoComplete.KEY_DOWN) {
        if (event.keyCode == CAutoComplete.KEY_UP) {
          if ($CurSuggestion.length)
            $NewSuggestion = $CurSuggestion.prev();
          if (!$NewSuggestion.length)
            $NewSuggestion = this.m_$Popup.children('div:last-child');
        }
        else {
          if ($CurSuggestion.length)
            $NewSuggestion = $CurSuggestion.next();
          if (!$NewSuggestion.length)
            $NewSuggestion = this.m_$Popup.children('div:first-child');
        }

        if ($NewSuggestion.length) {
          $CurSuggestion.removeClass('focus');
          $NewSuggestion.addClass('focus');
        }

        event.preventDefault();
      }
    }

    CAutoComplete.prototype.OnInputKeyUp = function (event) {
      if (this.m_bSuppressNextKeyUp && event.keyCode == CAutoComplete.KEY_ENTER) {
        this.m_bSuppressNextKeyUp = false;
        event.preventDefault();
      }
    }



    function GetCurrentScrollPercentage() {
      var s = $J(window).scrollTop();
      var d = $J(document).height();
      var c = $J(window).height();
      var scrollPercent = (s / (d - c)) * 100;
      return scrollPercent;
    }

    // @elemID id of the element
    // @fixedOffsetTop offset from the top when fixed
    // @bScrollWithPageIfTooTall if the element is taller than the page, then it will "scroll" with the page if this is true
    // @docHeightOffset if bScrollWithPageIfTooTall is set to true, then this is how much the document height is reduced by (recommend this to be 130 for the typical footer)
    function FixedElementOnScrollWrapper(elemID, fixedOffsetTop, bScrollWithPageIfTooTall, docHeightOffset, params) {
      params = $J.extend({
        fixedClass: null
      }, params);

      this.fixedElement = $(elemID);
      this.$FixedElement = $JFromIDOrElement(elemID);
      this.fixedOffsetTop = typeof fixedOffsetTop != "undefined" ? fixedOffsetTop : 0;
      this.bScrollWithPageIfTooTall = typeof bScrollWithPageIfTooTall != "undefined" ? bScrollWithPageIfTooTall : false;
      this.docHeightOffset = typeof docHeightOffset != "undefined" ? docHeightOffset : 0;
      this.homePosn = { x: this.fixedElement.cumulativeOffset()[0], y: this.fixedElement.cumulativeOffset()[1] };
      this.fixedClass = params.fixedClass;


      this.$FixedElementPadding = $J('<div/>', { 'class': 'FixedElementOnScrollWrapper_padding', 'id': 'ScrollWrapperPadding_' + elemID }).hide();
      this.fixedElement.insert({ before: this.$FixedElementPadding[0] });

      var _this = this;
      $J(window).on('scroll.FixedElementOnScrollWrapper hashchange.FixedElementOnScrollWrapper', function () { _this.handleScroll() });
      $J(window).on('resize.FixedElementOnScrollWrapper', function () { _this.handleScroll(true /* force recalc */) });
      this.handleScroll();
    }

    FixedElementOnScrollWrapper.prototype.BIsFixed = function () {
      if (this.fixedClass)
        return this.$FixedElement.hasClass(this.fixedClass);
      else
        return this.$FixedElement.css('position') == 'fixed';
    }

    FixedElementOnScrollWrapper.prototype.handleScroll = function (bForceRecalc) {
      this.scrollOffset = document.viewport.getScrollOffsets().top;
      var offsetTop = this.fixedOffsetTop + GetResponsiveHeaderFixedOffsetAdjustment();

      if (bForceRecalc && !this.BIsFixed())
        this.homePosn = { x: this.fixedElement.cumulativeOffset()[0], y: this.fixedElement.cumulativeOffset()[1] };

      if (this.scrollOffset > (this.homePosn.y - offsetTop)) {
        if (!this.BIsFixed() || bForceRecalc) {
          if (this.fixedClass)
            this.$FixedElement.addClass(this.fixedClass);
          else
            this.$FixedElement.css('position', 'fixed');

          this.fixedElement.style.top = offsetTop + 'px';
          this.fixedElement.style.left = this.homePosn.x;

          // jquery show() sets display to block, which prevents css from hiding this element if needed.
          this.$FixedElementPadding.css('display', '');
          this.$FixedElementPadding.css('height', this.fixedElement.getHeight() + 'px');
        }

        if (this.bScrollWithPageIfTooTall) {
          // this forces the element to scroll off the page, but there's enough that isn't on the page, "scroll" this guy percentage-wise
          var elemHeight = this.fixedElement.getHeight() + offsetTop;
          if (elemHeight > document.viewport.getHeight()) {
            var currentScrollPercentage = GetCurrentScrollPercentage();
            var heightDiff = elemHeight - (document.viewport.getHeight() - this.docHeightOffset);
            offsetTop -= Math.floor(heightDiff * currentScrollPercentage / 100);
            this.fixedElement.style.top = offsetTop + 'px';
          }
        }
      }
      else {
        if (this.BIsFixed()) {
          if (this.fixedClass)
            this.$FixedElement.removeClass(this.fixedClass);
          else
            this.$FixedElement.css('position', '');

          this.$FixedElement.css('top', '').css('left', '');
          this.$FixedElementPadding.css('display', 'none');
        }
      }
    }

    // general text suggestion control

    // fnSuggestForTerm will be called with two values, the current string to get suggestions for,
    //	and the callback to invoke with the new values.  You should always invoke the callback per call
    //	to fnSuggestForTerm, but can delay due to ajax if needed.
    function CTextInputSuggest($InputElement, fnSuggestForTerm, fnOnSuggest, strCssClass) {
      this.Init($InputElement, fnSuggestForTerm, fnOnSuggest, strCssClass);
    }

    CTextInputSuggest.prototype.Init = function ($InputElement, fnSuggestForTerm, fnOnSuggest, strCssClass) {
      if (!strCssClass)
        strCssClass = 'popup_block_new';
      this.m_bHaveSuggestions = false;
      this.m_$Input = $InputElement;
      this.m_fnSuggestForTerm = fnSuggestForTerm;
      this.m_fnOnSuggest = fnOnSuggest || function (term) { };
      this.m_strLastVal = '';
      this.m_align = 'left';
      this.m_valign = 'bottom';

      this.m_$Focus = $J();
      this.m_strLastFocusVal = null;

      this.m_nNextRequestID = 1;
      this.m_nRequestIDRecvd = 0;


      this.m_$SuggestionsCtn = $J('<div/>', { 'class': strCssClass, style: 'display: none;' });
      this.m_$Suggestions = $J('<div/>', { 'class': 'popup_body popup_menu' });
      this.m_$SuggestionsCtn.append(this.m_$Suggestions);

      this.m_$SuggestionsCtn.hide();
      $J(document.body).append(this.m_$SuggestionsCtn);

      var zIndex = 200;	//normal popup zindex
      this.m_$Input.parents().each(function () {
        var zIndexParent = $J(this).css('zIndex');
        if (zIndexParent != 'auto' && zIndexParent != 0) {
          zIndex = zIndexParent;
        }
      });
      this.m_$SuggestionsCtn.css('zIndex', zIndex + 20);

      var _this = this;
      this.m_$Input.on('keyup.CTextInputSuggest click.CTextInputSuggest', function (event) { _this.OnTextChanged(event) });
      this.m_$Input.on('paste.CTextInputSuggest cut.CTextInputSuggest', function () { window.setTimeout(function () { _this.OnTextChanged() }, 1); });
      this.m_$Input.on('keydown.CTextInputSuggest', function (event) { _this.OnKeyDown(event) });
      this.m_$Input.on('focus.CTextInputSuggest', function () { _this.ShowSuggestions() });
      this.m_$Input.on('blur.CTextInputSuggest', function () { _this.HideSuggestions() });
    }

    CTextInputSuggest.prototype.SetAlignment = function (align, valign) {
      this.m_align = align || 'left';
      this.m_valign = valign || 'bottom';
    };

    CTextInputSuggest.prototype.SetSuggestionsContainerId = function (strSuggestionsCtnId) {
      this.m_$SuggestionsCtn.attr('id', strSuggestionsCtnId);
    };

    CTextInputSuggest.prototype.ShowSuggestions = function () {
      if (!this.m_$SuggestionsCtn.find(':visible').length && this.m_bHaveSuggestions) {
        AlignMenu(this.m_$Input[0], this.m_$SuggestionsCtn[0], this.m_align, this.m_valign, true);
        this.m_$SuggestionsCtn.fadeIn('fast');
      }
    };

    CTextInputSuggest.prototype.HideSuggestions = function () {
      if (this.m_bHaveSuggestions)
        this.m_$SuggestionsCtn.fadeOut('fast');
      else
        this.m_$SuggestionsCtn.hide();
    };

    CTextInputSuggest.prototype.OnSuggestionSelected = function ($Suggestion) {
      this.m_$Input.val($Suggestion.text());

      this.m_bHaveSuggestions = false;
      this.m_$Focus = $J();
      this.HideSuggestions();

      this.m_fnOnSuggest($Suggestion.text());
    };

    CTextInputSuggest.prototype.SetSuggestions = function (rgSuggestions) {
      var strLastFocus = this.m_strLastFocusVal;

      this.m_$Suggestions.empty();

      this.m_$Focus = $J();
      this.m_strLastFocus = null;

      if (rgSuggestions && rgSuggestions.length) {
        var _this = this;
        for (var i = 0; i < rgSuggestions.length; i++) {
          var $Suggestion = $J('<div/>', { 'class': 'suggestion_item popup_menu_item' });
          $Suggestion.text(rgSuggestions[i]);
          $Suggestion.click($J.proxy(this.OnSuggestionSelected, this, $Suggestion));
          $Suggestion.mouseenter($J.proxy(this.SetFocus, this, $Suggestion));

          this.m_$Suggestions.append($Suggestion);

          if (rgSuggestions[i] == strLastFocus)
            this.SetFocus($Suggestion);
        }
        this.m_bHaveSuggestions = true;
        this.ShowSuggestions();
      }
      else {
        this.m_bHaveSuggestions = false;
        this.HideSuggestions();
      }
    };

    CTextInputSuggest.prototype.OnTextChanged = function (event) {
      if (event && (event.which == 13 || event.which == 27))
        return;

      var value = this.m_$Input.val();
      if (value != this.m_strLastVal) {
        var _this = this;
        var nRequestID = this.m_nNextRequestID++;
        this.m_fnSuggestForTerm(value, function (rgSuggestions) {
          // we've already recieved a more recent response, this is out-of-order
          if (_this.m_nRequestIDRecvd > nRequestID)
            return;

          _this.m_nRequestIDRecvd = nRequestID;
          _this.SetSuggestions(rgSuggestions);
        });

        this.m_strLastVal = value;
      }
    };

    CTextInputSuggest.prototype.OnKeyDown = function (event) {
      if (event.which == 27) {
        this.HideSuggestions();
      }
      else if (this.m_bHaveSuggestions) {
        var $NewSuggestion = null;
        if (event.which == 13) {
          if (this.m_$Focus.length && this.m_bHaveSuggestions) {
            this.OnSuggestionSelected(this.m_$Focus);
            event.stopPropagation();
            event.preventDefault();
          }
        }
        else if (event.which == 38 /* up arrow */) {
          event.preventDefault();
          if (this.m_$Focus.length)
            $NewSuggestion = this.m_$Focus.prev();
          if (!$NewSuggestion)
            $NewSuggestion = this.m_$Suggestions.children().last();
        }
        else if (event.which == 40 /* down arrow */) {
          event.preventDefault();
          if (this.m_$Focus.length)
            $NewSuggestion = this.m_$Focus.next();
          if (!$NewSuggestion)
            $NewSuggestion = this.m_$Suggestions.children().first();
        }

        if ($NewSuggestion)
          this.SetFocus($NewSuggestion);
      }
    };

    CTextInputSuggest.prototype.SetFocus = function ($Suggestion) {
      this.m_$Focus.removeClass('focus');
      this.m_$Focus = $Suggestion;
      this.m_$Focus.addClass('focus');
      this.m_strLastFocusVal = $Suggestion.text();
    };

    CTextInputSuggest.prototype.Destroy = function () {
      this.m_$SuggestionsCtn.remove();
      this.m_$Input.off('.CTextInputSuggest');
    };

    /**
     * Similar to CTextInputSuggest, but uses associative arrays instead of just text; useful for when we may have more than one
     * item with the same text name, or when you want to use HTML in the item name instead of just plaintext
     *
     * Each suggestion should include a 'key', and one of the following:
     * text - Suggestion text (escaped, sets textContents)
     * html - Raw suggestion html (NOT ESCAPED, sets innerHTML)
     *
     * @param $InputElement
     * @param fnSuggestForTerm
     * @param fnOnSuggest
     * @constructor
     */
    function CIndexedInputSuggest($InputElement, fnSuggestForTerm, fnOnSuggest, strCssClass) {
      this.Init($InputElement, fnSuggestForTerm, fnOnSuggest, strCssClass);
    }

    CIndexedInputSuggest.prototype = Object.create(CTextInputSuggest.prototype);;

    CIndexedInputSuggest.prototype.OnSuggestionSelected = function ($Suggestion) {
      this.m_$Input.val($Suggestion.text());

      this.m_bHaveSuggestions = false;
      this.m_$Focus = $J();
      this.HideSuggestions();

      this.m_fnOnSuggest($Suggestion.data('suggest-key'), $Suggestion.text());
    };

    CIndexedInputSuggest.prototype.SetSuggestions = function (rgSuggestions) {
      var strLastFocus = this.m_strLastFocusVal;

      this.m_$Suggestions.empty();

      this.m_$Focus = $J();
      this.m_strLastFocus = null;

      if (rgSuggestions && rgSuggestions.length) {
        var _this = this;
        for (var i = 0; i < rgSuggestions.length; i++) {

          var $Suggestion = $J('<div/>', { 'class': 'suggestion_item popup_menu_item' });
          if (rgSuggestions[i].text)
            $Suggestion.text(rgSuggestions[i].text);
          else if (rgSuggestions[i].html)
            $Suggestion.html(rgSuggestions[i].html);

          $Suggestion.data('suggest-key', rgSuggestions[i].key)

          $Suggestion.click($J.proxy(this.OnSuggestionSelected, this, $Suggestion));
          $Suggestion.mouseenter($J.proxy(this.SetFocus, this, $Suggestion));

          this.m_$Suggestions.append($Suggestion);

          if (rgSuggestions[i] == strLastFocus)
            this.SetFocus($Suggestion);
        }
        this.m_bHaveSuggestions = true;
        this.ShowSuggestions();
      }
      else {
        this.m_bHaveSuggestions = false;
        this.HideSuggestions();
      }
    };

    function InitBBCodeVideos(bAllowAutoPlay) {
      var videos = $J("video");
      if (videos.length != 0) {
        for (var i = 0; i < videos.length; ++i) {
          var video = videos[i];
          var $video = $J(video);

          if ($video.hasClass("bb_video_loop")) {
            video.setAttribute('loop', 'loop');
          }

          if ($video.hasClass("bb_video_controls")) {
            video.setAttribute('controls', 'controls');
          }

          if (bAllowAutoPlay) {
            $video.unbind('mouseenter mouseleave');

            video.preload = $video.hasClass("bb_video_preload") ? 'auto' : 'metadata';

            if ($video.hasClass("bb_video_autoplay")) {
              video.autoplay = 'autoplay';
            }
          }
          else {
            video.preload = 'metadata';
            $video.hover(function toggleControls() {
              if (this.hasAttribute("controls")) {
                this.removeAttribute("controls")
              } else {
                this.setAttribute("controls", "controls")
              }
            });
          }
        }
      }
    }


    /**
     * Generic interface for handling ajax-driven sub-pages.
     *
     * @param elTarget Element to dump content into
     * @param strBaseURL Base URL to attach nav params
     * @param strInstanceId Unique flag to look for when scanning for state change events. also determines our data selector
     * 						Only needed if you're using more than one CAjaxSubPageController on the same page.
     * @param strDefaultLocation Used when no navid is provided
     * @constructor
     */
    var CAjaxSubPageController = function (elTarget, strBaseURL, strInstanceId, strDefaultLocation) {
      this.elTarget = elTarget;
      this.strBaseURL = strBaseURL;
      this.strStateID = strInstanceId || 'navid';
      this.strDefaultLocation = strDefaultLocation || '';

      this.rgOriginalEvent = { 'html': this.elTarget.innerHTML, 'title': document.title, 'id': this.strStateID };

      window.addEventListener('popstate', this.OnWindowPopState.bind(this));

      this.InstrumentLinks(document);

      var _this = this;
      setTimeout(function () { $J(_this.elTarget).children().trigger('load'); }, 1);

      var strLocation = window.location.href.substring(strBaseURL.length);
      this.PaintLinks(strLocation || this.strDefaultLocation);


    };

    /**
     * Register click handlers. This also sets the href for browser link preview and fallback for non-click navigation
     * events, such as opening in a new tab/window via middle click.
     * @param elTarget Element to query from.
     * @constructor
     */
    CAjaxSubPageController.prototype.InstrumentLinks = function (elTarget) {
      //var rgLinks = elTarget.querySelectorAll('[data-'+this.strStateID+']');
      var rgLinks = $J('[data-' + this.strStateID + ']', elTarget);
      for (var i = 0; i < rgLinks.length; i++) {
        rgLinks[i].addEventListener('click', this.Navigate.bind(this, rgLinks[i].dataset[this.strStateID], rgLinks[i].dataset['title']));
        rgLinks[i].href = this.strBaseURL + rgLinks[i].dataset[this.strStateID];
      }
    };

    /**
     * Adds 'active' class to link that was clicked or is currently active.
     * @constructor
     */
    CAjaxSubPageController.prototype.PaintLinks = function (strLocation) {
      // Figure out which link we clicked and paint it with the correct class
      var rgLinks = document.querySelectorAll('[data-' + this.strStateID + ']');
      for (var i = 0; i < rgLinks.length; i++) {
        if (rgLinks[i].dataset[this.strStateID] == strLocation || rgLinks[i].dataset[this.strStateID] + '/' == strLocation)
          rgLinks[i].classList.add('active');
        else
          rgLinks[i].classList.remove('active');
      }
    };

    /**
     * Call to navigate the sub-frame.
     *
     * @param strLocation Assumed to be strBaseURL + strLocation. Trailing slash should be on strBaseURL already.
     * @param strpageTitle Optional: Replace page title with this new value.
     * @constructor
     */
    CAjaxSubPageController.prototype.Navigate = function (strLocation, strPageTitle, event) {
      var _this = this;
      var strURL = this.strBaseURL + strLocation;

      this.elTarget.classList.add('loading');

      this.PaintLinks(strLocation);

      // Trigger the "saveform" event which we may have bound to do things.
      $J('form', this.elTarget).trigger('saveform');

      $J.ajax({
        url: strURL,
        dataType: "html",
        cache: true, /* Let the browser decide caching rules */
        data: { 'ajax': 1 }
      }).done(function (result) {

        var elNewContents = $J(result);

        $J(_this.elTarget).empty();
        $J(_this.elTarget).append(elNewContents);


        _this.elTarget.classList.remove('loading');

        $J(elNewContents).trigger('load');

        _this.InstrumentLinks(_this.elTarget);
        if (strPageTitle)
          document.title = strPageTitle;

        $J('.tooltip', _this.elTarget).v_tooltip();

        window.history.pushState({ 'html': result, 'title': strPageTitle, 'id': _this.strStateID }, '', strURL);
      });

      if (event)
        event.preventDefault();

    };

    /**
     * Internal event handler for the "back" button.
     * @param Event event
     * @constructor
     */
    CAjaxSubPageController.prototype.OnWindowPopState = function (event) {
      // Revert to our original state if there's nothing in the stack.

      if (event.state == null) {
        event.state = 5;
      }

      var state = event.state || this.rgOriginalEvent;

      if (state && state.id == this.strStateID) {
        var strLocation = window.location.href.substring(this.strBaseURL.length);
        this.PaintLinks(strLocation);

        var elNewContents = $J(state.html);
        $J(this.elTarget).empty();
        $J(this.elTarget).append(elNewContents);
        if (state.title)
          document.title = state.title;

        $J(elNewContents).trigger('load');
        this.InstrumentLinks(elNewContents);
      }
    };

    function SetupAnimateOnHoverImages() {
      var $Images = $J('[data-animate-on-hover-src]', document);
      if ($Images.length) {
        for (var i = 0; i < $Images.length; ++i) {
          var img = $J($Images[i]);
          img.data('static-src', img.attr('src'));
          img.hover(
            function () {
              var thisImage = $J(this);
              thisImage.attr('src', thisImage.data('animate-on-hover-src'));
            },
            function () {
              var thisImage = $J(this);
              thisImage.attr('src', thisImage.data('static-src'));
            }
          );
        }
      }
    }

    function BindTooltips(selector, rgOptions) {
      // Standard tooltips
      var $TextTooltips = $J('[data-tooltip-text]', selector);
      if ($TextTooltips.length)
        $TextTooltips.v_tooltip({ 'tooltipClass': rgOptions.tooltipCSSClass, 'dataName': 'tooltipText', 'defaultType': 'text', 'replaceExisting': false, 'responsiveMode': window.UseSmallScreenMode && window.UseSmallScreenMode() });

      var $HTMLTooltips = $J('[data-tooltip-html]', selector);
      if ($HTMLTooltips.length)
        $HTMLTooltips.v_tooltip({ 'tooltipClass': rgOptions.tooltipCSSClass, 'dataName': 'tooltipHtml', 'defaultType': 'html', 'replaceExisting': false, 'responsiveMode': window.UseSmallScreenMode && window.UseSmallScreenMode() });
    }

    function ShowTooltipMenuAsPopup(toolDiv) {
      var $Popup = $J(toolDiv);
      // detach this element and when the dialog closes re-attach to the document body
      $Popup.detach();
      var originalPopupPosition = $Popup.css('position');
      $Popup.css('position', 'static'); // clear possible absolute positioning
      $Popup.show();

      var dialog = ShowDialog('', $Popup).always(
        function () {
          // save it away again for later
          $Popup.hide();
          $Popup.css('position', originalPopupPosition); // restore positioning
          $J(document.body).append($Popup);
        }
      );
      return dialog;
    }

    /**
     * Binds standard tooltips for the current site. This function also binds a mutationobserver to bind any future elements without additional work
     * @param strCSSClass
     * @constructor
     */
    var g_TooltipMutationObserver;
    var g_bTooltipMutationObserverDisabled = false;
    function SetupTooltips(rgOptions) {
      function InnerSetupTooltips() {

        BindTooltips(document, rgOptions);

        if (g_TooltipMutationObserver || g_bTooltipMutationObserverDisabled)
          return;

        try {
          var config = {
            attributes: true,	// not clear if we actually support this, as we only look at addedNodes
            childList: true,
            subtree: true,
            attributeFilter: ["data-tooltip-html", "data-tooltip-text"]
          };

          var callback = function (mutationsList) {
            for (var i = 0; i < mutationsList.length; i++) {
              var mutation = mutationsList[i];
              if (mutation.addedNodes && mutation.addedNodes.length)
                BindTooltips(mutation.addedNodes, rgOptions);
            }
          };

          // Create an observer instance linked to the callback function
          g_TooltipMutationObserver = new MutationObserver(callback);

          // Start observing the target node for configured mutations
          g_TooltipMutationObserver.observe(document, config);
        }
        catch (e) {
          // Swallow exceptions for browsers that don't support mutationobservers
        }
      }

      InnerSetupTooltips();
      $J(window).on('Responsive_SmallScreenModeToggled', InnerSetupTooltips);
    }

    // for perf sensitive pages
    function DisableTooltipMutationObserver() {
      g_bTooltipMutationObserverDisabled = true;

      if (g_TooltipMutationObserver) {
        g_TooltipMutationObserver.disconnect();
        g_TooltipMutationObserver = null;
      }
    }

    function ViewTitlesWithDescriptors(descid) {
      var waitDialog = ShowBlockingWaitDialog('Example Products', 'Please wait while we find some example products...');

      $J.get('https://store.steampowered.com/search/results/',
        {
          'filter': 'examplesforcontentdescriptors',
          'ignore_preferences': 1,
          'category1': '992,994,998', 'descids[]': descid,
          'json': 1,
        }
      ).done(function (response) {
        waitDialog.Dismiss();

        var content = $J("<div>");
        content.append($J("<div>", { class: 'content_descriptors_examples_desc', text: response.desc }));

        if (response.items.length != 0) {
          for (var i = 0; i < response.items.length && i < 10; ++i) {
            var item = response.items[i];
            var elem = $J("<div>", { class: 'content_descriptors_example_app' });
            elem.append($J("<img>", { class: 'app_logo', src: item.logo }));
            elem.append($J("<div>", { class: 'app_name', text: item.name }));
            content.append(elem);
          }
        }
        else {
          content.append($J("<div>", { class: "no_items", text: 'No Products Found' }));
        }

        var dialog = ShowAlertDialog('Example Products', content);
      });
    }



    // Element appearance montior. Designed to replace jQuery.appear

    var CAppearMonitor = function (fnOnAppear, bCheckAnyIntersection) {
      this.rgMonitoredElements = [];
      this.bRunning = false;
      this.unTimerFrequency = 500;
      this.bRegisteredWindowEvent = false;
      this.fnOnAppear = fnOnAppear;
      this.bCheckAnyIntersection = bCheckAnyIntersection || false;
    };

    CAppearMonitor.prototype.RegisterScrollEvent = function (elTarget) {
      var instance = this;

      $J(elTarget).on('scroll', function () {
        if (instance.bRunning || instance.rgMonitoredElements.length == 0)
          return;

        instance.bRunning = true;
        setTimeout(instance.CheckVisibilityInternal.bind(instance), instance.unTimerFrequency);

      });
    }

    CAppearMonitor.prototype.CheckVisibility = function () {
      // when items are added they will schedule an immediate check.  Delay for a bit
      if (this.m_iCheckVisibilityRequestInterval) {
        window.clearTimeout(this.m_iCheckVisibilityRequestInterval);
      }

      this.m_iCheckVisibilityRequestInterval = setTimeout(this.CheckVisibilityInternal.bind(this), this.unTimerFrequency);
    };

    CAppearMonitor.prototype.CheckVisibilityInternal = function () {
      // Walk backwards so we can slice while we iterate
      for (var i = this.rgMonitoredElements.length - 1; i >= 0; i--) {
        var rgMonitored = this.rgMonitoredElements[i];
        if (this.bIsElementVisible(rgMonitored.element)) {
          this.rgMonitoredElements.splice(i, 1);
          this.fnOnAppear(rgMonitored.element);
        } else if (!document.body.contains(rgMonitored.element)) {
          this.rgMonitoredElements.splice(i, 1);
        }
      }

      this.bRunning = false;
      this.m_iCheckVisibilityRequestInterval = undefined;
    };

    CAppearMonitor.prototype.bIsElementVisible = function (elElement) {
      if (!elElement)
        return;

      // Check physical position vs viewport. This is likely the fastest early-out.
      var rectElement = elElement.getBoundingClientRect();

      if (this.bCheckAnyIntersection) {
        if (rectElement.left > window.innerWidth || rectElement.right < 0)
          return false;

        if (rectElement.top > window.innerHeight || rectElement.bottom < 0)
          return false;
      }
      else {
        if (!(rectElement.top >= 0 && rectElement.left >= 0
          && rectElement.bottom <= window.innerHeight && rectElement.right <= window.innerWidth))
          return false;
      }

      // Ask jQuery to compute visibility, since it knows all the edge cases.
      if (!$J(elElement).is(':visible'))
        return false;

      return true;

    };

    CAppearMonitor.prototype.RegisterElement = function (elTarget) {
      if ($J(elTarget).data('manual-tracking'))
        return;

      this.rgMonitoredElements.push({
        element: elTarget
      });

      // Register the window scroll event ONLY after we have something to monitor
      if (!this.bRegisteredWindowEvent)
        this.RegisterScrollEvent(window);
    };

    CAppearMonitor.prototype.TrackAppearanceIfVisible = function (elTarget) {
      var _this = this;
      window.setTimeout(function () {
        // Ensure we're actually in the viewport (Carousel may be scrolling out of view and calling this)
        // this triggers layout, so we delay this check a little bit to give the page time to settle whatever
        // change may currently be in-flight
        if (!_this.bIsElementVisible(elTarget))
          return;

        _this.TrackAppearance(elTarget);
      }, 10);
    };

    CAppearMonitor.prototype.TrackAppearance = function (elTarget) {
      // Find our element, splice it out if we were tracking it
      for (var i = this.rgMonitoredElements.length - 1; i >= 0; i--) {
        var rgMonitored = this.rgMonitoredElements[i];
        if (rgMonitored.element === elTarget) {
          this.rgMonitoredElements.splice(i, 1);
        }
      }
      // Trigger it, even if we weren't actually tracking it
      this.fnOnAppear(elTarget);
    };

    CAppearMonitor.prototype.ClearElements = function () {
      this.rgMonitoredElements = [];
    }

    // gamepad navigation wrappers, the implementations of these are stored in legacy_web.
    // once legacy web initializes, these functions will be replaced by the real thing.  In the mean time,
    // we will queue any commands and send them when ready.
    var g_rgQueuedGamepadCommands = [];
    var g_rgOnReadyCallbacks = [];
    var g_bGamepadNavReady = false;
    function RunWhenGamepadNavReady(callback) {
      if (g_bGamepadNavReady)
        callback();
      else
        g_rgOnReadyCallbacks.push(callback);
    }
    window.addEventListener('vgp_gamepadnavready', function () {
      g_rgQueuedGamepadCommands.forEach(function (command) { window[command.name].apply(window, command.args); });
      g_rgQueuedGamepadCommands = [];

      g_rgOnReadyCallbacks.forEach(function (fn) { fn(); });
      g_rgOnReadyCallbacks = [];
    });

    function InstrumentFocusElements(element) {
      g_rgQueuedGamepadCommands.push({ name: 'InstrumentFocusElements', args: arguments });
    }
    function ForceUpdateFocusElements(element) {
      g_rgQueuedGamepadCommands.push({ name: 'ForceUpdateFocusElements', args: arguments });
    }
    function GPNavFocusChild(element) {
      g_rgQueuedGamepadCommands.push({ name: 'GPNavFocusChild', args: arguments });
    }
    function GPOnShowingModalWindow(element) {
      g_rgQueuedGamepadCommands.push({ name: 'GPOnShowingModalWindow', args: arguments });
    }
    function GPShowVirtualKeyboard(bShowKeyboard) {
      g_rgQueuedGamepadCommands.push({ name: 'GPShowVirtualKeyboard', args: arguments });
    }
    function GPNavUpdateActionDescriptions(element, actionDescriptions) {
      g_rgQueuedGamepadCommands.push({ name: 'GPNavUpdateActionDescriptions', args: arguments });
    }

    var SetGPFocusRestoreTimeout = function () { }; // no op unless InitializeGPFocusRestoreTimeout is called
    var nGPFocusRestoreTimeoutID = -1;
    function InitializeGPFocusRestoreTimeout(bUseWindowOnload = true) {
      window.history.replaceState($J.extend({}, window.history.state, { notify_focus_restore_ready: true }), "");
      SetGPFocusRestoreTimeout = function (delay = 200) {
        if (nGPFocusRestoreTimeoutID == 0 || (!window.UseTabletScreenMode || !window.UseTabletScreenMode()))
          return;

        if (nGPFocusRestoreTimeoutID !== -1)
          window.clearTimeout(nGPFocusRestoreTimeoutID);

        this.nGPFocusRestoreTimeoutID = window.setTimeout(function () {
          nGPFocusRestoreTimeoutID = 0;
          dispatchEvent(new Event('focus_restore_ready'));
        }, delay);
      }

      if (bUseWindowOnload)
        window.addEventListener("load", function () { SetGPFocusRestoreTimeout(); });
    }

    function HandleOverlayWindowPinnedView(bPinned, bShowPinnedView) {
      $J('body').toggleClass('OverlayWindowPinned', bPinned);
      $J('body').toggleClass('OverlayWindowPinnedView', bShowPinnedView);
    }


  </script>
  <script type="text/javascript">
    $J = jQuery.noConflict();
    if (typeof JSON != 'object' || !JSON.stringify || !JSON.parse) {
      document.write("<scr" + "ipt type=\"text\/javascript\" src=\"https:\/\/community.cloudflare.steamstatic.com\/public\/javascript\/json2.js?v=pmScf4470EZP&amp;l=english&amp;_cdn=cloudflare\" ><\/script>\n");
    };
  </script>
  <script>
    var INVENTORY_PAGE_ITEMS = 16;
    var INVENTORY_PAGE_WIDTH = 416;
    var g_bIsTrading = false;
    var g_bTradeOffer = false;	// implies g_bIsTrading
    var g_bIsInventoryPage = false;

    var g_bReadOnly = false;

    var g_bWalletTradeUnavailable = false;
    var g_bSellItemOnInventoryLoad = false;
    var g_bShowTradableItemsOnly = false;

    var g_bEnableDynamicSizing = false;
    var g_bAllowHighDPIItemImages = false;	// true if the page is responsive, otherwise we assume page is not updated to allow high dpi images
    var g_ActiveItemPopupModal = null;

    var g_ActiveUser = null;
    var ITEM_HOVER_DELAY = 500;

    function Economy_UseResponsiveLayout() {
      if (!window.UseSmallScreenMode || !window.UseSmallScreenMode())
        return false;

      // trading has a special break point
      if (g_bIsTrading && $J(window).width() > 600)
        return false;

      return true;
    }

    /*
     *		Initialization
     */

    function InitInventoryPage(bHasPendingGifts, showAppId, bShowTradableItemsOnly) {
      INVENTORY_PAGE_ITEMS = 25;	//5 x 5 grid
      INVENTORY_PAGE_WIDTH = 104 * 5;
      g_bIsInventoryPage = true;
      g_bShowTradableItemsOnly = bShowTradableItemsOnly;
      g_bAllowHighDPIItemImages = $J('html').hasClass('responsive');

      // set up the filter control
      Filter.InitFilter($('filter_control'));

      // decide what page we're going to start with
      // 	priority: hash params > cookie > first non-empty inventory > first inventory
      var oHashParams = ReadInventoryHash(window.location.hash);
      var oCookieParams = ReadInventoryCookie(GetCookie('strInventoryLastContext'));

      if (window.location.hash == '#pending_gifts' && $('tabcontent_pendinggifts')) {
        if (bHasPendingGifts)
          ShowPendingGifts();
        else
          ShowItemInventory(753, 1);
      }
      else if (window.location.hash == '#gift_history' && g_bViewingOwnProfile) {
        ShowGiftHistory();
      }
      else if (oHashParams && BValidateHashParams(oHashParams)) {
        ShowItemInventory(oHashParams.appid, oHashParams.contextid, oHashParams.assetid);
      }
      else if (showAppId != -1) {
        if (showAppId == 0)
          showAppId = 753;

        ShowItemInventory(showAppId, 0);
      }
      else if (oCookieParams) {
        ShowItemInventory(oCookieParams.appid, oCookieParams.contextid);
        UserYou.SetDefaultInventoryId(oCookieParams);
      }
      else {
        var oFirstInventory = null;
        var oFirstNonEmptyInventory = null;
        for (var appid in g_rgAppContextData) {
          var rgApp = g_rgAppContextData[appid];
          for (var contextid in rgApp.rgContexts) {
            var rgContext = rgApp.rgContexts[contextid];
            if (rgContext.asset_count && !oFirstNonEmptyInventory) {
              oFirstNonEmptyInventory = { appid: appid, contextid: contextid };
              break;
            }
            else if (!oFirstInventory) {
              oFirstInventory = { appid: appid, contextid: contextid };
            }
          }
          if (oFirstNonEmptyInventory)
            break;
        }
        var oInventoryToShow = oFirstNonEmptyInventory ? oFirstNonEmptyInventory : oFirstInventory;
        if (oInventoryToShow) {
          ShowItemInventory(oInventoryToShow.appid, oInventoryToShow.contextid);
          UserYou.SetDefaultInventoryId(oInventoryToShow);
        }

      }

      InitDynamicInventoryItemAutosizing($J('#inventories'), '.trade_item_box', true);
      $J(window).on('Responsive_SmallScreenModeToggled', function () {
        if (window.UseSmallScreenMode && window.UseSmallScreenMode()) {
          $J('#inventory_pagecontrols').hide();
        }
        else {
          $J('#inventory_pagecontrols').show();
        }
      });

      // watch for incoming # urls
      new LocationHashObserver(null, 0.2, OnLocationChange);
    }

    function ReadInventoryHash(hash) {
      if (hash && hash.length > 1) {
        var rgHashElements = hash.substring(1).split('_');
        if (rgHashElements.length >= 1 && rgHashElements.length < 4) {
          var oLocation = { appid: parseInt(rgHashElements[0]) };
          if (rgHashElements.length >= 2)
            oLocation.contextid = rgHashElements[1];
          if (rgHashElements.length == 3)
            oLocation.assetid = rgHashElements[2];
          return oLocation;
        }
      }
      return null;
    }

    function ReadInventoryCookie(cookie) {
      if (cookie) {
        var rgCookieElements = cookie.split('_');
        if (rgCookieElements.length == 2) {
          var oCookieParams = {};
          oCookieParams.appid = parseInt(rgCookieElements[0]);
          oCookieParams.contextid = rgCookieElements[1];
          if (BValidateHashParams(oCookieParams))
            return oCookieParams;
          else if (g_rgAppContextData[oCookieParams.appid]) {
            // cookie wasn't valid, but we do know the app, see if there's another context we can use
            var rgContexts = g_rgAppContextData[oCookieParams.appid].rgContexts;
            for (var contextid in rgContexts) {
              if (rgContexts[contextid].asset_count) {
                oCookieParams.contextid = contextid;
                break;
              }
            }
            // one more time
            if (BValidateHashParams(oCookieParams))
              return oCookieParams;
          }
        }
      }
      return null;
    }

    function BValidateHashParams(oHashParams) {
      // Context ID, if present, is a 64-bit value that can contain only digits
      if (oHashParams && oHashParams.contextid && !/^\d+$/.test(oHashParams.contextid)) {
        return false;
      }

      if (oHashParams && oHashParams.appid && g_rgAppContextData[oHashParams.appid]) {
        if (oHashParams.contextid && !g_rgAppContextData[oHashParams.appid].rgContexts[oHashParams.contextid])
          oHashParams.contextid = APPWIDE_CONTEXT;
        return true;
      }
      return false;

    }

    LocationHashObserver = Class.create(Abstract.TimedObserver, {
      getValue: function () {
        return window.location.hash;
      }
    });

    function OnLocationChange(elIgnored, hash) {
      var oHashParams = ReadInventoryHash(hash);
      if (hash == '#pending_gifts' && $('tabcontent_pendinggifts')) {
        ShowPendingGifts();
      }
      else if (oHashParams && BValidateHashParams(oHashParams)) {
        ShowItemInventory(oHashParams.appid, oHashParams.contextid, oHashParams.assetid);
      }
      else {
        var inventoryDefault = UserYou.GetDefaultInventoryId();
        ShowItemInventory(inventoryDefault.appid, inventoryDefault.contextid);
      }
    }

    /* 
     *		Inventory
     */
    var g_ActiveInventory = null;

    function InventoryNextPage() {
      g_ActiveInventory.NextPage();
    }
    function InventoryPreviousPage() {
      g_ActiveInventory.PreviousPage();
    }

    function ShowTagFilters() {
      if (g_ActiveInventory && g_ActiveInventory.getTagContainer())
        g_ActiveInventory.getTagContainer().show();

      $('filter_tag_show').hide();
      $('filter_tag_hide').show();

      var elTagHolder = $('filter_options');
      if (elTagHolder) {
        elTagHolder.removeClassName('filter_collapsed');
        elTagHolder.addClassName('filter_expanded');
      }
    }

    function HideTagFilters() {
      $$('.econ_tag_filter_checkbox').each(function (elCheckbox) {
        if ($(elCheckbox).checked)
          $(elCheckbox).checked = false;
      });

      if (g_ActiveInventory && g_ActiveInventory.getTagContainer()) {
        g_ActiveInventory.getTagContainer().hide();
        $('filter_tag_show').show();
        $('filter_tag_hide').hide();
        Filter.UpdateTagFiltering({});

        if (Object.values(g_ActiveInventory.tags).length == 0) {
          $('filter_tag_show').hide();
        }
        else {
          $('filter_tag_show').show();
        }
      }

      var elTagHolder = $('filter_options');
      if (elTagHolder) {
        elTagHolder.addClassName('filter_collapsed');
        elTagHolder.removeClassName('filter_expanded');
      }
    }

    var kStandardTag_Tradable =
    {
      name: 'Tradable',
      internal_name: "tradable",
      category: "misc",
      category_name: 'Misc'
    };

    var kStandardTag_Untradable =
    {
      name: 'Not Tradable',
      internal_name: "untradable",
      category: "misc",
      category_name: 'Misc'
    };

    var kStandardTag_Marketable =
    {
      name: 'Marketable',
      internal_name: "marketable",
      category: "misc",
      category_name: 'Misc'
    };

    var kStandardTag_Unmarketable =
    {
      name: 'Not Marketable',
      internal_name: "unmarketable",
      category: "misc",
      category_name: 'Misc'
    };

    function CreateItemContextMenuButton(elItemHolder, strCompositeId, owner) {
      // add the context menu
      var elActionMenuButton = new Element('a', { 'id': strCompositeId + '_actionmenu_button', 'class': 'slot_actionmenu_button' });
      elActionMenuButton.href = "javascript:void(0)";
      elItemHolder.appendChild(elActionMenuButton);

      $J(elActionMenuButton).click(function () {
        HandleTradeActionMenu(elActionMenuButton, elItemHolder.rgItem, owner);
      });
    }

    var CInventory = Class.create({
      owner: null,
      appid: 0,
      contextid: 0,
      rgInventory: null,
      rgCurrency: null,

      elInventory: null,
      rgItemElements: null,
      elTagContainer: null,

      initialized: false,

      cItemsPerPage: 0,
      cPageWidth: 0,

      pageCurrent: 0,
      pageList: null,
      pageTotal: 0,

      selectedItem: null,

      bInPagingTransition: false,

      bNeedsRepagination: true,
      m_rgLazyLoadImages: null,

      initialize: function (owner, appid, contextid, rgInventory, rgCurrency) {
        this.owner = owner;
        this.appid = appid;
        this.contextid = contextid;
        this.rgInventory = rgInventory;
        this.rgCurrency = rgCurrency;
        var strCompositeId = this.getCompositeID();
        this.elInventory = new Element('div', { id: 'inventory_' + strCompositeId, 'class': 'inventory_ctn' });
        this.rgItemElements = new Array();
        this.elTagContainer = new Element('div', { id: 'tags_' + strCompositeId });

        // make sure inventory is stored as an object, not an array
        if (this.rgInventory instanceof Array) {
          if (this.rgInventory.length == 0)
            this.rgInventory = null;
          else
            this.rgInventory = Object.extend({}, this.rgInventory);
        }
        // make sure inventory is stored as an object, not an array
        if (this.rgCurrency instanceof Array) {
          if (this.rgCurrency.length == 0)
            this.rgCurrency = null;
          else
            this.rgCurrency = Object.extend({}, this.rgCurrency);
        }

        this.tags = {};
        if (this.rgInventory) {
          for (var itemid in this.rgInventory) {
            var rgItem = this.rgInventory[itemid];
            rgItem.appid = this.appid;
            rgItem.contextid = this.contextid;

            if (rgItem.amount && rgItem.amount > 1) {
              rgItem.original_amount = rgItem.amount;
              rgItem.is_stackable = true;
            }

            if (!rgItem.tags)
              rgItem.tags = [];

            if (!g_bIsTrading && !g_bShowTradableItemsOnly) {
              if (rgItem.tradable)
                rgItem.tags.push(kStandardTag_Tradable);
              else
                rgItem.tags.push(kStandardTag_Untradable);
            }

            if (rgItem.marketable)
              rgItem.tags.push(kStandardTag_Marketable);
            else
              rgItem.tags.push(kStandardTag_Unmarketable);

            for (var tagid in rgItem.tags) {
              var rgTag = rgItem.tags[tagid];
              var rgCategory = this.tags[rgTag.category];

              if (!rgCategory) {
                if (typeof rgTag.category != "string")
                  continue;

                rgCategory = this.tags[rgTag.category] = { "name": rgTag.category_name ? rgTag.category_name : rgTag.category, "tags": {} };
              }

              if (rgCategory.tags[rgTag.internal_name])
                rgCategory.tags[rgTag.internal_name].count++;
              else {
                var rgNewTag = { "name": rgTag.name, "count": 1 };
                if (rgTag.color)
                  rgNewTag.color = rgTag.color;
                rgCategory.tags[rgTag.internal_name] = rgNewTag;
              }
            }
          }
        }

        if (this.rgCurrency) {
          for (var currencyid in this.rgCurrency) {
            var rgCurrency = this.rgCurrency[currencyid];
            rgCurrency.appid = this.appid;
            rgCurrency.contextid = this.contextid;
            rgCurrency.original_amount = rgCurrency.amount;
            rgCurrency.is_currency = true;
            rgCurrency.is_stackable = true;

            if (!rgCurrency.tags)
              rgCurrency.tags = [];

            if (!g_bIsTrading && !g_bShowTradableItemsOnly) {
              if (rgCurrency.tradable)
                rgCurrency.tags.push(kStandardTag_Tradable);
              else
                rgCurrency.tags.push(kStandardTag_Untradable);
            }

            if (rgCurrency.marketable)
              rgCurrency.tags.push(kStandardTag_Marketable);
            else
              rgCurrency.tags.push(kStandardTag_Unmarketable);

            for (var tagid in rgCurrency.tags) {
              var rgTag = rgCurrency.tags[tagid];
              var rgCategory = this.tags[rgTag.category];

              if (!rgCategory) {
                if (typeof rgTag.category != "string")
                  continue;

                rgCategory = this.tags[rgTag.category] = { "name": rgTag.category_name ? rgTag.category_name : rgTag.category, "tags": {} };
              }

              if (rgCategory.tags[rgTag.internal_name])
                rgCategory.tags[rgTag.internal_name].count++;
              else {
                var rgNewTag = { "name": rgTag.name, "count": 1 };
                if (rgTag.color)
                  rgNewTag.color = rgTag.color;
                rgCategory.tags[rgTag.internal_name] = rgNewTag;
              }
            }
          }

        }
      },

      getCompositeID: function () {
        return this.owner.GetSteamId() + '_' + this.appid + '_' + this.contextid;
      },

      destroy: function () {
        $J(window).off('scroll.LazyLoad_' + this.getCompositeID());
        if (this.elInventory) {
          if (this.elInventory.parentNode)
            this.elInventory.remove();

          this.elInventory = null;
        }
        if (this.elTagContainer) {
          if (this.elTagContainer.parentNode)
            this.elTagContainer.remove();
          this.elTagContainer = null;
        }
      },

      getInventoryElement: function () {
        return this.elInventory;
      },

      getTagContainer: function () {
        return this.elTagContainer;
      },

      hide: function () {
        $J(window).off('scroll.LazyLoad_' + this.getCompositeID());
        if (this.elInventory)
          this.elInventory.hide();
        if (this.elTagContainer)
          this.elTagContainer.hide();
      },

      show: function () {
        this.elInventory.show();

        var _this = this;

        $J(window).on('scroll.LazyLoad_' + this.getCompositeID(), function () {
          if (!_this.m_rgLazyLoadImages || !_this.m_rgLazyLoadImages.length)
            return;

          var nPageHeight = $J(window).height();
          var nStartOffset = $J(window).scrollTop() - (nPageHeight * 0.5);
          var nEndOffset = $J(window).scrollTop() + (nPageHeight * 1.5);
          var rgLazyLoadImages = _this.m_rgLazyLoadImages;

          var iStart, iEnd;
          for (iStart = 0; iStart < rgLazyLoadImages.length; iStart++) {
            if (rgLazyLoadImages[iStart].offset().top > nStartOffset)
              break;
          }
          if (iStart < rgLazyLoadImages.length) {
            for (iEnd = iStart; iEnd < rgLazyLoadImages.length; iEnd++) {
              if (rgLazyLoadImages[iEnd].offset().top > nEndOffset)
                break;
            }

            if (iStart != iEnd) {
              // we could have loaded these in the loop above, but there is better
              // perf doing it all at once rather than alternating between loading images and querying position()
              for (var i = iStart; i < iEnd; i++)
                _this.LoadItemImage(rgLazyLoadImages[i][0].firstChild);

              rgLazyLoadImages.splice(iStart, iEnd - iStart);
            }
          }
        });

      },

      BIsEmptyInventory: function () {
        return !this.rgInventory && !this.rgCurrency;
      },

      BIsPendingInventory: function () {
        // pending means we are still waiting for the inventory to load
        return false;
      },

      Initialize: function () {
        if (!this.BIsEmptyInventory()) {
          this.BuildInventoryDisplayElements();
        }

        this.BuildInventoryTagFilters();

        this.bNeedsRepagination = true;

        this.initialized = true;
      },

      TagCheckboxChanged: function () {
        // build an array of the selected tags
        var rgCategories = {};

        this.elTagContainer.select('.econ_tag_filter_category').each(function (elCategory) {
          var rgTags = [];

          $(elCategory).select('.econ_tag_filter_checkbox').each(function (elCheckbox) {
            if ($(elCheckbox).checked) {
              var elParent = $(elCheckbox).up();
              elParent.addClassName("filtered");
              rgTags.push($(elCheckbox).readAttribute('tag_name'));
            }
            else {
              $(elCheckbox).up().removeClassName("filtered");
            }
          });

          if (rgTags.length)
            rgCategories[elCategory.category_name] = rgTags;
        });

        Filter.UpdateTagFiltering(rgCategories);
      },

      BuildInventoryTagFilters: function () {
        if (!this.elTagContainer)
          return;

        $J('#' + this.elTagContainer.id).empty();

        for (var sCategoryName in this.tags) {
          if (typeof sCategoryName != "string")
            continue;
          var rgCategory = this.tags[sCategoryName];
          var elTagCategory = new Element('div', { 'class': 'econ_tag_filter_category' });
          elTagCategory.category_name = sCategoryName;

          var elTagCategoryLabel = new Element('div', { 'class': 'econ_tag_filter_category_label' });
          $J(elTagCategoryLabel).text(rgCategory.name);
          elTagCategory.appendChild(elTagCategoryLabel);

          var rgCategoryTags = [];
          //quickly determine the total number of valid tags
          var cTagsTotal = 0;
          for (var sInternalName in rgCategory.tags) {
            if (typeof sInternalName == 'string')
              cTagsTotal++;
          }

          var elTagCtn = elTagCategory;

          var cTagsDisplayed = 0;
          for (var sInternalName in rgCategory.tags) {
            if (!rgCategory.tags.hasOwnProperty(sInternalName))
              continue;

            var rgTag = rgCategory.tags[sInternalName];
            rgTag.internal_name = sInternalName;
            rgCategoryTags.push(rgTag);
          }

          rgCategoryTags.sort(function (a, b) {
            var aName = a.name.toUpperCase();
            var bName = b.name.toUpperCase();
            if (aName < bName) return -1;
            if (aName > bName) return 1;
            return 0;
          });

          for (var index in rgCategoryTags) {
            if (!rgCategoryTags.hasOwnProperty(index))
              continue;

            var rgTag = rgCategoryTags[index];
            var sInternalName = rgTag.internal_name;

            var elTagDiv = new Element('div', { 'class': 'econ_tag_filter_container' });

            var sCheckboxName = 'tag_filter_' + (this.owner && this.owner != UserYou ? 'them_' : '');
            sCheckboxName += this.appid + '_' + this.contextid + '_' + sCategoryName + '_' + sInternalName;
            var elTagFilter = new Element('input', { 'class': 'econ_tag_filter_checkbox', 'type': 'checkbox', 'name': sCheckboxName, 'id': sCheckboxName, 'tag_name': sInternalName });
            var elTagLabel = new Element('label', { 'class': 'econ_tag_filter_label', 'for': sCheckboxName });

            if (rgTag.color) {
              var elTagName = new Element('span');
              $J(elTagName).text(rgTag.name);
              elTagName.style.color = "#" + rgTag.color;
              elTagLabel.appendChild(elTagName);
            }
            else {
              $J(elTagLabel).text(rgTag.name);
            }

            var elItemCount = new Element('span', { 'class': 'econ_tag_count' });
            elItemCount.update(" (" + rgTag.count + ")");
            elTagLabel.appendChild(elItemCount);

            $(elTagFilter).observe('change', this.TagCheckboxChanged.bind(this));

            elTagDiv.appendChild(elTagFilter);
            elTagDiv.appendChild(elTagLabel);

            if (++cTagsDisplayed == 5 && cTagsTotal > 7) {
              var elExpandTags = new Element('div', { 'class': 'econ_tag_filter_collapsable_tags_showlink whiteLink' });
              var elCollapsedTagCtn = new Element('div', { 'class': 'econ_tag_filter_collapsable_tags', style: 'display: none;' });
              elExpandTags.update('+ Show more');
              Event.observe(elExpandTags, 'click', (function (elExpandLink, elDivToExpand) { elExpandLink.hide(); new Effect.BlindDown(elDivToExpand, { duration: 0.25 }); }).bind(null, elExpandTags, elCollapsedTagCtn));

              elTagCtn.appendChild(elExpandTags);
              elTagCtn.appendChild(elCollapsedTagCtn);

              elTagCtn = elCollapsedTagCtn;
            }

            elTagCtn.appendChild(elTagDiv);
          }

          this.elTagContainer.appendChild(elTagCategory);
        }

        // add a div to clear the floating
        this.elTagContainer.appendChild(new Element('div', { "style": "clear: left;" }));
      },

      BuildInventoryDisplayElements: function () {
        for (var currencyid in this.rgCurrency) {
          var rgCurrency = this.rgCurrency[currencyid];

          // hide wallet currencies this user does not care about
          if (CurrencyIsWalletFunds(rgCurrency) &&
            (g_bWalletTradeUnavailable ||
              (typeof (g_rgWalletInfo) != 'undefined' && g_rgWalletInfo['wallet_currency'] != (rgCurrency.id % 1000)))) {
            continue;
          }

          var elCurrency = this.BuildItemElement(rgCurrency);

          var elItemHolder = new Element('div', { 'class': 'itemHolder' });
          elItemHolder.appendChild(elCurrency);
          elItemHolder.rgItem = elCurrency.rgItem;

          this.rgItemElements.push(elItemHolder);

          var strCompositeId = this.owner.GetSteamId() + '_' + this.appid + '_' + this.contextid;
          if (g_bIsTrading) {
            CreateItemContextMenuButton(elItemHolder, strCompositeId, this.owner);
          }

          rgCurrency.element = elCurrency;
          rgCurrency.homeElement = elItemHolder;
        }

        var rgSortedInventory = {};
        for (var itemid in this.rgInventory) {
          var rgItem = this.rgInventory[itemid];
          rgSortedInventory[rgItem.pos] = rgItem;
        }

        for (var pos in rgSortedInventory) {
          var rgItem = rgSortedInventory[pos];
          var itemid = rgItem.id;
          var elItem;

          try {
            elItem = this.BuildItemElement(rgItem);
          }
          catch (e) {
            elItem = this.BuildUnknownItemElement(itemid);
          }

          if (g_bTradeOffer && this.owner == UserThem) {
            rgItem.is_their_item = true;
          }

          var elItemHolder = new Element('div', { 'class': 'itemHolder' });
          elItemHolder.appendChild(elItem);
          elItemHolder.rgItem = elItem.rgItem;

          this.rgItemElements.push(elItemHolder);

          var strCompositeId = this.owner.GetSteamId() + '_' + this.appid + '_' + this.contextid;
          if (g_bIsTrading) {
            CreateItemContextMenuButton(elItemHolder, strCompositeId, this.owner);
          }

          rgItem.element = elItem;
          rgItem.homeElement = elItemHolder;
        }

        if (g_bIsTrading && !g_bReadOnly)
          this.MakeElementsDraggable();
      },

      MakeElementsDraggable: function () {
        for (var currencyid in this.rgCurrency) {
          var rgCurrency = this.rgCurrency[currencyid];

          if (rgCurrency.element)
            MakeCurrencyDraggable(rgCurrency.element);
        }
        for (var itemid in this.rgInventory) {
          var rgItem = this.rgInventory[itemid];
          if (rgItem.is_stackable)
            MakeCurrencyDraggable(rgItem.element);
          else
            MakeItemDraggable(rgItem.element);
        }
      },

      LayoutPages: function () {
        // remove any current page elements
        this.elInventory.childElements().invoke('remove');

        var elPage = new Element('div', { 'class': 'inventory_page' });
        this.m_rgLazyLoadImages = [];
        var oPageBuilder = { elPage: elPage, cPageItemsRemaining: INVENTORY_PAGE_ITEMS };

        for (var iItem = 0; iItem < this.rgItemElements.length; iItem++) {
          var elItemHolder = this.rgItemElements[iItem];

          if (elItemHolder.parentNode)
            elItemHolder.remove();
          this.AddElementToPage(elItemHolder, oPageBuilder);
        }

        if (!g_bEnableDynamicSizing) {
          for (var i = 0; i < oPageBuilder.cPageItemsRemaining; i++) {
            oPageBuilder.elPage.appendChild(new Element('div', { 'class': 'itemHolder disabled' }));
          }
        }
        oPageBuilder.elPage.hide();
        this.elInventory.appendChild(oPageBuilder.elPage);

        var rgPages = this.elInventory.childElements();
        this.pageList = rgPages;
        this.pageTotal = rgPages.length;
        for (var i = 0; i < rgPages.length; i++)
          rgPages[i].iPage = i;

        this.elInventory.appendChild(new Element('div', { 'style': 'clear: left;' }));

        this.bNeedsRepagination = false;
      },

      AddElementToPage: function (elItemHolder, oPageBuilder) {
        if (g_bEnableDynamicSizing) {
          if (elItemHolder.firstChild.lazyload_image) {
            this.m_rgLazyLoadImages.push($J(elItemHolder));
          }
        }
        else if (oPageBuilder.cPageItemsRemaining-- <= 0) {
          oPageBuilder.elPage.hide();
          this.elInventory.appendChild(oPageBuilder.elPage);
          oPageBuilder.elPage = new Element('div', { 'class': 'inventory_page' });
          oPageBuilder.cPageItemsRemaining = INVENTORY_PAGE_ITEMS - 1;
        }

        oPageBuilder.elPage.appendChild(elItemHolder);
      },


      BuildItemElement: function (rgItem) {
        var elItem = new Element('div', { id: 'item' + this.appid + '_' + this.contextid + '_' + rgItem.id, 'class': 'item app' + this.appid + ' context' + this.contextid });
        if (rgItem.name_color)
          elItem.style.borderColor = '#' + rgItem.name_color;
        if (rgItem.background_color)
          elItem.style.backgroundColor = '#' + rgItem.background_color;

        rgItem.appid = this.appid;
        rgItem.contextid = this.contextid;
        elItem.rgItem = rgItem;

        if (rgItem.is_stackable)
          elItem.lazyload_image = ImageURL(rgItem.icon_url, '96f', '58f', true);
        else
          elItem.lazyload_image = ImageURL(rgItem.icon_url, '96f', '96f', true);

        if (typeof (rgItem.icon_drag_url) != 'undefined' && rgItem.icon_drag_url != '') {
          if (rgItem.is_stackable)
            elItem.drag_image = ImageURL(rgItem.icon_drag_url, '96f', '58f', true);
          else
            elItem.drag_image = ImageURL(rgItem.icon_drag_url, '96f', '96f', true);
        }

        if (rgItem.is_stackable) {
          var elAmount = new Element('div', { 'class': 'item_currency_amount' });
          if (rgItem.name_color)
            elAmount.style.color = '#' + rgItem.name_color;

          if (CurrencyIsWalletFunds(rgItem))
            elAmount.update(v_currencyformat(rgItem.amount, rgItem.name));
          else
            elAmount.update(v_numberformat(rgItem.amount));

          elItem.appendChild(elAmount);

          var elCurrencyName = new Element('div', { 'class': 'item_currency_name' });
          if (rgItem.name_color)
            elCurrencyName.style.color = '#' + rgItem.name_color;

          elCurrencyName.update(rgItem.is_currency ? rgItem.name : '');

          elItem.appendChild(elCurrencyName);
        }

        if (g_bIsTrading) {
          Event.observe(elItem, 'mouseover', MouseOverItem.bindAsEventListener(null, this.owner, elItem, rgItem));
          Event.observe(elItem, 'mouseout', MouseOutItem.bindAsEventListener(null, this.owner, elItem, rgItem));
        }

        var url = (g_bIsTrading ? this.GetInventoryPageURL() : '') + '#' + this.appid + '_' + this.contextid + '_' + rgItem.id;
        var elLink = new Element('a', { href: url, 'class': 'inventory_item_link' });
        if (Prototype.Browser.IE) {
          elLink.appendChild(new Element('img', { src: 'https://community.cloudflare.steamstatic.com/public/images/trans.gif', width: 96, height: 96 }));
        }
        elItem.appendChild(elLink);
        this.BindMouseEvents(elLink, elItem);

        if (rgItem.fraudwarnings) {
          var elFraudWarningIcon = new Element('div', { 'class': 'slot_app_fraudwarning' });
          elItem.appendChild(elFraudWarningIcon);
        }

        return elItem;
      },

      BuildUnknownItemElement: function (appid, contextid, itemid) {
        var elItem = new Element('div', { 'class': 'item unknownItem' });
        elItem.identify();
        elItem.update('<img src="https://community.cloudflare.steamstatic.com/public/images/' + (g_bIsTrading ? 'login/throbber.gif' : 'trans.gif') + '" class="item_throbber">');
        elItem.rgItem = { unknown: true, id: itemid, appid: this.appid, contextid: this.contextid, element: elItem, name: 'Unknown Item ' + itemid, descriptions: [], fraudwarnings: ['Could not retrieve information about this item.'] };

        if (g_bIsTrading) {
          Event.observe(elItem, 'mouseover', MouseOverItem.bindAsEventListener(null, this.owner, elItem, elItem.rgItem));
          Event.observe(elItem, 'mouseout', MouseOutItem.bindAsEventListener(null, this.owner, elItem, elItem.rgItem));
        }

        var url = (g_bIsTrading ? this.GetInventoryPageURL() : '') + '#' + this.appid + '_' + this.contextid + '_' + itemid;
        var elLink = new Element('a', { href: url, 'class': 'inventory_item_link' });
        if (Prototype.Browser.IE) {
          elLink.appendChild(new Element('img', { src: 'https://community.cloudflare.steamstatic.com/public/images/trans.gif', width: 96, height: 96 }));
        }
        elItem.appendChild(elLink);
        this.BindMouseEvents(elLink, elItem);

        return elItem;
      },

      BindMouseEvents: function (elLink, elItem) {
        // on trade UI, we only do "select item" for touches
        var _this = this;
        $J(elLink).on('click', function (e) {
          _this.SelectItem(e, elItem, elItem.rgItem, true);
          if (elItem.rgItem.in_touch) {
            $J(elItem).parents('.itemHolder').removeClass('in_touch');
            delete elItem.rgItem.in_touch;
          }
        });

        if (g_bIsTrading) {
          $J(elLink).on('touchstart', function () {
            elItem.rgItem.in_touch = true;
            $J(elItem).parents('.itemHolder').addClass('in_touch');
          });
        }
      },

      MakeActive: function () {
        // are we taking over paging controls again?
        if (this.bNeedsRepagination)
          this.LayoutPages();

        var elControls = $('inventory_pagecontrols');
        if (this.pageTotal <= 1)
          elControls.style.visibility = 'hidden';
        else
          elControls.style.visibility = '';

        this.SetActivePage(this.pageCurrent);

        this.show();
      },

      LocateAsset: function (itemid) {
        if (this.rgInventory && this.rgInventory[itemid])
          return this.rgInventory[itemid];
        else
          return null;
      },

      LocateAssetElement: function (itemid) {
        if (g_bIsTrading && !g_bTradeOffer && this.owner == UserThem) {
          // for the other user's inventory in a trade, we create elements on demand
          var item = this.LocateAsset(itemid);
          if (item) {
            if (!item.element) {
              // we create item elements on demand for the other user
              var element = this.BuildItemElement(item);
              item.element = element;
              this.LoadItemImage(element);
            }
            return item.element;
          }
        }
        else {
          if (!this.initialized)
            this.Initialize();

          if (this.rgInventory && this.rgInventory[itemid])
            return this.rgInventory[itemid].element;
        }

        return this.BuildUnknownItemElement(itemid);
      },

      LocateCurrency: function (currencyid) {
        if (this.rgCurrency && this.rgCurrency[currencyid])
          return this.rgCurrency[currencyid];
        else
          return null;
      },

      LoadPageImages: function (elPage) {
        if (g_bEnableDynamicSizing) {
          window.setTimeout(function () { $J(elPage).trigger('scroll'); }, 1);
        }
        else if (!elPage.images_loaded) {
          var rgItemHolders = elPage.childElements();
          for (var i = 0; i < rgItemHolders.length; i++) {
            var elItemHolder = rgItemHolders[i];
            var elItem = elItemHolder.firstChild;
            this.LoadItemImage(elItem);
          }
          elPage.images_loaded = true;
        }
      },

      LoadItemImage: function (elItem) {
        if (elItem && elItem.lazyload_image) {
          elItem.appendChild(new Element('img', { src: elItem.lazyload_image }));
          elItem.lazyload_image = false;
        }
      },

      PrepPageTransition: function (nPageWidth, iCurPage, iNextPage) {
        $('inventories').style.overflow = 'hidden';
        this.elInventory.style.width = (2 * nPageWidth) + 'px';

        // breifly fix the width on pages for the transition
        $J(this.pageList[iCurPage]).add(this.pageList[iNextPage]).css('width', nPageWidth + 'px');
        this.pageList[iNextPage].show();
        this.LoadPageImages(this.pageList[iNextPage]);

        this.bInPagingTransition = true;
      },

      NextPage: function () {
        if (this.pageCurrent < this.pageTotal - 1 && !this.bInPagingTransition) {
          var nPageWidth = $J(this.elInventory).children('.inventory_page:first').width();

          var iCurPage = this.pageCurrent;
          var iNextPage = iCurPage + 1;

          this.PrepPageTransition(nPageWidth, iCurPage, iNextPage);
          this.elInventory.style.left = '0px';

          var fnOnFinish = this.FinishPageTransition.bind(this, iCurPage, iNextPage);
          this.transitionEffect = new Effect.Move(this.elInventory, { x: -nPageWidth, duration: 0.25, afterFinish: fnOnFinish });
        }
      },

      PreviousPage: function () {
        if (this.pageCurrent > 0 && !this.bInPagingTransition) {
          var nPageWidth = $J(this.elInventory).children('.inventory_page:first').width();
          var iCurPage = this.pageCurrent;
          var iNextPage = iCurPage - 1;

          this.PrepPageTransition(nPageWidth, iCurPage, iNextPage);
          this.elInventory.style.left = '-' + nPageWidth + 'px';

          var fnOnFinish = this.FinishPageTransition.bind(this, iCurPage, iNextPage);
          this.transitionEffect = new Effect.Move(this.elInventory, { x: nPageWidth, duration: 0.25, afterFinish: fnOnFinish });
        }
      },

      FinishPageTransition: function (iLastPage, iCurPage) {
        this.pageCurrent = iCurPage;
        $('inventories').style.overflow = '';
        this.pageList[iLastPage].hide();
        this.elInventory.style.left = '0px';
        this.elInventory.style.width = '';
        $J(this.pageList[iLastPage]).add(this.pageList[iCurPage]).css('width', '');
        $J(this.elInventory).removeClass('inTransition');

        this.bInPagingTransition = false;
        this.UpdatePageCounts();
        this.PreloadPageImages(this.pageCurrent);
      },

      SetActivePage: function (iPage) {
        if (this.BIsPendingInventory()) {
          // just hold on to the value
          this.pageCurrent = iPage;
          return;
        }

        if (iPage >= this.pageTotal)
          return;

        // we may have removed pages
        if (this.pageCurrent >= 0 && this.pageCurrent < this.pageTotal)
          this.pageList[this.pageCurrent].hide();

        this.pageList[iPage].show();
        this.pageCurrent = iPage;
        this.UpdatePageCounts();


        this.PreloadPageImages(this.pageCurrent);
      },

      PreloadPageImages: function (iPage) {
        // this page
        this.LoadPageImages(this.pageList[iPage]);
        // next page
        if (iPage < this.pageTotal - 1)
          this.LoadPageImages(this.pageList[iPage + 1]);
        // previous page
        if (iPage > 0)
          this.LoadPageImages(this.pageList[iPage - 1]);
      },

      UpdatePageCounts: function () {
        $('pagecontrol_cur') && $('pagecontrol_cur').update(this.pageCurrent + 1);
        $('pagecontrol_max') && $('pagecontrol_max').update(this.pageTotal);

        if (this.pageCurrent > 0)
          $('pagebtn_previous').removeClassName('disabled');
        else
          $('pagebtn_previous').addClassName('disabled');

        if (this.pageCurrent < this.pageTotal - 1)
          $('pagebtn_next').removeClassName('disabled');
        else
          $('pagebtn_next').addClassName('disabled');
      },


      SelectItem: function (event, elItem, rgItem, bUserAction) {
        if (event)
          event.preventDefault();

        var bShouldShowPopup = (g_bIsInventoryPage && Economy_UseResponsiveLayout());

        if (g_bIsTrading) {
          // in trading you can't "select" items, for the most part.  Only on touch, or in responsive mode (no hovers)
          // parent_item indicates it's a stack of currency in a trade - clicking it presents a dialog instead of our popup
          if ((rgItem.in_touch || (Economy_UseResponsiveLayout())) &&
            !rgItem.parent_item)
            bShouldShowPopup = true;
          else
            return;
        }

        var iNewSelect = (iActiveSelectView == 0) ? 1 : 0;
        var sOldInfo = 'iteminfo' + iActiveSelectView;
        var sNewInfo = 'iteminfo' + iNewSelect;


        var elOldInfo = $(sOldInfo);
        var elNewInfo = $(sNewInfo);

        elOldInfo.style.position = 'absolute';
        elNewInfo.style.position = '';

        if (elNewInfo.visible && !bShouldShowPopup) {
          elNewInfo.effect && elNewInfo.effect.cancel();
          elNewInfo.hide();
          elNewInfo.style.opacity = 1;
        }
        if (elNewInfo.blankTimeout) {
          window.clearTimeout(elNewInfo.blankTimeout);
        }
        BuildHover(sNewInfo, rgItem, UserYou);


        if (bShouldShowPopup) {
          // event indicates the user tapped an item, otherwise they may have just switched inventories
          if (bUserAction) {
            var $Info = $J(elNewInfo);

            var $BtnAddToTrade = $Info.find('.item_desc_addtotrade');
            if ($BtnAddToTrade.length && typeof OnDoubleClickItem != 'undefined') {
              var bInTrade = $J(elItem).parents('.itemHolder').hasClass('trade_slot');

              if (bInTrade) {
                $BtnAddToTrade.removeClass('btn_green_white_innerfade').addClass('btn_grey_white_innerfade');
                $BtnAddToTrade.children('span').text('Remove from trade');
              }
              else {
                $BtnAddToTrade.removeClass('btn_grey_white_innerfade').addClass('btn_green_white_innerfade');
                $BtnAddToTrade.children('span').text('Add to trade');
              }

              $BtnAddToTrade.on('click', function () {
                g_ActiveItemPopupModal && g_ActiveItemPopupModal.Dismiss();
                OnDoubleClickItem(null, elItem);
              });

              if (typeof g_bReadOnly != 'undefined' && g_bReadOnly)
                $BtnAddToTrade.hide();
              else
                $BtnAddToTrade.show();
            }

            ShowItemHoverAsPopup($Info, function () {
              $BtnAddToTrade.off('click');

              $J('.inventory_page_right').append($Info);
              g_ActiveItemPopupModal = null;
            });
          }
        }
        else {
          elOldInfo.style.zIndex = 2;
          elNewInfo.style.zIndex = 1;
          elNewInfo.show();

          elOldInfo.hiding = false;
          HideWithFade(elOldInfo);
        }

        if (elOldInfo.builtFor && elOldInfo.builtFor.element)
          elOldInfo.builtFor.element.removeClassName('activeInfo');
        $(rgItem.element).addClassName('activeInfo');
        this.selectedItem = rgItem;

        // the user has the appwide context selected, so update the active item there.
        if (g_ActiveInventory && g_ActiveInventory != this && g_ActiveInventory.contextid == APPWIDE_CONTEXT)
          g_ActiveInventory.selectedItem = rgItem;

        elOldInfo.blankTimeout = window.setTimeout(function () { $(sOldInfo + '_item_icon').src = 'https://community.cloudflare.steamstatic.com/public/images/trans.gif'; }, 200);

        iActiveSelectView = iNewSelect;
      },

      SelectItemNoOp: function (event) {

        if (event)
          event.preventDefault();
      },

      EnsurePageActiveForItem: function (elItem) {
        if (elItem && elItem.parentNode && elItem.parentNode.parentNode)
          this.SetActivePage(elItem.parentNode.parentNode.iPage);
      },

      GetInventoryPageURL: function () {
        return this.owner.GetProfileURL() + '/inventory/';
      }

    });


    var CAppwideInventory = Class.create(CInventory, {

      rgInventories: null,
      bIsAppwideInventory: true,
      rgContextIds: null,
      rgChildInventories: null,
      cInventoriesLoaded: 0,
      bEmpty: true,
      rgAllChildElements: null,

      initialize: function ($super, owner, appid, rgContextIds) {
        $super(owner, appid, 0, null, null);
        this.rgContextIds = rgContextIds;
        this.rgChildInventories = {};
        this.rgAllChildElements = new Array();
      },

      Initialize: function () {
        this.bNeedsRepagination = true;

        this.initialized = true;
      },

      GetContextIds: function () {
        return this.rgContextIds;
      },

      AddChildInventory: function (inventory) {
        if (!this.rgChildInventories[inventory.contextid])
          this.cInventoriesLoaded++;

        this.rgChildInventories[inventory.contextid] = inventory;
        if (this.bEmpty && !inventory.BIsEmptyInventory())
          this.bEmpty = false;

        if (!this.BIsPendingInventory()) {
          this.AllChildrenLoaded();
        }
      },

      AllChildrenLoaded: function () {
        this.tags = {};

        for (var sContextID in this.rgChildInventories) {
          var inventory = this.rgChildInventories[sContextID];
          for (var sCategoryName in inventory.tags) {
            var rgChildCategory = inventory.tags[sCategoryName];

            var rgCategory = this.tags[sCategoryName];

            if (!rgCategory) {
              rgCategory = this.tags[sCategoryName] = { "name": rgChildCategory.name, "tags": {} };
            }

            for (var tagid in rgChildCategory.tags) {
              var rgTag = rgChildCategory.tags[tagid];

              if (rgCategory.tags[tagid])
                rgCategory.tags[tagid].count += rgTag.count;
              else {
                var rgNewTag = { "name": rgTag.name, "count": rgTag.count };
                if (rgTag.color)
                  rgNewTag.color = rgTag.color;
                rgCategory.tags[tagid] = rgNewTag;
              }
            }
          }
        }

        this.BuildInventoryTagFilters();
        var elTags = this.getTagContainer();
        var elTagHolder = $('filter_options');
        if (elTagHolder && elTags) {
          elTags.hide();
          elTagHolder.insert(elTags);
          elTagHolder.addClassName('filter_collapsed');
        }
      },

      OnInventoryReload: function (contextid) {
        if (this.rgChildInventories[contextid]) {
          this.cInventoriesLoaded--;
          this.rgChildInventories[contextid] = null;
          this.bNeedsRepagination = true;
        }
      },

      BIsPendingInventory: function () {
        // pending means we are still waiting for the inventory to load
        return this.cInventoriesLoaded < this.rgContextIds.length;
      },

      BIsEmptyInventory: function () {
        return this.bEmpty || this.BIsPendingInventory();
      },

      PrepareElementList: function () {

      },

      MakeActive: function () {
        if (this.BIsPendingInventory())
          return;

        for (var contextid in this.rgChildInventories) {
          var inventory = this.rgChildInventories[contextid];

          if (!inventory.initialized)
            inventory.Initialize();

          if (!inventory.bNeedsRepagination) {
            // if an inventory took control of its child elements again, we need to take them back
            this.bNeedsRepagination = true;
            inventory.bNeedsRepagination = true;
          }
        }

        if (this.bNeedsRepagination)
          this.LayoutPages();

        var elControls = $('inventory_pagecontrols');
        if (this.pageTotal <= 1)
          elControls.style.visibility = 'hidden';
        else
          elControls.style.visibility = '';

        this.SetActivePage(this.pageCurrent);

        this.show();
      },

      LayoutPages: function () {
        // remove any current page elements
        this.elInventory.childElements().invoke('remove');

        var elPage = new Element('div', { 'class': 'inventory_page' });
        this.m_rgLazyLoadImages = [];
        var oPageBuilder = { elPage: elPage, cPageItemsRemaining: INVENTORY_PAGE_ITEMS };

        for (var iContext = 0; iContext < this.rgContextIds.length; iContext++) {
          var contextid = this.rgContextIds[iContext];
          var inventory = this.rgChildInventories[contextid];
          for (var iItem = 0; iItem < inventory.rgItemElements.length; iItem++) {
            var elItemHolder = inventory.rgItemElements[iItem];

            if (elItemHolder.parentNode)
              elItemHolder.remove();
            this.AddElementToPage(elItemHolder, oPageBuilder);
          }
        }


        if (!g_bEnableDynamicSizing) {
          for (var i = 0; i < oPageBuilder.cPageItemsRemaining; i++) {
            oPageBuilder.elPage.appendChild(new Element('div', { 'class': 'itemHolder disabled' }));
          }
        }
        oPageBuilder.elPage.hide();
        this.elInventory.appendChild(oPageBuilder.elPage);

        var rgPages = this.elInventory.childElements();
        this.pageList = rgPages;
        this.pageTotal = rgPages.length;
        for (var i = 0; i < rgPages.length; i++)
          rgPages[i].iPage = i;

        this.elInventory.appendChild(new Element('div', { 'style': 'clear: left;' }));

        this.bNeedsRepagination = false;
      },

      LocateAsset: function (itemid) {
        for (var contextid in this.rgChildInventories) {
          var item = this.rgChildInventories[contextid].LocateAsset(itemid);
          if (item)
            return item;
        }
        return null;
      }

    });


    var CForeignInventoryPending = Class.create(CInventory, {

      LocateAssetElement: function (itemid) {
        return this.BuildUnknownItemElement(itemid);
      },

      LocateAsset: function (itemid) {
        return null;
      },

      BIsPendingInventory: function () {
        // pending means we are still waiting for the inventory to load
        return true;
      }
    });

    APPWIDE_CONTEXT = 0;

    var CUser = Class.create({
      bReady: false,
      nItemsInTrade: 0,
      cLoadsInFlight: 0,
      bDynamicLoadInventory: true,
      strProfileURL: null,
      strSteamId: null,
      rgContexts: null,
      rgAppwideInventories: null,
      rgContextIdsByApp: null,
      rgAppInfo: null,
      nActiveAppId: null,

      initialize: function () {
        this.rgContexts = {};
        this.rgContextIdsByApp = {};
        this.rgAppwideInventories = {};
        this.rgAppInfo = {};
        this.bReady = false;
      },

      GetContext: function (appid, contextid) {
        return this.rgContexts[appid] && this.rgContexts[appid][contextid];
      },

      getInventory: function (appid, contextid) {
        var rgContext = this.GetContext(appid, contextid);
        var inventory = rgContext ? rgContext.inventory : null;

        if (!inventory) {
          this.loadInventory(appid, contextid);
          // this will be a temporary inventory object
          inventory = rgContext.inventory;
        }
        else if (inventory.bIsAppwideInventory) {
          this.LoadAppwideInventory(inventory);
        }
        return inventory;
      },

      HasApp: function (appid) {
        return !!this.rgContexts[appid];
      },

      GetAllLoadedInventories: function () {
        var rgInventories = [];
        for (var appid in this.rgContexts) {
          var rgAppContexts = this.rgContexts[appid];
          for (var contextid in rgAppContexts) {
            var rgContext = rgAppContexts[contextid];
            if (rgContext && rgContext.inventory)
              rgInventories.push(rgContext.inventory);
          }
        }

        return rgInventories;
      },

      InvalidatePaging: function () {
        var rgInventories = this.GetAllLoadedInventories();
        for (var i = 0; i < rgInventories.length; i++) {
          rgInventories[i].bNeedsRepagination = true;
        }

        if (g_ActiveInventory && g_ActiveInventory.bNeedsRepagination &&
          !g_ActiveInventory.BIsPendingInventory() && !g_ActiveInventory.BIsEmptyInventory()) {
          g_ActiveInventory.LayoutPages();
          g_ActiveInventory.SetActivePage(0);


          var elControls = $('inventory_pagecontrols');
          if (g_ActiveInventory.pageTotal <= 1)
            elControls.style.visibility = 'hidden';
          else
            elControls.style.visibility = '';
        }
      },

      LoadAppwideInventory: function (appwideInventory) {
        var appid = appwideInventory.appid;
        var rgContextIds = appwideInventory.GetContextIds();
        for (var i = 0; i < rgContextIds.length; i++) {
          var contextid = rgContextIds[i];
          var rgContext = this.GetContext(appid, contextid);
          var inventory = rgContext ? rgContext.inventory : null;
          if (!inventory)
            this.loadInventory(appid, contextid);
        }
      },

      addInventory: function (inventory) {
        var rgContext = this.GetContext(inventory.appid, inventory.contextid);

        var oldInventory = rgContext.inventory;
        rgContext.inventory = inventory;

        if (oldInventory) {
          if (oldInventory.pageCurrent)
            inventory.SetActivePage(oldInventory.pageCurrent);

          oldInventory.destroy();
        }

        if ((this == UserYou || g_bTradeOffer) && inventory.contextid != APPWIDE_CONTEXT && !inventory.BIsPendingInventory() && !this.BIsSingleContextApp(inventory.appid)) {
          var appwideContext = this.GetContext(inventory.appid, APPWIDE_CONTEXT);
          appwideContext.inventory.AddChildInventory(inventory);

          if (!appwideContext.inventory.BIsPendingInventory()) {
            this.ShowInventoryIfActive(inventory.appid, APPWIDE_CONTEXT);
          }
        }
      },

      findAsset: function (appid, contextid, itemid) {
        var inventory = this.getInventory(appid, contextid);
        if (inventory)
          return inventory.LocateAsset(itemid);
        else
          return null;
      },

      findAssetElement: function (appid, contextid, itemid) {
        var inventory = this.getInventory(appid, contextid);
        if (inventory) {
          var element = inventory.LocateAssetElement(itemid);
          if (element)
            inventory.LoadItemImage(element);

          return element;
        }
        else
          return null;
      },

      FindCurrency: function (appid, contextid, currencyid) {
        var inventory = this.getInventory(appid, contextid);
        if (inventory)
          return inventory.LocateCurrency(currencyid);
        else
          return null;
      },

      BIsLoadingInventoryData: function () {
        return this.cLoadsInFlight > 0;
      },

      SetProfileURL: function (strProfileURL) {
        this.strProfileURL = strProfileURL;
      },

      GetProfileURL: function () {
        return this.strProfileURL;
      },

      SetSteamId: function (strSteamId) {
        this.strSteamId = strSteamId;
      },

      GetSteamId: function () {
        return this.strSteamId;
      },

      LoadContexts: function (rgAppContextData) {
        for (var appid in rgAppContextData) {
          var rgAppData = rgAppContextData[appid];

          var appTradePermissions = 'FULL';
          if (rgAppData.trade_permissions)
            appTradePermissions = rgAppData.trade_permissions;

          this.rgContexts[appid] = {};
          var rgContextIds = [];

          this.rgAppInfo[appid] = rgAppData;

          for (var contextid in rgAppData.rgContexts) {
            var rgContext = rgAppData.rgContexts[contextid];
            rgContext.trade_permissions = appTradePermissions;
            rgContext.inventory = null;
            this.rgContexts[appid][contextid] = rgContext;
            rgContextIds.push(contextid);
          }

          if (rgContextIds.length > 1) {
            // add a virtual context to represent the app-wide view
            var inventory = new CAppwideInventory(this, appid, rgContextIds.clone());
            var elInventory = inventory.getInventoryElement();
            elInventory.hide();
            $('inventories').insert(elInventory);

            var templAllContextName = new Template('All #{appname} Items');

            var rgContext = {
              id: APPWIDE_CONTEXT,
              trade_permissions: appTradePermissions,
              inventory: inventory,
              name: templAllContextName.evaluate({ appname: rgAppData.name })
            };


            this.rgContexts[appid][APPWIDE_CONTEXT] = rgContext;
            rgContextIds.splice(0, 0, APPWIDE_CONTEXT);
          }

          this.rgContextIdsByApp[appid] = rgContextIds;
        }
      },

      GetContextIdsForApp: function (appid) {
        return this.rgContextIdsByApp[appid];
      },

      BIsSingleContextApp: function (appid) {
        return (this.rgContextIdsByApp[appid] && this.rgContextIdsByApp[appid].length == 1) ? true : false;
      },

      GetFirstContextForApp: function (appid) {
        return this.GetContext(appid, this.rgContextIdsByApp[appid][0]);
      },

      ShowInventoryIfActive: function (appid, contextid) {
        if (g_ActiveUser == this && g_ActiveInventory && g_ActiveInventory.appid == appid && g_ActiveInventory.contextid == contextid) {
          if (g_bIsInventoryPage)
            ShowItemInventory(appid, contextid, null, true);
          else if (g_bIsTrading) {
            TradePageSelectInventory(g_ActiveUser, appid, contextid, true);
          }
        }
      },

      SetActiveAppId: function (appid) {
        this.nActiveAppId = appid;
      },

      GetActiveAppId: function () {
        return this.nActiveAppId;
      },

      GetTradePermissions: function (appid, contextid) {
        /* trade permissions are app-wide, but could be context-specific in the future */
        var rgContext = this.GetContext(appid, contextid);
        if (!rgContext) {
          if (!this.rgAppInfo[appid] || !this.rgAppInfo[appid].trade_permissions) {
            // We don't know anything about this app, so we're defaulting to full.
            // This allows somebody to receive items in a game they don't yet have items for, for example.
            return 'FULL';
          }
          else {
            return this.rgAppInfo[appid].trade_permissions;
          }
        }
        else {
          return rgContext.trade_permissions;
        }
      },

      GetAppData: function (appid) {
        return this.rgAppInfo[appid];
      },

      BAllowedToTradeItems: function (appid, contextid) {
        var permissions = this.GetTradePermissions(appid, contextid);
        return (permissions == 'FULL') || (permissions == 'SENDONLY') || (permissions == 'SENDONLY_FULLINVENTORY');
      },

      BAllowedToRecieveItems: function (appid, contextid) {
        var permissions = this.GetTradePermissions(appid, contextid);
        return (permissions == 'FULL') || (permissions == 'RECEIVEONLY');
      },

      BInventoryIsFull: function (appid, contextid) {
        var permissions = this.GetTradePermissions(appid, contextid);
        return permissions == 'SENDONLY_FULLINVENTORY';
      },

      OnLoadInventoryComplete: function (transport, appid, contextid) {
        this.cLoadsInFlight--;
        if (transport.responseJSON && transport.responseJSON.success) {
          var inventory = new CInventory(this, appid, contextid, transport.responseJSON.rgInventory, transport.responseJSON.rgCurrency);

          this.addInventory(inventory);
          var elInventory = inventory.getInventoryElement();
          elInventory.hide();
          $('inventories').insert(elInventory);

          var elTags = inventory.getTagContainer();
          var elTagHolder = $('filter_options');
          if (elTagHolder && elTags) {
            elTags.hide();
            elTagHolder.insert(elTags);
            elTagHolder.addClassName('filter_collapsed');
          }
        }
        else {
          this.OnInventoryLoadFailed(transport, appid, contextid);
          return;
        }

        this.ShowInventoryIfActive(appid, contextid);
        $J(window).trigger('resize.DynamicInventorySizing');

        if (g_bIsTrading)
          RedrawCurrentTradeStatus();
      },

      OnInventoryLoadFailed: function (transport, appid, contextid) {
        var elPendingInventory = $('pending_inventory_page') || $('trade_inventory_pending');
        var elFailedInventory = $('failed_inventory_page') || $('trade_inventory_failed');
        if (transport.responseJSON && transport.responseJSON.busy) {
          if (!elFailedInventory) {
            // if we don't have the "Failed" div, then just do a an alert
            alert('This inventory is not available at this time.  Please try again later.');
          }
        }

        if (g_ActiveInventory && g_ActiveInventory.appid == appid && (g_ActiveInventory.contextid == contextid || g_ActiveInventory.contextid == APPWIDE_CONTEXT)) {
          if (elPendingInventory && elFailedInventory) {
            elPendingInventory.hide();
            elFailedInventory.show();
          }
        }

        this.GetContext(appid, contextid).inventory = null;
      }


    });

    CUserYou = Class.create(CUser, {

      oDefaultInventoryId: null,
      rgActiveContextIdByApp: null,
      rgReapplyFilterTags: null,


      initialize: function ($super) {
        $super();
        this.rgActiveContextIdByApp = {};
      },

      ReloadInventory: function (appid, contextid) {
        // force a reload of an inventory that's already been loaded
        var context = this.GetContext(appid, contextid);
        if (context && context.inventory) {
          this.rgReapplyFilterTags = Filter.rgCurrentTags;
          var NewInventory = this.loadInventory(appid, contextid);

          if (!this.BIsSingleContextApp(appid)) {
            var appwideContext = this.GetContext(appid, APPWIDE_CONTEXT);
            var appwideInventory = appwideContext.inventory;

            var newAppwideInventory = new CAppwideInventory(this, appid, appwideInventory.rgContextIds);
            this.addInventory(newAppwideInventory);
            for (var sContextID in appwideInventory.rgChildInventories) {
              if (sContextID != contextid) {
                var ChildInventory = appwideInventory.rgChildInventories[sContextID];
                ChildInventory.bNeedsRepagination = true;
                newAppwideInventory.AddChildInventory(ChildInventory);
              }
            }

            var elNewAppwideInventory = newAppwideInventory.getInventoryElement();
            elNewAppwideInventory.hide();
            $('inventories').insert(elNewAppwideInventory);
          }

          if (g_ActiveInventory && g_ActiveInventory.appid == appid && (g_ActiveInventory.contextid == contextid || g_ActiveInventory.contextid == APPWIDE_CONTEXT)) {
            ShowItemInventory(appid, g_ActiveInventory.contextid, g_ActiveInventory.selectedItem ? g_ActiveInventory.selectedItem.id : null);
          }
        }
      },

      loadInventory: function (appid, contextid) {
        if (g_bIsTrading && !this.BAllowedToTradeItems(appid, contextid)) {
          // not allowed to trade, so we just create an empty inventory
          var EmptyInventory = new CInventory(this, appid, contextid, null, null);
          this.addInventory(EmptyInventory);
          return EmptyInventory;
        }
        this.cLoadsInFlight++;

        var PendingInventory = new CForeignInventoryPending(this, appid, contextid, null);
        this.addInventory(PendingInventory);

        var thisClosure = this;
        var params = {};
        if (g_bIsTrading || g_bShowTradableItemsOnly)
          params.trading = 1;

        if (typeof (g_bIsInMarketplace) != 'undefined' && g_bIsInMarketplace)
          params.market = 1;

        RequestFullInventory(
          g_strInventoryLoadURL + appid + '/' + contextid + '/',
          params,
          null,
          null,
          function (transport) { thisClosure.OnLoadInventoryComplete(transport, appid, contextid); }
        );

        return PendingInventory;
      },

      // an obj with .appid and .contextid
      GetDefaultInventoryId: function () {
        return this.oDefaultInventoryId;
      },

      SetDefaultInventoryId: function (oDefaultInventoryId) {
        this.oDefaultInventoryId = oDefaultInventoryId;
      },

      OnLoadInventoryComplete: function (transport, appid, contextid) {
        CUser.prototype.OnLoadInventoryComplete.call(this, transport, appid, contextid);

        if (this.rgReapplyFilterTags != null) {
          // Reapply filters
          Filter.rgLastTags = Filter.rgCurrentTags;
          Filter.rgCurrentTags = this.rgReapplyFilterTags;
          Filter.OnFilterChange();

          this.rgReapplyFilterTags = null;
        }
      }

    });
    UserYou = new CUserYou();

    function DisableReadOnlyMode() {
      g_bReadOnly = false;
      if (g_bIsTrading) {
        var rgInventories = UserYou.GetAllLoadedInventories();
        for (var i = 0; i < rgInventories.length; i++) {
          rgInventories[i].MakeElementsDraggable();
        }

        if (g_bTradeOffer) {
          var rgInventories = UserThem.GetAllLoadedInventories();
          for (var i = 0; i < rgInventories.length; i++) {
            rgInventories[i].MakeElementsDraggable();
          }
        }

        RedrawCurrentTradeStatus();
      }
    }

    function ShowPendingGifts() {
      if (!$('tabcontent_pendinggifts'))
        return;

      var elTabcontentInventory = $('tabcontent_inventory');
      if (elTabcontentInventory) {
        $('tabcontent_inventory').hide();
      }
      else {
        $('no_inventories') && $('no_inventories').hide();
      }

      $('tabcontent_pendinggifts').show();


      var elTab = $('pending_gift_link');
      if (elTab)
        elTab.addClassName('active');

      if (elTabcontentInventory) {
        $$('.games_list_tabs').first().childElements().invoke('removeClassName', 'active')
      }

      if (g_ActiveInventory)
        g_ActiveInventory.hide();

      g_ActiveInventory = null;
      UserYou.SetActiveAppId(null);
    }

    var g_deferredAsset = null;
    function ShowItemInventory(appid, contextid, assetid, bLoadCompleted) {
      if (g_ActiveUser == null) {
        g_ActiveUser = UserYou;
      }

      $('tabcontent_inventory') && $('tabcontent_inventory').show();
      $('tabcontent_pendinggifts') && $('tabcontent_pendinggifts').hide();

      if (!g_ActiveUser.HasApp(appid)) {
        return;
      }

      if (!contextid) {
        if (g_ActiveUser.BIsSingleContextApp(appid))
          contextid = g_ActiveUser.GetFirstContextForApp(appid).id;
        else
          contextid = APPWIDE_CONTEXT;
      }

      var inventory = g_ActiveUser.getInventory(appid, contextid);
      var bAlreadyInitialized = inventory.initialized;
      var bSellNow = false;

      if (bLoadCompleted && g_deferredAsset) {
        // use the asset we wanted to show before we dynamically loaded inventory
        assetid = g_deferredAsset;
        g_deferredAsset = null;
        if (g_bSellItemOnInventoryLoad) {
          g_bSellItemOnInventoryLoad = false;
          bSellNow = true;
        }
      }
      var lastAppId = g_ActiveInventory ? g_ActiveInventory.appid : null;
      var lastContextID = g_ActiveInventory ? g_ActiveInventory.contextid : null;
      var lastPageCurrent = g_ActiveInventory ? g_ActiveInventory.pageCurrent : 0;
      if (lastAppId != appid || contextid != lastContextID) {
        Filter.ClearFilter();
      }

      // if we're in the appwide context and looking for a specific asset, just scroll
      //	to the asset in the appwide context rather than switching to the specific
      //  context with the item
      if (assetid && lastAppId == appid && lastContextID == APPWIDE_CONTEXT) {
        contextid = APPWIDE_CONTEXT;
      }

      if (SelectInventoryFromUser(g_ActiveUser, appid, contextid, bLoadCompleted)) {
        $('iteminfo0').hide();
        $('iteminfo1').hide();
        if (g_ActiveItemPopupModal)
          g_ActiveItemPopupModal.Dismiss();

        if (g_ActiveUser.GetActiveAppId() != appid) {
          g_ActiveUser.SetActiveAppId(appid);

          var elTab = $('inventory_link_' + appid);
          elTab.siblings().invoke('removeClassName', 'active');

          var $ResponsiveSelect = $J('#responsive_inventory_select');
          var $Opt = $ResponsiveSelect.children('[data-appid=' + parseInt(appid) + ']');
          if ($Opt.length)
            $ResponsiveSelect.val($Opt.attr('value'));

          var elPendingGift = $('pending_gift_link');
          if (elPendingGift)
            elPendingGift.removeClassName('active');
          elTab.addClassName('active');
          var oEconomyDisplay = GetEconomyDisplay(appid, contextid);

          if (oEconomyDisplay && oEconomyDisplay.inventory_logo) {
            if (!bAlreadyInitialized) {
              // explicitly blank logo to prevent it from showing as the old logo until load is complete
              $('inventory_applogo').src = 'https://community.cloudflare.steamstatic.com/public/images/trans.gif';
              var fnUpdate = function () { $('inventory_applogo').src = oEconomyDisplay.inventory_logo };
              fnUpdate.defer();
            }
            else {
              $('inventory_applogo').src = oEconomyDisplay.inventory_logo;
            }
            $('inventory_applogo').show();
          }
          else {
            $('inventory_applogo').hide();
          }

          if (g_ActiveUser.BIsSingleContextApp(appid)) {
            $('context_selector').hide();
          }
          else {
            $('contextselect_options_contexts').update('');
            var rgContextIds = g_ActiveUser.GetContextIdsForApp(appid);
            var fnContextClick = function (appid, contextid) { HideMenu($('contextselect'), $('contextselect_options')); window.location = '#' + appid + '_' + contextid; };
            for (var i = 0; i < rgContextIds.length; i++) {
              var rgContext = g_ActiveUser.GetContext(appid, rgContextIds[i]);
              var elContext = new Element('div', { 'class': 'popup_item context_name', 'id': 'context_option_' + appid + '_' + rgContext.id });
              $J(elContext).text(rgContext.name);
              var strHash = '#' + appid + '_' + rgContext.id;
              elContext.observe('click', fnContextClick.bind(null, appid, rgContext.id));


              $('contextselect_options_contexts').appendChild(elContext);
            }
            $('context_selector').show();
          }
        }

        // display the current context in the drop down menu
        if (!g_ActiveUser.BIsSingleContextApp(appid)) {
          // make sure the popup isn't visible
          HideMenu($('contextselect'), $('contextselect_options'));
          var elActiveContext = $('context_option_' + appid + '_' + contextid);
          if (elActiveContext) {
            $('contextselect_activecontext').update(elActiveContext.clone(true));
          }

        }

        $('active_inventory_page').hide();
        $('empty_inventory_page').hide();
        $('pending_inventory_page').hide();
        $('failed_inventory_page').hide();

        if (g_ActiveInventory.BIsPendingInventory()) {
          $('pending_inventory_page').show();

          if (assetid)
            g_deferredAsset = assetid;
        }
        else if (g_ActiveInventory.BIsEmptyInventory()) {
          $('empty_inventory_page').show();

          $J($('empty_inventory_page').down('.gamename')).text(g_rgAppContextData[appid].name);
          var strHowToGet = '';
          if (oEconomyDisplay && oEconomyDisplay.howtoget)
            strHowToGet = oEconomyDisplay.howtoget;
          $('empty_inventory_page_howtoget').update(strHowToGet);
        }
        else {
          $('active_inventory_page').show();

          SetCookie('strInventoryLastContext', appid + '_' + contextid, 14);
        }

        // hide the tags after we select the new inventory so
        // we can show the "show" button appropriately.
        HideTagFilters();
      }
      else {
        // we already had this inventory selected.  Only continue if we are changing assetid
        if (!assetid)
          return;
      }

      // highlight an item for this game's inventory
      var rgItem = null;

      if (g_ActiveInventory.BIsEmptyInventory())
        return;

      var bShowPopup = true;
      if (assetid) {
        // either the passed in item ...
        rgItem = g_ActiveInventory.LocateAsset(assetid);
      }
      if (!rgItem) {
        // ... or the last selected item ...
        bSellNow = false;
        bShowPopup = false;
        rgItem = g_ActiveInventory.selectedItem;
      }
      if (!rgItem || rgItem.element.parentNode.filtered) {
        // ... or the first (non-filtered) item listed

        // jump to the page they were last on, if we're reloading
        if (g_ActiveInventory.appid == lastAppId && g_ActiveInventory.contextid == lastContextID && lastPageCurrent) {
          g_ActiveInventory.SetActivePage(lastPageCurrent);
        }

        bSellNow = false;
        bShowPopup = false;
        for (var iPage = g_ActiveInventory.pageCurrent; iPage < g_ActiveInventory.pageList.length; iPage++) {
          var rgItemHolders = g_ActiveInventory.pageList[iPage].childElements();
          for (var i = 0; i < rgItemHolders.length; i++) {
            if (rgItemHolders[i].filtered)
              continue;
            var elItem = $(rgItemHolders[i]).down('div.item');
            if (elItem) {
              rgItem = elItem.rgItem;
              break;
            }
          }
          if (rgItem) break;
        }
      }
      if (rgItem) {
        g_ActiveInventory.SelectItem(null, rgItem.element, rgItem, bShowPopup);
        g_ActiveInventory.EnsurePageActiveForItem(rgItem.element);

        if (bSellNow) {
          SellCurrentSelection();
        }
      }
    }

    function SelectInventoryFromUser(user, appid, contextid, bForceSelect) {
      var inventory = user.getInventory(appid, contextid);
      if (inventory == g_ActiveInventory && !bForceSelect) {
        return false;
      }

      if (g_ActiveInventory) {
        g_ActiveInventory.hide();
      }
      g_ActiveInventory = inventory;
      g_ActiveUser = user;
      if (!inventory.initialized) {
        inventory.Initialize();
      }

      inventory.MakeActive();

      return true;
    }

    function SelectInventory(appid, contextid, bForceSelect) {
      return SelectInventoryFromUser(UserYou, appid, contextid, bForceSelect);
    }

    /* special display rules for economy apps, logos, special messages, etc */
    var g_rgEconomyDisplay = { "440": { "howtoget": "You can get them from free in-game item drops, the in-game Mann Co. Store, or trade for them with friends." }, "620": { "howtoget": "You can get them from the Portal 2 in-game store or trade for them with friends." }, "753": { "1": { "howtoget": "You can get extra copies of games during special promotions, or by purchasing a game from the Steam Store and selecting \"Purchase as a Gift\" at checkout time." } }, "99900": { "logo": "https:\/\/community.cloudflare.steamstatic.com\/public\/images\/economy\/applogos\/99900.png" }, "99920": { "logo": "https:\/\/community.cloudflare.steamstatic.com\/public\/images\/economy\/applogos\/99900.png" } };
    function GetEconomyDisplay(appid, contextid) {
      var oDisplay = {};
      if (g_rgEconomyDisplay[appid]) {
        if (g_rgEconomyDisplay[appid][contextid])
          oDisplay = g_rgEconomyDisplay[appid][contextid];
        else
          oDisplay = g_rgEconomyDisplay[appid];
      }

      if (g_rgAppContextData[appid] && g_rgAppContextData[appid].inventory_logo)
        oDisplay.inventory_logo = g_rgAppContextData[appid].inventory_logo;
      else
        oDisplay.inventory_logo = oDisplay.logo;

      return oDisplay;
    }

    function ImageURL(imageName, x, y, bEnableHighDPI) {
      if (imageName) {
        x = x ? x : 0;
        y = y ? y : 0;
        var strSize = '';
        if (x != 0 || y != 0) {
          strSize = '/' + x + 'x' + y;

          // we support 2x (but not arbitrary DPIs for caching purposes).
          // The backend does not accept fractional DPIs, they are ignored.
          // 	The elements have to be set up to allow high DPI images - ie, they must be enforcing a css
          //	width or the image will be displayed too large
          if (bEnableHighDPI && window.devicePixelRatio >= 2 && g_bAllowHighDPIItemImages)
            strSize += 'dpx2x';
        }
        return 'https://community.cloudflare.steamstatic.com/economy/image/' + v_trim(imageName) + strSize;
      }
      else
        return 'https://community.cloudflare.steamstatic.com/public/images/trans.gif';
    }


    /*
     *		Hovers
     */
    function MouseOverItem(event, owner, elItem, rgItem) {
      // no hovers while the user is moving items around
      if (g_bEnableDynamicSizing || (g_bIsTrading && g_bInDrag) || (rgItem.in_touch))
        return;

      elItem.addClassName('hover');
      var hover = $('hover');
      if (hover.hiding && hover.visible() && hover.target == elItem) {
        ShowWithFade(hover);
      }
      else if ((!hover.visible() || hover.target != elItem) && !elItem.timer) {
        elItem.wants_hover = true;
        // if the hover is visible, wait a bit to give it a chacne to disappear
        if (hover.visible())
          window.setTimeout(function () { if (elItem.wants_hover) BuildHover('hover', rgItem, owner); }, Math.min(250, ITEM_HOVER_DELAY - 50));
        else
          BuildHover('hover', rgItem, owner);

        elItem.timer = window.setTimeout(function () { elItem.timer = false; if (elItem.wants_hover) ShowHover(elItem, rgItem); elItem.wants_hover = false; }, ITEM_HOVER_DELAY);
      }
    }

    function MouseOutItem(event, owner, elItem, rgItem) {
      if (event) {
        var reltarget = (event.relatedTarget) ? event.relatedTarget : event.toElement;
        if (reltarget && (reltarget == elItem || ($(reltarget).up('#' + elItem.identify()))))
          return;
      }

      CancelItemHover(elItem);
    }

    function CancelItemHover(elItem) {
      elItem.removeClassName('hover');
      if (elItem.wants_hover && elItem.timer) {
        window.clearTimeout(elItem.timer);
        elItem.wants_hover = false;
        elItem.timer = false;
      }
      else
        HideHover.defer();
    }

    var iActiveSelectView = 0;


    var HoverCurrencyFromTemplate = new Template('<span style="#{currencystyle}">#{amount}</span> from #{contextname}');

    function GetNameForItem(item) {
      var strName = item.name;
      if (CurrencyIsWalletFunds(item))
        strName = v_currencyformat(item.amount, item.name) + ' <span class="hover_item_name_small">' + strName + '</span>';
      else if (item.is_stackable)
        strName = v_numberformat(item.amount) + ' ' + strName;

      // Show the other user's currency in the name field.
      if (CurrencyIsWalletFunds(item) && typeof (g_rgWalletInfo) != 'undefined' && typeof (g_rgWalletInfo['wallet_other_currency']) != 'undefined' &&
        g_rgWalletInfo['wallet_currency'] != g_rgWalletInfo['wallet_other_currency']) {
        var bThisIsOurCurrency = (g_rgWalletInfo['wallet_currency'] == (item.id % 1000));
        var bThisIsTheirCurrency = (g_rgWalletInfo['wallet_other_currency'] == (item.id % 1000));

        if (bThisIsOurCurrency) {
          var strTheirCurrency = GetCurrencyCode(g_rgWalletInfo['wallet_other_currency']);
          strName += '<span class="hover_item_name_conversion"> / ' +
            v_currencyformat(ConvertToTheirCurrency(item.amount), strTheirCurrency) + ' <span class="hover_item_name_small">' + strTheirCurrency + '</span>' +
            '</span>';
        }
        else if (bThisIsTheirCurrency) {
          // strName already contains their currency, so let's convert to our currency and display that first.
          var strOurCurrency = GetCurrencyCode(g_rgWalletInfo['wallet_currency']);
          strName = v_currencyformat(ConvertToOurCurrencyForDisplay(item.amount), strOurCurrency) + ' <span class="hover_item_name_small">' + strOurCurrency + '</span>' +
            '<span class="hover_item_name_conversion"> / ' + strName + '</span>';
        }
      }

      return strName;
    }

    /* We allow owner to be a CUser or string ( steamid ) */
    function BuildHover(prefix, item, owner) {
      var imageName = item.icon_url_large ? item.icon_url_large : item.icon_url;
      var url = '';
      if (g_bIsTrading)
        url = ImageURL(imageName, 192, 192);
      else
        url = ImageURL(imageName, 330, 192);

      var strHoverClass = 'item_desc_content';
      if (item.appid)
        strHoverClass = strHoverClass + ' app' + item.appid + ' context' + item.contextid;

      var elHoverContent = $(prefix + '_content');
      elHoverContent.className = strHoverClass;

      $(prefix + '_item_icon').src = url;
      $(prefix + '_item_icon').alt = item.name;

      var strName = GetNameForItem(item);
      $(prefix + '_item_name').update(strName.escapeHTML());

      var elArrowLeft = $(prefix + '_arrow_left');
      var elArrowRight = $(prefix + '_arrow_right');
      if (item.name_color) {
        $(prefix + '_item_name').style.color = '#' + item.name_color;
        $(prefix + '_content').parentNode.style.borderColor = '#' + item.name_color;
        if (elArrowLeft) elArrowLeft.style.borderRightColor = '#' + item.name_color;
        if (elArrowRight) elArrowRight.style.borderLeftColor = '#' + item.name_color;
      }
      else {
        $(prefix + '_item_name').style.color = '';
        $(prefix + '_content').parentNode.style.borderColor = '';
        if (elArrowLeft) elArrowLeft.style.borderRightColor = '';
        if (elArrowRight) elArrowRight.style.borderLeftColor = '';
      }

      var elFraudWarnings = $J('#' + prefix + '_fraud_warnings');
      if (elFraudWarnings) {
        // on the inventory page, we only show fraud warnings for currency (special privacy notice)
        if (item.fraudwarnings || (g_bIsInventoryPage && item.is_currency)) {
          elFraudWarnings.empty();
          if (item.fraudwarnings) {
            for (var i = 0; i < item.fraudwarnings.length; i++) {
              var warning = $J('<div/>', { class: 'fraud_warning_box' });
              var warningImage = $J('<img>', { class: 'fraud_warning_image', src: 'https://community.cloudflare.steamstatic.com/public/images/sharedfiles/icons/icon_warning.png' });
              warning.append(warningImage);
              var warningText = $J('<span/>');
              warningText.text(item.fraudwarnings[i]);
              warning.append(warningText);
              elFraudWarnings.append(warning);
            }
          }
          if (g_bIsInventoryPage && item.is_currency) {
            var warning = $J('<div/>');
            warning.text('This amount is private and shown only to you.');
            elFraudWarnings.appendChild(warning);
          }
          elFraudWarnings.show();
        }
        else {
          elFraudWarnings.hide();
        }
      }

      if (item.appid && g_rgAppContextData[item.appid]) {
        var rgAppData = g_rgAppContextData[item.appid];
        $(prefix + '_game_icon').src = rgAppData.icon;
        $(prefix + '_game_icon').alt = rgAppData.name;
        $JFromIDOrElement(prefix + '_game_name').text(rgAppData.name);
        $JFromIDOrElement(prefix + '_item_type').text(item.type);
        $(prefix + '_game_info').show();
      }
      else {
        $(prefix + '_game_info').hide();
      }

      var elDescriptors = $(prefix + '_item_descriptors');
      PopulateDescriptions(elDescriptors, item.descriptions);

      var elActions = $(prefix + '_item_actions');
      if (elActions) {
        PopulateActions(prefix, elActions, item.actions, item, owner);
      }

      var elOwnerDescriptors = $(prefix + '_item_owner_descriptors');
      if (elOwnerDescriptors) {
        PopulateDescriptions(elOwnerDescriptors, item.owner_descriptions)
      }

      var elOwnerActions = $(prefix + '_item_owner_actions');
      if (elOwnerActions) {
        PopulateActions(prefix, elOwnerActions, item.owner_actions, item, owner);
      }

      var elCurrencyInTradeDescriptor = $(prefix + '_currency_in_trade');
      if (elCurrencyInTradeDescriptor) {
        elCurrencyInTradeDescriptor.update('');
        if (item.is_currency && item.parent_currency && owner == UserYou) {
          // this item is currency in a trade, display how much is being offered
          var rgContext = owner && owner.GetContext(item.appid, item.contextid);
          var oParams = {};
          oParams.amount = v_numberformat(item.amount);
          oParams.contextname = rgContext ? rgContext.name : '';
          oParams.currencystyle = item.name_color ? 'color: #' + item.name_color + ';' : '';
          elCurrencyInTradeDescriptor.update(HoverCurrencyFromTemplate.evaluate(oParams));
        }
      }

      var elTags = $(prefix + '_item_tags');
      var elTagsContent = $(prefix + '_item_tags_content');
      if (elTags && elTagsContent) {
        PopulateTags(elTags, elTagsContent, item.tags);
      }

      var elScrapActions = $(prefix + '_item_scrap_actions');
      var elScrapAmount = $(prefix + '_item_scrap_value');
      var elScrapLink = $(prefix + '_item_scrap_link');
      if (elScrapActions && elScrapAmount && elScrapLink) {
        if (typeof (g_bViewingOwnProfile) != 'undefined' && g_bViewingOwnProfile) {
          PopulateScrapAction(elScrapActions, elScrapAmount, elScrapLink, item);
        }
      }

      var elMarketActions = $(prefix + '_item_market_actions');
      if (elMarketActions) {
        PopulateMarketActions(elMarketActions, item);
      }


      $(prefix).builtFor = item;
      $(prefix).builtForAmount = item.amount;
    }

    function PopulateDescriptions(elDescriptions, rgDescriptions) {
      elDescriptions.update('');
      if (!rgDescriptions || !rgDescriptions.length) {
        elDescriptions.hide();
        return;
      }

      elDescriptions.show();
      for (var i = 0; i < rgDescriptions.length; i++) {
        var description = rgDescriptions[i];
        if (!description.value)
          continue;

        var strParsedDescription = v_trim(description.value.replace(/\[date\](\d*)\[\/date\]/g, function (match, p1) {
          var date = new Date(p1 * 1000);
          return date.toLocaleString();
        }));

        var elDescription = new Element('div', { 'class': 'descriptor' });
        if (description.color)
          elDescription.style.color = '#' + description.color;

        // just use a blank space for an empty string
        if (strParsedDescription.length == 0) {
          elDescription.update('&nbsp;');
        }
        else if (description.type == 'image') {
          var elImage = new Element('img', { src: v_trim(description.value) });
          elDescription.appendChild(elImage);
        }
        else if (description.type == 'html') {
          elDescription.update(strParsedDescription);
        }
        else {
          var strEscapedDescription = strParsedDescription.escapeHTML().replace(/\n/g, '<br>');
          if (description.type == 'usertext') {
            if (typeof (g_bViewingOwnProfile) == 'undefined' || !g_bViewingOwnProfile) {
              strEscapedDescription = '<strong>Custom description: </strong>' + strEscapedDescription;
            }
          }
          elDescription.update(strEscapedDescription);
        }

        if (description.label) {
          var elLabel = new Element('span', { 'class': 'descriptor_label' });
          elLabel.update(description.label + ': ');
          elDescription.insert({ top: elLabel });
        }

        elDescriptions.appendChild(elDescription);
      }
    }

    function PopulateActions(prefix, elActions, rgActions, item, owner) {
      elActions.update('');
      if (!rgActions) {
        elActions.hide();
        return;
      }
      for (var i = 0; i < rgActions.length; i++) {
        var action = rgActions[i];
        if (!action.link || !action.name)
          continue;

        var strLink = action.link.replace("%assetid%", item.id);
        strLink = strLink.replace("%contextid%", item.contextid);
        if (owner) {
          if (typeof owner == 'string')
            strLink = strLink.replace("%owner_steamid%", owner);
          else
            strLink = strLink.replace("%owner_steamid%", owner.GetSteamId());
        }

        // hack to handle "grind into goo" action
        if (strLink.match(/^javascript:GetGooValue/)) {
          HandleGetGooValueAction(prefix, item, strLink);
          continue;
        }

        var elAction = new Element(
          'a',
          {
            'class': 'btn_small btn_grey_white_innerfade',
            href: strLink
          }
        );
        var elSpan = new Element('span');
        elSpan.update(action.name);
        elAction.appendChild(elSpan);
        elActions.appendChild(elAction);
      }
      elActions.show();
    }

    function HandleGetGooValueAction(prefix, item, action) {
      var elScrapActions = $(prefix + '_item_scrap_actions');
      var elScrapAmount = $(prefix + '_item_scrap_value');
      var elScrapLink = $(prefix + '_item_scrap_link');
      if (elScrapActions && elScrapAmount && elScrapLink) {
        var rgMatches = action.match(/GetGooValue\( *'?([0-9]+)'? *, *'?([0-9]+)'? *, *'?([0-9]+)'? *, *'?([0-9]+)'? *, *'?([0-9]+)'?/);

        if (rgMatches) {
          PopulateScrapAction(elScrapActions, elScrapAmount, elScrapLink, item, rgMatches[3], rgMatches[4], rgMatches[5]);
        }
      }
    }

    function PopulateTags(elTags, elTagsContent, rgTags) {
      elTagsContent.update('');
      if (!rgTags) {
        elTags.hide();
        return;
      }

      var sTagList = "";
      for (var i = 0; i < rgTags.length; i++) {
        var tag = rgTags[i];
        if (!tag.name)
          continue;

        if (sTagList != "")
          sTagList += ", ";

        sTagList += tag.name;
      }

      if (sTagList != "") {
        elTags.show();
        $J(elTagsContent).text(sTagList);
      }
      else {
        elTags.hide();
      }
    }

    function CreateMarketActionButton(color, href, text) {
      var elButton = new Element('a', { 'class': 'item_market_action_button item_market_action_button_' + color, 'href': href });
      var elButtonLeft = new Element('span', { 'class': 'item_market_action_button_edge item_market_action_button_left' });
      var elButtonContents = new Element('span', { 'class': 'item_market_action_button_contents' });
      var elButtonRight = new Element('span', { 'class': 'item_market_action_button_edge item_market_action_button_right' });
      var elButtonPreload = new Element('span', { 'class': 'item_market_action_button_preload' });

      elButtonContents.update(text);

      elButton.appendChild(elButtonLeft);
      elButton.appendChild(elButtonContents);
      elButton.appendChild(elButtonRight);
      elButton.appendChild(elButtonPreload);

      return elButton;
    }

    function PopulateScrapAction(elActions, elScrapAmount, elScrapLink, item, appid, item_type, border_color) {
      if (item.appid != 753 || item.contextid != 6 || !appid || !item_type) {
        elActions.hide();
        return;
      }

      elScrapAmount.update('');
      elScrapLink.setAttribute('href', '#');

      // this currently uses a per-user request getting the scrap value of the item for the specific user - so it doesn't get cached
      // would be better to use one based off the properties of the item, but we don't have the item_type and border_color handy here
      $J.ajax({
        url: 'https://steamcommunity.com' + '/auction/ajaxgetgoovalueforitemtype/',
        type: 'GET',
        data: {
          appid: appid,
          item_type: item_type,
          border_color: border_color
        },
        error: function () {
          elActions.hide();
        },
        success: function (response) {
          if (response.goo_value && parseInt(response.goo_value) > 0) {
            elScrapAmount.update('%s Gems'.replace(/%s/, response.goo_value));
            elScrapLink.setAttribute('href', 'javascript:GrindIntoGoo( ' + appid + ',' + item.contextid + ',\'' + item.id + '\' )');
            elActions.show();
          }
          else {
            elActions.hide();
          }
        }
      });
    }

    function PopulateMarketActions(elActions, item) {
      elActions.update('');
      if (!item.marketable || (item.is_currency && CurrencyIsWalletFunds(item))) {
        elActions.hide();
        return;
      }

      var bIsTrading = typeof (g_bIsTrading) != 'undefined' && g_bIsTrading;

      if ((typeof (g_bViewingOwnProfile) != 'undefined' && g_bViewingOwnProfile) || bIsTrading) {
        var strMarketName = GetMarketHashName(item);

        var elPriceInfo = new Element('div');
        var elPriceInfoHeader = new Element('div', { 'style': 'height: 24px;' });

        var elMarketLink = new Element('a', {
          'href': 'https://steamcommunity.com/market/listings/' + item.appid + '/' + encodeURIComponent(strMarketName)
        });
        elMarketLink.update('View in Community Market');

        if (bIsTrading)
          Steam.LinkInNewWindow($J(elMarketLink));

        elPriceInfoHeader.appendChild(elMarketLink);

        elPriceInfo.appendChild(elPriceInfoHeader);

        var elPriceInfoContent = new Element('div', { 'style': 'min-height: 3em; margin-left: 1em;' });
        elPriceInfoContent.update('<img src="https://community.cloudflare.steamstatic.com/public/images/login/throbber.gif" alt="Working...">');
        elPriceInfo.appendChild(elPriceInfoContent);

        new Ajax.Request('https://steamcommunity.com/market/priceoverview/', {
          method: 'get',
          parameters: {
            country: g_strCountryCode,
            currency: typeof (g_rgWalletInfo) != 'undefined' ? g_rgWalletInfo['wallet_currency'] : 1,
            appid: item.appid,
            market_hash_name: strMarketName
          },
          onSuccess: function (transport) {
            if (transport.responseJSON && transport.responseJSON.success) {
              var strInfo = '';
              if (transport.responseJSON.lowest_price) {
                strInfo += 'Starting at: ' + transport.responseJSON.lowest_price + '<br>'
              }
              else {
                strInfo += 'There are no listings currently available for this item.' + '<br>';
              }

              if (transport.responseJSON.volume) {
                var strVolume = '%1$s sold in the last 24 hours';
                strVolume = strVolume.replace('%1$s', transport.responseJSON.volume);
                //strInfo += 'Median price: ' + transport.responseJSON.median_price + '<br>';
                strInfo += 'Volume: ' + strVolume + '<br>';
              }

              elPriceInfoContent.update(strInfo);
            }
          },
          onFailure: function (transport) { elPriceInfo.hide(); }
        });

        elActions.appendChild(elPriceInfo);

        if (!bIsTrading) {
          var elSellButton = CreateMarketActionButton('green', 'javascript:SellCurrentSelection()', 'Sell');
          elActions.appendChild(elSellButton);
        }

        if (!g_bMarketAllowed) {
          var elTooltip = $('market_tip_noaccess');
          InstallHoverTooltip(elSellButton, elTooltip);
        }
      }
      else {
        elActions.hide();
        return;
      }


      elActions.show();
    }


    function ShowItemHoverAsPopup(elNewInfo, fnOnDismiss) {
      g_ActiveItemPopupModal && g_ActiveItemPopupModal.Dismiss();

      var $Info = $J(elNewInfo);
      $Info.show();
      $Info.css('opacity', 1);

      var $Modal = $J('<div/>', { 'class': 'newmodal economy_modal_ctn' });
      var $PopupCtn = $J('<div/>', { 'class': 'economy_item_popup' });
      var $Scroll = $J('<div/>', { 'class': 'economy_item_popup_scroll' });
      var $DismissBtn = $J('<div/>', { 'class': 'economy_item_popup_dismiss' }).text('X');

      $PopupCtn.append($Scroll.append($Info));
      $PopupCtn.append($DismissBtn);

      g_ActiveItemPopupModal = new CModal($Modal.append($PopupCtn));
      g_ActiveItemPopupModal.SetRemoveContentOnDismissal(true);
      g_ActiveItemPopupModal.Show();
      $DismissBtn.click(function () { g_ActiveItemPopupModal.Dismiss(); });


      if (g_ActiveItemPopupModal.m_fnBackgroundClick) {
        $Modal.add($Scroll).click(function (e) { if (e.target == this && g_ActiveItemPopupModal) g_ActiveItemPopupModal.m_fnBackgroundClick(); });

      }
      g_ActiveItemPopupModal.OnDismiss(fnOnDismiss);
    }


    function SellCurrentSelection() {
      if (!g_bMarketAllowed)
        return;

      if (g_rgWalletInfo['wallet_currency'] == 0) {
        MessageDialog.Show(
          'You cannot sell items in the Community Market until you <a href="https://store.steampowered.com/steamaccount/addfunds" target="_top">add funds to your Steam Wallet</a> or make a purchase in the Steam store and provide your billing address.',
          'Cannot sell item'
        );
      }
      else {
        SellItemDialog.Show(g_ActiveInventory.selectedItem);
      }
    }

    MessageDialog = {
      m_bInitialized: false,

      Initialize: function () {
        $('market_message_dialog_accept').observe('click', this.OnAccept.bindAsEventListener(this));
        $('market_message_dialog_close').observe('click', this.OnAccept.bindAsEventListener(this));

        this.m_bInitialized = true;
      },

      Show: function (strMessage, strTitle) {

        if (!this.m_bInitialized)
          this.Initialize();

        $('market_message_dialog_title').innerHTML = strTitle;
        $('market_message_dialog_message').innerHTML = strMessage;
        showModal('market_message_dialog', true);
      },

      Dismiss: function () {
        $(document).stopObserving('keydown', this.m_fnDocumentKeyHandler);
        hideModal('market_message_dialog');
      },

      OnAccept: function (event) {
        event.stop();
        this.Dismiss();
      }
    };

    function SSAPopup() {
      var win = window.open('https://store.steampowered.com/checkout/ssapopup', 'steam_ssa', 'width=536,height=546,resize=yes,scrollbars=yes');
      win.focus();
    }

    SellItemDialog = {
      m_bInitialized: false,
      m_bWaitingForUserToConfirm: false,
      m_bWaitingOnServer: false,
      m_nConfirmedPrice: 0,
      m_nConfirmedQuantity: 0,
      m_item: null,
      m_strEscapedName: '',
      m_fnDocumentKeyHandler: null,

      m_plotPriceHistory: null,
      m_timePriceHistoryEarliest: new Date(),
      m_timePriceHistoryLatest: new Date(),

      m_modal: null,
      m_elDialogContent: null,

      Initialize: function () {
        $('market_sell_dialog_accept').observe('click', this.OnAccept.bindAsEventListener(this));
        if ($('market_sell_dialog_cancel')) $('market_sell_dialog_cancel').observe('click', this.OnCancel.bindAsEventListener(this));
        $('market_sell_dialog_ok').observe('click', this.OnConfirmationAccept.bindAsEventListener(this));
        $('market_sell_dialog_back').observe('click', this.OnConfirmationBack.bindAsEventListener(this));
        $('market_sell_quantity_input').observe('keypress', this.OnInputKeyPress.bindAsEventListener(this));
        $('market_sell_quantity_input').observe('keyup', this.OnInputKeyUp.bindAsEventListener(this));
        $('market_sell_currency_input').observe('keypress', this.OnInputKeyPress.bindAsEventListener(this));
        $('market_sell_currency_input').observe('keyup', this.OnInputKeyUp.bindAsEventListener(this));
        $('market_sell_buyercurrency_input').observe('keypress', this.OnInputKeyPress.bindAsEventListener(this));
        $('market_sell_buyercurrency_input').observe('keyup', this.OnBuyerPriceInputKeyUp.bindAsEventListener(this));

        $('market_sell_dialog').style.visibility = 'hidden';
        $('market_sell_dialog').show();
        // TODO: Slider
        $('market_sell_dialog').hide();
        $('market_sell_dialog').style.visibility = '';

        // hold a reference to prevent it form getting removed
        this.m_elDialogContent = $('market_sell_dialog');

        this.m_bInitialized = true;
      },

      Show: function (item) {

        if (!this.m_bInitialized)
          this.Initialize();

        this.m_bWaitingForUserToConfirm = false;
        this.m_nConfirmedPrice = 0;
        this.m_nConfirmedQuantity = 0;

        $('market_sell_quantity_input').style.borderColor = '';
        $('market_sell_currency_input').style.borderColor = '';
        $('market_sell_buyercurrency_input').style.borderColor = '';
        $('market_sell_dialog_error').hide();

        $('market_sell_dialog_title').update('Put an item up for sale');
        //$('market_sell_dialog_background').show();
        $('market_sell_dialog_item_availability_hint').hide();
        $('market_sell_dialog_confirm_buttons').hide();

        $('market_sell_dialog_accept').style.cursor = '';
        $('market_sell_dialog_accept').style.opacity = 1;

        $('market_sell_quantity_input').style.borderColor = '';
        $('market_sell_quantity_input').style.backgroundColor = '';
        $('market_sell_currency_input').style.borderColor = '';
        $('market_sell_currency_input').style.backgroundColor = '';
        $('market_sell_buyercurrency_input').style.borderColor = '';
        $('market_sell_buyercurrency_input').style.backgroundColor = '';

        $('market_sell_quantity_input').enable();
        $('market_sell_currency_input').enable();
        $('market_sell_buyercurrency_input').enable();
        $('market_sell_dialog_accept_ssa').enable();

        $('market_sell_dialog_ok').show();
        $('market_sell_dialog_ok').style.cursor = '';
        $('market_sell_dialog_ok').style.opacity = 1;
        $('market_sell_dialog_back').show();
        $('market_sell_dialog_back').style.cursor = '';
        $('market_sell_dialog_back').style.opacity = 1;
        $('market_sell_dialog_throbber').hide();

        this.m_item = item;

        var elItem = $('market_sell_dialog_item');
        if (item.name_color)
          elItem.style.borderColor = '#' + item.name_color;
        if (item.background_color)
          elItem.style.backgroundColor = '#' + item.background_color;

        var elItemImage = $('market_sell_dialog_item_img');
        if (item.is_stackable)
          elItemImage.src = ImageURL(item.icon_url, '96f', '58f');
        else
          elItemImage.src = ImageURL(item.icon_url, '96f', '96f');

        this.m_strEscapedName = GetNameForItem(item).escapeHTML();
        $('market_sell_dialog_item_name').update(item.name.escapeHTML());
        $('market_sell_quantity_available_amt').update(item.amount);

        if (item.name_color) {
          $('market_sell_dialog_item_name').style.color = '#' + item.name_color;
        }
        else {
          $('market_sell_dialog_item_name').style.color = '';
        }

        if (item.appid && g_rgAppContextData[item.appid]) {
          var rgAppData = g_rgAppContextData[item.appid];
          $('market_sell_dialog_game_icon').src = rgAppData.icon;
          $('market_sell_dialog_game_icon').alt = rgAppData.name;
          $JFromIDOrElement('market_sell_dialog_game_name').text(rgAppData.name);
          $J('#market_sell_dialog_item_type').update(item.type);
          $('market_sell_dialog_game_info').show();
        }
        else {
          $('market_sell_dialog_game_info').hide();
        }

        if (item.amount == 1) {
          $('market_sell_quantity_input').disable();

          $('market_sell_quantity_label').hide();
          $('market_sell_quantity_input').hide();
          $('market_sell_quantity_available').hide();
          $('market_sell_dialog_total_youreceive').hide();
        }
        else {
          $('market_sell_quantity_label').show();
          $('market_sell_quantity_input').show();
          $('market_sell_quantity_available').show();
          $('market_sell_dialog_total_youreceive').show();
        }

        this.m_fnDocumentKeyHandler = this.OnDocumentKeyPress.bindAsEventListener(this);
        $(document).observe('keydown', this.m_fnDocumentKeyHandler);

        var currencyCode = GetCurrencyCode(g_rgWalletInfo['wallet_currency']);
        $('market_sell_quantity_input').value = 1;
        $('market_sell_currency_input').value = GetCurrencySymbol(currencyCode);
        $('market_sell_buyercurrency_input').value = GetCurrencySymbol(currencyCode);
        $('market_sell_dialog_total_youreceive_amount').update(GetCurrencySymbol(currencyCode));

        var $elDialogContent = $J(this.m_elDialogContent);
        this.m_modal = new CModal($elDialogContent);
        this.m_modal.Show();

        // Make sure the dialog doesn't get wider when the user presses OK.
        this.m_modal.SetMaxWidth($elDialogContent.width());

        var _this = this;
        $J(this.m_elDialogContent).find('.newmodal_close').click(function () { _this.m_modal.m_fnBackgroundClick(); });


        $J('#market_sell_currency_input').one('focus', function () {
          // move the caret to the correct spot
          var oPriceInput = $('market_sell_currency_input');
          if (oPriceInput.setSelectionRange) {
            if (IsCurrencySymbolBeforeValue(currencyCode)) {
              // move the caret to the end
              var length = oPriceInput.value.length;
              oPriceInput.setSelectionRange(length, length);
            }
            else {
              // caret to the beginning
              oPriceInput.setSelectionRange(0, 0);
            }
          }
          else {
            var oldval = oPriceInput.value;
            oPriceInput.value = '';
            oPriceInput.value = oldval;
          }
        });

        // don't give focus on touch devices - the keyboard appears and will either
        //	overlap the actual box with focus or scroll the dialog off screen
        if (!window.UseTouchFriendlyMode || !window.UseTouchFriendlyMode())
          $('market_sell_currency_input').focus();

        // Load price history
        $J('#pricehistory_container').show();
        $J('#pricehistory').hide();
        $J('#pricehistory_throbber').show();
        $J('#pricehistory_notavailable').hide();
        new Ajax.Request('https://steamcommunity.com/market/pricehistory/', {
          method: 'get',
          parameters: {
            appid: this.m_item.appid,
            market_hash_name: GetMarketHashName(this.m_item)
          },
          onSuccess: function (transport) { SellItemDialog.OnPriceHistorySuccess(transport); },
          onFailure: function (transport) { SellItemDialog.OnPriceHistoryFailure(transport); }
        });
      },

      OnPriceHistorySuccess: function (transport) {
        $J('#pricehistory_throbber').hide();
        if (transport.responseJSON && transport.responseJSON.success && transport.responseJSON.prices.length > 0) {
          $J('#pricehistory').show();

          var line1 = transport.responseJSON.prices;

          this.m_timePriceHistoryEarliest = new Date();
          if (line1 != false) {
            this.m_timePriceHistoryEarliest = new Date(line1[0][0]);
            this.m_timePriceHistoryLatest = new Date(line1[line1.length - 1][0]);
          }

          var strFormatPrefix = transport.responseJSON.price_prefix;
          var strFormatSuffix = transport.responseJSON.price_suffix;

          this.m_plotPriceHistory = CreatePriceHistoryGraph(line1, 5, strFormatPrefix, strFormatSuffix);

          pricehistory_zoomMonthOrLifetime(this.m_plotPriceHistory, this.m_timePriceHistoryEarliest, this.m_timePriceHistoryLatest);
        }
        else {
          $J('#pricehistory_notavailable').show();
        }
      },

      OnPriceHistoryFailure: function (transport) {
        $J('#pricehistory_throbber').hide();
        $J('#pricehistory_notavailable').show();
      },

      DisplayError: function (error) {
        $('market_sell_dialog_error').show();
        $('market_sell_dialog_error').update(error);
        $('market_sell_dialog_error').style.color = '#ffffff';
        new Effect.Morph($('market_sell_dialog_error'), { style: { color: '#ff0000' }, duration: 0.25 });
      },

      Dismiss: function () {
        $(document).stopObserving('keydown', this.m_fnDocumentKeyHandler);
        if (this.m_modal)
          this.m_modal.Dismiss();
      },

      GetPriceAsInt: function () {
        return GetPriceValueAsInt($('market_sell_currency_input').value);
      },

      GetBuyerPriceAsInt: function () {
        return GetPriceValueAsInt($('market_sell_buyercurrency_input').value);
      },

      GetQuantityAsInt: function () {
        var nAmount;
        var strAmount = $('market_sell_quantity_input').value;

        if (!strAmount) {
          return 0;
        }

        strAmount = strAmount.replace(/[,.]/g, '');
        if (!strAmount || strAmount.length == 0) {
          return 0;
        }

        nAmount = parseInt(strAmount);
        if (isNaN(nAmount)) {
          return 0;
        }

        return nAmount;
      },

      OnAccept: function (event) {
        event.stop();

        // If already accepted, ignore
        if (this.m_bWaitingForUserToConfirm) {
          return;
        }

        if (!$('market_sell_dialog_accept_ssa') || !$('market_sell_dialog_accept_ssa').checked) {
          this.DisplayError('You must agree to the terms of the Steam Subscriber Agreement to sell this item.');
          return;
        }

        var price = this.GetPriceAsInt();
        var buyerPrice = this.GetBuyerPriceAsInt();
        var quantity = this.GetQuantityAsInt();

        if (quantity < 1 || quantity > this.m_item.amount) {
          $('market_sell_quantity_input').style.borderColor = 'red';
          this.DisplayError('You must enter a valid quantity.');
          return;
        }

        $('market_sell_currency_input').value = v_currencyformat(price, GetCurrencyCode(g_rgWalletInfo['wallet_currency']));
        this.OnInputKeyUp(null);

        this.RecalculateTotal(price, quantity);
        $('market_sell_quantity_input').value = quantity;

        // If the price entered exceeds the maximum allowed, prevent the sale.
        if (buyerPrice > g_rgWalletInfo['wallet_trade_max_balance'] || price > g_rgWalletInfo['wallet_trade_max_balance']) {
          $('market_sell_buyercurrency_input').style.borderColor = 'red';
          if (price > g_rgWalletInfo['wallet_trade_max_balance']) {
            $('market_sell_currency_input').style.borderColor = 'red';
          }

          var strError = ' The price entered exceeds the maximum price of %1$s.'
            .replace('%1$s', v_currencyformat(g_rgWalletInfo['wallet_trade_max_balance'], GetCurrencyCode(g_rgWalletInfo['wallet_currency'])));
          this.DisplayError(strError);
          return;
        }

        if (price <= 0 || buyerPrice <= 0) {
          $('market_sell_currency_input').style.borderColor = 'red';
          this.DisplayError('You must enter a valid price.');
          return;
        }

        // validation succeeded
        this.m_bWaitingForUserToConfirm = true;

        $('market_sell_quantity_input').style.borderColor = '';
        $('market_sell_currency_input').style.borderColor = '';
        $('market_sell_buyercurrency_input').style.borderColor = '';
        $('market_sell_dialog_error').hide();

        $('market_sell_dialog_title').update('Confirm sell price');
        //$('market_sell_dialog_background').fade({ duration: 0.25 });
        new Effect.BlindDown('market_sell_dialog_item_availability_hint', { duration: 0.25 });
        new Effect.BlindDown('market_sell_dialog_confirm_buttons', { duration: 0.25 });
        new Effect.BlindUp('pricehistory_container', { duration: 0.25 });

        // Hide the button
        $('market_sell_dialog_accept').style.cursor = 'default';
        new Effect.Morph('market_sell_dialog_accept', { style: 'opacity:0', duration: 0.25 });
        new Effect.Morph('market_sell_quantity_input', { style: 'border-color: #262626; background-color: #262626', duration: 0.25 });
        new Effect.Morph('market_sell_currency_input', { style: 'border-color: #262626; background-color: #262626', duration: 0.25 });
        new Effect.Morph('market_sell_buyercurrency_input', { style: 'border-color: #262626; background-color: #262626', duration: 0.25 });

        $('market_sell_quantity_input').disable();
        $('market_sell_currency_input').disable();
        $('market_sell_buyercurrency_input').disable();
        $('market_sell_dialog_accept_ssa').disable();

        this.m_nConfirmedPrice = price;
        this.m_nConfirmedQuantity = quantity;
      },

      OnCancel: function (event) {
        this.Dismiss();
        event.stop();
      },

      OnConfirmationAccept: function (event) {
        if (this.m_bWaitingOnServer) {
          event.stop();
          return;
        }

        this.m_bWaitingOnServer = true;

        $('market_sell_dialog_error').hide();

        $('market_sell_dialog_ok').fade({ duration: 0.25 });
        $('market_sell_dialog_back').fade({ duration: 0.25 });
        $('market_sell_dialog_throbber').show();
        $('market_sell_dialog_throbber').fade({ duration: 0.25, from: 0, to: 1 });

        $J.ajax({
          url: 'https://steamcommunity.com/market/sellitem/',
          type: 'POST',
          data: {
            sessionid: g_sessionID,
            appid: this.m_item.appid,
            contextid: this.m_item.contextid,
            assetid: this.m_item.id,
            amount: this.m_nConfirmedQuantity,
            price: this.m_nConfirmedPrice
          },
          crossDomain: true,
          xhrFields: { withCredentials: true }
        }).done(function (data) {
          if (data.success) {
            SellItemDialog.OnSuccess({ responseJSON: data });
          }
          else {
            SellItemDialog.OnFailure({ responseJSON: data });
          }
        }).fail(function (jqxhr) {
          // jquery doesn't parse json on fail
          var data = $J.parseJSON(jqxhr.responseText);
          SellItemDialog.OnFailure({ responseJSON: data });
        });

        event.stop();
      },

      OnConfirmationBack: function (event) {
        if (this.m_bWaitingOnServer) {
          event.stop();
          return;
        }

        this.m_bWaitingForUserToConfirm = false;

        // reverse the effects
        $('market_sell_dialog_title').update('Put an item up for sale');

        var item = this.m_item;

        //$('market_sell_dialog_background').fade({ duration: 0.25, from: 0, to: 1 });
        new Effect.BlindUp('market_sell_dialog_item_availability_hint', { duration: 0.25 });
        new Effect.BlindUp('market_sell_dialog_confirm_buttons', { duration: 0.25 });
        new Effect.BlindDown('pricehistory_container', { duration: 0.25 });
        new Effect.Morph('market_sell_dialog_accept', { style: 'opacity:1', duration: 0.25 });
        new Effect.Morph('market_sell_quantity_input', { style: 'border-color: #707070; background-color: #1A1A1A', duration: 0.25 });
        new Effect.Morph('market_sell_currency_input', { style: 'border-color: #707070; background-color: #1A1A1A', duration: 0.25 });
        new Effect.Morph('market_sell_buyercurrency_input', { style: 'border-color: #707070; background-color: #1A1A1A', duration: 0.25 });

        $('market_sell_dialog_accept').style.cursor = '';

        $('market_sell_dialog_accept_ssa').enable();
        $('market_sell_currency_input').enable();
        $('market_sell_buyercurrency_input').enable();
        if (item.amount != 1) {
          $('market_sell_quantity_input').enable();
        }

        event.stop();
      },

      OnSuccess: function (transport) {
        this.m_bWaitingForUserToConfirm = false;
        this.m_bWaitingOnServer = false;

        if (transport.responseJSON) {
          this.Dismiss();

          var idNameShow = (transport.responseJSON.requires_confirmation ? '_pending' : '');
          var idNameHide = (transport.responseJSON.requires_confirmation ? '' : '_pending');

          new Effect.BlindUp('market_headertip_itemsold' + idNameHide, { duration: 0.0 });

          if (this.m_nConfirmedQuantity > 1) {
            $('market_headertip_itemsold_itemname' + idNameShow).update(v_numberformat(this.m_nConfirmedQuantity) + ' ' + this.m_item.name.escapeHTML());
          }
          else {
            $('market_headertip_itemsold_itemname' + idNameShow).update(this.m_item.name.escapeHTML());
          }

          if (this.m_item.name_color) {
            $('market_headertip_itemsold_itemname' + idNameShow).style.color = '#' + this.m_item.name_color;
          }
          else {
            $('market_headertip_itemsold_itemname' + idNameShow).style.color = '';
          }

          new Effect.BlindDown('market_headertip_itemsold' + idNameShow, { duration: 0.25 });

          if (transport.responseJSON.requires_confirmation) {
            var bNeedsEmailConfirmation = transport.responseJSON.needs_email_confirmation;
            var bNeedsMobileConfirmation = transport.responseJSON.needs_mobile_confirmation;

            var strText = '';
            if (bNeedsMobileConfirmation) {
              strText = 'In order to list this item on the Community Market, you must verify the listing in your Steam Mobile app. You can verify it by launching the app and navigating to the Confirmations page from the menu.' +
                '<br><br>' +
                'If you don\'t see the Confirmations option in the main menu of the app, then make sure you have the latest version of the app.';

            }
            else {
              strText = 'In order to list this item on the Community Market, you must complete an additional verification step.  An email has been sent to your address (ending in "%s") with additional instructions.'.replace(/%s/, transport.responseJSON.email_domain);
            }

            ShowAlertDialog(
              'Additional confirmation needed',
              strText
            );
          }
          else {
            UserYou.ReloadInventory(this.m_item.appid, this.m_item.contextid);
          }
        }
        else {
          this.DisplayError('There was a problem listing your item. Refresh the page and try again.');
        }
      },

      OnFailure: function (transport) {
        this.m_bWaitingOnServer = false;

        var queue = Effect.Queues.get('global');
        queue.each(function (effect) { effect.cancel(); });

        $('market_sell_dialog_ok').show();
        $('market_sell_dialog_ok').setOpacity('0');
        $('market_sell_dialog_ok').fade({ duration: 0.25, from: 0, to: 1 });
        $('market_sell_dialog_back').show();
        $('market_sell_dialog_back').setOpacity('0');
        $('market_sell_dialog_back').fade({ duration: 0.25, from: 0, to: 1 });
        $('market_sell_dialog_throbber').fade({ duration: 0.25 });

        if (transport.responseJSON && transport.responseJSON.message) {
          this.DisplayError(transport.responseJSON.message);
        }
        else {
          this.DisplayError('There was a problem listing your item. Refresh the page and try again.');
        }
      },

      OnDocumentKeyPress: function (event) {
        if (event.keyCode == Event.KEY_ESC) {
          this.Dismiss();
          event.stop();
        }
      },

      OnInputKeyPress: function (event) {
        if (event.keyCode == Event.KEY_RETURN) {
          if (this.m_bWaitingForUserToConfirm) {
            this.OnConfirmationAccept(event);
          }
          else {
            this.OnAccept(event);
          }
        }
      },

      OnInputKeyUp: function (event) {
        var inputValue = this.GetPriceAsInt();
        var nAmount = inputValue;
        var quantity = this.GetQuantityAsInt();

        if (inputValue > 0 && nAmount == parseInt(nAmount)) {
          // Calculate what the buyer pays
          var publisherFee = typeof this.m_item.market_fee != 'undefined' ? this.m_item.market_fee : g_rgWalletInfo['wallet_publisher_fee_percent_default'];
          var info = CalculateAmountToSendForDesiredReceivedAmount(nAmount, publisherFee);
          $('market_sell_buyercurrency_input').value = v_currencyformat(info.amount, GetCurrencyCode(g_rgWalletInfo['wallet_currency']));

          this.RecalculateTotal(nAmount, quantity);
        }
      },

      OnBuyerPriceInputKeyUp: function (event) {
        var inputValue = this.GetBuyerPriceAsInt();
        var nAmount = inputValue;
        var quantity = this.GetQuantityAsInt();

        if (inputValue > 0 && nAmount == parseInt(nAmount)) {
          // Calculate what the seller gets
          var publisherFee = typeof this.m_item.market_fee != 'undefined' ? this.m_item.market_fee : g_rgWalletInfo['wallet_publisher_fee_percent_default'];
          var feeInfo = CalculateFeeAmount(nAmount, publisherFee);
          nAmount = nAmount - feeInfo.fees;
          $('market_sell_currency_input').value = v_currencyformat(nAmount, GetCurrencyCode(g_rgWalletInfo['wallet_currency']));

          this.RecalculateTotal(nAmount, quantity);
        }
      },

      RecalculateTotal: function (nAmount, quantity) {
        if (quantity > 0) {
          $('market_sell_dialog_total_youreceive_amount').update(v_currencyformat(nAmount * quantity,
            GetCurrencyCode(g_rgWalletInfo['wallet_currency'])
          ));
        }
        else {
          $('market_sell_dialog_total_youreceive_amount').update(GetCurrencySymbol(GetCurrencyCode(g_rgWalletInfo['wallet_currency'])));
        }
      }
    };

    function ShowHover(elem, item) {
      var hover = $('hover');
      if (hover.target != elem || hover.builtFor != item || hover.builtForAmount != item.amount) {
        if (hover.target)
          hover.target.removeClassName('hover');

        BuildHover('hover', item);
        hover.target = elem;
      }

      var divHoverContents = hover.down('.hover_box');

      hover.style.visibility = 'hidden';
      hover.show();

      hover.clonePosition(elem, { setWidth: false, setHeight: false });
      var hover_box = hover.down('.hover_box');
      var hover_arrow_left = hover.down('.hover_arrow_left');
      var hover_arrow_right = hover.down('.hover_arrow_right');


      var hover_arrow = hover_arrow_left;

      var nHoverHorizontalPadding = (hover_arrow ? -4 : 8);
      var boxRightViewport = elem.viewportOffset().left + parseInt(elem.getDimensions().width) + hover_box.getWidth() + (24 - nHoverHorizontalPadding);
      var nSpaceRight = document.viewport.getWidth() - boxRightViewport;
      var nSpaceLeft = parseInt(hover.style.left) - hover.getWidth();
      if (boxRightViewport > document.viewport.getWidth() && nSpaceLeft > nSpaceRight) {
        hover.style.left = (parseInt(hover.style.left) - hover.getWidth() + nHoverHorizontalPadding) + 'px';
        hover_arrow = hover_arrow_right;
      }
      else {
        hover.style.left = (parseInt(hover.style.left) + parseInt(elem.getDimensions().width) - nHoverHorizontalPadding) + 'px';
      }

      if (hover_arrow) {
        hover_arrow_left.hide();
        hover_arrow_right.hide();
        hover_arrow.show();
      }

      var nTopAdjustment = 0;

      if (elem.getDimensions().height < 98)
        nTopAdjustment = elem.getDimensions().height / 2 - 49;
      hover.style.top = ((parseInt(hover.style.top) - 13) + nTopAdjustment) + 'px';

      var boxTopViewport = elem.viewportOffset().top + nTopAdjustment;
      if (boxTopViewport + hover_box.getHeight() + 8 > document.viewport.getHeight()) {
        var nViewportAdjustment = (hover_box.getHeight() + 8) - (document.viewport.getHeight() - boxTopViewport);
        nViewportAdjustment = Math.min(hover_box.getHeight() - 74, nViewportAdjustment);
        hover.style.top = (parseInt(hover.style.top) - nViewportAdjustment) + 'px';

        if (hover_arrow)
          hover_arrow.style.top = (48 + nViewportAdjustment) + 'px';
      }
      else {
        if (hover_arrow)
          hover_arrow.style.top = '';
      }

      hover.hide();
      hover.style.visibility = '';

      ShowWithFade(hover);
    }

    function HideHover() {
      var hover = $('hover');

      if (!hover.visible() || !hover.target)
        return;

      hover.target.removeClassName('hover');

      HideWithFade(hover);
    }

    function InventoryDismissPurchaseMessage() {
      new Effect.BlindUp($('economy_popup_msg'), { duration: 0.25 });
    }


    var Filter = {

      strLastFilter: '',
      elFilter: null,
      rgLastTags: {},
      rgCurrentTags: {},

      InitFilter: function (elFilter) {
        this.strLastFilter = '';
        this.elFilter = elFilter;

        elFilter.observe('keyup', this.OnFilterChange.bind(this));
        elFilter.observe('blur', this.OnFilterChange.bind(this));
        elFilter.observe('click', this.OnFilterChange.bind(this));
        elFilter.observe('paste', this.FilterOnPaste.bind(this));
        elFilter.observe('cut', this.FilterOnPaste.bind(this));
        $('filter_clear_btn').observe('click', this.ClearTextFilter.bind(this));
      },

      ClearTextFilter: function () {
        this.elFilter.value = '';
        this.OnFilterChange();
      },

      ClearFilter: function () {
        this.elFilter.value = '';
        this.rgLastTags = this.rgCurrentTags;
        this.rgCurrentTags = {};
        this.OnFilterChange();
      },

      FilterOnPaste: function (event) {
        this.OnFilterChange.bind(this).defer();
      },

      OnFilterChange: function () {
        this.ApplyFilter(this.elFilter.value);
      },

      ReApplyFilter: function () {
        /* erase the filter so visibilty will be recalculated - should store last filter at inventory level */
        if (g_ActiveInventory.bFilterApplied && this.strLastFilter.length == 0) {
          this.strLastFilter = 'x';
          this.ApplyFilter(this.elFilter.value);
        }
        else {
          this.strLastFilter = '';
          this.ApplyFilter(this.elFilter.value);
        }
      },

      UpdateTagFiltering: function (rgNewTags) {
        this.rgLastTags = this.rgCurrentTags;
        this.rgCurrentTags = rgNewTags;
        this.ApplyFilter(this.elFilter.value);
      },

      ApplyFilter: function (filterValue, elInsertedItem) {
        if (!g_ActiveInventory || g_ActiveInventory.BIsEmptyInventory())
          return;

        var filter = v_trim(filterValue);

        if (filter == this.strLastFilter && !Object.values(this.rgCurrentTags).length && !Object.values(this.rgLastTags).length)
          return;

        var bRestricting = true;
        var bLoosening = true;
        if (elInsertedItem)
          bRestricting = bLoosening = false;

        // if it's the text filter that changed, turn on the loosening/restricting optimization
        if (filter != this.strLastFilter) {
          if (this.strLastFilter && this.strLastFilter.startsWith(filter))
            bRestricting = false;
          else if (!this.strLastFilter || filter.startsWith(this.strLastFilter))
            bLoosening = false;
        }

        this.strLastFilter = filter;

        var rgTerms = filter.length ? filter.split(' ') : false;
        for (var i = 0; i < rgTerms.length; i++) {
          // wrap each string in a case-insensitive regexp (using prototype's escape function)
          rgTerms[i] = new RegExp(RegExp.escape(rgTerms[i]), 'i');
        }


        var rgNewItemList = Array();
        var rgPages = g_ActiveInventory.pageList;
        var rgForwardInserts = {};
        var cElementsDisplayed = 0;
        for (var iPage = 0; iPage < rgPages.length; iPage++) {
          var page = rgPages[iPage];
          var iCarryoverInserts = 0;

          if (rgForwardInserts[iPage]) {
            // new items became visible on the first page, pushing some items on to this page
            for (var i = rgForwardInserts[iPage].length - 1; i >= 0; i--) {
              page.insertBefore(rgForwardInserts[iPage][i].remove(), page.firstChild);
              iCarryoverInserts++;
            }
          }

          var rgChildren = page.childElements();
          for (var iChild = 0; iChild < rgChildren.length; iChild++) {
            // skip any items that were pushed on to this page from the previous page - they've already been processed
            if (iCarryoverInserts > 0) {
              iCarryoverInserts--;
              continue;
            }

            var elItemHolder = rgChildren[iChild];
            var elItem = elItemHolder.firstChild;
            var bVisible = !elItemHolder.filtered;
            if (bVisible && bRestricting) {
              var bHide = !this.MatchItem(elItem, rgTerms, this.rgCurrentTags);
              if (bHide) {
                elItemHolder.hide();
                elItemHolder.filtered = true;
              }
            }
            else if (!bVisible && (bLoosening || elInsertedItem && elItem == elInsertedItem)) {
              var bShow = this.MatchItem(elItem, rgTerms, this.rgCurrentTags);
              if (bShow) {
                elItemHolder.show();
                elItemHolder.filtered = false;
              }
            }
            if (!elItemHolder.filtered)
              cElementsDisplayed++;
            var iCorrectPage = Math.floor((cElementsDisplayed > 0 ? cElementsDisplayed - 1 : 0) / INVENTORY_PAGE_ITEMS);
            if (iCorrectPage != iPage) {
              if (iCorrectPage > iPage) {
                if (!rgForwardInserts[iCorrectPage])
                  rgForwardInserts[iCorrectPage] = new Array();
                rgForwardInserts[iCorrectPage].push(elItemHolder);
              }
              else {
                rgPages[iCorrectPage].appendChild(elItemHolder.remove());
                g_ActiveInventory.LoadItemImage(elItem);
              }
            }
          }
        }

        if (g_bEnableDynamicSizing)
          $J(rgPages[0]).trigger('scroll');

        // blue border around filtered items
        if (filter.length || Object.values(this.rgCurrentTags).length) {
          $('inventories').addClassName('filtered');
          g_ActiveInventory.bFilterApplied = true;
        }
        else {
          $('inventories').removeClassName('filtered');
          g_ActiveInventory.bFilterApplied = false;
        }

        // blue border around the text box
        if (filter.length) {
          if ($('filter_control')) {
            $('filter_control').addClassName('filtered');
            $('filter_clear_btn').show();
          }
        }
        else {
          if ($('filter_control')) {
            $('filter_control').removeClassName('filtered');
            $('filter_clear_btn').hide();
          }
        }

        // blue border around the tag controls
        if (Object.values(this.rgCurrentTags).length) {
          if ($('filter_options'))
            $('filter_options').removeClassName('filtered');
        }
        else {
          if ($('filter_options'))
            $('filter_options').removeClassName('filtered');
        }

        if (cElementsDisplayed == 0) {
          if ($('empty_filtered_inventory_page')) {
            $('empty_filtered_inventory_page').show();
            $('active_inventory_page').hide();
          }
        }
        else {
          if ($('empty_filtered_inventory_page')) {
            $('empty_filtered_inventory_page').hide();
            $('active_inventory_page').show();
          }
        }

        // adjust page controls.  If the active page no longer has any items, dump the user on the first (0th) page
        var cNewMaxPages = Math.floor((cElementsDisplayed + INVENTORY_PAGE_ITEMS - 1) / INVENTORY_PAGE_ITEMS);
        if (cNewMaxPages <= 1)
          cNewMaxPages = 1;
        g_ActiveInventory.pageTotal = cNewMaxPages;
        if (g_ActiveInventory.pageCurrent >= cNewMaxPages) {
          g_ActiveInventory.pageList[g_ActiveInventory.pageCurrent].hide();
          g_ActiveInventory.SetActivePage(0);
        }
        g_ActiveInventory.UpdatePageCounts();
      },

      MatchItem: function (elItem, rgTerm, rgCategories) {
        if (!rgTerm && !Object.values(rgCategories).length)
          return true;

        if (!elItem || !elItem.rgItem || !elItem.rgItem.name)
          return false;

        return this.MatchItemCategories(elItem, rgCategories)
          && this.MatchItemTerms(elItem, rgTerm);
      },

      // match a tag in every category. This is an AND
      MatchItemCategories: function (elItem, rgCategories) {
        if (Object.values(rgCategories).length > 0 && (!elItem.rgItem.tags || !elItem.rgItem.tags.length))
          return false;

        for (var sCategoryName in rgCategories) {
          if (typeof sCategoryName != "string")
            continue;

          if (!this.MatchItemTags(elItem, rgCategories[sCategoryName]))
            return false;
        }

        return true;
      },

      // match any tag within a category. This is an OR
      MatchItemTags: function (elItem, rgTags) {
        for (var iTag = 0; iTag < rgTags.length; iTag++) {
          var sTag = rgTags[iTag];
          for (var iItemTag = 0; iItemTag < elItem.rgItem.tags.length; iItemTag++) {
            var rgItemTag = elItem.rgItem.tags[iItemTag];
            if (rgItemTag.internal_name == sTag) {
              return true;
            }
          }
        }

        return false;
      },

      MatchItemTerms: function (elItem, rgTerms) {
        if (!rgTerms)
          return true;

        var name = elItem.rgItem.name;
        var type = elItem.rgItem.type;
        var descriptions = elItem.rgItem.descriptions;

        for (var iTerm = 0; iTerm < rgTerms.length; iTerm++) {
          var bMatch = false;
          if (name.match(rgTerms[iTerm]) || (type && type.match(rgTerms[iTerm]))) {
            bMatch = true;
          }
          if (!bMatch && descriptions && descriptions.length) {
            for (var i = 0; i < descriptions.length; i++) {
              if (descriptions[i].value && descriptions[i].value.match(rgTerms[iTerm])) {
                bMatch = true;
                break;
              }
            }
          }
          if (!bMatch)
            return false;
        }

        return true;
      }
    };

    function CreateCurrencyHoverFromContainer(container, id, appid, contextid, currencyid, amount) {
      var element = $(id);
      var rgItem = container[appid][currencyid];
      if (!rgItem)
        return;
      rgItem = Object.clone(rgItem);
      rgItem.appid = appid;
      rgItem.contextid = contextid;
      rgItem.amount = amount;
      AddItemHoverToElement(element, rgItem);
    }

    function CreateItemHoverFromContainer(container, id, appid, contextid, assetid, amount) {
      var element = $(id);
      if (element == null)
        return;

      var rgItem = container[appid][contextid][assetid];
      if (!rgItem)
        return;
      rgItem.appid = appid;
      rgItem.contextid = contextid;
      rgItem.amount = amount;
      rgItem.is_stackable = amount > 1;
      AddItemHoverToElement(element, rgItem);
    }

    function AddItemHoverToElement(element, rgItem) {
      var $Element = $JFromIDOrElement(element);

      $Element.addClass('economy_item_hoverable');

      var bInTouch = false;
      $Element.on('touchstart', function () {
        bInTouch = true;
      });
      $Element.on('click.ItemHover', function (e) {

        // if this is an actual link, we won't show a hover we'll just navigate
        if (e.target && $J(e.target).is('a'))
          return;

        if (bInTouch || (window.UseSmallScreenMode && window.UseSmallScreenMode())) {
          BuildHover('hover', rgItem, UserYou);
          var $Content = $JFromIDOrElement('iteminfo_clienthover');
          ShowItemHoverAsPopup($Content, function () {
            bInTouch = false;
            $J('#hover').append($Content);
            $J('#hover_item_icon').attr('src', 'https://community.cloudflare.steamstatic.com/public/images/trans.gif');
          });
        }
      });
      $Element.on('mouseenter', function () {
        if (!bInTouch && (!window.UseSmallScreenMode || !window.UseSmallScreenMode()))
          MouseOverItem(null, UserYou, $(element), rgItem);
      });
      $Element.on('mouseleave', function () {
        if (!bInTouch && (!window.UseSmallScreenMode || !window.UseSmallScreenMode()))
          MouseOutItem(null, UserYou, $(element), rgItem);
      });

    }

    /* trade history page */
    function HistoryPageCreateCurrencyHover(id, appid, contextid, currencyid, amount) {
      CreateCurrencyHoverFromContainer(g_rgHistoryCurrency, id, appid, contextid, currencyid, amount);
    }

    function HistoryPageCreateItemHover(id, appid, contextid, assetid, amount) {
      CreateItemHoverFromContainer(g_rgHistoryInventory, id, appid, contextid, assetid, amount);
    }

    CNewItemScroller = Class.create({

      m_rgPageOffsets: [],
      m_iPage: 0,

      m_elScroller: null,
      m_elRightControl: null,
      m_elLeftControl: null,

      m_bInTransition: false,

      initialize: function (elScroller, elRightControl, elLeftControl) {
        this.m_elScroller = $(elScroller);
        this.m_elRightControl = $(elRightControl);
        this.m_elLeftControl = $(elLeftControl);

        this.CalculatePages();
        if (this.m_rgPageOffsets.length > 1)
          this.m_elRightControl.show();

        this.m_elRightControl.observe('click', this.ScrollNext.bind(this));
        this.m_elLeftControl.observe('click', this.ScrollPrevious.bind(this));

        var _this = this;
        $J(this.m_elScroller).parent().on('scroll', function () {
          var nScrollLeft = $J(this).scrollLeft();
          var nWidth = $J(this).width();
          var nTotalWidth = $J(_this.m_elScroller).width();
          if (nScrollLeft > 25)
            _this.m_elLeftControl.show();
          else
            _this.m_elLeftControl.hide();

          if (nScrollLeft + nWidth < nTotalWidth - 25)
            _this.m_elRightControl.show();
          else
            _this.m_elRightControl.hide();

          for (var iPage = _this.m_rgPageOffsets.length - 1; iPage >= 0; iPage--) {
            if (nScrollLeft >= _this.m_rgPageOffsets[iPage]) {
              _this.m_iPage = iPage;
              break;
            }
          }
        });
        $J(window).on('resize', function () {
          _this.CalculatePages();
          $J(_this.m_elScroller).parent().trigger('scroll');
        });
      },

      CalculatePages: function () {
        var rgItems = this.m_elScroller.childElements();

        this.m_rgPageOffsets = [0];

        var iPage = 0;
        // we start with a negative accumulated width because we have some extra space on the intial page due
        //	to no previous page button
        var nAccumWidth = -20;
        var nLastPageOffset = 0;
        var nMaxWidth = $(this.m_elScroller.parentNode).getWidth() - 50;
        var nItemMargin = 10;

        for (var iItem = 0; iItem < rgItems.length; iItem++) {
          var elItem = rgItems[iItem];
          var nItemWidth = elItem.getWidth();

          if ((nAccumWidth - nLastPageOffset) + nItemWidth > nMaxWidth) {
            this.m_rgPageOffsets.push(nAccumWidth);
            iPage++;
            nLastPageOffset = nAccumWidth;
            nAccumWidth += nItemWidth + nItemMargin;
          }
          else {
            nAccumWidth += nItemWidth + nItemMargin;
          }
        }

        $J(this.m_elScroller).css('width', nAccumWidth + 25);
      },

      ScrollPrevious: function () {
        this.ScrollTo(this.m_iPage - 1);
      },

      ScrollNext: function () {
        this.ScrollTo(this.m_iPage + 1);
      },

      ScrollTo: function (iPage) {
        if (iPage < 0 || iPage > this.m_rgPageOffsets.length || this.m_bInTransition)
          return;

        var nOffset = this.m_rgPageOffsets[iPage];

        this.m_bInTransition = true;

        $J(this.m_elScroller).parent().animate({ scrollLeft: nOffset + 'px' }, 500, 'swing', $J.proxy(this.OnScrollComplete, this));

        this.m_iPage = iPage;

        if (this.m_iPage < this.m_rgPageOffsets.length - 1)
          this.m_elRightControl.show();
        else
          this.m_elRightControl.hide();

        if (this.m_iPage > 0)
          this.m_elLeftControl.show();
        else
          this.m_elLeftControl.hide();
      },

      OnScrollComplete: function () {
        this.m_bInTransition = false;
      }

    });

    function InventoryDismissNewItems(elNewItems) {
      new Effect.BlindUp(elNewItems, { duration: 0.5 });
      document.cookie = 'tsNewItemsPreviousLastChecked=0';
    }

    function SelectItemDialogOnSelect() {
      var item = g_ActiveInventory.selectedItem;
      if (item && window.parent && window.parent.OnItemSelected) {
        window.parent.OnItemSelected(item);
      }
      else {
        alert('There was a problem saving your selection, please try again later.');
      }
    }

    function DisableMarketButtons() {
      $J('a.item_market_action_button, a.market_commodity_buy_button, a.market_noncommodity_buyorder_button, a.market_unstyled_button').each(function () {
        if (!$J(this).hasClass('nodisable') && !$J(this).hasClass('item_market_action_button_disabled')) {
          $J(this).attr('onclick', '');
          $J(this).click(function (event) { event.stopPropagation(); return false; });
          $J(this).addClass('item_market_action_button_disabled');
        }
      });
    }

    function InstallHoverTooltip(elem, tooltip) {
      elem.observe('mouseover', function (event) {
        HoverTooltipMouseOver(elem, tooltip, event)
      });
      elem.observe('mousemove', function (event) {
        HoverTooltipMouseMove(tooltip, event)
      });
      elem.observe('mouseout', function (event) {
        tooltip.hide();
      });
    }

    function HoverTooltipMouseOver(elem, tooltip, event) {
      tooltip.show();
      HoverTooltipMouseMove(tooltip, event);
    }

    function HoverTooltipMouseMove(tooltip, event) {
      var docWidth = document.documentElement.clientWidth - 8;
      var toolWidth = tooltip.getWidth();
      var toolHeight = tooltip.getHeight();
      var newLeft = event.pageX + 28;
      var newTop = event.pageY + 20;

      var scrollLeft = document.documentElement.scrollLeft + document.body.scrollLeft;
      var scrollTop = document.documentElement.scrollTop + document.body.scrollTop;

      if (newLeft + toolWidth - scrollLeft > docWidth) {
        newLeft = docWidth - toolWidth + scrollLeft;
      }

      if (newLeft < scrollLeft) {
        newLeft = scrollLeft;
      }

      if (newTop + toolHeight - scrollTop > document.documentElement.clientHeight) {
        newTop = event.pageY - toolHeight - 20;
      }

      if (newTop < scrollTop) {
        newTop = scrollTop;
      }

      tooltip.setStyle({ left: newLeft + 'px', top: newTop + 'px' });
    }

    function HandleTradeActionMenu(elActionMenuButton, item, user) {
      HideMenuFast(elActionMenuButton, 'trade_action_popup');

      var bOtherProfileIsPublic = user != null; // TODO: Set this properly
      var bShowStaticActions = item.marketable || bOtherProfileIsPublic;
      var bItemHasActions = typeof item.actions != 'undefined';
      if (bShowStaticActions)
        $J('#trade_action_popup_staticactions').show();

      if (bShowStaticActions && bItemHasActions)
        $J('#trade_action_popup_itemstaticsep').show();
      else
        $J('#trade_action_popup_itemstaticsep').hide();

      var strLinkPrefix = '';
      if (Steam.BIsUserInSteamClient())
        strLinkPrefix = 'steam://openurl/';

      if (item.marketable) {
        var sMarketHashName = GetMarketHashName(item);
        $J('#trade_action_viewinmarket').attr('href', strLinkPrefix + 'https://steamcommunity.com/market/listings/' + item.appid + '/' + sMarketHashName);
        $J('#trade_action_viewinmarket').show();
      }
      else {
        $J('#trade_action_viewinmarket').hide();
      }

      if (bOtherProfileIsPublic) {
        $J('#trade_action_viewininventory').attr('href', strLinkPrefix + user.GetProfileURL() + '/inventory/#' + item.appid + '_' + item.contextid + '_' + item.id);
        $J('#trade_action_viewininventory').show();
      }
      else {
        $J('#trade_action_viewininventory').hide();
      }

      if (bItemHasActions) {
        var elItemActions = $J('#trade_action_popup_itemactions');
        elItemActions.empty();
        for (var action = 0; action < item.actions.length; action++) {
          var rgAction = item.actions[action];
          var elNewAction = $J('<a></a>');
          elNewAction.addClass('popup_menu_item');

          var strLink = rgAction.link.replace("%assetid%", item.id).replace("%contextid%", item.contextid).replace("%owner_steamid%", user.GetSteamId());
          elNewAction.attr('href', strLink);

          if (rgAction.link.substr(0, 6) != "steam:") {
            elNewAction.attr('target', '_blank');
            elNewAction.attr('rel', 'noreferrer');
          }

          elNewAction.text(rgAction.name);

          elNewAction.click(function () {
            HideMenu(elActionMenuButton, 'trade_action_popup');
          });

          elItemActions.append(elNewAction);
        }

        elItemActions.show();
      }
      else {
        $J('#trade_action_popup_itemactions').hide();
      }

      ShowMenu(elActionMenuButton, 'trade_action_popup', 'right');
    }


    function CreatePriceHistoryGraph(line1, numYAxisTicks, strFormatPrefix, strFormatSuffix) {
      var plot = $J.jqplot('pricehistory', [line1], {
        title: { text: 'Median Sale Prices', textAlign: 'left' },
        gridPadding: { left: 45, right: 45, top: 25 },
        axesDefaults: { showTickMarks: false },
        axes: {
          xaxis: {
            renderer: $J.jqplot.DateAxisRenderer,
            tickOptions: { formatString: '%b %#d<span class="priceHistoryTime"> %#I%p<span>' },
            pad: 1
          },
          yaxis: {
            pad: 1.1,
            tickOptions: { formatString: strFormatPrefix + '%0.2f' + strFormatSuffix, labelPosition: 'start', showMark: false },
            numberTicks: numYAxisTicks
          }
        },
        grid: {
          gridLineColor: '#1b2939',
          borderColor: '#1b2939',
          background: '#101822'
        },
        cursor: {
          show: true,
          zoom: true,
          showTooltip: false
        },
        highlighter: {
          show: true,
          lineWidthAdjust: 2.5,
          sizeAdjust: 5,
          showTooltip: true,
          tooltipLocation: 'n',
          tooltipOffset: 20,
          fadeTooltip: true,
          yvalues: 2,
          formatString: '<strong>%s</strong><br>%s<br>%d sold'
        },
        series: [{ lineWidth: 3, markerOptions: { show: false, style: 'circle' } }],
        seriesColors: ["#688F3E"]
      });

      plot.defaultNumberTicks = numYAxisTicks;
      return plot;
    }

    function GetYAXisForPriceHistoryGraph(plotPriceHistory, timeMin, timeMax) {
      var min = -1;
      var max = 0.06;
      for (var index in plotPriceHistory.series[0].data) {
        var rgData = plotPriceHistory.series[0].data[index];
        if (rgData[0] >= timeMin.getTime() && rgData[0] <= timeMax.getTime()) {
          if (rgData[1] > max) {
            max = rgData[1];
          }

          if (rgData[1] < min || min == -1) {
            min = rgData[1];
          }
        }
      }

      return $J.jqplot.LinearTickGenerator(min, max, null, plotPriceHistory.defaultNumberTicks, false, false);
    }

    function pricehistory_zoomDays(plotPriceHistory, timePriceHistoryEarliest, timePriceHistoryLatest, days) {
      var timeSelected = new Date(timePriceHistoryLatest.getTime() - (days * 24 * 60 * 60 * 1000));

      plotPriceHistory.axes.xaxis.ticks = [];
      //plotPriceHistory.resetZoom();
      plotPriceHistory.axes.xaxis.reset();
      plotPriceHistory.axes.y2axis.reset();

      var rgYAxis = GetYAXisForPriceHistoryGraph(plotPriceHistory, timeSelected, timePriceHistoryLatest);

      var ticks = (days == 7) ? 7 : 6;
      plotPriceHistory.axes.xaxis.tickInterval = days / ticks + " days";
      plotPriceHistory.axes.xaxis.min = timeSelected;
      plotPriceHistory.axes.xaxis.max = timePriceHistoryLatest;

      plotPriceHistory.axes.yaxis.min = rgYAxis[0];
      plotPriceHistory.axes.yaxis.max = rgYAxis[1];
      plotPriceHistory.axes.yaxis.numberTicks = rgYAxis[2];
      plotPriceHistory.axes.yaxis.tickInterval = rgYAxis[4];

      plotPriceHistory.replot();

      $J('#pricehistory .jqplot-yaxis').children().first().remove();
      $J('#pricehistory .jqplot-yaxis').children().last().remove();

      return false;
    }

    function pricehistory_zoomMonthOrLifetime(plotPriceHistory, timePriceHistoryEarliest, timePriceHistoryLatest) {
      var timeMonthAgo = new Date(timePriceHistoryLatest.getTime() - (30 * 24 * 60 * 60 * 1000));
      plotPriceHistory.resetZoom();

      var days = (timePriceHistoryLatest.getTime() - timePriceHistoryEarliest.getTime()) / (24 * 60 * 60 * 1000);
      if (days / 7 < 1) {
        var difference = timePriceHistoryLatest.getTime() - timePriceHistoryEarliest.getTime();
        plotPriceHistory.axes.xaxis.ticks = [timePriceHistoryEarliest, new Date(timePriceHistoryEarliest.getTime() + difference * 0.25), new Date(timePriceHistoryEarliest.getTime() + difference * 0.5), new Date(timePriceHistoryEarliest.getTime() + difference * 0.75), timePriceHistoryLatest];
      }
      else {
        plotPriceHistory.axes.xaxis.tickInterval = (days / 7) + " days";
      }
      if (timePriceHistoryEarliest > timeMonthAgo)
        plotPriceHistory.axes.xaxis.min = timePriceHistoryEarliest;
      else
        plotPriceHistory.axes.xaxis.min = timeMonthAgo;
      plotPriceHistory.axes.xaxis.max = timePriceHistoryLatest;

      var rgYAxis = GetYAXisForPriceHistoryGraph(plotPriceHistory, plotPriceHistory.axes.xaxis.min, timePriceHistoryLatest);
      plotPriceHistory.axes.yaxis.min = rgYAxis[0];
      plotPriceHistory.axes.yaxis.max = rgYAxis[1];
      plotPriceHistory.axes.yaxis.numberTicks = rgYAxis[2];
      plotPriceHistory.axes.yaxis.tickInterval = rgYAxis[4];

      plotPriceHistory.replot();

      $J('#pricehistory .jqplot-yaxis').children().first().remove();
      $J('#pricehistory .jqplot-yaxis').children().last().remove();

      return false;
    }

    function pricehistory_zoomLifetime(plotPriceHistory, timePriceHistoryEarliest, timePriceHistoryLatest) {
      var timeMonthAgo = new Date(timePriceHistoryLatest.getTime() - (30 * 24 * 60 * 60 * 1000));
      plotPriceHistory.axes.xaxis.ticks = [];
      plotPriceHistory.resetZoom();
      plotPriceHistory.axes.xaxis.reset();
      plotPriceHistory.axes.y2axis.reset();

      var days = (timePriceHistoryLatest.getTime() - timePriceHistoryEarliest.getTime()) / (24 * 60 * 60 * 1000);
      if (days / 7 < 1) {
        var difference = timePriceHistoryLatest.getTime() - timePriceHistoryEarliest.getTime();
        plotPriceHistory.axes.xaxis.ticks = [timePriceHistoryEarliest, new Date(timePriceHistoryEarliest.getTime() + difference * 0.25), new Date(timePriceHistoryEarliest.getTime() + difference * 0.5), new Date(timePriceHistoryEarliest.getTime() + difference * 0.75), timePriceHistoryLatest];
      }
      else {
        plotPriceHistory.axes.xaxis.tickInterval = (days / 7) + " days";
      }
      plotPriceHistory.axes.xaxis.min = timePriceHistoryEarliest;
      plotPriceHistory.axes.xaxis.max = timePriceHistoryLatest;

      var rgYAxis = GetYAXisForPriceHistoryGraph(plotPriceHistory, timePriceHistoryEarliest, timePriceHistoryLatest);
      plotPriceHistory.axes.yaxis.min = rgYAxis[0];
      plotPriceHistory.axes.yaxis.max = rgYAxis[1];
      plotPriceHistory.axes.yaxis.numberTicks = rgYAxis[2];
      plotPriceHistory.axes.yaxis.tickInterval = rgYAxis[4];

      plotPriceHistory.replot();

      $J('#pricehistory .jqplot-yaxis').children().first().remove();
      $J('#pricehistory .jqplot-yaxis').children().last().remove();

      return false;
    }

    function ReportTradeScam(steamIDTarget, strPersonaName) {
      var $Dialog = $J('<div/>');
      $Dialog.append($J('<div/>', { 'class': 'trade_scam_report_label' }).html('Use this to report %s to Steam Support for an attempted scam.<br><br>Please provide a brief description:'.replace(/%s/, strPersonaName)));
      var $TextArea = $J('<textarea/>', { 'rows': 3, 'cols': 26 });
      $Dialog.append($J('<div/>', { 'class': 'gray_bevel fullwidth' }).append($TextArea));
      var Modal = ShowConfirmDialog('Report Scam', $Dialog, 'Report Scam').done(function () {
        if (!$TextArea.val()) {
          ShowAlertDialog('Report Scam', 'A description is required.');
          return;
        }

        var rgParams = {
          json: 1,
          abuseID: steamIDTarget,
          sessionid: g_sessionID,
          abuseType: 'Trade Scam',
          abuseDescription: $TextArea.val()
        };

        $J.post('https://steamcommunity.com/actions/ReportAbuse/', rgParams).done(function () {
          ShowAlertDialog('Thank You!', 'Your report has been submitted and will be reviewed by Steam Support.');
        }).fail(function () {
          ShowAlertDialog('Report Scam', 'There was a problem saving your report.  Please try again later.');
        });
      });

      $TextArea.focus();
    }

    function ContinueFullInventoryRequestIfNecessary(transport, mergedResponse, strURL, oParams, fOnSuccess, fOnFailure, fOnComplete) {
      var bMore = false;
      var bSuccess = false;

      if (transport.responseJSON && transport.responseJSON.success) {
        bMore = transport.responseJSON.more;
        bSuccess = true;

        if (transport.responseJSON.rgAppInfo) {
          mergedResponse.rgAppInfo = transport.responseJSON.rgAppInfo;
        }

        // Merge the inventory into the merged response and also put the description with the item
        if (transport.responseJSON.rgInventory && !(transport.responseJSON.rgInventory instanceof Array)) {
          for (var itemid in transport.responseJSON.rgInventory) {
            var rgItem = transport.responseJSON.rgInventory[itemid];
            if (rgItem) {
              mergedResponse.rgInventory[itemid] = Object.extend(rgItem, Object.clone(transport.responseJSON.rgDescriptions[rgItem.classid + '_' + rgItem.instanceid]));

              // each item needs its own tags
              if (rgItem.tags) {
                mergedResponse.rgInventory[itemid].tags = mergedResponse.rgInventory[itemid].tags.clone();
              }
            }
          }
        }

        // Merge the currencies into the merged response and also put the description with the currency
        if (transport.responseJSON.rgCurrency && !(transport.responseJSON.rgCurrency instanceof Array)) {
          for (var itemid in transport.responseJSON.rgCurrency) {
            var rgItem = transport.responseJSON.rgCurrency[itemid];
            if (rgItem) {
              mergedResponse.rgCurrency[itemid] = Object.extend(rgItem, Object.clone(transport.responseJSON.rgDescriptions[rgItem.classid + '_' + 0]));

              // each item needs its own tags
              if (rgItem.tags) {
                mergedResponse.rgCurrency[itemid].tags = mergedResponse.rgCurrency[itemid].tags.clone();
              }
            }
          }
        }

        if (bMore) {
          oParams.start = transport.responseJSON.more_start;

          new Ajax.Request(strURL, {
            method: 'get',
            parameters: oParams,
            onComplete:
              function (newTransport) {
                ContinueFullInventoryRequestIfNecessary(
                  newTransport,
                  mergedResponse,
                  strURL,
                  oParams,
                  fOnSuccess, fOnFailure, fOnComplete
                );
              }
          });
        }
      }
      else {
        if (fOnFailure != null) {
          fOnFailure(transport);
        }
      }

      // If we're done, call the complete method
      if (!bMore) {
        mergedResponse.success = bSuccess;

        if (fOnSuccess != null && bSuccess) {
          fOnSuccess({ responseJSON: mergedResponse });
        }

        if (fOnComplete != null) {
          fOnComplete({ responseJSON: mergedResponse });
        }
      }
    }

    function RequestFullInventory(strURL, oParams, fOnSuccess, fOnFailure, fOnComplete) {
      new Ajax.Request(strURL, {
        method: 'get',
        parameters: oParams,
        onComplete:
          function (transport) {
            ContinueFullInventoryRequestIfNecessary(
              transport,
              { rgInventory: {}, rgCurrency: {}, rgAppInfo: {} },
              strURL,
              oParams,
              fOnSuccess, fOnFailure, fOnComplete
            );
          }
      });
    }

    function InitDynamicInventoryItemAutosizing($InventoryCtn, strCSSClass, bAutoRetryIfNotVisible) {
      // a global event to toggle the pagination on inventory and a global that the CUser class uses to change some behaviors
      var bDynamicWasSizingEnabled;
      $J(window).off('resize.EconomyRepaginateInventory').on('resize.EconomyRepaginateInventory', function () {
        // this flag is used by inventories in a few places
        if (Economy_UseResponsiveLayout()) {
          g_bEnableDynamicSizing = true;
        }
        else {
          g_bEnableDynamicSizing = false;
        }

        if (bDynamicWasSizingEnabled != g_bEnableDynamicSizing) {
          bDynamicWasSizingEnabled = g_bEnableDynamicSizing;
          if (typeof UserYou != 'undefined' && UserYou)
            UserYou.InvalidatePaging();
          if (typeof UserThem != 'undefined' && UserThem)
            UserThem.InvalidatePaging();
        }
      }).trigger('resize.EconomyRepaginateInventory');


      var elStyle = document.createElement('style');
      $J(document.head).append(elStyle);

      var styles = elStyle.sheet;

      var bAddedRules = false;

      $J(window).on('resize.DynamicInventorySizing', function () {

        if (!Economy_UseResponsiveLayout()) {
          $InventoryCtn.removeClass('dynamicSizing');
          if (bAddedRules) {
            bAddedRules = false;
            while (styles.rules.length)
              styles.deleteRule(0);
          }
          return;
        }

        if ($InventoryCtn.width() == 0) {
          //too soon
          if (bAutoRetryIfNotVisible)
            window.setTimeout(function () { $J(window).trigger('resize.DynamicInventorySizing') }, 50);

          return;
        }

        var nDesiredItemCtnWidth = 98;
        var flMarginPct = 0.0625;
        var flDesiredItemCtnWidthWithMargin = nDesiredItemCtnWidth + ((nDesiredItemCtnWidth - 2) * flMarginPct);

        var nRowWidth = Math.max($InventoryCtn.width() - 1, nDesiredItemCtnWidth);
        // the -0.3 here creates a window where we'll use the smaller number of items but at pixel-perfect size
        var cDesiredItemsPerRow = Math.max(Math.ceil(nRowWidth / flDesiredItemCtnWidthWithMargin - 0.3), 3);

        // now re-do the math at that rate
        var flItemWidthWithMargin = nRowWidth / cDesiredItemsPerRow;

        var flMargin, flItemCtnWidth;
        if (flItemWidthWithMargin > flDesiredItemCtnWidthWithMargin)
          flItemWidthWithMargin = flDesiredItemCtnWidthWithMargin;

        var flMargin = Math.floor((flItemWidthWithMargin - 2) * flMarginPct / (1 + flMarginPct));
        var flItemCtnWidth = flItemWidthWithMargin - flMargin;

        $InventoryCtn.addClass('dynamicSizing');
        styles.insertRule('html.responsive ' + strCSSClass + '.dynamicSizing .itemHolder { width: ' + flItemCtnWidth + 'px; height: ' + flItemCtnWidth + 'px; margin: ' + (flMargin / 2) + 'px; }', 0);
        styles.insertRule('html.responsive ' + strCSSClass + '.dynamicSizing .inventory_page { width: ' + nRowWidth + 'px }', 0);


        if (bAddedRules) {
          styles.deleteRule(2);
          styles.deleteRule(2);
        }

        bAddedRules = true;
      });
      $J(window).trigger('resize.DynamicInventorySizing');

    }

    function ShowEscrowExplanationDialog(bAddSteamGuardLink) {
      var description = $J('<div/>', { class: 'escrow_explanation' });

      description.append('<div class="escrow_explanation_q">What is a trade or market hold?</div>');
      description.append('<div class="escrow_explanation_a">A hold is a period of time where items are held by Steam before a trade is completed or a Market listing is posted.</div>');

      description.append('<div class="escrow_explanation_q">Items holds help protect your items</div>');
      description.append('<div class="escrow_explanation_a">Steam accounts are valuable, especially if they have items worth stealing. If you haven\'t protected your account with a physical device (the Steam Guard Mobile Authenticator), a trade hold will give you time to discover your account has been compromised and to prevent your items from leaving your account.</div>');

      description.append('<div class="escrow_explanation_q">A delay to catch and stop item theft</div>');
      description.append('<div class="escrow_explanation_a">If a user trading away or selling items hasn\'t had their account protected by a Mobile Authenticator for the past 7 days: <br><span style="color: #5aa9d6">Trades:</span> item delivery from completed trades will be delayed by Steam for up to 15 days <br><span style="color: #5aa9d6">Market:</span> sell listings will be held by Steam before they are posted for up to 15 days <br><br>This provides the user time to cancel any pending transactions they didn\'t authorize. <br><br>Cancelling trades that are pending or in a trade hold will begin a trading cooldown on your account to prevent any further unauthorized attempts to trade away items. There is no cooldown for cancelling market listings.</div>');

      description.append('<div class="escrow_explanation_q">Remove the need for item holds</div>');
      description.append('<div class="escrow_explanation_a">Using a Mobile Authenticator ensures that you and only you can trade or sell your items quickly and securely, so holds are no longer necessary. Increase your account security by getting the <a href="https://store.steampowered.com/mobile/" >Steam Guard Mobile Authenticator</a> for iOS and Android devices. </div>');

      description.append('<div class="escrow_explanation_a"><a href="http://store.steampowered.com/news/20631/" >Read the Steam blog post about account security</a> for a detailed explanation on why we implemented holds.</div>');

      if (bAddSteamGuardLink) {
        var dialog = ShowConfirmDialog(
          'Trade and Market Holds',
          description,
          'Learn About Steam Guard Mobile Authenticator',
          'Close'
        );

        dialog.done(function () {
          window.open('https://store.steampowered.com/mobile');
        });
      }
      else {
        var dialog = ShowAlertDialog(
          'Trade Holds',
          description
        );
      }
      return false;
    }


  </script>
  <script>



    var TRADE_UPDATE_INTEVRAL = 1000;
    var MESSAGE_TRADE_PARTNER_ABSENSE_TIME = 5;
    var g_bWalletBalanceWouldBeOverMax = false;
    var g_nItemsFromContextWithNoPermissionToReceive = 0;
    var g_rgnItemsExpiringBeforeEscrow = [0, 0];
    var GTradeStateManager = null;
    var Tutorial = null;
    var g_bWarnOnReady = false;
    var g_dateEscrowEnd = null;
    var g_bWarnedAboutPlaytime = false;
    var g_bWarnedAboutUnvettedApp = false;

    function BeginTrading(bShowTutorial) {
      g_bAllowHighDPIItemImages = $J('html').hasClass('responsive');

      if (!GTradeStateManager)
        GTradeStateManager = CTradeStateManager;

      if (!Tutorial)
        Tutorial = new CTradeTutorial();

      if (bShowTutorial && !Economy_UseResponsiveLayout())
        Tutorial.Init();

      INVENTORY_PAGE_ITEMS = 16;	//4 x 4 grid
      INVENTORY_PAGE_WIDTH = 104 * 4;
      g_bIsTrading = true;
      g_bShowTradableItemsOnly = true;
      g_ActiveUser = UserYou;

      SizeWindow();


      if (g_bTradePartnerProbation) {
        var elEvent = new Element('div', { 'class': 'logevent' });
        elEvent.update(
          '<%1$s>Warning:<%2$s> %3$s was recently trade banned and is currently on probation. %4$s may not be trustworthy.'
            .replace('%1$s', 'span class="warning"')
            .replace('%2$s', '/span')
            .replace('%3$s', g_strTradePartnerPersonaName)
            .replace('%4$s', g_strTradePartnerPersonaName));
        $('log').appendChild(elEvent);
      }

      // set up inventory and drag drop
      Droppables.add($('trade_yours'), { hoverclass: 'readyForDrop', onDrop: OnDropItemInTrade });
      if (g_bTradeOffer)
        Droppables.add($('trade_theirs'), { hoverclass: 'readyForDrop', onDrop: OnDropItemInTrade });

      InitResponsiveTradeControls();
      // set up the filter control
      Filter.InitFilter($('filter_control'));

      Event.observe(window, 'resize', SizeWindow);
      Event.observe(window, 'unload', TradingUnloaded);

      if (!g_bTradeOffer) {
        //set up chat controls
        var elChatEntry = $('chat_text_entry');
        elChatEntry.observe('keypress', OnChatKeypress);
        elChatEntry.observe('keyup', OnChatKeyup);
        elChatEntry.observe('paste', OnChatUpdate);
        elChatEntry.observe('cut', OnChatUpdate);
        $('chat_send_btn').observe('click', DoChat);

        // if the user starts typing in the trade dialog, move the focus to the chat control
        $(document).observe('keypress', TransferFocusToChat);

        RedrawCurrentTradeStatus();
        RequestTradeStatusUpdate();
      }


      var appid = 0;
      var contextid = 0;

      // If the document says to use a specific inventory, do so
      if (typeof (force_appid) !== 'undefined') {
        appid = force_appid['appid'];
        contextid = force_appid['contextid'];
      }

      // Otherwise default to the last used inventory
      if (appid == 0) {
        var oCookieParams = ReadInventoryCookie(GetCookie('strTradeLastInventoryContext'));
        if (BValidateHashParams(oCookieParams)) {
          appid = oCookieParams.appid;
          contextid = oCookieParams.contextid;
        }
      }

      // Select an app's inventory if we know which one to pick
      if (appid != 0) {
        TradePageSelectInventory(UserYou, appid, contextid);
      }
    }

    function InitResponsiveTradeControls() {
      var $ItemArea = $J('.trade_left');
      var $OfferArea = $J('.trade_right');


      var TRADE_MODE_OFFER = 0, TRADE_MODE_YOUR_ITEMS = 1, TRADE_MODE_THEIR_ITEMS = 2;
      var nCurrentTradeMode = TRADE_MODE_OFFER;
      var rgScrollTopByMode = [0, 0, 0];

      window.ResponsiveTrade_SwitchMode = function (nTargetTradeMode) {
        if (nCurrentTradeMode != nTargetTradeMode)
          rgScrollTopByMode[nCurrentTradeMode] = $J(window).scrollTop();

        if (nTargetTradeMode == TRADE_MODE_OFFER) {
          $OfferArea.show();
          $ItemArea.hide();
        }
        else {
          $OfferArea.hide();
          $ItemArea.show();
          if (nTargetTradeMode == TRADE_MODE_YOUR_ITEMS)
            $J('#inventory_select_your_inventory').click();
          else
            $J('#inventory_select_their_inventory').click();
        }
        nCurrentTradeMode = nTargetTradeMode;
        $J(window).scrollTop(rgScrollTopByMode[nCurrentTradeMode]);

        // even if we didn't scroll, we want to update fixed position stuff based on current displayed elements
        // and also dynamic sizing
        $J(window).trigger('resize');
      };

      InitDynamicInventoryItemAutosizing($J('.trade_offer .trade_item_box'), '.trade_offer .trade_item_box');
      InitDynamicInventoryItemAutosizing($J('#inventories'), '#inventories');

      var $ResponsiveTradeOfferItems = $J('.responsive_trade_offersection');
      var bResponsiveMode;
      $J(window).on('resize.TradeWindow', function () {
        var bNewResponsiveMode = Economy_UseResponsiveLayout();
        if (bNewResponsiveMode == bResponsiveMode)
          return;

        bResponsiveMode = bNewResponsiveMode;

        if (bResponsiveMode) {
          // enable the current mode again
          $J('#responsivetrade_itemfilters').append($J('#nonresponsivetrade_itemfilters').children());
          ResponsiveTrade_SwitchMode(nCurrentTradeMode);
        }
        else {
          $J('#nonresponsivetrade_itemfilters').append($J('#responsivetrade_itemfilters').children());
          $ItemArea.show();
          $OfferArea.show();
        }

        RedrawCurrentTradeStatus();

        $ResponsiveTradeOfferItems.each(function () {
          var $Item = $J(this);
          if (!$Item.data('originalPositionWrapper')) {
            $Item.wrap('<div/>', { 'class': 'responsive_element_placeholder' });
            $Item.data('originalPositionWrapper', $Item.parent());
          }

          if (bResponsiveMode) {
            if ($Item.hasClass('top'))
              $OfferArea.prepend($Item);
            else
              $OfferArea.append($Item);
          }
          else {
            var $Wrapper = $Item.data('originalPositionWrapper');
            $Wrapper && $Wrapper.append($Item);
          }
        });
      }).trigger('resize.TradeWindow');


      $J('#trade_yours').on('click', '.trade_slot:not(.has_item)', function () {
        if (Economy_UseResponsiveLayout() && !$J('#trade_yours').hasClass('ready'))
          ResponsiveTrade_SwitchMode(TRADE_MODE_YOUR_ITEMS);
      });

      if (g_bTradeOffer) {
        $J('#trade_theirs').on('click', '.trade_slot:not(.has_item)', function () {
          if (Economy_UseResponsiveLayout() && !$J('#trade_theirs').hasClass('ready'))
            ResponsiveTrade_SwitchMode(TRADE_MODE_THEIR_ITEMS);
        });
      }

      $J('#responsivetrade_backtooffer').click(function () { ResponsiveTrade_SwitchMode(TRADE_MODE_OFFER); });

      $J('#responsive_tab_select_yourinventory select').on('change', function () {
        if ($J(this).val())
          TradePageSelectInventory(UserYou, $J(this).val());
      });
      $J('#responsive_tab_select_yourcontexts select').on('change', function () {
        TradePageSelectInventory(UserYou, $J(this).data('appid'), $J(this).val());
      });
      if (g_bTradeOffer) {
        $J('#responsive_tab_select_theirinventory select').on('change', function () {
          if ($J(this).val())
            TradePageSelectInventory(UserThem, $J(this).val());
        });
        $J('#responsive_tab_select_theircontexts select').on('change', function () {
          TradePageSelectInventory(UserThem, $J(this).data('appid'), $J(this).val());
        });
      }
    }

    CUserThem = Class.create(CUser, {

      GetContext: function (appid, contextid) {
        if (g_bTradeOffer) {
          return this.rgContexts[appid] && this.rgContexts[appid][contextid];
        }
        else {
          // TODO: load trade partner app contexts
          if (!this.rgContexts[appid])
            this.rgContexts[appid] = {};
          if (!this.rgContexts[appid][contextid])
            this.rgContexts[appid][contextid] = { inventory: null };
          return this.rgContexts[appid][contextid];
        }
      },

      loadInventory: function (appid, contextid) {
        this.LoadForeignAppContextData(g_ulTradePartnerSteamID, appid, contextid);
      },

      /*
       *		Trading Partner's Inventory
       */

      LoadForeignAppContextData: function (steamid, appid, contextid) {
        this.cLoadsInFlight++;
        this.addInventory(new CForeignInventoryPending(this, appid, contextid, null, null));
        var thisClosure = this;

        if (g_bTradeOffer) {
          RequestFullInventory(
            g_strTradePartnerInventoryLoadURL,
            {
              sessionid: g_sessionID,
              partner: steamid,
              appid: appid,
              contextid: contextid
            },
            function (transport) { thisClosure.OnLoadInventoryComplete(transport, appid, contextid); },
            function (transport) { thisClosure.OnInventoryLoadFailed(transport, appid, contextid) },
            null
          );
        }
        else {
          RequestFullInventory(
            'https://steamcommunity.com/trade/' + g_ulTradePartnerSteamID + '/foreigninventory/',
            {
              sessionid: g_sessionID,
              steamid: steamid,
              appid: appid,
              contextid: contextid
            },
            function (transport) { thisClosure.OnLoadForeignAppContextData(transport, appid, contextid); },
            null,
            null
          );
        }
        return true;
      },

      OnLoadForeignAppContextData: function (transport, appid, contextid) {
        this.cLoadsInFlight--;
        if (transport.responseJSON && transport.responseJSON.success) {
          var rgAppInfo = transport.responseJSON.rgAppInfo;
          // see if this is a new app the current user didn't know about
          if (!g_rgAppContextData[appid]) {
            g_rgAppContextData[appid] = Object.clone(rgAppInfo);
          }

          for (var itemid in transport.responseJSON.rgInventory) {
            var rgItem = transport.responseJSON.rgInventory[itemid];
            rgItem.is_their_item = true;
          }

          // replace the pending inventory object with the real inventory
          var inventory = new CInventory(this, appid, contextid, transport.responseJSON.rgInventory, transport.responseJSON.rgCurrency);

          this.addInventory(inventory);

          RedrawCurrentTradeStatus();
        }
        else {
          // erase the pending inventory object so it will be reloaded
          this.GetContext(appid, contextid).inventory = null;
        }
      }
    });

    var UserThem = new CUserThem();

    var templActiveApp = new Template('<img src="#{icon}"> #{name}');
    var templAllContextName = new Template('All #{appname} Items');

    function TradePageSelectNoInventory(user) {
      Filter.ApplyFilter('');
      HideTagFilters();
      $('filter_tag_show').hide();
      $('filter_tag_hide').hide();
      $('inventories').childElements().invoke('hide');
    }

    function TradePageSelectInventory(user, appid, contextid, bLoadCompleted) {
      if (g_bTradeOffer) {
        HideMenu($('appselect'), $('appselect_you_options'));
        HideMenu($('appselect'), $('appselect_them_options'));
      }
      else {
        HideMenu($('appselect'), $('appselect_options'));
      }

      if (!contextid) {
        if (user.BIsSingleContextApp(appid))
          contextid = user.GetFirstContextForApp(appid).id;
        else
          contextid = APPWIDE_CONTEXT;
      }

      Filter.ApplyFilter('');

      if (SelectInventoryFromUser(user, appid, contextid, bLoadCompleted)) {
        Filter.ReApplyFilter();

        // copy the html of the chosen game option to the app select box
        var oAppDisplay = GetEconomyDisplay(appid, contextid);
        var rgAppData = user.GetAppData(appid);

        var displayName = rgAppData ? rgAppData.name : '';

        var $ResponsiveInventorySelect = (user == UserYou) ? $J('#responsive_tab_select_yourinventory select') : $J('#responsive_tab_select_theirinventory select');
        var $ResponsiveContextSelectCtn = (user == UserYou) ? $J('#responsive_tab_select_yourcontexts') : $J('#responsive_tab_select_theircontexts');

        if (!user.BIsSingleContextApp(appid)) {
          displayName = displayName + ' ' + user.GetContext(appid, contextid).name;
          var $ContextSelect = $ResponsiveContextSelectCtn.find('select');
          $ContextSelect.empty();
          $ContextSelect.data('appid', appid);

          var rgContextIDs = user.GetContextIdsForApp(appid);
          for (var i = 0; i < rgContextIDs.length; i++) {
            var rgContext = user.GetContext(appid, rgContextIDs[i]);
            var strName = rgContext.name;
            if (rgContext.id != APPWIDE_CONTEXT)
              strName += ' (' + v_numberformat(rgContext.asset_count) + ')';
            $ContextSelect.append($J('<option/>', { value: rgContext.id }).text(strName));
          }
          $ContextSelect.val(contextid);

          $ResponsiveContextSelectCtn.show();
        }
        else {
          $ResponsiveContextSelectCtn.hide();
        }

        // update the height of the spacer div based on which dropdowns are shown
        var nFixedCtnHeight = $ResponsiveInventorySelect.parents('.responsive_trade_fixedcontents').height();
        $ResponsiveInventorySelect.parents('.trade_nonresponsive_hidden').children('.responsive_trade_fixedcontents_spacer').css('height', nFixedCtnHeight ? nFixedCtnHeight + 'px' : '');

        if (user == UserYou) {
          $J('#responsive_tab_select_yourinventory select').val(appid);
        }
        else {
          $J('#responsive_tab_select_theirinventory select').val(appid);
        }

        $('trade_inventory_unavailable').hide();
        $('trade_inventory_failed').hide();

        if (g_ActiveInventory.BIsEmptyInventory()) {
          var appname = displayName;

          g_ActiveInventory.hide();

          $('trade_inventory_message_no_inventory').hide();
          $('trade_inventory_message_not_allowed').hide();
          $('trade_inventory_pending').hide();

          if (g_ActiveInventory.BIsPendingInventory()) {
            $('trade_inventory_pending').show();
          }
          else if (!UserYou.BAllowedToTradeItems(appid, contextid)) {
            $('trade_inventory_message_not_allowed').show();
            if (UserYou.BAllowedToRecieveItems(appid, contextid)) {
              $('trade_inventory_message_not_allowed_none').hide();
              $('trade_inventory_message_not_allowed_receiveonly').show();

              $J($('trade_inventory_message_not_allowed_receiveonly').down('.gamename')).text(appname);
            }
            else {
              $('trade_inventory_message_not_allowed_none').show();
              $('trade_inventory_message_not_allowed_receiveonly').hide();

              $J($('trade_inventory_message_not_allowed_none').down('.gamename')).text(appname);
            }
            var elAlerts = $('trade_inventory_message_not_allowed_alerts');
            elAlerts.update('');
            if (g_rgAppContextData[appid].alerts) {
              for (var i = 0; i < g_rgAppContextData[appid].alerts.length; i++) {
                var alert = g_rgAppContextData[appid].alerts[i];
                var elAlert = new Element('div');
                if (alert.color)
                  elAlert.style.color = '#' + alert.color;
                elAlert.update(alert.text);
                elAlerts.appendChild(elAlert);
              }
            }
          }
          else {
            $('trade_inventory_message_no_inventory').show();
            $J($('trade_inventory_message_no_inventory').down('.gamename')).text(appname);
            var strHowToGet = '';
            if (oAppDisplay && oAppDisplay.howtoget)
              strHowToGet = oAppDisplay.howtoget;
            $('trade_inventory_message_no_inventory_howtoget').update(strHowToGet);
          }
        }
        else {
          Tutorial.OnSelectedNonEmptyInventory(user);
          SetCookie('strTradeLastInventoryContext', appid + '_' + contextid, 14, g_bTradeOffer ? '/tradeoffer/' : '/trade/');
        }

        // hide the tags after we select the new inventory so
        // we can show the "show" button appropriately.
        HideTagFilters();
      }
    }

    /*
     *		Drag & Drop
     */


    var g_bInDrag = false;

    function MakeItemDraggable(element) {
      element.style.zIndex = 3;
      new Draggable(element, { revert: 'failure', ghosting: false, onStart: StartDrag, onEnd: EndDrag });
      Event.observe(element, 'dblclick', OnDoubleClickItem.bindAsEventListener(null, element));
    }

    function MakeCurrencyDraggable(element) {
      element.style.zIndex = 3;
      // currency always reverts
      new Draggable(element, { revert: true, ghosting: true, onStart: StartDragCurrency, onEnd: EndDragCurrency });
      Event.observe(element, 'dblclick', OnDoubleClickItem.bindAsEventListener(null, element));
    }

    function StartDragCurrency(draggable, event) {
      draggable._clone.id = '';
      draggable._clone.removeClassName('hover');
      StartDrag(draggable, event);

      draggable.element.addClassName('in_drag');

      if (typeof (draggable.element.drag_image) != 'undefined') {
        var elImage = draggable.element.select('img');
        if (elImage) {
          draggable.element.drag_reset_image = elImage[0].src;
          elImage[0].src = draggable.element.drag_image;
        }
      }
    }

    function EndDragCurrency(draggable, event) {
      // defer the end drag so our click event can operate on the g_bInDrag variable
      (function () { g_bInDrag = false; }).defer();

      draggable.element.removeClassName('in_drag');

      if (typeof (draggable.element.drag_reset_image) != 'undefined') {
        var elImage = draggable.element.select('img');
        elImage[0].src = draggable.element.drag_reset_image;
        delete draggable.element.drag_reset_image;
      }

      if (g_bTradeOffer) {
        ResetTradeOfferOpacity($('trade_yours'));
        ResetTradeOfferOpacity($('trade_theirs'));
      }

      RemoveDroppable($('inventories'));
    }

    function StartDrag(draggable, event) {
      HideHover();
      if (draggable.element.wants_hover)
        draggable.element.wants_hover = false;
      draggable.element.removeClassName('hover');

      var item = draggable.element.rgItem;

      var elSlots = (item.is_their_item ? $('their_slots') : $('your_slots'));

      elSlots.childElements().invoke('removeClassName', 'nextTarget');
      if (BIsInTradeSlot(draggable.element)) {
        Droppables.add($('inventories'), { hoverclass: 'readyForDrop', onDrop: OnDropItemInInventory });
        $(draggable.element.parentNode.parentNode).down('.slot_applogo').hide();
      }
      else {
        if (item.trade_stack && BIsInTradeSlot(item.trade_stack.element)) {
          $(item.trade_stack.element.parentNode.parentNode).addClassName('nextTarget');
        }
        else {
          var oSlotInfo = FindFreeSlot(elSlots);
          oSlotInfo.elSlot.addClassName('nextTarget');
        }

        if (g_bTradeOffer) {
          var elUnusedOffer = (item.is_their_item ? $('trade_yours') : $('trade_theirs'));
          elUnusedOffer.effect && elUnusedOffer.effect.cancel();
          elUnusedOffer.effect = new Effect.Opacity(elUnusedOffer, { to: 0.3, delay: 0.1, duration: 0.15 });
        }
      }

      g_bInDrag = true;
    }

    function EndDrag(draggable, event) {
      g_bInDrag = false;
      draggable.element.style.zIndex = 5;

      if (BIsInTradeSlot(draggable.element)) {
        $(draggable.element.parentNode.parentNode).down('.slot_applogo').show();
      }

      if (g_bTradeOffer) {
        ResetTradeOfferOpacity($('trade_yours'));
        ResetTradeOfferOpacity($('trade_theirs'));
      }

      RemoveDroppable($('inventories'));
    }

    function ResetTradeOfferOpacity(elOffer) {
      if (elOffer.effect)
        elOffer.effect.cancel();

      elOffer.effect = new Effect.Opacity(elOffer, { to: 1.0, duration: 0.15 });
    }

    function RemoveDroppable(element) {
      Droppables.remove(element);
    }

    function CleanupDraggable(elItem) {
      elItem.style.zIndex = 5;

      // unset scriptaculous draggable stuff
      elItem.style.left = '';
      elItem.style.top = '';
      elItem.style.opacity = 1.0;

      elItem.removeClassName('in_drag');
    }

    function OnDoubleClickItem(event, elItem) {
      if (BIsInTradeSlot(elItem)) {
        MoveItemToInventory(elItem);
      }
      else {
        MoveItemToTrade(elItem);
      }
      CancelItemHover(elItem);
    }

    function OnDropItemInTrade(elItem, elTarget, event) {
      CleanupDraggable(elItem);
      MoveItemToTrade(elItem);
    }

    function OnDropItemInInventory(elItem, elTarget, event) {
      CleanupDraggable(elItem);
      MoveItemToInventory(elItem);
    }

    function ShowStackableItemDialog(elItem) {
      var currency = elItem.rgItem;

      if (currency.parent_item)
        return;

      // show transfer dialog
      PresentCurrencyDialog(currency);
    }

    function MoveItemToTrade(elItem) {
      var item = elItem.rgItem;
      if (item.is_stackable) {
        //stackable items present a dialog first, then will call FindSlotAndSetItem
        ShowStackableItemDialog(elItem);
      }
      else {
        FindSlotAndSetItem(item);
      }
    }

    function FindSlotAndSetItem(item, xferAmount) {
      var elItem = item.element;
      var bStackable = item.is_stackable;
      var bTheirItem = item.is_their_item;
      var elSlots = (bTheirItem ? $('their_slots') : $('your_slots'));
      if (bStackable) {
        var stack = GetTradeItemStack(bTheirItem ? UserThem : UserYou, item);
        elItem = stack.element;

        if (xferAmount == 0) {
          GTradeStateManager.RemoveItemFromTrade(item);
          return;
        }
      }

      var iSlot = 0;

      // find a slot to drop this item in
      if (!BIsInTradeSlot(elItem)) {
        var oSlotInfo = FindFreeSlot(elSlots);
        ReserveSlot(oSlotInfo.elSlot);
        iSlot = oSlotInfo.iSlot;
      }
      else {
        // stackable items will reuse their current slot
        iSlot = GetCurrentSlot(elItem);
      }

      item.homeElement.down('.slot_actionmenu_button').hide();

      if (!BIsInTradeSlot(elItem) || bStackable) {
        if (Economy_UseResponsiveLayout() && window.ResponsiveTrade_SwitchMode)
          ResponsiveTrade_SwitchMode(0);

        // commit the update
        GTradeStateManager.SetItemInTrade(item, iSlot, xferAmount);
      }
    }

    function MoveItemToInventory(elItem) {
      var item = elItem.rgItem;
      if (BIsInTradeSlot(elItem)) {
        CleanupSlot(elItem.parentNode.parentNode);
      }

      if (item.is_stackable) {
        // stackable items are fully removed by this call
        SetStackableItemInTrade(item, 0);
        return;
      }

      RevertItem(item);

      item.homeElement.down('.slot_actionmenu_button').show();

      GTradeStateManager.RemoveItemFromTrade(item);
    }

    CTradeStateManager = {

      RemoveItemFromTrade: function (item) {
        CancelTradeStatusPoll();
        new Ajax.Request('https://steamcommunity.com/trade/' + g_ulTradePartnerSteamID + '/removeitem/', {
          method: 'post',
          parameters: {
            sessionid: g_sessionID,
            appid: item.appid,
            contextid: item.contextid,
            itemid: item.id
          },
          onComplete: HandleDropFailure
        });
      },

      SetCurrencyInTrade: function (currency, xferAmount) {
        CancelTradeStatusPoll();
        new Ajax.Request('https://steamcommunity.com/trade/' + g_ulTradePartnerSteamID + '/setcurrency/', {
          method: 'post',
          parameters: {
            sessionid: g_sessionID,
            appid: currency.appid,
            contextid: currency.contextid,
            currencyid: currency.id,
            amount: xferAmount
          },
          onSuccess: OnTradeStatusUpdate,
          onFailure: RequestTradeStatusUpdate
        });
      },

      SetItemInTrade: function (item, slot, xferAmount) {
        CancelTradeStatusPoll();

        var params = {
          sessionid: g_sessionID,
          appid: item.appid,
          contextid: item.contextid,
          itemid: item.id,
          slot: slot
        };

        if (xferAmount)
          params.amount = xferAmount;

        new Ajax.Request('https://steamcommunity.com/trade/' + g_ulTradePartnerSteamID + '/additem/', {
          method: 'post',
          parameters: params,
          onComplete: function (transport) { HandleDropFailure(transport); }
        });
      },

      ToggleReady: function (bReady) {
        CancelTradeStatusPoll();
        new Ajax.Request('https://steamcommunity.com/trade/' + g_ulTradePartnerSteamID + '/toggleready/', {
          method: 'post',
          parameters: {
            sessionid: g_sessionID,
            ready: bReady,
            version: g_rgLastFullTradeStatus.version
          },
          onSuccess: OnTradeStatusUpdate,
          onFailure: RequestTradeStatusUpdate
        });
      },

      UpdateConfirmButtonStatus: function () {
        if (g_bConfirmPending) {
          $('trade_confirm_message').update('Waiting for the other party to confirm...');
          $('trade_confirmbtn').hide();
          $('trade_confirm_throbber').show();
        }
        else {
          $('trade_confirmbtn').show();
          $('trade_confirm_throbber').hide();
          if (UserYou.bReady && UserThem.bReady) {
            $('trade_confirmbtn').addClassName('active');
            $('trade_confirm_message').update('Both parties are ready.');
          }
          else {
            $('trade_confirmbtn').removeClassName('active');
            $('trade_confirm_message').update('Waiting for both parties to check the ready box.');
          }
        }
      }
    };

    function SetStackableItemInTrade(item, xferAmount) {
      if (item.is_currency)
        GTradeStateManager.SetCurrencyInTrade(item, xferAmount);
      else
        FindSlotAndSetItem(item, xferAmount);
    }

    // callback that handles SetItem or RemoveItem returning failure and puts the item back where it was
    function HandleDropFailure(transport, fnOnFail) {
      if (!transport || !transport.responseJSON || !transport.responseJSON.success) {
        if (fnOnFail)
          fnOnFail();
        RequestTradeStatusUpdate();
      }
      else
        OnTradeStatusUpdate(transport);
    }

    function RevertItem(item) {
      if (item.is_stackable) {
        // remove the currency from the trade by setting the amount in-trade to 0.
        SetStackableItemInTrade(item, 0);
      }
      else {
        item.homeElement.appendChild(item.element.remove());
        // if the inventory view is filtered, make sure the item applies
        if (g_ActiveInventory && g_ActiveInventory.appid == item.appid && g_ActiveInventory.contextid == item.contextid)
          Filter.ApplyFilter($('filter_control').value, item.element);
      }
    }

    /*
     * 		Trade slots
     */


    function BIsInTradeSlot(element) {
      return element.parentNode && $(element.parentNode).hasClassName('slot_inner');
    }

    function GetCurrentSlot(element) {
      if (element.parentNode && element.parentNode.parentNode && $(element.parentNode.parentNode).hasClassName('trade_slot')) {
        return element.parentNode.parentNode.iSlot;
      }
      return 0;
    }

    function CreateCurrencyTradeSlot(bIsYourSlot, currency) {
      var elSlotContainer = bIsYourSlot ? $('your_slots_currency') : $('their_slots_currency');
      var currencyId = currency.appid + '_' + currency.contextid + '_' + currency.id;
      var id = bIsYourSlot ? 'your_slot_currency_' + currencyId : 'their_slot_currency_' + currencyId;
      var elSlot = CreateSlotElement(id);
      elSlotContainer.appendChild(elSlot);
      return elSlot;
    }

    function CreateTradeSlot(bIsYourSlot, iSlot) {
      var elSlotContainer = bIsYourSlot ? $('your_slots') : $('their_slots');
      var id = bIsYourSlot ? 'your_slot_' + iSlot : 'their_slot_' + iSlot;
      var elSlot = CreateSlotElement(id);
      elSlot.iSlot = iSlot;
      elSlotContainer.appendChild(elSlot);
      return elSlot;
    }

    function CreateSlotElement(id) {
      var elSlot = new Element('div', { id: id, 'class': 'itemHolder trade_slot' });
      elSlot.appendChild(new Element('div', { 'class': 'slot_inner' }));

      var elAppLogo = new Element('div', { 'class': 'slot_applogo' });
      elAppLogo.style.display = 'none';
      elAppLogo.appendChild(new Element('img', { 'class': 'slot_applogo_img' }));
      elSlot.appendChild(elAppLogo);

      var elActionMenuButton = new Element('a', { 'id': id + '_actionmenu_button', 'class': 'slot_actionmenu_button' });
      elActionMenuButton.style.display = 'none';
      elActionMenuButton.href = "javascript:void(0)";
      elSlot.appendChild(elActionMenuButton);

      var elFraudWarningIcon = new Element('div', { 'class': 'slot_app_fraudwarning' });
      elFraudWarningIcon.style.display = 'none';
      elSlot.appendChild(elFraudWarningIcon);
      return elSlot;
    }

    function FindFreeSlot(slotHolder) {
      var slots = slotHolder.childElements();
      var slot = null;
      var elSlot = null;
      var iLastSlotInUse = 0;
      for (var i = 0; i < slots.length; i++) {
        if (!slots[i].hasItem) {
          if (!elSlot) {
            elSlot = slots[i];
            slot = i;
          }
        }
        else {
          iLastSlotInUse = Math.max(iLastSlotInUse, i);
        }
      }
      return { elSlot: elSlot, iSlot: slot, iLastSlotInUse: iLastSlotInUse };
    }

    function EnsureSufficientTradeSlots(bYourSlots, cSlotsInUse, cCurrencySlotsInUse) {
      var elSlotContainer = bYourSlots ? $('your_slots') : $('their_slots');


      var cTotalSlotsInUse = cSlotsInUse + cCurrencySlotsInUse;

      var cDesiredSlots;
      if (Economy_UseResponsiveLayout())
        cDesiredSlots = cTotalSlotsInUse + 1;
      else
        cDesiredSlots = Math.max(Math.floor((cTotalSlotsInUse + 5) / 4) * 4, 8);

      var cDesiredItemSlots = cDesiredSlots - cCurrencySlotsInUse;

      var cCurrentItemSlots = elSlotContainer.childElements().length;
      var cCurrentSlots = cCurrentItemSlots + cCurrencySlotsInUse;

      var $ContainerParent = $J(elSlotContainer.parentNode);
      $ContainerParent.css('height', $ContainerParent.height() + 'px');
      $ContainerParent.css('overflow', 'hidden');

      var bElementsChanged = false;
      var fnOnAnimComplete = null;
      if (cDesiredSlots > cCurrentSlots) {
        for (var i = cCurrentItemSlots; i < cDesiredItemSlots; i++) {
          CreateTradeSlot(bYourSlots, i);
        }
        bElementsChanged = true;
      }
      else if (cDesiredSlots < cCurrentSlots) {
        // going to compact
        var prefix = bYourSlots ? 'your_slot_' : 'their_slot_';
        var rgElementsToRemove = new Array();
        for (var i = cDesiredItemSlots; i < cCurrentItemSlots; i++) {
          var element = $(prefix + i);
          element.id = '';
          $(elSlotContainer.parentNode).appendChild(element.remove());
          rgElementsToRemove.push(element);
        }
        fnOnAnimComplete = function () { rgElementsToRemove.invoke('remove') };
        bElementsChanged = true;
      }

      if (bElementsChanged) {
        if (cCurrentSlots) {
          var iNewHeight = $ContainerParent[0].scrollHeight - parseInt($ContainerParent.css('paddingTop'));

          $ContainerParent.stop();
          $ContainerParent.animate({ height: iNewHeight + 'px' }, 250, 'swing', function () {
            if (fnOnAnimComplete) {
              fnOnAnimComplete();
            }
            $ContainerParent.css('height', '').css('overflow', '');
          });
        }
        else {
          $ContainerParent.css('height', '').css('overflow', '');
          fnOnAnimComplete && fnOnAnimComplete();
        }
      }
      else {
        $ContainerParent.css('height', '').css('overflow', '');
      }
    }

    function ReserveSlot(elSlot) {
      $J(elSlot).addClass('has_item');
      elSlot.hasItem = true;
    }

    function PutItemInSlot(elItem, elSlot) {
      var item = elItem.rgItem;
      if (elItem.parentNode && elItem.parentNode.nodeType != Node.DOCUMENT_FRAGMENT_NODE /* IE cruft */) {
        $(elItem.parentNode).down('.slot_actionmenu_button').hide();
        elItem.remove();
      }
      elSlot.down('.slot_inner').appendChild(elItem);

      if (item && item.appid && g_rgAppContextData[item.appid]) {
        var rgAppData = g_rgAppContextData[item.appid];
        elSlot.down('.slot_applogo_img').src = rgAppData.icon;
        elSlot.down('.slot_applogo').show();

        if (typeof (g_rgPlayedApps) != 'undefined' && g_rgPlayedApps !== false && !g_rgPlayedApps[item.appid]) {
          var strWarning = 'You\'ve never played the game this item is from.';
          if (!item.fraudwarnings) {
            item.fraudwarnings = [strWarning];
          }
          else {
            // Don't push the NoPlaytime warning over and over.
            if (item.fraudwarnings.indexOf(strWarning) == -1) {
              item.fraudwarnings.push(strWarning);
            }
          }
        }

        if (item.id && item.fraudwarnings) {
          elSlot.down('.slot_app_fraudwarning').show();
        }
        else {
          elSlot.down('.slot_app_fraudwarning').hide();
        }
      }
      else {
        elSlot.down('.slot_applogo').hide();
        elSlot.down('.slot_app_fraudwarning').hide();
      }

      var elActionMenuButton = elSlot.down('.slot_actionmenu_button');
      elActionMenuButton.show();
      $J('#' + elActionMenuButton.id).click(function () {
        HandleTradeActionMenu(elActionMenuButton, item, item.is_their_item ? UserThem : UserYou)
      });

      $J(elSlot).addClass('has_item');
      elSlot.hasItem = true;
    }

    function CleanupSlot(elSlot) {
      $J('#' + elSlot.id).unbind();

      elSlot.down('.slot_applogo').hide();
      elSlot.down('.slot_actionmenu_button').hide();
      elSlot.down('.slot_app_fraudwarning').hide();
      $J(elSlot).removeClass('has_item');
      elSlot.hasItem = false;
    }

    /*
     *		Update polling
     */

    var g_bPollInFlight = false;
    var g_bPeriodicPollCancelledInFlight = false;
    var g_cTradePollFailures = 0;
    var g_iNextLogPos = 0;

    var g_timerTradePoll = null;
    var g_rgLastFullTradeStatus = null;
    var g_cMyItemsInTrade = 0;
    var g_cTheirItemsInTrade = 0;
    var g_cCurrenciesInTrade = 0;

    function RequestTradeStatusUpdate() {
      GetTradeStatus();
    }

    function GetTradeStatus() {
      if (g_bPollInFlight)
        return;

      CancelTradeStatusPoll();
      g_bPollInFlight = true;
      new Ajax.Request('https://steamcommunity.com/trade/' + g_ulTradePartnerSteamID + '/tradestatus/', {
        method: 'post',
        parameters: { sessionid: g_sessionID, logpos: g_iNextLogPos, version: g_rgLastFullTradeStatus.version },
        onSuccess: OnPeriodicTradeStatusUpdate,
        onFailure: OnTradeStatusFailure
      }
      );
    }

    function OnPeriodicTradeStatusUpdate(transport) {
      // if we got cancelled in flight because some other user-action (added item to trade, readied, etc)
      //	then don't process this update, the user action will return the latest status
      g_bPollInFlight = false;
      if (g_bPeriodicPollCancelledInFlight) {
        g_bPeriodicPollCancelledInFlight = false;
        QueueNextTradeStatusUpdateRequest();
        return;
      }
      else {
        OnTradeStatusUpdate(transport);
      }
    }

    function OnTradeStatusUpdate(transport) {
      try {
        if (transport.responseJSON && transport.responseJSON.success) {
          var rgNewTradeStatus = transport.responseJSON;

          if (rgNewTradeStatus.trade_status == 1 || rgNewTradeStatus.trade_status == 6) {
            // we're done here
            Tutorial.OnCompletedTutorial();
            StopWatchingForUnload();

            if (rgNewTradeStatus.trade_status == 6) {
              window.location = 'https://steamcommunity.com/my/tradeoffers/view/' + rgNewTradeStatus.tradeid + '?partner=' + g_ulTradePartnerSteamID;
            }
            else {
              window.location = 'https://steamcommunity.com/trade/' + rgNewTradeStatus.tradeid + '/receipt/';
            }

            return;
          }
          else if (rgNewTradeStatus.trade_status == 3) {
            var url = 'https://steamcommunity.com/trade/' + g_ulTradePartnerSteamID + '/cancelled/';
            if (g_bRequestedCancel)
              url += '?requestedCancel=1';
            StopWatchingForUnload();
            window.location = url;
            return;
          }
          else if (rgNewTradeStatus.trade_status == 4) {
            var url = 'https://steamcommunity.com/trade/' + g_ulTradePartnerSteamID + '/';
            if ($('trade_theirs_timeout').visible())
              url += '?partnerTimeout=1';
            StopWatchingForUnload();
            window.location = url;
            return;
          }
          else if (rgNewTradeStatus.trade_status == 5) {
            var url = 'https://steamcommunity.com/trade/' + rgNewTradeStatus.tradeid + '/failed/';
            StopWatchingForUnload();
            window.location = url;
            return;
          }
          else if (rgNewTradeStatus.trade_status != 0 || !rgNewTradeStatus.me || !rgNewTradeStatus.them) {
            // missing expected data- treat this as a failure
            OnTradeStatusFailure();
            return;
          }

          RefreshTradeStatus(rgNewTradeStatus);
          g_rgCurrentTradeStatus = rgNewTradeStatus;
          g_cTradePollFailures = 0;
        }
        else {
          OnTradeStatusFailure();
        }
      }
      catch (e) {
        // error updating trade status
        OnTradeStatusFailure();
      }
      QueueNextTradeStatusUpdateRequest();
    }

    function OnTradeStatusFailure() {
      g_bPollInFlight = false;

      if (g_cTradePollFailures++ > 3) {
        StopWatchingForUnload();
        window.location = window.location;
      }

      QueueNextTradeStatusUpdateRequest();
    }

    function CancelTradeStatusPoll() {
      if (g_timerTradePoll) {
        window.clearTimeout(g_timerTradePoll);
        g_timerTradePoll = null;
      }
      if (g_bPollInFlight) {
        // tell the in-flight poll to ignore its results as they'll be stale
        g_bPeriodicPollCancelledInFlight = true;
      }
    }

    function QueueNextTradeStatusUpdateRequest() {
      CancelTradeStatusPoll();
      g_timerTradePoll = window.setTimeout(GetTradeStatus, TRADE_UPDATE_INTEVRAL);
    }

    function ElementCount(obj) {
      if (!obj)
        return 0;
      else if (obj instanceof Array)
        return obj.length;
      else
        return Object.keys(obj).length;
    }

    function RedrawCurrentTradeStatus() {
      RefreshTradeStatus(g_rgCurrentTradeStatus, true);
    }

    function RefreshTradeStatus(rgTradeStatus, bForce) {
      if (rgTradeStatus.newversion || bForce) {
        var rgTradeStatusForSlots = rgTradeStatus;
        if (bForce && !rgTradeStatus.newversion) {
          // if we are forcing an update (such ass after loading partner's inventory),
          //	 use the last full update for putting items in the slots
          rgTradeStatusForSlots = g_rgLastFullTradeStatus;
        }

        g_cMyItemsInTrade = ElementCount(rgTradeStatusForSlots.me.assets) + rgTradeStatusForSlots.me.currency.length;
        g_cTheirItemsInTrade = ElementCount(rgTradeStatusForSlots.them.assets) + rgTradeStatusForSlots.them.currency.length;
        RefreshTradeEscrowDisplay();

        UpdateSlots(rgTradeStatusForSlots.me.assets, rgTradeStatusForSlots.me.currency, true, UserYou, rgTradeStatusForSlots.version);

        UpdateSlots(rgTradeStatusForSlots.them.assets, rgTradeStatusForSlots.them.currency, false, UserThem, rgTradeStatusForSlots.version);

        if (rgTradeStatus.newversion)
          g_rgLastFullTradeStatus = rgTradeStatus;

        g_cCurrenciesInTrade = rgTradeStatusForSlots.me.currency.length + rgTradeStatusForSlots.them.currency.length;
        if (g_cMyItemsInTrade + g_cTheirItemsInTrade > 0)
          Tutorial.OnUserAddedItemsToTrade(g_cMyItemsInTrade, g_cTheirItemsInTrade);
      }
      if (rgTradeStatus.me.ready && !UserYou.bReady || !rgTradeStatus.me.ready && UserYou.bReady) {
        UserYou.bReady = rgTradeStatus.me.ready;
        if (!UserYou.bReady) // you were unreadied by a trade change
          $('notready_tradechanged_message').show();
      }
      if (rgTradeStatus.them.ready && !UserThem.bReady || !rgTradeStatus.them.ready && UserThem.bReady) {
        UserThem.bReady = rgTradeStatus.them.ready;
      }
      if (rgTradeStatus.them.connection_pending || (rgTradeStatus.them.sec_since_touch && rgTradeStatus.them.sec_since_touch > MESSAGE_TRADE_PARTNER_ABSENSE_TIME)) {
        $('trade_theirs_timeout').show();
      }
      else {
        $('trade_theirs_timeout').hide();
      }

      g_bConfirmPending = rgTradeStatus.me.confirmed;

      UpdateReadyButtons();

      // only update the event log if we have all the data about the other user's inventory
      if (rgTradeStatus.events && !UserThem.BIsLoadingInventoryData() && !UserYou.BIsLoadingInventoryData()) {
        UpdateEventLog(rgTradeStatus.events);
      }

    }

    function UpdateSlots(rgSlotItems, rgCurrency, bYourSlots, user, version) {
      var slotPrefix = bYourSlots ? 'your_slot_' : 'their_slot_';
      var elSlotContainer = bYourSlots ? $('your_slots') : $('their_slots');
      var elCurrencySlotContainer = bYourSlots ? $('your_slots_currency') : $('their_slots_currency');

      // see what the last slot with an item is
      var cMaxSlotId = 0;
      if (rgSlotItems instanceof Array) {
        cMaxSlotId = rgSlotItems.length;
      }
      else {
        for (var slotid in rgSlotItems) {
          var iSlot = parseInt(slotid);
          if (iSlot && !isNaN(iSlot))
            cMaxSlotId = Math.max(iSlot, cMaxSlotId);
        }
        cMaxSlotId++;
      }

      var cCurrenciesInTrade = 0;
      for (var iCurrency = 0; iCurrency < rgCurrency.length; iCurrency++) {
        var currencyUpdate = rgCurrency[iCurrency];

        // just skip pending inventories, the currency will be drawn after the inventory arrival
        var inventory = user.getInventory(currencyUpdate.appid, currencyUpdate.contextid);
        if (!inventory || inventory.BIsPendingInventory())
          continue;

        cCurrenciesInTrade++;

        var currency = user.FindCurrency(currencyUpdate.appid, currencyUpdate.contextid, currencyUpdate.currencyid);
        var stack = GetTradeItemStack(user, currency);

        if ((parseInt(stack.amount) + parseInt(stack.fee)) != currencyUpdate.amount) {
          UpdateTradeItemStackDisplay(currency, stack, currencyUpdate.amount);
          if (!bYourSlots && !g_bTradeOffer)
            HighlightNewlyAddedItem(stack.element);
        }

        stack.version = version;
      }
      var rgCurrencySlots = elCurrencySlotContainer.childElements();
      if (cCurrenciesInTrade < rgCurrencySlots.length) {
        // there's an extra slot in the trade, remove it
        for (var iCurrencySlot = 0; iCurrencySlot < rgCurrencySlots.length; iCurrencySlot++) {
          var elSlot = rgCurrencySlots[iCurrencySlot];
          var stack = elSlot.stack;
          if (stack.version < version) {
            elSlot.remove();
            var origCurrency = user.FindCurrency(stack.appid, stack.contextid, stack.id);
            origCurrency.amount = origCurrency.original_amount;
            origCurrency.trade_stack = null;
            if (bYourSlots)
              UpdateCurrencyDisplay(origCurrency);
          }
        }
      }

      EnsureSufficientTradeSlots(bYourSlots, cMaxSlotId, cCurrenciesInTrade);

      var nNumBadItems = 0;
      var firstBadItem = null;
      var nNumExpiringItems = 0;
      var firstExpiringItem = null;
      var nFullInventoryAppId = false;
      for (var slot = 0; slot < elSlotContainer.childElements().length; slot++) {
        var elSlot = $(slotPrefix + slot);
        var elCurItem = elSlot.down('.slot_inner').firstDescendant();
        var elNewItem = null;

        var bRemoveCurItem = (elCurItem != null);

        var bItemIsNewToTrade = false;  //lets us know if we need to indicate this item was added
        var bStackAmountChanged = false;	// if a stackable item's amount has changed, we also treat that like new

        if (rgSlotItems[slot]) {
          var appid = rgSlotItems[slot].appid;
          var contextid = rgSlotItems[slot].contextid;
          var itemid = rgSlotItems[slot].assetid;
          var amount = rgSlotItems[slot].amount;

          // check that we are allowed to receive this item
          if (!bYourSlots) {
            if (!UserYou.BAllowedToRecieveItems(appid, contextid)) {
              if (!nFullInventoryAppId && UserYou.BInventoryIsFull(appid, contextid)) {
                nFullInventoryAppId = appid;
              }

              if (nNumBadItems == 0) {
                firstBadItem = rgSlotItems[slot];
              }

              nNumBadItems++;
            }
          }

          var elItem = user.findAssetElement(appid, contextid, itemid);;
          if (g_dateEscrowEnd != null && typeof elItem.rgItem.item_expiration == 'string') {
            var dateExpiration = new Date(elItem.rgItem.item_expiration);
            if (g_dateEscrowEnd >= dateExpiration) {
              if (nNumExpiringItems == 0) {
                firstExpiringItem = rgSlotItems[slot];
              }

              nNumExpiringItems++;
            }
          }

          if (elCurItem && elCurItem.rgItem && elCurItem.rgItem.appid == appid && elCurItem.rgItem.contextid == contextid
            && elCurItem.rgItem.id == itemid && !elCurItem.rgItem.unknown) {
            // it's already there
            bRemoveCurItem = false;

            if (elCurItem.rgItem.is_stackable) {
              var stack = elCurItem.rgItem;
              bStackAmountChanged = (amount != stack.amount);
              UpdateTradeItemStackDisplay(stack.parent_item, stack, amount);
            }
          }
          else {
            // it's new to the trade
            elNewItem = elItem;
            var item = elNewItem.rgItem;

            if (!item.unknown) {
              bItemIsNewToTrade = true;
            }

            if (item.is_stackable) {
              var stack = GetTradeItemStack(user, item);
              bStackAmountChanged = (amount != stack.amount);
              UpdateTradeItemStackDisplay(item, stack, amount);

              elNewItem = stack.element;
            }

            if (elNewItem && elNewItem.parentNode) {
              if ($(elNewItem.parentNode).down('.slot_actionmenu_button')) {
                $(elNewItem.parentNode).down('.slot_actionmenu_button').hide();
              }

              if (BIsInTradeSlot(elNewItem)) {
                CleanupSlot(elNewItem.parentNode.parentNode);
                bItemIsNewToTrade = false;
              }
              elNewItem.remove();
            }
          }
        }

        if (elCurItem && bRemoveCurItem) {
          if (elCurItem.rgItem && elCurItem.rgItem.is_stackable) {
            var stack = elCurItem.rgItem;
            UpdateTradeItemStackDisplay(stack.parent_item, stack, 0);
            elCurItem.remove();
          }
          else if (elCurItem.rgItem && elCurItem.rgItem.homeElement)
            elCurItem.rgItem.homeElement.appendChild(elCurItem.remove());
          else
            elCurItem.remove();
          CleanupSlot(elSlot);
        }

        if (elNewItem) {
          PutItemInSlot(elNewItem, elSlot);
          if (bItemIsNewToTrade && !bYourSlots && !g_bTradeOffer) {
            HighlightNewlyAddedItem(elNewItem);
          }
        }
        else if (bStackAmountChanged && !bYourSlots && !g_bTradeOffer) {
          HighlightNewlyAddedItem(elCurItem);
        }
      }

      if (!bYourSlots && nNumBadItems != g_nItemsFromContextWithNoPermissionToReceive && !UserThem.BIsLoadingInventoryData()) {
        g_nItemsFromContextWithNoPermissionToReceive = nNumBadItems;

        if (nNumBadItems > 0) {
          var strEvent = "";
          var item = user.findAsset(firstBadItem.appid, firstBadItem.contextid, firstBadItem.assetid);
          if (item) {
            if (nNumBadItems == 1) {
              strEvent = 'You are not allowed to receive the item "%1$s."'
                .replace('%1$s', item.name.escapeHTML());
            }
            else {
              strEvent = 'You are not allowed to receive %1$s of the items being offered including "%2$s."'
                .replace('%1$s', nNumBadItems)
                .replace('%2$s', item.name.escapeHTML());
            }
          }
          else {
            if (nNumBadItems == 1) {
              strEvent = 'You are not allowed to receive one of the items being offered.';
            }
            else {
              strEvent = 'You are not allowed to receive %1$s of the items being offered.'
                .replace('%1$s', nNumBadItems);
            }
          }

          if (nFullInventoryAppId) {
            var rgAppData = g_rgAppContextData[nFullInventoryAppId];
            var strEventAppend = 'Your inventory for %1$s is full.'
              .replace('%1$s', rgAppData.name.escapeHTML());

            strEvent = strEvent + ' ' + strEventAppend;
          }

          var elEvent = new Element('div', { 'class': 'logevent' });
          elEvent.update(strEvent);
          $('log').appendChild(elEvent);
        }
      }

      if (nNumExpiringItems != g_rgnItemsExpiringBeforeEscrow[bYourSlots ? 0 : 1]) {
        g_rgnItemsExpiringBeforeEscrow[bYourSlots ? 0 : 1] = nNumExpiringItems;

        if (nNumExpiringItems > 0) {
          var strEvent = "";
          var item = user.findAsset(firstExpiringItem.appid, firstExpiringItem.contextid, firstExpiringItem.assetid);
          if (item) {
            if (nNumExpiringItems == 1) {
              strEvent = 'The item "%1$s" cannot be included in this trade because it will expire before the trade hold period is over.'
                .replace('%1$s', item.name.escapeHTML());
            }
            else {
              strEvent = 'Some items, including "%1$s," cannot be included in this trade because they will expire before the trade hold period is over.'
                .replace('%1$s', item.name.escapeHTML());
            }
          }
          else {
            if (nNumExpiringItems == 1) {
              strEvent = 'One item cannot be included in this trade because it will expire before the trade hold period is over.';
            }
            else {
              strEvent = 'Some items cannot be included in this trade because they will expire before the trade hold period is over.';
            }
          }

          var elEvent = new Element('div', { 'class': 'logevent' });
          elEvent.update(strEvent);
          $('log').appendChild(elEvent);
        }
      }
    }

    // default border color: #3A3A3A
    function HighlightNewlyAddedItem(elItem) {

      var rgItem = elItem.rgItem;
      var slotParent = elItem.parentNode;

      slotParent.style.backgroundColor = '#ffffff';
      elItem.hide();
      new Effect.Appear(elItem, { duration: 0.6, afterFinish: function () { slotParent.style.backgroundColor = ''; } });

    }

    /*
     *		Trade events log
     */

    var EventLogAddYouTemplate = new Template('You added <span class="item" style="#{itemstyle}">#{itemname}</span>');
    var EventLogAddThemTemplate = new Template('#{theirname} added <span class="item" style="#{itemstyle}">#{itemname}</span>');
    var EventLogRemoveYouTemplate = new Template('You removed <span class="item" style="#{itemstyle}">#{itemname}</span>');
    var EventLogRemoveThemTemplate = new Template('#{theirname} removed <span class="item" style="#{itemstyle}">#{itemname}</span>');
    var EventLogReadyYouTemplate = new Template('You are ready');
    var EventLogReadyThemTemplate = new Template('#{theirname} is ready');
    var EventLogUnReadyYouTemplate = new Template('You are not ready');
    var EventLogUnReadyThemTemplate = new Template('#{theirname} is not ready');
    var EventLogIncreaseCurrencyYouTemplate = new Template('You increased the amount of <span class="item" style="#{itemstyle}">#{currencyname}</span> to <span style="#{itemstyle}">#{amount}</span>');
    var EventLogDecreaseCurrencyYouTemplate = new Template('You decreased the amount of <span class="item" style="#{itemstyle}">#{currencyname}</span> to <span style="#{itemstyle}">#{amount}</span>');
    var EventLogIncreaseCurrencyThemTemplate = new Template('#{theirname} increased the amount of <span class="item" style="#{itemstyle}">#{currencyname}</span> to <span style="#{itemstyle}">#{amount}</span>');
    var EventLogDecreaseCurrencyThemTemplate = new Template('#{theirname} decreased the amount of <span class="item" style="#{itemstyle}">#{currencyname}</span> to <span style="#{itemstyle}">#{amount}</span>');

    function UpdateEventLog(events) {
      var iLastLog = g_iNextLogPos - 1;
      var bDidAppend = false;
      var bNeedInventoryLoad = false;
      for (var i in events) {
        if (i < g_iNextLogPos)
          continue;
        var event = events[i];

        var bTheirAction = (event.steamid && event.steamid == g_ulTradePartnerSteamID);
        var elEvent = new Element('div', { 'class': 'logevent' });
        var strEvent = null;
        var strAfterEvent = null;
        switch (parseInt(event.action)) {
          case 0:
          case 1:
            var template = null;
            if (event.action == 0)
              template = bTheirAction ? EventLogAddThemTemplate : EventLogAddYouTemplate;
            else
              template = bTheirAction ? EventLogRemoveThemTemplate : EventLogRemoveYouTemplate;

            var user = bTheirAction ? UserThem : UserYou;
            var item = user.findAsset(event.appid, event.contextid, event.assetid);
            if (!item && user.BIsLoadingInventoryData()) {
              bNeedInventoryLoad = true;
              break;
            }

            var itemname = (item) ? item.name.escapeHTML() : 'Unknown Item';
            var itemstyle = (item && item.name_color) ? 'color: #' + item.name_color + ';' : '';

            strEvent = template.evaluate({ theirname: g_strTradePartnerPersonaName, itemname: itemname, itemstyle: itemstyle });

            break;
          case 2:
          case 3:
            var template = null;
            if (event.action == 2)
              template = bTheirAction ? EventLogReadyThemTemplate : EventLogReadyYouTemplate;
            else
              template = bTheirAction ? EventLogUnReadyThemTemplate : EventLogUnReadyYouTemplate;

            strEvent = template.evaluate({ theirname: g_strTradePartnerPersonaName });

            break;
          case 6:
            var template = null;
            var bAmountChanged = false;
            var newAmount = parseInt(event.amount);
            var oldAmount = parseInt(event.old_amount);

            if (event.amount == 0) {
              template = bTheirAction ? EventLogRemoveThemTemplate : EventLogRemoveYouTemplate;
            }
            else if (event.old_amount == 0) {
              template = bTheirAction ? EventLogAddThemTemplate : EventLogAddYouTemplate;
            }
            else if (newAmount > oldAmount) {
              bAmountChanged = true;
              template = bTheirAction ? EventLogIncreaseCurrencyThemTemplate : EventLogIncreaseCurrencyYouTemplate;
            }
            else if (newAmount < oldAmount) {
              bAmountChanged = true;
              template = bTheirAction ? EventLogDecreaseCurrencyThemTemplate : EventLogDecreaseCurrencyYouTemplate;
            }

            var user = bTheirAction ? UserThem : UserYou;
            var currency = user.FindCurrency(event.appid, event.contextid, event.currencyid);
            if (!currency && user.BIsLoadingInventoryData()) {
              bNeedInventoryLoad = true;
              break;
            }

            var currencyname = (currency) ? currency.name.escapeHTML() : 'Unknown Item';

            var formatFunc;
            if (CurrencyIsWalletFunds(currency)) {
              if (bTheirAction) {
                var bShouldConvert = typeof (g_rgWalletInfo) != 'undefined' &&
                  g_rgWalletInfo['wallet_currency'] != g_rgWalletInfo['wallet_other_currency'];
                var feeInfo = CalculateFeeAmount(newAmount);
                var nNewAmountAfterFee = newAmount - feeInfo.fees;
                if (bShouldConvert) {
                  nNewAmountAfterFee = ConvertToOurCurrencyForDisplay(nNewAmountAfterFee);
                }

                var bPreviouslyOverMax = g_bWalletBalanceWouldBeOverMax;
                g_bWalletBalanceWouldBeOverMax = newAmount > 0 && (typeof (g_rgWalletInfo) != 'undefined' && nNewAmountAfterFee + g_rgWalletInfo['wallet_balance'] > g_rgWalletInfo['wallet_max_balance']);

                if (g_bWalletBalanceWouldBeOverMax) {
                  strAfterEvent =
                    '<%1$s>Error:<%2$s> You can\'t accept %3$s\'s offer of %4$s. You currently have %5$s in your Steam Wallet, but this offer would put you over the maximum of %6$s.'
                      .replace('%1$s', 'span class="warning"')
                      .replace('%2$s', '/span')
                      .replace('%3$s', g_strTradePartnerPersonaName)
                      .replace('%4$s', v_currencyformat(nNewAmountAfterFee, GetCurrencyCode(g_rgWalletInfo['wallet_currency'])))
                      .replace('%5$s', v_currencyformat(g_rgWalletInfo['wallet_balance'], GetCurrencyCode(g_rgWalletInfo['wallet_currency'])))
                      .replace('%6$s', v_currencyformat(g_rgWalletInfo['wallet_max_balance'], GetCurrencyCode(g_rgWalletInfo['wallet_currency'])));
                }

                if (g_bWalletBalanceWouldBeOverMax != bPreviouslyOverMax) {
                  UpdateReadyButtons();
                }
              }

              // Don't show a currency name unless we're changing value ( ex: "increased the amount of Wallet Funds to $1.23" )
              currencyname = bAmountChanged ? 'Wallet Funds' : '';

              formatFunc = function (x) {
                var feeInfo = CalculateFeeAmount(x);
                var nPostFeeAmount = x - feeInfo.fees;
                if (bShouldConvert) {
                  // return "OurCurrency / TheirCurrency";
                  if (g_rgWalletInfo['wallet_other_currency'] == (currency.id % 1000)) {
                    return v_currencyformat(ConvertToOurCurrencyForDisplay(nPostFeeAmount), GetCurrencyCode(g_rgWalletInfo['wallet_currency'])) + ' / ' + v_currencyformat(nPostFeeAmount, currency.name.escapeHTML());
                  }
                  else if (g_rgWalletInfo['wallet_currency'] == (currency.id % 1000)) {
                    return v_currencyformat(nPostFeeAmount, currency.name.escapeHTML()) + ' / ' + v_currencyformat(ConvertToTheirCurrency(nPostFeeAmount), GetCurrencyCode(g_rgWalletInfo['wallet_other_currency']));
                  }
                }

                return v_currencyformat(nPostFeeAmount, currency.name.escapeHTML());
              };
            }
            else {
              formatFunc = v_numberformat;
            }

            var itemname = formatFunc(event.amount == 0 ? event.old_amount : event.amount) + ' ' + currencyname;
            var itemstyle = (currency && currency.name_color) ? 'color: #' + currency.name_color + ';' : '';

            strEvent = template.evaluate(
              {
                theirname: g_strTradePartnerPersonaName,
                itemname: itemname,
                currencyname: currencyname,
                itemstyle: itemstyle,
                amount: formatFunc(event.amount)
              }
            );

            break;
          case 7:
            if (g_bSuppressChat)
              break;

            if (bTheirAction)
              strEvent = '<span class="playerchatname">' + g_strTradePartnerPersonaName + '</span>: ';
            else
              strEvent = '<span class="playerchatname">' + g_strYourPersonaName + '</span>: ';

            strEvent += event.text ? event.text.substr(0, 100).escapeHTML().replace(/\n/g, '') : '';

            break;
          case 4:
          case 5:
          default:
            continue;
        }
        // we need to wait for some items to load, so abort!
        if (bNeedInventoryLoad)
          break;

        if (strEvent) {
          strEvent += ' <span class="timestamp">' + (new Date(event.timestamp * 1000).toLocaleTimeString()) + '</span>';
          elEvent.update(strEvent);
          $('log').appendChild(elEvent);
          bDidAppend = true;
        }

        if (strAfterEvent) {
          var elAfterEvent = new Element('div', { 'class': 'logevent' });
          elAfterEvent.update(strAfterEvent);
          $('log').appendChild(elAfterEvent);
          bDidAppend = true;
        }

        iLastLog = Math.max(iLastLog, i);
      }
      if (bDidAppend) {
        $('log').scrollTop = 10000;
      }
      g_iNextLogPos = iLastLog + 1;
    }

    /*
     *		Ready/Confirm
     */

    var g_bConfirmPending = false;

    function ToggleReady(bReady) {
      var fnReady = function () {
        UserYou.bReady = bReady;

        GTradeStateManager.ToggleReady(bReady);

        UpdateReadyButtons();
        $('notready_tradechanged_message').hide();
      };

      if (bReady && g_cTheirItemsInTrade > 0 && !g_bWarnedAboutPlaytime && typeof (g_rgPlayedApps) != 'undefined' && g_rgPlayedApps !== false) {
        var strTitle = 'This trade appears suspicious';
        var strWarning = 'One or more of the items you\'re receiving in this trade come from games that you have never played:';
        var strButton = 'Yes, I want items for games I\'ve never played'.replace(/%s/, g_strTradePartnerPersonaName);

        strWarning += '<ul class="trade_warning_item_list">';
        var bShouldWarn = false;
        var rgAssets = g_bTradeOffer ? g_rgCurrentTradeStatus.them.assets : g_rgLastFullTradeStatus.them.assets;
        for (var i = 0; i < rgAssets.length; i++) {
          var rgItem = UserThem.findAsset(rgAssets[i].appid, rgAssets[i].contextid, rgAssets[i].assetid);
          if (typeof (g_rgPlayedApps[rgAssets[i].appid]) == 'undefined' || g_rgPlayedApps[rgAssets[i].appid] == false) {
            bShouldWarn = true;
            strWarning += '<li' + (rgItem && rgItem.name_color ? ' style="color: #' + rgItem.name_color + ';"' : '') + '>';
            if (rgItem)
              strWarning += rgItem.name.escapeHTML() + ' <span class="trade_warning_item_type">(' + rgItem.type.escapeHTML() + ')</span>';
            else
              strWarning += 'Unknown Item';
            strWarning += '</li>';
          }
        }
        strWarning += '</ul>';

        if (bShouldWarn) {
          var elWarning = $J('<div/>', { 'class': 'trade_warn_dialog_content' }).html(strWarning.replace(/%s/g, g_strTradePartnerPersonaName));
          ShowConfirmDialog(strTitle, elWarning, strButton).done(function () {
            g_bWarnedAboutPlaytime = true;
            ToggleReady(true);
          });

          return;
        }
      }

      if (bReady && g_cTheirItemsInTrade > 0 && !g_bWarnedAboutUnvettedApp) {
        var strTitle = 'This trade appears suspicious';
        var strWarning = 'One or more of the items you\'re receiving in this trade come from new games on Steam. Use caution with these items:';
        var strButton = 'Yes, I trust %s'.replace(/%s/, g_strTradePartnerPersonaName);

        strWarning += '<ul class="trade_warning_item_list">';
        var bShouldWarn = false;
        var rgAssets = g_bTradeOffer ? g_rgCurrentTradeStatus.them.assets : g_rgLastFullTradeStatus.them.assets;
        for (var i = 0; i < rgAssets.length; i++) {
          var rgItem = UserThem.findAsset(rgAssets[i].appid, rgAssets[i].contextid, rgAssets[i].assetid);

          if ((typeof (g_rgAppContextData[rgAssets[i].appid]) != 'undefined' && g_rgAppContextData[rgAssets[i].appid].store_vetted == false) ||
            (typeof (UserThem.rgAppInfo[rgAssets[i].appid]) != 'undefined' && UserThem.rgAppInfo[rgAssets[i].appid].store_vetted == false)) {
            bShouldWarn = true;
            strWarning += '<li' + (rgItem && rgItem.name_color ? ' style="color: #' + rgItem.name_color + ';"' : '') + '>';
            if (rgItem)
              strWarning += rgItem.name.escapeHTML() + ' <span class="trade_warning_item_type">(' + rgItem.type.escapeHTML() + ')</span>';
            else
              strWarning += 'Unknown Item';
            strWarning += '</li>';
          }
        }
        strWarning += '</ul>';

        if (bShouldWarn) {
          var elWarning = $J('<div/>', { 'class': 'trade_warn_dialog_content' }).html(strWarning.replace(/%s/g, g_strTradePartnerPersonaName));
          ShowConfirmDialog(strTitle, elWarning, strButton).done(function () {
            g_bWarnedAboutUnvettedApp = true;
            ToggleReady(true);
          });

          return;
        }
      }

      if (bReady && (g_bWarnOnReady || g_cTheirItemsInTrade == 0)) {
        var strWarning = '';
        var strButton = '';
        var strTitle = 'This trade appears suspicious';
        if (g_cTheirItemsInTrade == 0) {
          if (g_bTradeOffer && GTradeStateManager.m_eTradeOfferState == CTradeOfferStateManager.TRADE_OFFER_STATE_NEW) {
            strTitle = 'Warning';
            strWarning = 'You have not selected any items for %s to offer in exchange for yours.  If %s accepts this trade, you will lose the items you\'ve offered but will not receive any items.';
          }
          else {
            strWarning = '%s has not offered any items in the trade.  When this trade is completed, you will not receive anything.  If %s has promised you Steam Wallet funds, CD-Keys, or other items outside the trade window, they may be attempting to scam you.';
          }

          strWarning += '<br><br>' + 'Please confirm that you are giving your items away, and expect nothing in return.';
          strButton = 'Yes, this is a gift';
        }
        else {
          strWarning = 'Upon completion of this trade, you will only receive the following items:';
          strWarning += '<ul class="trade_warning_item_list">';
          var rgAssets = g_bTradeOffer ? g_rgCurrentTradeStatus.them.assets : g_rgLastFullTradeStatus.them.assets;
          for (var i = 0; i < rgAssets.length; i++) {
            var rgItem = UserThem.findAsset(rgAssets[i].appid, rgAssets[i].contextid, rgAssets[i].assetid);
            strWarning += '<li' + (rgItem && rgItem.name_color ? ' style="color: #' + rgItem.name_color + ';"' : '') + '>';
            if (rgItem)
              strWarning += rgItem.name.escapeHTML() + ' <span class="trade_warning_item_type">(' + rgItem.type.escapeHTML() + ')</span>';
            else
              strWarning += 'Unknown Item';
            // afarnsworthTODO: fraud warnings!
            strWarning += '</li>';
          }
          strWarning += '</ul>';
          strWarning += '<span class="trade_warning_bold">You will not receive any other items or money.  If %s has promised you any other items, Steam Wallet funds, or CD-Keys outside the trade window, they may be attempting to scam you.</span>';
          strButton = 'Yes, I trust %s'.replace(/%s/, g_strTradePartnerPersonaName);
        }
        var elWarning = $J('<div/>', { 'class': 'trade_warn_dialog_content' }).html(strWarning.replace(/%s/g, g_strTradePartnerPersonaName));
        ShowConfirmDialog(strTitle, elWarning, strButton).done(fnReady);
      }
      else {
        fnReady();
      }
    }

    var g_bConfirmInFlight = false;
    function ConfirmTrade() {
      if (g_bConfirmInFlight)
        return;

      function OnTradeConfirmFailed(data) {
        if (data.eresult == 25) {
          ShowAlertDialog('This trade cannot be completed because it would exceed the maximum number of items allowed in your inventory.');
        }
        else {
          RequestTradeStatusUpdate();
        }
      }

      if (UserYou.bReady && UserThem.bReady) {
        CancelTradeStatusPoll();
        g_bConfirmInFlight = true;
        new Ajax.Request('https://steamcommunity.com/trade/' + g_ulTradePartnerSteamID + '/confirm/', {
          method: 'post',
          parameters: {
            sessionid: g_sessionID,
            version: g_rgLastFullTradeStatus.version
          },
          onSuccess: OnTradeStatusUpdate,
          onFailure: OnTradeConfirmFailed,
          onComplete: function () { g_bConfirmInFlight = false; }
        });
      }
    }

    function UpdateReadyButtons() {
      if (UserYou.bReady) {
        $('you_cantready').hide();
        $('you_notready').hide();
        $('you_ready').show();
        $('trade_area').addClassName('ready');
        $('trade_yours').addClassName('ready');
        $('inventory_box').addClassName('ready');
        Tutorial.OnUserIsReady();
      }
      else {
        var badOffer = g_bWalletBalanceWouldBeOverMax || g_nItemsFromContextWithNoPermissionToReceive > 0 || g_rgnItemsExpiringBeforeEscrow[0] > 0 || g_rgnItemsExpiringBeforeEscrow[1] > 0;
        if (!badOffer && (g_cMyItemsInTrade > 0 || g_cTheirItemsInTrade > 0)) {
          $('you_cantready').hide();
          $('you_notready').show();
        }
        else {
          var strMessage;
          if (badOffer) {
            strMessage = 'You can\'t accept the offer. See chat.';
          }
          else {
            if (g_bTradeOffer)
              strMessage = 'Waiting for you to offer one or more items.';
            else
              strMessage = 'Waiting for someone to make an offer.';
          }

          $$('#you_cantready .content').each(function (elContent) {
            elContent.update(strMessage);
          });

          $('you_notready').hide();
          $('you_cantready').show();
        }
        $('you_ready').hide();
        $('trade_area').removeClassName('ready');
        $('trade_yours').removeClassName('ready');
        $('inventory_box').removeClassName('ready');
      }

      if (!g_bTradeOffer) {
        if (UserThem.bReady) {
          $('them_notready').hide();
          $('them_ready').show();
          $('trade_theirs').addClassName('ready');
        }
        else {
          $('them_notready').show();
          $('them_ready').hide();
          $('trade_theirs').removeClassName('ready');
        }
      }
      else {
        if (g_bReadOnly) {
          //read only is the state where we are vieiwing a trade offer but haven't clicked on the "let's modify" button yet
          $('trade_yours').addClassName('ready');
          $('trade_theirs').addClassName('ready');
        }
        else if (UserYou.bReady) {
          $('trade_theirs').addClassName('ready');
        }
        else {
          $('trade_theirs').removeClassName('ready');
        }
      }

      if (!UserYou.bReady || !UserThem.bReady) {
        g_bConfirmPending = false;
      }

      GTradeStateManager.UpdateConfirmButtonStatus();
    }

    var g_bRequestedCancel = false;
    var g_bTradeCancelled = false;
    function CancelTrade() {
      if (g_bTradeCancelled)
        return;

      g_bTradeCancelled = true;
      g_bRequestedCancel = true;
      new Ajax.Request('https://steamcommunity.com/trade/' + g_ulTradePartnerSteamID + '/cancel/', {
        method: 'post',
        parameters: {
          sessionid: g_sessionID
        },
        onComplete: function () { g_bTradeCancelled = false; RequestTradeStatusUpdate(); }
      });
    }


    /* currency transfer in/out of trade */
    function PresentCurrencyDialog(currency) {
      if (CurrencyIsWalletFunds(currency) && g_rgWalletInfo['wallet_currency'] != g_rgWalletInfo['wallet_other_currency']) {
        CurrencyConversionDialog.Show(currency);
      }
      else {
        CurrencyDialog.Show(currency);
      }
    }

    function UpdateCurrencyDisplay(currency) {
      // no display element
      if (!currency.element)
        return;

      var elAmount = currency.element.down('.item_currency_amount');
      if (elAmount) {
        if (CurrencyIsWalletFunds(currency)) {
          var bShouldConvert = typeof (g_rgWalletInfo) != 'undefined' &&
            g_rgWalletInfo['wallet_currency'] != g_rgWalletInfo['wallet_other_currency'] &&
            g_rgWalletInfo['wallet_currency'] != (currency.id % 1000);

          var strAmount = (currency.owner != UserYou && bShouldConvert ?
            v_currencyformat(ConvertToOurCurrencyForDisplay(currency.amount), GetCurrencyCode(g_rgWalletInfo['wallet_currency'])) :
            v_currencyformat(currency.amount, currency.name.escapeHTML()));

          // Display the fee in small text underneath if applicable
          if (currency.fee > 0 && currency.owner == UserYou) {
            strAmount += "<div style=\"font-size: xx-small\">" + v_currencyformat(currency.fee, currency.name.escapeHTML()) + "</div>";
          }
          elAmount.update(strAmount);
        }
        else {
          elAmount.update(v_numberformat(currency.amount));
        }
      }
    }


    CurrencyDialog = {

      m_bInitialized: false,
      m_currency: null,
      m_fnDocumentKeyHandler: null,
      m_slider: null,
      m_elSliderHandle: null,
      m_elSliderProgress: null,
      m_elSliderCount: null,
      m_bIgnoreSlider: false,
      m_bIsWallet: false,

      m_$Dialog: null,
      m_Modal: null,

      Initialize: function () {

        this.m_$Dialog = $J('#trade_currency_dialog');

        this.m_elSliderProgress = this.m_$Dialog.find('#trade_currency_slider_ctn').find('.slider_progress');
        this.m_elSliderCount = this.m_$Dialog.find('#trade_currency_slider_count');


        this.m_bInitialized = true;
      },

      Show: function (currency) {

        if (!this.m_bInitialized)
          this.Initialize();

        this.m_currency = currency;
        this.m_bIsWallet = CurrencyIsWalletFunds(currency);
        var idAppend = (this.m_bIsWallet ? '_wallet' : '');

        var stack = currency.trade_stack;

        if (this.m_bIsWallet)
          this.m_$Dialog.addClass('trade_wallet');
        else
          this.m_$Dialog.removeClass('trade_wallet');

        if (!this.m_bIsWallet) {
          this.m_$Dialog.find('#trade_currency_dialog_currencyname1').text(currency.name);
          this.m_$Dialog.find('#trade_currency_dialog_currencyname2').text(currency.name);
        }

        var rgContext = UserYou.GetContext(currency.appid, currency.contextid);
        this.m_$Dialog.find('#trade_currency_dialog_contextname').text(rgContext ? rgContext.name : '');

        var amount = stack && stack.amount > 0 ? stack.amount : 1;

        this.m_$Dialog.find('#trade_currency_input').val(amount);

        var iconUrl = ImageURL(currency.icon_url, 42, '42f');
        this.m_$Dialog.find('#trade_currency_dialog_symbol1').attr('src', iconUrl);
        this.m_$Dialog.find('#trade_currency_dialog_symbol2').attr('src', iconUrl);

        this.m_$Dialog.find('#trade_currency_input').css('color', currency.name_color ? '#' + currency.name_color : '');
        this.m_$Dialog.find('#trade_currency_dialog_remaining_display').css('color', currency.name_color ? '#' + currency.name_color : '');

        this.m_$Dialog.find('#trade_currency_dialog_error').text('');

        var maximum = this.m_currency.original_amount;
        if (this.m_bIsWallet && g_rgWalletInfo['wallet_fee']) {
          this.m_$Dialog.find('#trade_currency_fee_amount_percent').text((g_rgWalletInfo['wallet_fee_percent'] * 100).toFixed(1));
          var feeInfo = CalculateFeeAmount(maximum);
          maximum = maximum - feeInfo.fees;
        }

        this.m_$Dialog.find('#trade_currency_input').on('keypress', this.OnInputKeyPress.bindAsEventListener(this));
        this.m_$Dialog.find('#trade_currency_input').on('keyup', this.OnInputKeyUp.bindAsEventListener(this));

        this.m_Modal = ShowConfirmDialog('', this.m_$Dialog.show()).done($J.proxy(this.OnAccept, this)).fail($J.proxy(this.OnCancel, this));
        this.m_$Dialog.find('#trade_currency_input').focus();

        this.m_elSliderHandle = this.m_$Dialog.find('#trade_currency_slider').children('.handle');
        this.m_slider = new CSlider(this.m_$Dialog.find('#trade_currency_slider'), this.m_elSliderHandle, {
          min: 0,
          max: maximum,
          value: amount,
          fnOnChange: this.OnSliderSlide.bind(this),
        });
        this.OnSliderSlide(amount);
      },

      UpdateRemainingCurrencyDisplay: function () {
        var inputValue = this.GetInputValueAsInt();
        var nAmount = inputValue;

        // If we're taking a fee, nAmount must be equal to the amount deducted from the sender's wallet.
        if (this.m_bIsWallet && g_rgWalletInfo['wallet_fee']) {
          if (inputValue > 0) {
            var feeInfo = CalculateAmountToSendForDesiredReceivedAmount(nAmount);
            this.m_$Dialog.find('#trade_currency_fee_amount_dollars').text(v_currencyformat(feeInfo.fees, this.m_currency.name));
          }
          else {
            this.m_$Dialog.find('#trade_currency_fee_amount_dollars').text(v_currencyformat(0, this.m_currency.name));
          }

          this.m_$Dialog.find('#trade_currency_fee_total_dollars').text(v_currencyformat(nAmount, this.m_currency.name));
        }

        var nDisplayAmount = this.m_currency.original_amount;
        if (nAmount <= this.m_currency.original_amount)
          nDisplayAmount = this.m_currency.original_amount - nAmount;

        if (this.m_bIsWallet) {
          this.m_$Dialog.find('#trade_currency_dialog_remaining_display').text(v_currencyformat(nDisplayAmount, this.m_currency.name));
        }
        else {
          this.m_$Dialog.find('#trade_currency_dialog_remaining_display').text(v_numberformat(nDisplayAmount));
        }
      },

      DisplayError: function (error) {
        this.m_$Dialog.find('#trade_currency_dialog_error').text(error);
        this.m_$Dialog.find('#trade_currency_dialog_error').css('color', '#ffffff');
        new Effect.Morph(this.m_$Dialog.find('#trade_currency_dialog_error')[0], { style: { color: '#ff0000' }, duration: 0.25 });
      },

      Dismiss: function () {
        this.m_Modal && this.m_Modal.Dismiss();
        this.m_Modal = null;
      },

      GetInputValueAsInt: function () {
        var nAmount;
        var strAmount = this.m_$Dialog.find('#trade_currency_input').val();

        if (!strAmount) {
          return 0;
        }

        if (this.m_bIsWallet) {
          nAmount = GetPriceValueAsInt(strAmount);
        }
        else {
          nAmount = parseInt(strAmount.replace(/[,.]/g, ''));
        }

        nAmount = Math.max(nAmount, 0);
        return nAmount;
      },

      OnAccept: function () {

        var inputValue = (this.m_bIsWallet ? this.m_$Dialog.find('#trade_currency_input').val().replace(GetCurrencySymbol(this.m_currency.name.escapeHTML()), '').replace(',', '.').replace('.--', '.00') : this.m_$Dialog.find('#trade_currency_input').val());
        if (!inputValue.match(/^[0-9,.]*$/)) {
          this.DisplayError('Please enter a valid amount above.');
          return;
        }

        var xferAmount = this.GetInputValueAsInt();

        if (this.m_bIsWallet && xferAmount > 0) {
          var feeInfo = CalculateAmountToSendForDesiredReceivedAmount(xferAmount);
          xferAmount = feeInfo.amount;
        }

        if (xferAmount > this.m_currency.original_amount) {
          this.DisplayError('You do not have enough ' + this.m_currency.name.escapeHTML() + '.');
          return;
        }

        SetStackableItemInTrade(this.m_currency, xferAmount);

        this.Dismiss();
      },

      OnCancel: function () {
      },

      OnInputKeyPress: function (event) {
        if (event.keyCode == Event.KEY_RETURN) {
          this.OnAccept(event);
        }
      },

      OnInputKeyUp: function (event) {

        var value = this.GetInputValueAsInt();

        this.UpdateRemainingCurrencyDisplay();

        this.m_bIgnoreSlider = true;
        this.m_slider.SetValue(value);
        this.m_bIgnoreSlider = false;
        this.UpdateSliderNumberDisplays(value);
      },

      UpdateSliderNumberDisplays: function (value) {
        var flooredValue = Math.floor(value);
        var strValue = (this.m_bIsWallet ? v_currencyformat(flooredValue, this.m_currency.name) : v_numberformat(flooredValue));

        this.m_elSliderProgress.css('width', this.m_elSliderHandle.css('left'));

        this.m_elSliderCount.text(strValue);
        this.m_elSliderCount.css('left', (parseInt(this.m_elSliderHandle.css('left')) - (this.m_elSliderCount.width() / 2) + 12) + 'px');
      },

      SetInputValuesFromSlider: function (value) {
        var flooredValue = Math.floor(value);
        var strValue = (this.m_bIsWallet ? v_currencyformat(flooredValue, this.m_currency.name) : v_numberformat(flooredValue));
        this.m_$Dialog.find('#trade_currency_input').val(strValue);
        this.UpdateRemainingCurrencyDisplay();
      },

      OnSliderSlide: function (value, bInDrag) {
        this.UpdateSliderNumberDisplays(value);

        if (bInDrag) {
          this.m_elSliderHandle.addClass('active');
        }
        else {
          this.m_elSliderHandle.removeClass('active');
        }

        this.SetInputValuesFromSlider(value);
      }
    };

    WarningDialog = {

      m_bInitialized: false,
      m_fnDocumentKeyHandler: null,

      Initialize: function () {
        $('trade_currency_dialog_warning_accept').observe('click', this.OnAccept.bindAsEventListener(this));

        this.m_bInitialized = true;
      },

      Show: function (strWarning) {

        if (!this.m_bInitialized)
          this.Initialize();

        this.m_fnDocumentKeyHandler = this.OnDocumentKeyPress.bindAsEventListener(this);
        $(document).observe('keydown', this.m_fnDocumentKeyHandler);

        $('trade_currency_dialog_warning_contents').update(strWarning);
        showModal('trade_currency_dialog_warning', true);
      },

      Dismiss: function () {
        $(document).stopObserving('keydown', this.m_fnDocumentKeyHandler);
        hideModal('trade_currency_dialog_warning');
      },

      OnAccept: function (event) {

        this.Dismiss();
        event.stop();
      },

      OnDocumentKeyPress: function (event) {
        if (event.keyCode == Event.KEY_ESC || event.keyCode == Event.KEY_RETURN) {
          this.OnAccept();
        }
      }
    };

    CurrencyConversionDialog = {

      m_bInitialized: false,
      m_currency: null,
      m_fnDocumentKeyHandler: null,
      m_slider: null,
      m_elSliderHandle: null,
      m_elSliderProgress: null,
      m_elSliderCount: null,
      m_bIgnoreSlider: false,
      m_bIgnoreConversion: false,
      m_bIsWallet: false,

      Initialize: function () {
        $('trade_currency_dialog_conversion_accept').observe('click', this.OnAccept.bindAsEventListener(this));
        $('trade_currency_dialog_conversion_cancel').observe('click', this.OnCancel.bindAsEventListener(this));
        $('trade_currency_conversion_input_you').observe('keypress', this.OnInputKeyPress.bindAsEventListener(this));
        $('trade_currency_conversion_input_you').observe('keyup', this.OnInputKeyUp.bindAsEventListener(this));
        $('trade_currency_conversion_input_them').observe('keypress', this.OnInputKeyPress.bindAsEventListener(this));
        $('trade_currency_conversion_input_them').observe('keyup', this.OnOtherCurrencyInputKeyUp.bindAsEventListener(this));

        $('trade_currency_dialog_conversion').style.visibility = 'hidden';
        $('trade_currency_dialog_conversion').show();

        this.m_elSliderHandle = $('trade_currency_conversion_slider').down('.handle');
        this.m_slider = new Control.Slider(this.m_elSliderHandle, $('trade_currency_conversion_slider'), {
          range: $R(0, 1),
          sliderValue: 0,
          onSlide: this.OnSliderSlide.bind(this),
          onChange: this.OnSliderChange.bind(this)
        });
        this.m_elSliderProgress = $('trade_currency_conversion_slider_ctn').down('.slider_progress');
        this.m_elSliderCount = $('trade_currency_conversion_slider_count');
        $('trade_currency_dialog_conversion').hide();
        $('trade_currency_dialog_conversion').style.visibility = '';
        this.m_bInitialized = true;
      },

      Show: function (currency) {

        if (!this.m_bInitialized)
          this.Initialize();

        this.m_currency = currency;

        var stack = currency.trade_stack;
        var amount = stack && stack.amount > 0 ? stack.amount : 1;

        $('trade_currency_conversion_input_you').value = amount;

        $('trade_currency_conversion_input_you').style.color = currency.name_color ? '#' + currency.name_color : '';
        $('trade_currency_conversion_input_them').style.color = currency.name_color ? '#' + currency.name_color : '';
        $('trade_currency_dialog_conversion_remaining').style.color = currency.name_color ? '#' + currency.name_color : '';
        $('trade_currency_dialog_conversion_currencyname1').style.color = currency.name_color ? '#' + currency.name_color : '';
        $('trade_currency_dialog_conversion_currencyname2').style.color = currency.name_color ? '#' + currency.name_color : '';

        $('trade_currency_dialog_conversion_currencyname1').update(currency.name.escapeHTML());
        $('trade_currency_dialog_conversion_username1').update(g_strTradePartnerPersonaName);
        $('trade_currency_dialog_conversion_currencyname2').update(GetCurrencyCode(g_rgWalletInfo['wallet_other_currency']));
        $('trade_currency_dialog_conversion_username2').update(g_strTradePartnerPersonaName);

        $('trade_currency_dialog_conversion_error').update('');

        this.m_fnDocumentKeyHandler = this.OnDocumentKeyPress.bindAsEventListener(this);
        $(document).observe('keydown', this.m_fnDocumentKeyHandler);

        var maximum = this.m_currency.original_amount;
        if (g_rgWalletInfo['wallet_fee']) {
          $('trade_currency_conversion_fee_amount_percent').update((g_rgWalletInfo['wallet_fee_percent'] * 100).toFixed(1));
          var feeInfo = CalculateFeeAmount(maximum);
          maximum = maximum - feeInfo.fees;
        }

        this.m_slider.range = $R(0, maximum);
        this.m_slider.maximum = this.m_currency.original_amount;
        this.m_slider.setValue(amount);

        this.UpdateRemainingCurrencyDisplay();

        showModal('trade_currency_dialog_conversion', true);
        $('trade_currency_conversion_input_you').focus();
      },

      UpdateRemainingCurrencyDisplay: function () {
        var inputValue = this.GetInputValueAsInt();
        var nAmount = inputValue;

        // If we're taking a fee, nAmount must be equal to the amount deducted from the sender's wallet.
        if (g_rgWalletInfo['wallet_fee']) {
          if (inputValue > 0) {
            var feeInfo = CalculateAmountToSendForDesiredReceivedAmount(nAmount);
            $('trade_currency_conversion_fee_amount_dollars').update(v_currencyformat(feeInfo.fees, this.m_currency.name.escapeHTML()));
          }
          else {
            $('trade_currency_conversion_fee_amount_dollars').update(v_currencyformat(0, this.m_currency.name.escapeHTML()));
          }

          $('trade_currency_conversion_fee_total_dollars').update(v_currencyformat(nAmount, this.m_currency.name.escapeHTML()));
        }

        var nDisplayAmount = this.m_currency.original_amount;
        if (nAmount <= this.m_currency.original_amount)
          nDisplayAmount = this.m_currency.original_amount - nAmount;

        $('trade_currency_dialog_conversion_remaining_display').update(v_currencyformat(nDisplayAmount, this.m_currency.name.escapeHTML()));
      },

      DisplayError: function (error) {
        $('trade_currency_dialog_conversion_error').update(error);
        $('trade_currency_dialog_conversion_error').style.color = '#ffffff';
        new Effect.Morph($('trade_currency_dialog_conversion_error'), { style: { color: '#ff0000' }, duration: 0.25 });
      },

      Dismiss: function () {
        $(document).stopObserving('keydown', this.m_fnDocumentKeyHandler);
        hideModal('trade_currency_dialog_conversion');
      },

      GetInputValueAsInt: function () {
        return GetPriceValueAsInt($('trade_currency_conversion_input_you').value);
      },

      OnAccept: function (event) {

        var inputValue = $('trade_currency_conversion_input_you').value.replace(GetCurrencySymbol(this.m_currency.name), '').replace('.--', '.00');
        var theirInputValue = $('trade_currency_conversion_input_them').value.replace(GetCurrencySymbol(GetCurrencyCode(g_rgWalletInfo['wallet_other_currency'])), '').replace('.--', '.00');
        var theirInputValueAsFloat = parseFloat(theirInputValue) * 100;
        var theirInputValueAsInt = GetPriceValueAsInt($('trade_currency_conversion_input_them').value);
        if (!inputValue.match(/^[0-9,.]*$/)) {
          this.DisplayError('Please enter a valid amount above.');
          return;
        }

        var strWarning, bHadWarning;
        var xferAmount = this.GetInputValueAsInt();
        if (theirInputValue.match(/^[0-9,.]*$/) && ConvertToTheirCurrency(xferAmount) != theirInputValueAsInt) {
          bHadWarning = true;
          strWarning = 'Due to currency conversion, you cannot send %1$s to %2$s. The amount being sent has been changed to %3$s and %4$s will receive %5$s.'
            .replace('%1$s', v_currencyformat(theirInputValueAsInt, GetCurrencyCode(g_rgWalletInfo['wallet_other_currency'])))
            .replace('%2$s', g_strTradePartnerPersonaName)
            .replace('%3$s', v_currencyformat(xferAmount, this.m_currency.name.escapeHTML()))
            .replace('%4$s', g_strTradePartnerPersonaName)
            .replace('%5$s', v_currencyformat(ConvertToTheirCurrency(xferAmount), GetCurrencyCode(g_rgWalletInfo['wallet_other_currency'])));
        }


        var feeInfo = CalculateAmountToSendForDesiredReceivedAmount(xferAmount);
        xferAmount = feeInfo.amount;

        if (bHadWarning && g_rgWalletInfo['wallet_fee']) {
          strWarning += ' After the transaction fee, you will be charged %1$s.'
            .replace('%1$s', v_currencyformat(xferAmount, this.m_currency.name.escapeHTML()));
        }

        if (xferAmount > this.m_currency.original_amount) {
          this.DisplayError('You do not have enough ' + this.m_currency.name.escapeHTML() + '.');
          return;
        }

        SetStackableItemInTrade(this.m_currency, xferAmount);

        this.Dismiss();
        event.stop();

        if (bHadWarning) {
          WarningDialog.Show(strWarning);
        }
      },

      OnCancel: function (event) {
        this.Dismiss();
        event.stop();
      },

      OnDocumentKeyPress: function (event) {
        if (event.keyCode == Event.KEY_ESC) {
          this.Dismiss();
          event.stop();
        }
      },

      OnInputKeyPress: function (event) {
        if (event.keyCode == Event.KEY_RETURN) {
          this.OnAccept(event);
        }
      },

      OnInputKeyUp: function (event) {

        var value = this.GetInputValueAsInt();

        this.UpdateRemainingCurrencyDisplay();

        this.m_bIgnoreSlider = true;
        this.m_slider.setValue(value);
        this.m_bIgnoreSlider = false;
        this.UpdateSliderNumberDisplays(value);
      },

      OnOtherCurrencyInputKeyUp: function (event) {

        // Convert the other currency back to our currency.
        var strAmount = $('trade_currency_conversion_input_them').value;
        var nAmount = ConvertToOurCurrency(GetPriceValueAsInt(strAmount));
        $('trade_currency_conversion_input_you').value = v_currencyformat(nAmount, this.m_currency.name.escapeHTML());

        this.m_bIgnoreConversion = true;
        this.OnInputKeyUp(event);
        this.m_bIgnoreConversion = false;
      },

      UpdateSliderNumberDisplays: function (value) {
        var flooredValue = Math.floor(value);
        var strValue = v_currencyformat(flooredValue, this.m_currency.name);

        this.m_elSliderProgress.style.width = this.m_slider.handles[0].style.left;

        this.m_elSliderCount.style.left = (parseInt(this.m_slider.handles[0].style.left) - 40) + 'px';
        this.m_elSliderCount.update(strValue.escapeHTML());

        if (!this.m_bIgnoreConversion) {
          var nAmount = ConvertToTheirCurrency(flooredValue);
          $('trade_currency_conversion_input_them').value = v_currencyformat(nAmount, GetCurrencyCode(g_rgWalletInfo['wallet_other_currency']));
        }
      },

      SetInputValuesFromSlider: function (value) {
        var flooredValue = Math.floor(value);
        var strValue = v_currencyformat(flooredValue, this.m_currency.name);
        $('trade_currency_conversion_input_you').value = strValue.escapeHTML();
        this.UpdateRemainingCurrencyDisplay();
      },

      OnSliderSlide: function (value) {
        this.UpdateSliderNumberDisplays(value);
        if (this.m_slider.active && !this.m_elSliderHandle.active) {
          this.m_elSliderHandle.active = true;
          this.m_elSliderHandle.addClassName('active');
        }

        if (this.m_bIgnoreSlider)
          return;

        this.SetInputValuesFromSlider(value);
      },

      OnSliderChange: function (value) {
        if (this.m_elSliderHandle.active) {
          this.m_elSliderHandle.active = false;
          this.m_elSliderHandle.removeClassName('active');
        }

        if (this.m_bIgnoreSlider)
          return;
        this.m_bIgnoreSlider = true;

        this.UpdateSliderNumberDisplays(value);
        this.m_slider.setValue(value);

        this.SetInputValuesFromSlider(value);

        this.m_bIgnoreSlider = false;
      }
    };

    function GetTradeItemStack(user, item) {
      var stack = item.trade_stack;
      if (!stack) {

        // build a virtual currency element that will represent the currency in the trade
        stack = Object.clone(item);
        stack.amount = 0;
        stack.fee = 0;
        stack.parent_item = item;
        stack.owner = user;
        var Inventory = user.getInventory(item.appid, item.contextid);
        var elStack = Inventory.BuildItemElement(stack);

        if (typeof (elStack.drag_image) != 'undefined') {
          if (elStack.lazyload_image) {
            elStack.lazyload_image = elStack.drag_image;
            delete elStack.drag_image;
          }
          else {
            // The image may have already been created (trade partner inventory)
            var elImage = elStack.select('img');
            if (elImage) {
              elStack.drag_reset_image = elImage[0].src;
              elImage[0].src = elStack.drag_image;
            }
          }
        }

        Inventory.LoadItemImage(elStack);

        elStack.id = 'tradestack_' + stack.id;
        stack.element = elStack;
        stack.homeElement = null;

        // for currency, we make a unique slot for this element right now
        if (item.is_currency) {
          var elSlot = CreateCurrencyTradeSlot(user == UserYou, item);
          PutItemInSlot(elStack, elSlot);

          elSlot.stack = stack;
        }

        if (user == UserYou) {
          MakeCurrencyDraggable(elStack);
          elStack.observe('click', OnCurrencyInTradeClick.bind(null, item));
        }

        item.trade_stack = stack;
      }
      return stack;
    }

    function UpdateTradeItemStackDisplay(item, stack, amount) {
      if (amount != parseInt(stack.amount) + parseInt(stack.fee)) {
        item.amount = item.original_amount - amount;
        stack.amount = amount;
        stack.fee = 0;
        if (CurrencyIsWalletFunds(stack) && g_rgWalletInfo['wallet_fee'] && stack.amount > 0) {
          var feeInfo = CalculateFeeAmount(stack.amount);
          stack.fee = feeInfo.fees;
          if (stack.fee > 0 && stack.owner == UserYou) {
            // Fake some descriptions so that we can display fee information.
            stack.descriptions = [
              {
                value: '+%1$s Steam transaction fee (%2$s%%)'
                  .replace('%1$s', v_currencyformat(stack.fee, stack.name.escapeHTML()))
                  .replace('%2$s', (g_rgWalletInfo['wallet_fee_percent'] * 100).toFixed(1))
                  .replace('%%', '%')
              },
              {
                value: '%1$s Total cost to you'
                  .replace('%1$s', v_currencyformat(stack.amount, stack.name.escapeHTML()))
              }
            ];

            var elDescriptors = $('hover_item_descriptors');
            PopulateDescriptions(elDescriptors, item.descriptions);
          }

          stack.amount -= stack.fee;
        }

        UpdateCurrencyDisplay(item);
        UpdateCurrencyDisplay(stack);
      }
    }

    function OnCurrencyInTradeClick(currency) {
      if (!g_bInDrag) {
        PresentCurrencyDialog(currency);
      }
    }

    function OnChatKeypress(event) {
      // try not to catch any browser shortcuts
      if (event.shiftKey)
        return;

      var keynum = event.which || event.keyCode;

      if (keynum == Event.KEY_RETURN) {
        DoChat();
        event.stop();
      }
    }

    function OnChatKeyup(event) {
      var elChatText = $('chat_text_entry');

      UpdateSendChatBtnState();

    }

    function UpdateSendChatBtnState() {
      var elChatText = $('chat_text_entry');
      if (elChatText && elChatText.value && v_trim(elChatText.value).length > 0)
        $('chat_send_btn').addClassName('active');
      else
        $('chat_send_btn').removeClassName('active');
    }

    function OnChatUpdate() {
      UpdateSendChatBtnState.defer();
    }

    function DoChat() {
      var elChatText = $('chat_text_entry');
      if (elChatText && elChatText.value && v_trim(elChatText.value).length > 0) {
        SendChatMsg(elChatText.value);
      }
      elChatText.value = '';
      UpdateSendChatBtnState();
    }

    function SendChatMsg(strMessage) {
      // send chat message will respond with the latest trade status (which should include the new message in the chat log)
      CancelTradeStatusPoll();
      new Ajax.Request('https://steamcommunity.com/trade/' + g_ulTradePartnerSteamID + '/chat/', {
        method: 'post',
        parameters: {
          sessionid: g_sessionID,
          message: strMessage,
          logpos: g_iNextLogPos,
          version: g_rgLastFullTradeStatus.version
        },
        onSuccess: OnTradeStatusUpdate,
        onFailure: OnTradeStatusFailure
      });
    }

    /*
      item filtering
     */

    function TransferFocusToChat(event) {
      if (event.keyCode == 116) {
        StopWatchingForUnload();
        return;
      }

      if (document.activeElement.tagName == "TEXTAREA" || (document.activeElement.tagName == "INPUT" && document.activeElement.type == "text"))
        return;

      // try not to catch any browser shortcuts
      if (event.altKey || event.ctrlKey || event.metaKey)
        return;

      var c = null;
      if (event.charCode)
        c = event.charCode;
      else
        c = event.keyCode;
      if (c >= 65 && c <= 90 || c >= 48 && c <= 57 || c >= 97 && c <= 122) {
        // this doesn't work outside of chrome, firefox has lost the keystroke by the time the control
        //		gets focus
        $('chat_text_entry').focus();
      }
    }

    function CTutorial(MAX_STEPS) {
      this.bActive = false;
      this.iStep = 1;
      this.MAX_STEPS = MAX_STEPS;
    }

    CTutorial.prototype.Init = function () {
      this.bActive = true;
      this.UpdateStepDisplay();
    };

    CTutorial.prototype.UpdateStepDisplay = function () {
      for (var i = 1; i <= this.MAX_STEPS; i++) {
        var elArrow = $('tutorial_arrow_step' + i);
        var elStep = $('tutorial_message_step' + i);
        if (elArrow) {
          if (this.bActive && i == this.iStep) {
            elArrow.show();
            $(elArrow.parentNode).addClassName('activeArrow');
          }
          else {
            elArrow.hide();
            $(elArrow.parentNode).removeClassName('activeArrow');
          }
        }

        if (elStep) {
          if (i == this.iStep)
            elStep.show();
          else
            elStep.hide();
        }
      }
    };

    CTutorial.prototype.AdvanceToStep = function (step) {
      if (this.bActive && this.iStep < step) {
        this.iStep = step;
        this.UpdateStepDisplay();
      }
    };


    CTutorial.prototype.EndTutorial = function () {
      var elHeaderMessage = $('tutorial_header_message');
      if (elHeaderMessage && elHeaderMessage.visible()) {
        new Effect.BlindUp(elHeaderMessage, { duration: 0.25 });
      }
      this.bActive = false;
      // update step display will hide all step arrows when active is false
      this.UpdateStepDisplay();
      this.OnCompletedTutorial();
    };

    CTutorial.prototype.OnCompletedTutorial = function () {
      //SetCookie( 'bCompletedTradeTutorial', 'true', 365 * 10, g_bTradeOffer ? '/tradeoffer/' : '/trade/' );
    };


    CTutorial.prototype.OnSelectedNonEmptyInventory = function (user) {

    };

    CTutorial.prototype.OnUserAddedItemsToTrade = function (cMyItems, cTheirItems) {

    };

    CTutorial.prototype.OnUserIsReady = function () {

    };

    function CTradeTutorial() {
      CTutorial.apply(this, [4]);
    }
    CTradeTutorial.prototype = new CTutorial;
    CTradeTutorial.prototype.constructor = CTradeTutorial;

    CTradeTutorial.prototype.OnSelectedNonEmptyInventory = function (user) {
      this.AdvanceToStep(2);
    };

    CTradeTutorial.prototype.OnUserAddedItemsToTrade = function (cMyItems, cTheirItems) {
      if (cMyItems > 0)
        this.AdvanceToStep(3);
    };

    CTradeTutorial.prototype.OnUserIsReady = function () {
      this.AdvanceToStep(4);
    };

    CTradeTutorial.prototype.OnCompletedTutorial = function () {
      SetCookie('bCompletedTradeTutorial', 'true', 365 * 10, g_bTradeOffer ? '/tradeoffer/' : '/trade/');
    };

    function SeenSteamGuardWarning() {
      var elHeaderMessage = $('steamguard_header_message');
      if (elHeaderMessage && elHeaderMessage.visible()) {
        new Effect.BlindUp(elHeaderMessage, { duration: 0.25 });
      }

      SetCookie('bSeenSteamGuardWarning', 'true', 365 * 10, g_bTradeOffer ? '/tradeoffer/' : '/trade/');
    }

    function SizeWindow() {
      if (!Prototype.Browser.WebKit) {
        return;
      }

      var flSetZoom = '';

      if (!Economy_UseResponsiveLayout()) {
        var widthZoom = document.viewport.getWidth() / 976;
        var heightZoom = document.viewport.getHeight() / Math.min($(document.body).getHeight() + 16, 1012);
        var flSetZoom = flZoom > 0.55 ? flZoom : 0.55;
        if (widthZoom <= 0.99 || heightZoom <= 0.99) {
          var flZoom = widthZoom < heightZoom ? widthZoom : heightZoom;
          flSetZoom = flZoom > 0.55 ? flZoom : 0.55;
        }
        else {
          flSetZoom = 1.0;
        }
      }

      $J('#mainContent').css('zoom', flSetZoom);
      $J('#tutorial_header_message').css('zoom', flSetZoom);

      if (!g_bTradeOffer)
        $('log').scrollTop = 10000;

      $J('#trade_recaptcha').css('zoom', flSetZoom ? (1.0 / flSetZoom) : '');
    }

    function TradingUnloaded(e) {
      if (g_bTradeCancelled || g_bTradeOffer)
        return;

      g_bTradeCancelled = true;
      var waiting = true;
      new Ajax.Request('https://steamcommunity.com/trade/' + g_ulTradePartnerSteamID + '/cancel/', {
        method: 'post',
        parameters: {
          sessionid: g_sessionID
        }
      });

      // "this is pretty wonky"
      var iters = 0;
      var start = new Date().getMilliseconds();
      while (iters < 10000000 && (new Date().getMilliseconds() - start) < 30) { iters++; }
    };

    function StopWatchingForUnload() {
      Event.stopObserving(window, 'unload', TradingUnloaded);
    }

    function RefreshTradeEscrowDisplay() {
      var bWeAreSendingItems = g_cMyItemsInTrade > 0;
      var bTheyAreSendingItems = g_cTheirItemsInTrade > 0;
      var cEscrowDays = 0;

      if (bWeAreSendingItems && bTheyAreSendingItems) {
        cEscrowDays = g_daysBothEscrow;
      }
      else if (bWeAreSendingItems) {
        cEscrowDays = g_daysMyEscrow;
      }
      else if (bTheyAreSendingItems) {
        cEscrowDays = g_daysTheirEscrow;
      }

      var $elHeader = $J('#trade_escrow_header');
      var $elNoticeNearButton = $J('#trade_escrow_notice_near_button');


      if (cEscrowDays == 0) {
        g_dateEscrowEnd = null;

        if ($elHeader.is(":visible")) {
          $elHeader.slideUp();
        }

        if ($elNoticeNearButton.is(":visible")) {
          $elNoticeNearButton.slideUp();
        }
      }
      else {
        g_dateEscrowEnd = new Date(Date.now() + (cEscrowDays * 86400 * 1000));

        $J('#trade_escrow_hours').text((cEscrowDays) + ((cEscrowDays != 1) ? ' days' : ' day'));
        $J('#trade_escrow_hours2').text((cEscrowDays) + ((cEscrowDays != 1) ? ' days' : ' day'));

        if (bWeAreSendingItems && g_daysMyEscrow != 0) {
          $J('#trade_escrow_for_me').show();
        }
        else {
          $J('#trade_escrow_for_me').hide();
        }

        if (bTheyAreSendingItems && g_daysTheirEscrow != 0) {
          $J('#trade_escrow_for_them').show();
        }
        else {
          $J('#trade_escrow_for_them').hide();
        }

        if (!$elHeader.is(":visible")) {
          $elHeader.slideDown();
        }

        if (!$elNoticeNearButton.is(":visible")) {
          $elNoticeNearButton.slideDown();
        }
      }
    }


  </script>
  <script>


    function BeginTradeOffer(nTradeOfferID, bShowTutorial) {
      g_bTradeOffer = true;

      // have the TradeOfferStateManager handle all trade updates
      GTradeStateManager = CTradeOfferStateManager;
      GTradeStateManager.InitCaptcha();
      Tutorial = new CTradeOfferTutorial();


      // set up the textarea for the note and events to advance tutorial when note is added
      if ($('trade_offer_note')) {
        new CAutoSizingTextArea($('trade_offer_note'), 82);
        var fnCheckNote = function () {
          if (this.value.length > 0)
            Tutorial.OnUserEnteredNote();
        };
        $J('#trade_offer_note').on('change keyup', fnCheckNote);
        $J('#trade_offer_note').on('keypress', function (event) { if (event.which == 13) return false; else return true; });
      }

      if (nTradeOfferID) {
        // viewing an existing trade offer
        g_bReadOnly = true;
        GTradeStateManager.m_eTradeOfferState = CTradeOfferStateManager.TRADE_OFFER_STATE_VIEW;
        GTradeStateManager.m_nTradeOfferID = nTradeOfferID;


        $('you_notready').addClassName('short');
        $('you_ready').addClassName('short');

        $('tradeoffer_addmessage') && $('tradeoffer_addmessage').hide();
      }

      BeginTrading(bShowTutorial);

      RefreshTradeStatus(g_rgCurrentTradeStatus);

      UpdateDisplayForActiveUser();
    }

    function GetOptionsDivForActiveUser() {
      if (g_ActiveUser == UserThem) {
        return 'appselect_them_options';
      }

      return 'appselect_you_options';
    }

    $J(function () {
      g_ActiveUser = UserYou;


      $J('#inventory_select_your_inventory').click(function (event) {
        if (g_ActiveInventory && g_ActiveInventory.appid && UserYou.GetContext(g_ActiveInventory.appid, g_ActiveInventory.contextid))
          TradePageSelectInventory(UserYou, g_ActiveInventory.appid, g_ActiveInventory.contextid, g_ActiveUser != UserYou /* force when flipping */);
        else {
          g_ActiveUser = UserYou;
          TradePageSelectNoInventory(g_ActiveUser);
        }
        $J('#inventory_box').removeClass('their_inventory_active').addClass('your_inventory_active');

        UpdateDisplayForActiveUser();

        return false;
      });

      $J('#inventory_select_their_inventory').click(function (event) {
        if (g_ActiveInventory && g_ActiveInventory.appid && UserThem.GetContext(g_ActiveInventory.appid, g_ActiveInventory.contextid))
          TradePageSelectInventory(UserThem, g_ActiveInventory.appid, g_ActiveInventory.contextid, g_ActiveUser != UserThem /* force if flipping */);
        else {
          g_ActiveUser = UserThem;
          TradePageSelectNoInventory(g_ActiveUser);
        }
        $J('#inventory_box').removeClass('your_inventory_active').addClass('their_inventory_active');

        UpdateDisplayForActiveUser();

        return false;
      });
    });

    function UpdateDisplayForActiveUser() {
      HideMenu($('appselect'), $('appselect_you_options'));
      HideMenu($('appselect'), $('appselect_them_options'));

      var active = (g_ActiveUser == UserYou ? 'your' : 'their');
      var inactive = (g_ActiveUser == UserYou ? 'their' : 'your');

      $J('#inventory_select_' + active + '_inventory').addClass('active');
      $J('#inventory_select_' + inactive + '_inventory').removeClass('active');

      if (g_ActiveUser == UserYou) {
        $J('#trade_area > .trade_box_bgheader').addClass('active');
        $J('#trade_items_separator').css('visibility', 'visible');
        $J('#trade_theirs_active').hide();
      }
      else {
        $J('#trade_area > .trade_box_bgheader').removeClass('active');
        $J('#trade_items_separator').css('visibility', 'hidden');
        $J('#trade_theirs_active').show();
      }
    }

    function ConfirmTradeOffer() {
      if (!UserYou.bReady)
        return;

      if (g_bConfirmPending)
        return;

      GTradeStateManager.ConfirmTradeOffer();
    }

    function StartCounterOffer() {
      GTradeStateManager.StartCounterOffer();
    }

    function DeclineTradeOffer() {
      if (GTradeStateManager.m_eTradeOfferState != CTradeOfferStateManager.TRADE_OFFER_STATE_VIEW || g_bConfirmPending)
        return;

      ShowConfirmDialog(
        'Decline Trade',
        'Are you sure you want to decline this trade offer?',
        'Decline Trade'
      ).done(function () {
        GTradeStateManager.DeclineTradeOffer();
      });
    }

    function DismissTradeOfferWindow() {
      var bConfirm = false;
      if ((g_cMyItemsInTrade > 0 || g_cTheirItemsInTrade > 0 || g_cCurrenciesInTrade > 0) &&
        GTradeStateManager.m_eTradeOfferState != CTradeOfferStateManager.TRADE_OFFER_STATE_VIEW) {
        var strConfirmMessage = 'Are you sure you want to cancel this trade offer?  Any changes will not be saved.';
        if (this.m_eTradeOfferState == CTradeOfferStateManager.TRADE_OFFER_STATE_COUNTEROFFER)
          strConfirmMessage = 'Are you sure you want to cancel this trade offer?' + '<br><br>' + 'Any changes will not be saved.  You will still be able to accept, decline, or counter this trade offer at a later time.';

        ShowConfirmDialog(
          'Cancel Trade Offer',
          strConfirmMessage,
          'Yes',
          'No'
        ).done(function () {
          EndTradeOffer();
        });
      }
      else {
        EndTradeOffer();
      }
    }

    function MessageWindowOpener(msg) {
      try {
        window.opener.postMessage(msg, 'https://steamcommunity.com/');
        return;
      } catch (e) { }
      try {
        window.opener.postMessage(msg, 'https://steamcommunity.com/');
      } catch (e) { }
    }

    // URL is optional and is where we'll go if this isn't a popup for some reason.
    //	if bSendOpenerToURL is true, then we will always send the window that opened the popup to that URL.
    function EndTradeOffer(url, bSendOpenerToURL) {
      // window.opener does not work in the steam client or overlay
      if (window.opener && window.opener.postMessage) {
        if (bSendOpenerToURL) {
          MessageWindowOpener({ type: 'location', url: url });
        }
        window.close();
      }
      else {
        if (!url)
          url = UserYou.GetProfileURL() + '/tradeoffers/';

        if (Steam.BIsUserInSteamClient()) {
          url = 'steam://openurl/' + url;

          // give the steam:// url time to process
          window.setTimeout(function () { window.close(); }, 1);
        }

        //overlay (or any browser where we didn't have an opener, eg direct navigation) will follow this route
        window.location = url;
      }
    }

    CTradeOfferStateManager = {

      TRADE_OFFER_STATE_NEW: 0,
      TRADE_OFFER_STATE_VIEW: 1,
      TRADE_OFFER_STATE_COUNTEROFFER: 2,

      m_nTradeOfferID: 0,
      m_eTradeOfferState: 0,	/* TRADE_OFFER_STATE_NEW */
      m_bChangesMade: false,
      m_rgTradeOfferCreateParams: {},
      m_bCaptchaReady: true,
      m_Recaptcha: null,
      m_nPollIntervalId: 0,

      SetTradeOfferCreateParams: function (rgParams) {
        $J.extend(this.m_rgTradeOfferCreateParams, rgParams);
      },

      RemoveItemFromTrade: function (item) {
        var slots = item.is_their_item ? g_rgCurrentTradeStatus.them : g_rgCurrentTradeStatus.me;

        var bChanged = false;
        for (var i = 0; i < slots.assets.length; i++) {
          var rgAsset = slots.assets[i];
          if (rgAsset.appid == item.appid && rgAsset.contextid == item.contextid && rgAsset.assetid == item.id) {
            slots.assets.splice(i, 1);
            bChanged = true;
            break;
          }
        }

        if (bChanged) {
          this.m_bChangesMade = true;
          this.UpdateTradeStatus();
        }
      },

      SetAssetOrCurrencyInTrade: function (item, xferAmount, is_currency) {
        var userslots = item.is_their_item ? g_rgCurrentTradeStatus.them : g_rgCurrentTradeStatus.me;
        var slots = is_currency ? userslots.currency : userslots.assets;

        // find existing element
        var iExistingElement = -1;
        var bChanged = false;
        for (var i = 0; i < slots.length; i++) {
          var rgSlotItem = slots[i];
          if (rgSlotItem.appid == item.appid && rgSlotItem.contextid == item.contextid &&
            ((is_currency ? rgSlotItem.currencyid : rgSlotItem.assetid) == item.id)) {
            iExistingElement = i;
            if (xferAmount == 0) {
              slots.splice(i, 1);
              bChanged = true;
            }
            break;
          }
        }

        if (xferAmount > 0) {
          if (iExistingElement != -1) {
            if (slots[iExistingElement].amount != xferAmount) {
              slots[iExistingElement].amount = xferAmount;
              bChanged = true;
            }
          }
          else {
            var oSlot = {
              appid: item.appid,
              contextid: item.contextid,
              amount: xferAmount
            };
            if (is_currency)
              oSlot.currencyid = item.id;
            else
              oSlot.assetid = item.id;

            slots.push(oSlot);
            bChanged = true;
          }
        }

        if (bChanged) {
          this.m_bChangesMade = true;
          this.UpdateTradeStatus();
        }
      },

      SetCurrencyInTrade: function (currency, xferAmount) {
        this.SetAssetOrCurrencyInTrade(currency, xferAmount, true);
      },


      SetItemInTrade: function (item, slot, xferAmount) {
        this.SetAssetOrCurrencyInTrade(item, xferAmount || 1, false);
      },

      ToggleReady: function (bReady) {
      },

      SetCaptchaReady: function (bReady) {
        if (bReady != this.m_bCaptchaReady) {
          this.m_bCaptchaReady = bReady;
          this.UpdateConfirmButtonStatus();

          if (bReady && this.m_nPollIntervalId) {
            clearInterval(this.m_nPollIntervalId);
            this.m_nPollIntervalId = 0;
          }
        }
      },

      InitCaptcha: function () {
        if ($J('#trade_confirm_captchaentry').length != 0) {
          this.m_bCaptchaReady = false;
        }
      },

      RefreshCaptcha: function () {
        if (this.m_nPollIntervalId) {
          clearInterval(this.m_nPollIntervalId);
        }

        if ($J('#trade_confirm_captchaentry').length == 0) {
          return;
        }

        if (this.m_Recaptcha == null) {
          this.m_Recaptcha = grecaptcha.render('trade_recaptcha', {
            'sitekey': '6Le6zV8UAAAAAOeG-paA00HM3xX8OGFx2lctB-A1',
            'theme': 'dark'
          });
        }
        else {
          grecaptcha.reset(this.m_Recaptcha);
        }

        this.m_bCaptchaReady = false;
        var _this = this;
        this.m_nPollIntervalId = setInterval(function () {
          var strResponse = grecaptcha.getResponse(_this.m_Recaptcha);
          if (strResponse) {
            _this.SetCaptchaReady(true);
            clearInterval(_this.m_nPollIntervalId);
            _this.m_nPollIntervalId = 0;
          }
        }, 200);
      },

      GetCaptchaResponse: function () {
        if (this.m_bCaptchaReady && $J('#trade_confirm_captchaentry').length != 0)
          return grecaptcha.getResponse(this.m_Recaptcha);
        else
          return "";
      },

      UpdateConfirmButtonStatus: function () {
        if (g_bConfirmPending) {
          $('trade_confirmbtn').hide();
          $('trade_confirm_throbber').show();
        }
        else {
          $('trade_confirmbtn').show();
          $('trade_confirm_throbber').hide();
        }

        if (this.m_eTradeOfferState == this.TRADE_OFFER_STATE_COUNTEROFFER) {
          $('trade_confirmbtn_text').update('Send Counter Offer');
        }
        else if (this.m_eTradeOfferState == this.TRADE_OFFER_STATE_VIEW) {
          $('trade_confirmbtn_text').update('Accept Trade');
        }
        else {
          $('trade_confirmbtn_text').update('Make Offer');
        }

        if (UserYou.bReady && this.m_bCaptchaReady) {
          $('trade_confirmbtn').addClassName('active');

          if (this.m_eTradeOfferState == this.TRADE_OFFER_STATE_COUNTEROFFER || this.m_eTradeOfferState == this.TRADE_OFFER_STATE_NEW) {
            $('trade_confirm_message').update('Ready to send your offer.');
          }
          else {
            $('trade_confirm_message').update('Ready to complete the trade.');
          }
        }
        else {
          $('trade_confirmbtn').removeClassName('active');

          if (UserYou.bReady && !this.m_bCaptchaReady) {
            var $CaptchaCtn = $J('#trade_confirm_captchaentry');
            if (!$CaptchaCtn.is(':visible')) {
              this.RefreshCaptcha();
              $CaptchaCtn.show();
            }

            $('trade_confirm_message').update('Waiting for you to check the box above.');
          }
          else {
            if (this.m_eTradeOfferState == this.TRADE_OFFER_STATE_COUNTEROFFER || this.m_eTradeOfferState == this.TRADE_OFFER_STATE_NEW) {
              if (g_rgCurrentTradeStatus.me.assets.length || g_rgCurrentTradeStatus.me.currency.length ||
                g_rgCurrentTradeStatus.them.assets.length || g_rgCurrentTradeStatus.them.currency.length) {
                $('trade_confirm_message').update('Waiting for you to confirm your offer.');
              }
              else {
                $('trade_confirm_message').update('Make Offer');
              }
            }
            else {
              //view
              $('trade_confirm_message').update('Waiting for you to confirm trade contents.');
            }
          }
        }
      },

      UpdateTradeStatus: function () {
        g_rgCurrentTradeStatus.version++;
        RefreshTradeStatus(g_rgCurrentTradeStatus);
      },

      StartCounterOffer: function () {
        if (this.m_eTradeOfferState == CTradeOfferStateManager.TRADE_OFFER_STATE_VIEW) {
          this.m_eTradeOfferState = CTradeOfferStateManager.TRADE_OFFER_STATE_COUNTEROFFER;
          UserYou.bReady = false;
          $('modify_trade_offer_opts').hide();
          $('you_notready').removeClassName('short');
          $('you_ready').removeClassName('short');

          $('btn_decline_trade_offer').hide();

          $('tradeoffer_includedmessage') && $('tradeoffer_includedmessage').hide();
          $('tradeoffer_addmessage') && $('tradeoffer_addmessage').show();

          DisableReadOnlyMode();	// will make items draggable again
        }
      },

      ConfirmTradeOffer: function () {
        if (!this.m_bCaptchaReady)
          return;

        g_bConfirmPending = true;
        this.UpdateConfirmButtonStatus();

        var StateManager = this;

        if (this.m_eTradeOfferState == CTradeOfferStateManager.TRADE_OFFER_STATE_NEW || this.m_eTradeOfferState == CTradeOfferStateManager.TRADE_OFFER_STATE_COUNTEROFFER) {
          if (this.m_eTradeOfferState == CTradeOfferStateManager.TRADE_OFFER_STATE_COUNTEROFFER && !this.m_bChangesMade) {
            // user has not made changes.  Prompt to just accept the offer
            ShowConfirmDialog('Send Counter Offer',
              'You have not made any changes to this counter offer.  Would you like to accept the original offer?',
              'Accept Trade'
            ).done(function () {
              // flip back to VIEW state so that this function will run the usual accept AJAX
              StateManager.m_eTradeOfferState = CTradeOfferStateManager.TRADE_OFFER_STATE_VIEW;
              var deferred = StateManager.ConfirmTradeOffer();

              // if something goes wrong with the AJAX, flip back to the COUNTEROFFER state (to match the UI)
              if (deferred)
                deferred.fail(function () {
                  StateManager.m_eTradeOfferState = CTradeOfferStateManager.TRADE_OFFER_STATE_COUNTEROFFER;
                  StateManager.UpdateConfirmButtonStatus();
                });

            }).fail(function () {
              g_bConfirmPending = false;
              StateManager.UpdateConfirmButtonStatus();
            });

            // we don't actually send the counter offer in this case.
            return null;
          }

          var rgParams = {
            sessionid: g_sessionID,
            serverid: 1, partner: g_ulTradePartnerSteamID,
            tradeoffermessage: $('trade_offer_note') ? $('trade_offer_note').value : '',
            json_tradeoffer: V_ToJSON(g_rgCurrentTradeStatus),
            captcha: CTradeOfferStateManager.GetCaptchaResponse()
          };

          if (this.m_rgTradeOfferCreateParams)
            rgParams['trade_offer_create_params'] = V_ToJSON(this.m_rgTradeOfferCreateParams);

          if (this.m_eTradeOfferState == CTradeOfferStateManager.TRADE_OFFER_STATE_NEW) {
            // remember that the user has created a new trade
            Tutorial.OnCompletedTutorial();
          }
          else if (this.m_eTradeOfferState == CTradeOfferStateManager.TRADE_OFFER_STATE_COUNTEROFFER) {
            rgParams['tradeofferid_countered'] = this.m_nTradeOfferID;
          }

          return $J.ajax(
            {
              url: 'https://steamcommunity.com/tradeoffer/new/send',
              data: rgParams,
              type: 'POST',
              crossDomain: true,
              xhrFields: { withCredentials: true }
            }
          ).done(function (data) {
            var bNeedsEmailConfirmation = data && data.needs_email_confirmation;
            var bNeedsMobileConfirmation = data && data.needs_mobile_confirmation;

            var Modal;
            if (bNeedsMobileConfirmation) {
              var strText = 'In order to send this trade offer, you must verify it in your Steam Mobile app. You can verify it by launching the app and navigating to the Confirmations page from the menu.';

              Modal = ShowAlertDialog(
                'Additional confirmation needed',
                strText + '<br><br>' +
                'If you don\'t see the Confirmations option in the main menu of the app, then make sure you have the latest version of the app.'
              );
            }
            else if (bNeedsEmailConfirmation) {
              Modal = ShowAlertDialog(
                'Additional confirmation needed',
                'In order to send this trade offer, you must complete an additional verification step.  An email has been sent to your address (ending in "%s") with additional instructions.'.replace(/%s/, data.email_domain)
              );
            }
            else
              Modal = ShowAlertDialog(
                'Trade Offer Sent',
                'Success!  Your trade offer has been sent to %s.<br><br>You can manage your outstanding trade offers from your Sent Trade Offers page.'.replace(/%s/, g_strTradePartnerPersonaName)
              );

            Modal.always(function () {
              EndTradeOffer(UserYou.GetProfileURL() + '/tradeoffers/sent/', true);
            });
          }).fail(function (jqXHR) {
            var data = $J.parseJSON(jqXHR.responseText);
            g_bConfirmPending = false;
            StateManager.RefreshCaptcha();
            StateManager.UpdateConfirmButtonStatus();
            ShowAlertDialog('Make Offer', data && data.strError ? data.strError : 'There was an error sending your trade offer.  Please try again later.');
          });
        }
        else if (this.m_eTradeOfferState == CTradeOfferStateManager.TRADE_OFFER_STATE_VIEW) {
          var nTradeOfferID = this.m_nTradeOfferID;
          var rgParams = {
            sessionid: g_sessionID,
            serverid: 1, tradeofferid: nTradeOfferID,
            partner: g_ulTradePartnerSteamID,
            captcha: CTradeOfferStateManager.GetCaptchaResponse()
          };

          return $J.ajax(
            {
              url: 'https://steamcommunity.com/tradeoffer/' + nTradeOfferID + '/accept',
              data: rgParams,
              type: 'POST',
              crossDomain: true,
              xhrFields: { withCredentials: true }
            }
          ).done(function (data) {

            var bNeedsEmailConfirmation = data && data.needs_email_confirmation;
            var bNeedsMobileConfirmation = data && data.needs_mobile_confirmation;

            if (bNeedsMobileConfirmation) {
              var strText = 'In order to complete this trade, you must verify it in your Steam Mobile app. You can verify it by launching the app and navigating to the Confirmations page from the menu.';

              Modal = ShowAlertDialog(
                'Additional confirmation needed',
                strText
              );
            }
            else if (bNeedsEmailConfirmation) {
              ShowAlertDialog(
                'Additional confirmation needed',
                'In order to complete this trade, you must complete an additional verification step.  An email has been sent to your address (ending in "%s") with additional instructions.'.replace(/%s/, data.email_domain)
              ).always(function () {
                if (window.opener)
                  window.close();
                else
                  EndTradeOffer(UserYou.GetProfileURL() + '/tradeoffers/');
              });

              if (window.opener && window.opener.postMessage) {
                MessageWindowOpener({ type: 'await_confirm', tradeofferid: nTradeOfferID });
              }
            }
            else {
              if (window.opener && window.opener.postMessage) {
                MessageWindowOpener({ type: 'accepted', tradeofferid: nTradeOfferID });
              }

              if (data.tradeid)
                window.location = 'https://steamcommunity.com/trade/' + data.tradeid + '/receipt';
              else
                EndTradeOffer(UserYou.GetProfileURL() + '/inventory/');	//?? not sure
            }
          }).fail(function (jqXHR) {
            var data = $J.parseJSON(jqXHR.responseText);
            g_bConfirmPending = false;
            StateManager.RefreshCaptcha();
            StateManager.UpdateConfirmButtonStatus();
            ShowAlertDialog('Accept Trade', data && data.strError ? data.strError : 'There was an error accepting this trade offer.  Please try again later.');
          });
        }
      },

      DeclineTradeOffer: function () {
        if (this.m_eTradeOfferState != CTradeOfferStateManager.TRADE_OFFER_STATE_VIEW || g_bConfirmPending)
          return;

        g_bConfirmPending = true;
        this.UpdateConfirmButtonStatus();
        var StateManager = this;

        var rgParams = {
          sessionid: g_sessionID
        };

        $J.ajax(
          {
            url: 'https://steamcommunity.com/tradeoffer/' + this.m_nTradeOfferID + '/decline',
            data: rgParams,
            type: 'POST',
            crossDomain: true,
            xhrFields: { withCredentials: true }
          }
        ).done(function (data) {
          EndTradeOffer();
        }).fail(function () {
          g_bConfirmPending = false;
          StateManager.UpdateConfirmButtonStatus();
          ShowAlertDialog('Decline Trade', 'There was an error modifying this trade offer.  Please try again later.');
        });
      }

    };


    function CTradeOfferTutorial() {
      CTutorial.apply(this, [5]);
    }
    CTradeOfferTutorial.prototype = new CTutorial;
    CTradeOfferTutorial.prototype.constructor = CTradeOfferTutorial;

    CTradeOfferTutorial.prototype.OnSelectedNonEmptyInventory = function (user) {

    };

    CTradeOfferTutorial.prototype.OnUserAddedItemsToTrade = function (cMyItems, cTheirItems) {
      if (cTheirItems > 0 && cMyItems > 0) {
        if ($('trade_offer_note'))
          this.AdvanceToStep(3);
        else
          this.AdvanceToStep(4);	//skip note
      }
      else if (cMyItems > 0)
        this.AdvanceToStep(2);
    };

    CTradeOfferTutorial.prototype.OnUserEnteredNote = function () {
      this.AdvanceToStep(4);
    };

    CTradeOfferTutorial.prototype.OnUserIsReady = function () {
      this.AdvanceToStep(5);
    };

    CTradeOfferTutorial.prototype.OnCompletedTutorial = function () {
      SetCookie('bCompletedTradeOfferTutorial', 'true', 365 * 10, '/tradeoffer/');
    };



  </script>
  <script>
    "use strict";

    // build our menu on init
    jQuery(function ($) {
      var mqQueryMenuMode = window.matchMedia ? window.matchMedia("(max-width: 910px)") : { matches: false };
      var mqMobileMode = window.matchMedia ? window.matchMedia("(max-width: 500px)") : { matches: false };

      var $HTML = $J('html');
      window.UseTouchFriendlyMode = function () {
        return $HTML.hasClass('responsive') && (mqQueryMenuMode.matches || $HTML.hasClass('touch'));
      };
      window.UseSmallScreenMode = function () {
        return $HTML.hasClass('responsive') && mqQueryMenuMode.matches;
      };
      window.UseMobileScreenMode = function () {
        return $HTML.hasClass('responsive') && mqMobileMode.matches;
      };
      window.UseTabletScreenMode = function () {
        return $HTML.hasClass('responsive') && $HTML.hasClass('tablet');
      };
      window.UseNewMobileAppMode = function () {
        // the new mobile app can run on screen widths wider than responsive_css_maxwidth
        return $HTML.hasClass('responsive') && $HTML.hasClass('rn_mobile_app');
      };

      // main menu

      var $Menu = $('#responsive_page_menu');
      var $Frame = $('.responsive_page_frame');
      var $ContentCtn = $('.responsive_page_content');
      var $ContentOverlay = $('.responsive_page_content_overlay');

      var fnResetMenuState = function () {
        $Frame.removeClass('mainmenu_active');
        $Frame.removeClass('localmenu_active');
        $J(document.body).removeClass('overflow_hidden');

        $ContentOverlay.off('click.ReponsiveMenuDismiss');
      };

      $J(document).on('click.OnClickDismissMenu', '.responsive_OnClickDismissMenu', fnResetMenuState);

      var strLastExpandedSubmenu = WebStorage.GetLocalSession('responsiveMenuLastSubmenu');

      var fnMakeExpandableMenuItem = function ($MenuItem, $Submenu) {
        $MenuItem.append($J('<div/>', { 'class': 'chevron' }));


        var $SubmenuWrapper = $J('<div/>', { 'class': 'menuitem_submenu_wrapper' });
        $MenuItem.after($SubmenuWrapper.append($Submenu));
        $Submenu.wrap($('<div/>', { 'class': 'inner_borders' }));

        // if this was the last used submenu, start with it expanded
        if (strLastExpandedSubmenu && strLastExpandedSubmenu == $Submenu.data('submenuid')) {
          $SubmenuWrapper.css('height', $Submenu.height() + 'px');
          $MenuItem.addClass('submenu_active');
          $SubmenuWrapper.addClass('active');
        }
        else {
          $SubmenuWrapper.css('height', 0);
        }

        $Submenu.show();

        $MenuItem.click(function (e) {
          e.preventDefault();
          if ($SubmenuWrapper.hasClass('active')) {
            $SubmenuWrapper.removeClass('active').css('height', 0);
            $MenuItem.removeClass('submenu_active');
            WebStorage.SetLocalSession('responsiveMenuLastSubmenu', null);
          }
          else {
            $SubmenuWrapper.siblings('.menuitem_submenu_wrapper.active').css('height', 0).removeClass('active');
            $MenuItem.siblings('.menuitem').removeClass('submenu_active');
            $SubmenuWrapper.css('height', $Submenu.height() + 'px');
            $MenuItem.addClass('submenu_active');
            $SubmenuWrapper.addClass('active');
            WebStorage.SetLocalSession('responsiveMenuLastSubmenu', $Submenu.data('submenuid'));
          }
        });
      };

      var fnBuildMenuEvents = function ($Menu, strMenuName, fnFirstTimeInitialization) {
        var strActiveClass = strMenuName + '_active';
        var fnGPOnClosingModalWindow = null;

        var fnDismissMenu = function () {
          $ContentCtn.off('click.ReponsiveMenuDismiss');
          $Frame.removeClass(strActiveClass);
          $J(document.body).removeClass('overflow_hidden');

          // tell gamepad navigation we're closing the menu
          if (fnGPOnClosingModalWindow) {
            fnGPOnClosingModalWindow();
            fnGPOnClosingModalWindow = null;
          }

          window.setTimeout(function () {
            if (!$Frame.hasClass('mainmenu_active') && !$Frame.hasClass('localmenu_active')) {
              fnResetMenuState();
            }
          }, 500);
        };

        var bInitialized = false;
        var fnActivateMenu = function () {
          if (!bInitialized) {
            fnFirstTimeInitialization && fnFirstTimeInitialization();
            bInitialized = true;
          }

          if ($Frame.hasClass(strActiveClass)) {
            fnDismissMenu();
          }
          else {
            $J(document.body).addClass('overflow_hidden');
            $Menu.removeClass('secondary_active');
            $Frame.addClass(strActiveClass);
            $ContentOverlay.one('click.ResponsiveMenuDismiss', function () {
              fnDismissMenu();
            });

            // tell gamepad navigation to treat this menu as a modal dialog
            if (typeof GPOnShowingModalWindow === "function")
              fnGPOnClosingModalWindow = GPOnShowingModalWindow($Menu.get(0));
          }
        };

        return { fnActivateMenu: fnActivateMenu, fnDismissMenu: fnDismissMenu };
      };

      var fnInitMainMenu = function () {
        $('.responsive_page_menu').find('.supernav').each(function () {
          var $Element = $(this);
          $Element.attr('href', '');
          var strSubmenuSelector = $Element.data('tooltip-content');
          var $Submenu = $Element.parent().find(strSubmenuSelector);
          if ($Submenu.length) {
            fnMakeExpandableMenuItem($Element, $Submenu);
          }
        });

        var $NotificationItem = $Menu.find('.notifications_item');
        var $NotificationSubmenu = $Menu.find('.notification_submenu');
        if ($NotificationItem.length && $NotificationSubmenu.length) {
          fnMakeExpandableMenuItem($NotificationItem, $NotificationSubmenu);
        }
        Responsive_BuildChangeLanguageOption($Menu.find('.change_language_action'));
      };

      var MainMenuEvents = null;
      if ($Menu.length) {
        MainMenuEvents = fnBuildMenuEvents($Menu, 'mainmenu', fnInitMainMenu);


        $('#responsive_menu_logo').click(function (e) {
          MainMenuEvents.fnActivateMenu();
        });
      }


      // local (page-specific) menu

      var $LocalMenuContent = $('.responsive_local_menu');
      var $LocalMenu = null;
      var LocalMenuEvents = null;
      if ($LocalMenuContent.length) {
        var bLocalMenuEnabed = false;
        var rgMenuContents = [];

        var fnInitLocalMenu = function () {
          if (rgMenuContents.length)
            return;

          for (var i = 0; i < $LocalMenuContent.length; i++) {
            var $LocalMenuElement = $($LocalMenuContent[i]).wrap($J('<div/>', { 'class': 'responsive_local_menu_placeholder' }));
            var $LocalMenuWrapper = $($LocalMenuContent[i]).parent();
            rgMenuContents.push({
              wrapper: $LocalMenuWrapper,
              content: $LocalMenuElement
            });
          }
        };

        $LocalMenu = $J('#responsive_page_local_menu');
        var $Affordance = $J('.responsive_local_menu_tab');

        LocalMenuEvents = fnBuildMenuEvents($LocalMenu, 'localmenu');

        $Affordance.click(function (e) {
          LocalMenuEvents.fnActivateMenu();
        });

        g_fnActivateLocalMenu = LocalMenuEvents.fnActivateMenu;

        $(window).on('Responsive_SmallScreenModeToggled.ReponsiveLocalMenu', function () {
          var bShouldUseResponsiveMenu = UseSmallScreenMode();
          if (bLocalMenuEnabed != bShouldUseResponsiveMenu) {
            if (bShouldUseResponsiveMenu) {
              $Affordance.addClass('active');
              fnInitLocalMenu();
              $LocalMenu.find('.localmenu_content').append($LocalMenuContent);
            }
            else {
              fnResetMenuState();
              $Affordance.removeClass('active');
              for (var i = 0; i < rgMenuContents.length; i++) {
                rgMenuContents[i].wrapper.append(rgMenuContents[i].content);
              }
            }
            bLocalMenuEnabed = bShouldUseResponsiveMenu;
          }
        }).trigger('Responsive_SmallScreenModeToggled.ReponsiveLocalMenu');

        // menu is available, so set the action description for the page content.
        GPNavUpdateActionDescriptions($('#responsive_page_template_content'), { onOptionsActionDescription: 'Menu' });
        $('#responsive_page_template_content').on('vgp_onoptions', function () { LocalMenuEvents.fnActivateMenu(); });
      }

      Responsive_InitMenuSwipes($, $Menu, $LocalMenu, MainMenuEvents, LocalMenuEvents);

      Responsive_InitFixOnScroll($);

      Responsive_InitTouchDetection($);

      Responsive_InitTabSelect($);

      Responsive_InitResponsiveToggleEvents($);

      Responsive_InitJQPlotHooks($);

      if (window.UseTabletScreenMode && window.UseTabletScreenMode())
        Responsive_InitForTablet($);
    });

    function Responsive_InitForTablet($) {
      // support using gamepad to change slider position
      $('input[type=range]').on('vgp_ondirection', function (event) {

        if (event.originalEvent.detail.button == 11 || event.originalEvent.detail.button == 12) {
          if (event.originalEvent.detail.button == 11) // EGamepadButton.DIR_LEFT
            this.stepDown();
          else if (event.originalEvent.detail.button == 12) // EGamepadButton.DIR_RIGHT
            this.stepUp();

          $(this).trigger('input').trigger('change');

          return false; // prevent the message from propagating
        }
      });
    }

    function Responsive_InitMenuSwipes($, $Menu, $LocalMenu, MainMenuEvents, LocalMenuEvents) {
      if (!MainMenuEvents && !LocalMenuEvents)
        return;

      var $Frame = $('.responsive_page_frame');
      // set up touch drag events
      var bInMainMenuDrag = false;
      var bInLocalMenuDrag = false;
      var bInDismissMenuDrag = false;
      var bLooksLikeSwipe = false;
      var nDragMenuWidth = 0;

      var nCurDragOffset = 0;
      var nTouchStartPageX = 0;	// page/CSS coordinates because that's how we measure the menu width
      var nTouchStartPageY = 0;

      var fnGetSingleTouch = function (e) {
        var TouchEvent = e.originalEvent;
        var rgTouches = TouchEvent ? TouchEvent.touches : null;
        if (!rgTouches || rgTouches.length != 1)
          return null;
        return rgTouches[0];
      };
      var fnCancelDrag = function () {
        $Frame.removeClass('in_menu_drag');
        if (bLooksLikeSwipe) {
          var DragMenuEvents = bInMainMenuDrag ? MainMenuEvents : LocalMenuEvents;
          var $DragMenu = bInMainMenuDrag ? $Menu : $LocalMenu;
          $DragMenu.parents('.responsive_page_menu_ctn').css('left', '').css('right', '');
          if ((!bInDismissMenuDrag && nCurDragOffset < nDragMenuWidth / 2) ||
            (bInDismissMenuDrag && nCurDragOffset > nDragMenuWidth / 2)) {
            DragMenuEvents.fnDismissMenu();
          }
        }

        bInLocalMenuDrag = bInMainMenuDrag = bLooksLikeSwipe = bInDismissMenuDrag = false;
      };
      $(window).on('touchstart.ResponsiveMenuActivate', function (e) {
        if (!UseSmallScreenMode())
          return;

        var Touch = fnGetSingleTouch(e);
        if (!Touch)
          return;

        if ($Frame.hasClass('mainmenu_active')) {
          if (Touch.clientX > $Menu.width() * 0.9) {
            bInMainMenuDrag = true;
            bInDismissMenuDrag = true;
          }
        }
        else if ($Frame.hasClass('localmenu_active')) {
          if (Touch.clientX < (window.innerWidth - $LocalMenu.width() * 0.9)) {
            bInLocalMenuDrag = true;
            bInDismissMenuDrag = true;
          }
        }
        else {
          var nClientXAsPct = 100 * Touch.clientX / window.innerWidth;
          bInDismissMenuDrag = false;
          if (nClientXAsPct > 93 && LocalMenuEvents)
            bInLocalMenuDrag = true;
          else if (nClientXAsPct < 7 && MainMenuEvents)
            bInMainMenuDrag = true;
        }

        if (bInLocalMenuDrag || bInMainMenuDrag) {
          bLooksLikeSwipe = false;
          nTouchStartPageX = Touch.pageX;
          nTouchStartPageY = Touch.pageY;
        }
      });
      $(window).on('touchmove.ResponsiveMenuActive', function (e) {
        if (!bInLocalMenuDrag && !bInMainMenuDrag)
          return;

        var Touch = fnGetSingleTouch(e);
        if (!Touch)
          return;
        var nDeltaPageX = Touch.pageX - nTouchStartPageX;
        var nDeltaPageY = Touch.pageY - nTouchStartPageY;

        if ((bInLocalMenuDrag && !bInDismissMenuDrag) || (bInMainMenuDrag && bInDismissMenuDrag))
          nDeltaPageX = -nDeltaPageX;

        var DragMenuEvents = bInMainMenuDrag ? MainMenuEvents : LocalMenuEvents;
        var $DragMenu = bInMainMenuDrag ? $Menu : $LocalMenu;

        if (!bLooksLikeSwipe && nDeltaPageX > 25 && nDeltaPageX > nDeltaPageY * 2) {
          // horizontal drag
          $Frame.addClass('in_menu_drag');
          if (!bInDismissMenuDrag)
            DragMenuEvents.fnActivateMenu();
          //$Frame.addClass( bInLocalMenuDrag ? 'localmenu_active' : 'mainmenu_active' );
          nDragMenuWidth = $DragMenu.width();
          bLooksLikeSwipe = true;
        }
        else if (nDeltaPageY > 2 * nDeltaPageX) {
          // looks like scrolling?
          fnCancelDrag();
          return;
        }


        if (bLooksLikeSwipe) {
          nCurDragOffset = Math.max(Math.min(nDeltaPageX, nDragMenuWidth), 0);

          var nOffset = bInDismissMenuDrag ? -nCurDragOffset : -(nDragMenuWidth - nCurDragOffset);

          $DragMenu.parents('.responsive_page_menu_ctn').css(bInLocalMenuDrag ? 'right' : 'left', nOffset + 'px');
        }
      });
      $(window).on('touchend.ResponsiveMenuActivate touchcancel.ResponsiveMenuActivate', function (e) {
        fnCancelDrag();
      });
    }

    function Responsive_InitTouchDetection($) {
      var $HTML = $J('html');
      if (!$HTML.hasClass('touch') && $HTML.hasClass('responsive')) {
        $J(window).one('touchstart', function () {
          // user is on a touch device - enable touch-friendly accessors and
          // remember for the rest of this session

          $HTML.addClass('touch');
          V_SetCookie("strResponsiveViewPrefs", 'touch', 0);
        });
      }
    }

    function Responsive_InitTabSelect($) {
      // handle any tab dropdowns
      $J(document).on('change.ResponsiveTabSelect', 'select.responsive_tab_select', function () {
        var url = $J(this).val();
        if (url != window.location)
          window.location = url;
      });
    }

    function Responsive_InitFixOnScroll($) {
      var $Ctn = $J('.responsive_fixonscroll_ctn');
      var $Elements = $J('.responsive_fixonscroll');
      if ($Elements.length) {
        var nCtnTop = -1;
        var nCtnHeight = 0;

        $J(window).on('scroll.ResponsiveFixOnScroll resize.ResponsiveFixOnScroll', function () {
          var nHeaderOffset = GetResponsiveHeaderFixedOffsetAdjustment();
          var nScrollTop = $J(window).scrollTop() + nHeaderOffset + nCtnHeight;

          if (nHeaderOffset != nCtnTop) {
            nCtnTop = nHeaderOffset;
            $Ctn.css('top', nCtnTop + 'px');
          }
          $Elements.each(function () {
            var $Element = $J(this);
            if (!$Element.is(':visible')) {
              if ($Element.hasClass('in_fixed_ctn') && $Element.data('originalContents')) {
                $Element.append($Element.data('originalContents'));
                $Element.removeClass('in_fixed_ctn');
                $Element.css('height', '');
                nCtnHeight = $Ctn.height();
              }
              return;
            }

            var nElementTop = $Element.offset().top;
            if (nElementTop > nScrollTop) {
              if ($Element.hasClass('in_fixed_ctn')) {
                $Element.append($Element.data('originalContents'));
                $Element.removeClass('in_fixed_ctn');
                $Element.css('height', '');
                nCtnHeight = $Ctn.height();
              }
            }
            else {
              if (!$Element.hasClass('in_fixed_ctn')) {
                $Element.css('height', $Element.height() + 'px');
                $Element.data('originalContents', $Element.children());
                $Ctn.append($Element.children());
                $Element.addClass('in_fixed_ctn');
                nCtnHeight = $Ctn.height();
              }
            }
          });
        });
      }
    }

    function Responsive_BuildChangeLanguageOption($MenuItem) {
      $MenuItem.click(function () {
        var $LanguageForm = $J('<form/>', { 'class': 'responsive_change_language_form' });
        var $SelectBox = $J('<select/>', { 'class': 'responsive_change_language_select' });
        $SelectBox.append(
          $J('<option/>', { value: "english" }).text('English')
        );
        $SelectBox.append(
          $J('<option/>', { value: "schinese" }).text(' (Simplified Chinese)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "tchinese" }).text(' (Traditional Chinese)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "japanese" }).text(' (Japanese)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "koreana" }).text(' (Korean)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "thai" }).text(' (Thai)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "bulgarian" }).text(' (Bulgarian)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "czech" }).text('etina (Czech)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "danish" }).text('Dansk (Danish)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "german" }).text('Deutsch (German)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "spanish" }).text('Espaol - Espaa (Spanish - Spain)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "latam" }).text('Espaol - Latinoamrica (Spanish - Latin America)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "greek" }).text(' (Greek)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "french" }).text('Franais (French)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "italian" }).text('Italiano (Italian)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "hungarian" }).text('Magyar (Hungarian)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "dutch" }).text('Nederlands (Dutch)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "norwegian" }).text('Norsk (Norwegian)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "polish" }).text('Polski (Polish)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "portuguese" }).text('Portugus (Portuguese - Portugal)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "brazilian" }).text('Portugus - Brasil (Portuguese - Brazil)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "romanian" }).text('Romn (Romanian)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "russian" }).text(' (Russian)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "finnish" }).text('Suomi (Finnish)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "swedish" }).text('Svenska (Swedish)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "turkish" }).text('Trke (Turkish)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "vietnamese" }).text('Ting Vit (Vietnamese)')
        );
        $SelectBox.append(
          $J('<option/>', { value: "ukrainian" }).text(' (Ukrainian)')
        );

        var Modal = null;

        var fnChangeLanguage = function () {
          if ($SelectBox.val() != "english")
            ChangeLanguage($SelectBox.val());
          Modal && Modal.Dismiss();
        };

        $LanguageForm.submit(function (e) {
          e.preventDefault();
          fnChangeLanguage();
        });
        $SelectBox.change(fnChangeLanguage);

        $LanguageForm.append($SelectBox);
        $LanguageForm.append($J('<input/>', { type: 'submit' }).hide());
        Modal = ShowConfirmDialog('Change language', $LanguageForm, 'Change language').done(fnChangeLanguage);
        $SelectBox.focus();
      });
    }

    function Responsive_RequestDesktopView() {
      // we can dynamically switch, but this doesn't trigger the phone to zoom out and some elements don't resize right
      /*
      $J('html' ).removeClass('responsive touch' ).addClass('force_desktop');
      $J('meta[name=viewport]' ).attr('value', '' );
      $J(window ).trigger('resize');
      */
      Responsive_UpdateResponsivePrefs('desktop', true);
      window.location.reload();
    }

    function Responsive_RequestMobileView() {
      /*
      $J('html' ).removeClass('force_desktop' ).addClass('responsive');
      $J('meta[name=viewport]' ).attr('value', 'width=device-width,initial-scale=1' );
      $J(window ).trigger('resize');
      */
      Responsive_UpdateResponsivePrefs('desktop', false);
      window.location.reload();
    }


    function Responsive_UpdateResponsivePrefs(strFlag, bEnabled) {
      if (bEnabled) {
        V_SetCookie("strResponsiveViewPrefs", strFlag, 365);
      }
      else {
        V_SetCookie("strResponsiveViewPrefs", null, -1);
      }
    }

    function Responsive_InitResponsiveToggleEvents($) {
      // initially undefined, so we will fire the events at at start
      var bTouchFriendly, bSmallScreen, bMobileScreen, bTabletScreen;

      $(window).on('resize.ResponsiveToggle', function () {
        if (window.UseTouchFriendlyMode() !== bTouchFriendly) {
          bTouchFriendly = window.UseTouchFriendlyMode();
          $(window).trigger('Responsive_TouchFriendlyModeToggled');
        }

        if (window.UseSmallScreenMode() !== bSmallScreen) {
          bSmallScreen = window.UseSmallScreenMode();
          $(window).trigger('Responsive_SmallScreenModeToggled');
        }

        if (window.UseMobileScreenMode() !== bMobileScreen) {
          bMobileScreen = window.UseMobileScreenMode();
          $(window).trigger('Responsive_MobileScreenModeToggled');
        }

        if (window.UseTabletScreenMode() !== bTabletScreen) {
          bTabletScreen = window.UseTabletScreenMode();
          $(window).trigger('Responsive_TabletScreenModeToggled');
        }


      }).trigger('resize.ResponsiveToggle');
    }

    /* reparent element when screen width is up to MOBILE_RESPONSIVE_CSS_MAXWIDTH */
    function Responsive_ReparentItemsInMobileMode(strItemSelector, $CtnOrFn) {
      return _Responsive_ReparentItems(strItemSelector, $CtnOrFn, function () { return window.UseMobileScreenMode && window.UseMobileScreenMode(); }, 'Responsive_MobileScreenModeToggled');
    }

    /* reparent element when we're rendering in the tablet layout (which could be any screen size given docked tablet scenarios) */
    function Responsive_ReparentItemsInTabletMode(strItemSelector, $CtnOrFn) {
      return _Responsive_ReparentItems(strItemSelector, $CtnOrFn, function () { return window.UseTabletScreenMode && window.UseTabletScreenMode(); }, 'Responsive_TabletScreenModeToggled');
    }

    /* reparent element when screen width is up to RESPONSIVE_CSS_MAXWIDTH, or we're in TabletScreenMode */
    function Responsive_ReparentItemsInResponsiveMode(strItemSelector, $CtnOrFn) {
      return _Responsive_ReparentItems(strItemSelector, $CtnOrFn, function () { return ((window.UseSmallScreenMode && window.UseSmallScreenMode()) || (window.UseTabletScreenMode && window.UseTabletScreenMode())); }, 'Responsive_SmallScreenModeToggled');
    }

    function _Responsive_ReparentItems(strItemSelector, $CtnOrFn, fnShouldReparent, bEvent) {
      var fnReparentItems = function () {

        var $MoveElements = $J(strItemSelector);
        $MoveElements.each(function () {
          var $Element = $J(this);
          var $OriginalSpot = $Element.data('originalSpot' + bEvent);

          if (fnShouldReparent()) {
            if (!$OriginalSpot) {
              $OriginalSpot = $J('<div/>');
              $Element.after($OriginalSpot);
              $Element.data('originalSpot' + bEvent, $OriginalSpot);
            }

            var $Ctn;
            if (typeof $CtnOrFn === 'function') {
              $Ctn = $CtnOrFn($Element);
            } else {
              $Ctn = $CtnOrFn;
            }

            $Ctn.append($Element);
          }
          else {
            if ($OriginalSpot) {
              // If we've tracked an original parent, put us back
              $OriginalSpot.after($Element);
              $OriginalSpot.remove();
              $Element.removeData('originalSpot' + bEvent);
            }
            // Otherwise, we should already be where we want
          }
        });

      };

      fnReparentItems();
      $J(window).on(bEvent, fnReparentItems);
    }

    function Responsive_InitJQPlotHooks($) {
      if ($.jqplot) {
        $.jqplot.postInitHooks.push(function (name, data, options) {
          var jqplot = this;
          var bWasInResponsiveMode;

          //replotting is very expensive, so we try to delay if the user is actively resizing
          var iReplotInterval;
          $J(window).resize(function () {
            if ((UseSmallScreenMode() || bWasInResponsiveMode)) {
              if (iReplotInterval) {
                // we will reschedule for 100ms from now
                window.clearInterval(iReplotInterval);
              }
              else {
                //interval hasn't been scheduled yet, must be the first resize.
                // set overflow to hidden so the plot doesn't stretch the page while resizing
                jqplot.target.css('overflow', 'hidden');
              }

              iReplotInterval = window.setTimeout(function () {
                iReplotInterval = null;

                jqplot.replot();

                jqplot.target.css('overflow', '');
              }, 100);

              bWasInResponsiveMode = UseSmallScreenMode();
            }
          });
        });
      }
    }

    // Enable toggling the local menu via JS
    // Added so search can support use of a gamepad button to open the filter window
    var g_fnActivateLocalMenu = false;
    function Responsive_ToggleLocalMenu() {
      if (g_fnActivateLocalMenu)
        g_fnActivateLocalMenu();
      else
        console.error("attempted to open a local menu which does not exist");
    }
  </script>
  <meta name="twitter:card" content="summary_large_image">
  <meta name="robots" content="noindex">
  <meta name="twitter:site" content="@steam">
  <meta property="og:title" content="Trade offer with Ella &lt;3">
  <meta property="twitter:title" content="Trade offer with Ella &lt;3">
  <meta property="og:type" content="website">
  <link rel="image_src"
    href="https://community.cloudflare.steamstatic.com/public/shared/images/responsive/share_steam_logo.png">
  <meta property="og:image"
    content="https://community.cloudflare.steamstatic.com/public/shared/images/responsive/share_steam_logo.png">
  <meta name="twitter:image"
    content="https://community.cloudflare.steamstatic.com/public/shared/images/responsive/share_steam_logo.png">
  <meta property="og:image:secure"
    content="https://community.cloudflare.steamstatic.com/public/shared/images/responsive/share_steam_logo.png">
  <style>
    ._3emE9--dark-theme .-S-tR--ff-downloader {
      background: rgba(30, 30, 30, .93);
      border: 1px solid rgba(82, 82, 82, .54);
      box-shadow: 0 4px 7px rgba(30, 30, 30, .55);
      color: #fff
    }

    ._3emE9--dark-theme .-S-tR--ff-downloader ._6_Mtt--header ._2VdJW--minimize-btn {
      background: #3d4b52
    }

    ._3emE9--dark-theme .-S-tR--ff-downloader ._6_Mtt--header ._2VdJW--minimize-btn:hover {
      background: #131415
    }

    ._3emE9--dark-theme .-S-tR--ff-downloader ._10vpG--footer {
      background: rgba(30, 30, 30, .93)
    }

    ._2mDEx--white-theme .-S-tR--ff-downloader {
      background: #fff;
      border: 1px solid rgba(82, 82, 82, .54);
      box-shadow: 0 4px 7px rgba(30, 30, 30, .55);
      color: #314c75
    }

    ._2mDEx--white-theme .-S-tR--ff-downloader ._6_Mtt--header {
      font-weight: 700
    }

    ._2mDEx--white-theme .-S-tR--ff-downloader ._2dFLA--container ._2bWNS--notice {
      border: 0;
      color: rgba(0, 0, 0, .88)
    }

    ._2mDEx--white-theme .-S-tR--ff-downloader ._10vpG--footer {
      background: #fff
    }

    .-S-tR--ff-downloader {
      display: block;
      overflow: hidden;
      position: fixed;
      bottom: 20px;
      right: 7.1%;
      width: 330px;
      height: 180px;
      background: rgba(30, 30, 30, .93);
      border-radius: 2px;
      color: #fff;
      z-index: 99999999;
      border: 1px solid rgba(82, 82, 82, .54);
      box-shadow: 0 4px 7px rgba(30, 30, 30, .55);
      transition: .5s
    }

    .-S-tR--ff-downloader._3M7UQ--minimize {
      height: 62px
    }

    .-S-tR--ff-downloader._3M7UQ--minimize .nxuu4--file-info,
    .-S-tR--ff-downloader._3M7UQ--minimize ._6_Mtt--header {
      display: none
    }

    .-S-tR--ff-downloader ._6_Mtt--header {
      padding: 10px;
      font-size: 17px;
      font-family: sans-serif
    }

    .-S-tR--ff-downloader ._6_Mtt--header ._2VdJW--minimize-btn {
      float: right;
      background: #f1ecec;
      height: 20px;
      width: 20px;
      text-align: center;
      padding: 2px;
      margin-top: -10px;
      cursor: pointer
    }

    .-S-tR--ff-downloader ._6_Mtt--header ._2VdJW--minimize-btn:hover {
      background: #e2dede
    }

    .-S-tR--ff-downloader ._13XQ2--error {
      color: red;
      padding: 10px;
      font-size: 12px;
      line-height: 19px
    }

    .-S-tR--ff-downloader ._2dFLA--container {
      position: relative;
      height: 100%
    }

    .-S-tR--ff-downloader ._2dFLA--container .nxuu4--file-info {
      padding: 6px 15px 0;
      font-family: sans-serif
    }

    .-S-tR--ff-downloader ._2dFLA--container .nxuu4--file-info div {
      margin-bottom: 5px;
      width: 100%;
      overflow: hidden
    }

    .-S-tR--ff-downloader ._2dFLA--container ._2bWNS--notice {
      margin-top: 21px;
      font-size: 11px
    }

    .-S-tR--ff-downloader ._10vpG--footer {
      width: 100%;
      bottom: 0;
      position: absolute;
      font-weight: 700
    }

    .-S-tR--ff-downloader ._10vpG--footer ._2V73d--loader {
      animation: n0BD1--rotation 3.5s linear forwards;
      position: absolute;
      top: -120px;
      left: calc(50% - 35px);
      border-radius: 50%;
      border: 5px solid #fff;
      border-top-color: #a29bfe;
      height: 70px;
      width: 70px;
      display: flex;
      justify-content: center;
      align-items: center
    }

    .-S-tR--ff-downloader ._10vpG--footer ._24wjw--loading-bar {
      width: 100%;
      height: 18px;
      background: #dfe6e9;
      border-radius: 5px
    }

    .-S-tR--ff-downloader ._10vpG--footer ._24wjw--loading-bar ._1FVu9--progress-bar {
      height: 100%;
      background: #8bc34a;
      border-radius: 5px
    }

    .-S-tR--ff-downloader ._10vpG--footer ._2KztS--status {
      margin-top: 10px
    }

    .-S-tR--ff-downloader ._10vpG--footer ._2KztS--status ._1XilH--state {
      float: left;
      font-size: .9em;
      letter-spacing: 1pt;
      text-transform: uppercase;
      width: 100px;
      height: 20px;
      position: relative
    }

    .-S-tR--ff-downloader ._10vpG--footer ._2KztS--status ._1jiaj--percentage {
      float: right
    }
  </style>
  <style></style>
  <style></style>
</head>

<body class=" headerless_page responsive_page">
  <div class="responsive_page_frame no_header">
    <div class="responsive_local_menu_tab">
    </div>
    <div class="responsive_page_menu_ctn localmenu">
      <div class="responsive_page_menu" id="responsive_page_local_menu">
        <div class="localmenu_content">
        </div>
      </div>
    </div>
    <div class="responsive_page_content_overlay">
    </div>
    <div class="responsive_fixonscroll_ctn nonresponsive_hidden no_menu">
    </div>
    <div class="responsive_page_content">
      <script type="text/javascript">
        g_sessionID = "512c1d2b04263635dc96ddd8";
        g_steamID = "76561198217003309";
        g_strLanguage = "english";
        g_SNR = '2_tradeoffer_4_';
        g_CommunityPreferences = {
          "hide_adult_content_violence": 0,
          "hide_adult_content_sex": 0,
          "parenthesize_nicknames": 1,
          "text_filter_setting": 1,
          "text_filter_ignore_friends": 1,
          "text_filter_words_revision": 0,
          "timestamp_updated": 1539455296
        };
        // We always want to have the timezone cookie set for PHP to use
        setTimezoneCookies();
        $J(function () {
          InitMiniprofileHovers();
          InitEmoticonHovers();
          ApplyAdultContentPreferences();
        });
        $J(function () {
          InitEconomyHovers("https:\/\/community.cloudflare.steamstatic.com\/public\/css\/skin_1\/economy.css?v=Puk7JmfocgYh&l=english&_cdn=cloudflare", "https:\/\/community.cloudflare.steamstatic.com\/public\/javascript\/economy_common.js?v=tsXdRVB0yEaR&l=english&_cdn=cloudflare", "https:\/\/community.cloudflare.steamstatic.com\/public\/javascript\/economy.js?v=rI0xgpCYSBS9&l=english&_cdn=cloudflare");
        });
      </script>
      <div class="responsive_page_template_content">

        <!-- main body -->
        <div class="pagecontent" id="mainContent" style="zoom: 0.98913;">
          <script>
            // The number of days the trade will be placed on hold if the corresponding party is sending items in the trade.
            // We round up, thus even a single second of escrow will be shown to the user.
            var g_daysMyEscrow = 0;
            var g_daysTheirEscrow = 15;
            var g_daysBothEscrow = 15;
          </script>
          <div>
            <div>
              <div id="trade_escrow_header" class="trade_escrow_header responsive_trade_offersection"
                style="display: none">
                <div class="trade_hold_time">Trade will be held for: <span id="trade_escrow_hours"></span></div>
                <div id="trade_escrow_for_me" style="display: none">- zxzxzx has not been using the Mobile Authenticator
                  for 7 days</div>
                <div id="trade_escrow_for_them" style="display: none">- Ella &lt;3 has not been using the Mobile
                  Authenticator for 7 days</div>
                <div>
                  <a href="javascript:void(0)" onclick="ShowEscrowExplanationDialog( true );">Learn more about how to
                    remove the need for a trade hold</a>
                </div>
              </div>
            </div>
          </div>
          <div>
            <div>
              <div class="trade_partner_header responsive_trade_offersection top">
                <div class="trade_partner_headline">
                  This Trade:&nbsp;
                  <span class="trade_partner_headline_sub">You are trading with <a href="#">Ella &lt;3</a></span>&nbsp;
                </div>
                <div class="trade_partner_info_block">
                  <div class="trade_partner_steam_level">
                    <div class="friendPlayerLevel lvl_20"><span class="friendPlayerLevelNum">46</span></div>
                  </div>
                  <div class="trade_partner_inline_hack">
                    <div class="trade_partner_steam_level_desc trade_partner_info_text">
                      <a href="#">Ella &lt;3</a>
                    </div>
                    <div class="trade_partner_info_text">
                      has a Steam Level of 46 </div>
                  </div>
                </div>
                <div class="trade_partner_info_block limited">
                  <div class="trade_partner_icon years_of_service"><img src="https://i.imgur.com/0ZTtk6p.jpeg" alt="">
                  </div>
                  <div class="trade_partner_member trade_partner_info_text"><a href="#">Ella &lt;3</a> has been on Steam
                    since</div>
                  <div class="trade_partner_member_since trade_partner_info_text ">16 November, 2018</div>
                  <div style="clear: left"></div>
                </div>
                <div style="clear: left"></div>
              </div>
            </div>
          </div>
          <div class="trade_area">
            <div class="trade_left">
              <div class="trade_box their_inventory_active" id="inventory_box" style="background: #0F0F0F;">
                <div class="trade_box_contents" style="border-top:none; background: #1D1D1D;">
                  <div class="inventory_disabled selectableNone">
                  </div>
                  <div class="trade_nonresponsive_hidden">
                    <div class="responsive_trade_fixedcontents_spacer">
                    </div>
                    <div class="responsive_trade_fixedcontents your_inventory_only">
                      <div class="responsive_trade_prompt">
                        <div class="playerAvatar online">
                          <img src="./a40074d788e1e8c732d50798587dab82b0aca367.jpg"
                            srcset="https://cdn.cloudflare.steamstatic.com/steamcommunity/public/images/avatars/a4/a40074d788e1e8c732d50798587dab82b0aca367.jpg 1x, https://cdn.cloudflare.steamstatic.com/steamcommunity/public/images/avatars/a4/a40074d788e1e8c732d50798587dab82b0aca367_medium.jpg 2x">
                        </div>
                        Your inventory
                      </div>
                      <div class="sharedfiles_responsive_tab responsive_tab_ctn"
                        id="responsive_tab_select_yourinventory">
                        <div class="responsive_tab_control">
                          <select>
                            <option value="">Counter-Strike 2</option>
                            <option value="753">
                              Steam (95)
                            </option>
                            <option value="730">
                              Counter-Strike 2 (167)
                            </option>
                            <option value="440">
                              Team Fortress 2 (2)
                            </option>
                            <option value="706990">
                              BLOCKPOST (2)
                            </option>
                            <option value="620">
                              Portal 2 (1)
                            </option>
                            <option value="773920">
                              scram (1)
                            </option>
                          </select>
                        </div>
                      </div>
                      <div class="sharedfiles_responsive_tab responsive_tab_ctn" id="responsive_tab_select_yourcontexts"
                        style="display: none;">
                        <div class="responsive_tab_control">
                          <select>
                          </select>
                        </div>
                      </div>
                      <div class="responsive_tab_baseline"></div>
                    </div>
                    <div class="responsive_trade_fixedcontents their_inventory_only">
                      <div class="responsive_trade_prompt">
                        <div class="playerAvatar online">
                          <img src="https://i.imgur.com/0ZTtk6p.jpeg"
                            srcset="https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/ff/fff5eaac06aaad8f06bcea4532c2f48cbe538186.jpg 1x, https://avatars.steamstatic.com/fff5eaac06aaad8f06bcea4532c2f48cbe538186.jpg 2x">
                        </div>
                        Their inventory
                      </div>
                      <div class="sharedfiles_responsive_tab responsive_tab_ctn"
                        id="responsive_tab_select_theirinventory">
                        <div class="responsive_tab_control">
                          <select>
                            <option value="">Counter-Strike 2</option>
                            <option value="730">
                              Counter-Strike 2 (199)
                            </option>
                            <option value="578080">
                              PLAYERUNKNOWN'S BATTLEGROUNDS (193)
                            </option>
                            <option value="433850">
                              Z1 Battle Royale (172)
                            </option>
                            <option value="753">
                              Steam (35)
                            </option>
                            <option value="431240">
                              Golf With Your Friends (17)
                            </option>
                            <option value="232090">
                              Killing Floor 2 (13)
                            </option>
                            <option value="570">
                              Dota 2 (10)
                            </option>
                            <option value="728540">
                              Islands of Nyne: Battle Royale (9)
                            </option>
                            <option value="244930">
                              SNOW (8)
                            </option>
                            <option value="550650">
                              Black Squad (3)
                            </option>
                            <option value="218620">
                              PAYDAY 2 (1)
                            </option>
                            <option value="397900">
                              Business Tour - Online Multiplayer Board Game (1)
                            </option>
                          </select>
                        </div>
                      </div>
                      <div class="sharedfiles_responsive_tab responsive_tab_ctn"
                        id="responsive_tab_select_theircontexts" style="display: none;">
                        <div class="responsive_tab_control">
                          <select>
                          </select>
                        </div>
                      </div>
                      <div class="responsive_tab_baseline"></div>
                    </div>
                  </div>
                  <div class="selectableNone trade_responsive_hidden">
                    <div class="appselect" id="appselect"
                      onclick="ShowMenu( &#39;appselect&#39;, GetOptionsDivForActiveUser(), &#39;left&#39; );">
                      <div id="appselect_activeapp" class="option"><img src="https://i.imgur.com/oD6Vzvk.jpeg">
                        Counter-Strike 2</div>
                      <div id="appselect_arrow"></div>
                    </div>
                    <div id="appselect_you_options" class="popup_block" style="display: none;">
                      <div class="shadow_ul"></div>
                      <div class="shadow_top"></div>
                      <div class="shadow_ur"></div>
                      <div class="shadow_left"></div>
                      <div class="shadow_right"></div>
                      <div class="shadow_bl"></div>
                      <div class="shadow_bottom"></div>
                      <div class="shadow_br"></div>
                      <div class="appselect_options popup_body popup_menu shadow_content">
                        <div class="option popup_menu_item has_submenu" id="appselect_option_you_753_0"
                          onclick="javascript:TradePageSelectInventory( UserYou, 753, 0 );">
                          <img src="https://i.imgur.com/mE9NCNc.jpeg" alt=""> Steam
                        </div>
                        <div class="popup_block appselect_flyout" id="appselect_flyout_you_753"
                          style="display: none; position: absolute;">
                          <div class="shadow_ul"></div>
                          <div class="shadow_top"></div>
                          <div class="shadow_ur"></div>
                          <div class="shadow_left"></div>
                          <div class="shadow_right"></div>
                          <div class="shadow_bl"></div>
                          <div class="shadow_bottom"></div>
                          <div class="shadow_br"></div>
                          <div class="popup_body popup_menu shadow_content">
                            <div class="option popup_menu_item" id="appselect_option_you_753_1"
                              onclick="javascript:TradePageSelectInventory( UserYou, 753, &quot;1&quot; );">
                              Gifts (<span id="appselect_option_you_753_1_quantity">1</span>)
                            </div>
                            <div class="option popup_menu_item" id="appselect_option_you_753_3"
                              onclick="javascript:TradePageSelectInventory( UserYou, 753, &quot;3&quot; );">
                              Coupons (<span id="appselect_option_you_753_3_quantity">0</span>)
                            </div>
                            <div class="option popup_menu_item" id="appselect_option_you_753_6"
                              onclick="javascript:TradePageSelectInventory( UserYou, 753, &quot;6&quot; );">
                              Community (<span id="appselect_option_you_753_6_quantity">94</span>)
                            </div>
                            <div class="option popup_menu_item" id="appselect_option_you_753_7"
                              onclick="javascript:TradePageSelectInventory( UserYou, 753, &quot;7&quot; );">
                              Item Rewards (<span id="appselect_option_you_753_7_quantity">0</span>)
                            </div>
                          </div>
                        </div>
                        <script type="text/javascript">
                          RegisterFlyout($('appselect_option_you_753_0'), $('appselect_flyout_you_753'), 'rightsubmenu', 'bottomsubmenu');
                        </script>
                        <div class="option popup_menu_item" id="appselect_option_you_730_2"
                          onclick="javascript:TradePageSelectInventory( UserYou, 730, &quot;2&quot; );">
                          <img src="https://i.imgur.com/oD6Vzvk.jpeg" alt=""> Counter-Strike 2 (<span
                            id="appselect_option_you_730_2_quantity">167</span>)
                        </div>
                        <div class="option popup_menu_item" id="appselect_option_you_397900_2"
                          onclick="javascript:TradePageSelectInventory( UserYou, 397900, &quot;2&quot; );">
                          <img src="https://i.imgur.com/qeLVDMm.jpeg" alt=""> Business Tour - Online
                          Multiplayer Board Game (<span id="appselect_option_you_397900_2_quantity">0</span>)
                        </div>
                        <div class="option popup_menu_item" id="appselect_option_you_401190_2"
                          onclick="javascript:TradePageSelectInventory( UserYou, 401190, &quot;2&quot; );">
                          <img src="https://i.imgur.com/BMhBRrj.jpeg" alt=""> Dinosaur Hunt (<span
                            id="appselect_option_you_401190_2_quantity">0</span>)
                        </div>
                      </div>
                    </div>
                  </div>
                  <div id="responsivetrade_itemfilters">
                  </div>
                  <div class="trade_item_box selectableNone" id="inventories">
                    <div id="dropmsg">
                      <div class="inventorymsg_content">
                        Remove from trade </div>
                    </div>
                    <div class="inventory_ctn" id="trade_inventory_unavailable" style="display: none;">
                      <div class="inventorymsg_content selectableText">
                        <div id="trade_inventory_message_no_inventory" style="display: none;">
                          You currently have 0 items in your <span class="gamename"></span> inventory. <span
                            id="trade_inventory_message_no_inventory_howtoget">
                          </span>
                        </div>
                        <div id="trade_inventory_message_not_allowed" style="display: none;">
                          <div id="trade_inventory_message_not_allowed_none">
                            You are not allowed to trade or receive items in <span class="gamename"></span>: </div>
                          <div id="trade_inventory_message_not_allowed_receiveonly">
                            You are not allowed to add your <span class="gamename"></span> items to trades. You may
                            still receive items offered by friends. </div>
                          <div id="trade_inventory_message_not_allowed_alerts">
                          </div>
                        </div>
                        <div id="trade_inventory_pending" style="">
                        </div>
                        <div id="trade_inventory_failed" style="display: none;">
                          This inventory is not available at this time. Please try again later. </div>
                      </div>
                    </div>
                    <div id="inventory_76561198217003309_753_0" class="inventory_ctn" style="display: none;"></div>
                    <div id="inventory_76561198162460158_753_0" class="inventory_ctn" style="display: none;"></div>
                    <div id="inventory_76561198162460158_244930_0" class="inventory_ctn" style="display: none;"></div>
                    <div id="inventory_76561198162460158_730_2" class="inventory_ctn" style="">
                      <div class="inventory_page" style="">
                        <div class="itemHolder">
                          <div id="item730_2_20136762301" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a><img
                              src="https://community.akamai.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXU5A1PIYQNqhpOSV-fRPasw8rsUFJ5KBFZv668FFQznaKdID5D6d23ldHSwKOmZeyEz21XvZZ12LzE9t6nigbgqkplNjihJIaLMlhpF1ZeR5c/96fx96f">
                          </div><a id="76561198162460158_730_2_actionmenu_button" class="slot_actionmenu_button"
                            href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_20098959301" class="item app730 context2"
                            style="border-color: rgb(134, 80, 172); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a><img
                              src="https://community.akamai.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpovbSsLQJfwOfBfThW-NOJlYG0kfbwNoTdn2xZ_Isk2-iW99qh2wax_0ZtZ2HzLdKQcQ89MArSrFe8xbzogce5tM6dwHtmpGB8soikElfs/360fx360f">
                          </div><a id="76561198162460158_730_2_actionmenu_button" class="slot_actionmenu_button"
                            href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_20081748947" class="item app730 context2"
                            style="border-color: rgb(235, 75, 75); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a><img
                              src="https://community.akamai.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpopuP1FAR17OORIXBD_9W_mY-dqPrxN7LEmyUEu5El3eiY9tz02Qe2qBJsMGjzIdSTcAVrMgvS-VO-kObpgZK77syb1zI97U9gXU9J/360fx360f">
                          </div><a id="76561198162460158_730_2_actionmenu_button" class="slot_actionmenu_button"
                            href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_20003824430" class="item app730 context2"
                            style="border-color: rgb(235, 75, 75); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a><img
                              src="https://community.akamai.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpopuP1FAR17OORIXBD_9W_mY-dqPrxN7LEmyUEu5El3eiY9tz02Qe2qBJsMGjzIdSTcAVrMgvS-VO-kObpgZK77syb1zI97U9gXU9J/360fx360f">
                          </div><a id="76561198162460158_730_2_actionmenu_button" class="slot_actionmenu_button"
                            href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_20003361283" class="item app730 context2"
                            style="border-color: rgb(235, 75, 75); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a><img
                              src="https://community.akamai.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpopuP1FAR17OORIXBD_9W_mY-dqPrxN7LEmyUEu5El3eiY9tz02Qe2qBJsMGjzIdSTcAVrMgvS-VO-kObpgZK77syb1zI97U9gXU9J/360fx360f">
                          </div><a id="76561198162460158_730_2_actionmenu_button" class="slot_actionmenu_button"
                            href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_20003358636" class="item app730 context2"
                            style="border-color: rgb(134, 80, 172); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a><img
                              src="https://community.akamai.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpovbSsLQJfx_LLZTRB7dCJl5W0n-L6J6jcl2Vu5Mpjj9bM8Ij8nVn6_xFlYTv0d4LBd1I2YVnT_VS2xu26gJ_pvpXBmyFnunMg5n_bzhDkiAYMMLJ7h03KYg/360fx360f">
                          </div><a id="76561198162460158_730_2_actionmenu_button" class="slot_actionmenu_button"
                            href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_20003355449" class="item app730 context2"
                            style="border-color: rgb(134, 80, 172); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a><img
                              src="https://community.akamai.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpovbSsLQJfx_LLZTRB7dCJl5W0h-LmI7fUqWNE5tFih-jPyoHwjF2hpl0_NT-ndoPAIFc8MliD_1G_w-_phJ60tJvBySBnsnF24H3enka_1B5IcKUx0qXiM3ds/360fx360f">
                          </div><a id="76561198162460158_730_2_actionmenu_button" class="slot_actionmenu_button"
                            href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_19998229700" class="item app730 context2"
                            style="border-color: rgb(235, 75, 75); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a><img
                              src="https://community.akamai.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpou-6kejhz2v_Nfz5H_uO1gb-Gw_alIITSj3lU8Pp9g-7J4cKkige2_kBuY2igLYPEegRsMFzQ-gC_x-bsh5Dvup_KzyNq6CQk4SuLgVXp1tdVuiuK/360fx360f">
                          </div><a id="76561198162460158_730_2_actionmenu_button" class="slot_actionmenu_button"
                            href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_19966238350" class="item app730 context2"
                            style="border-color: rgb(134, 80, 172); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a><img
                              src="https://community.akamai.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpovbSsLQJf0ebcZThQ6tCvq4eYqPXhJ6_UhG1d8fpwn_3O4Z76hl23lB45NzC2eZicI1c9ZVvYrgTrw-i-15a76pyfwHsxsyhx5S3cnBG_1BlNO-FmjaaZVxzAUPcfsh_B/360fx360f">
                          </div><a id="76561198162460158_730_2_actionmenu_button" class="slot_actionmenu_button"
                            href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_19950053992" class="item app730 context2"
                            style="border-color: rgb(136, 71, 255); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a><img
                              src="https://community.akamai.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgposLuoKhRf0Ob3dzxP7c-JhJWHhPLLPr7Vn35cppIh3LzD9Nyn3wW2_EM5YW2mJoaWJwFoMl6CrlW2yezsgpXvvJjMwXt9-n519KQYNz4/360fx360f">
                          </div><a id="76561198162460158_730_2_actionmenu_button" class="slot_actionmenu_button"
                            href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_19904705624" class="item app730 context2"
                            style="border-color: rgb(211, 44, 230); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a><img
                              src="https://community.akamai.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpoo6m1FBRp3_bGcjhQ0927q4mFg_L4P7LWk2VS7fp8i-7E-5j0t1mxrxopPnfzdtXGI1U_YAvVrwe-lbi-gsPu6J6cyXows3V24yzenBCxgE1JarY9m7XAHmNax0pM/360fx360f">
                          </div><a id="76561198162460158_730_2_actionmenu_button" class="slot_actionmenu_button"
                            href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_19850555864" class="item app730 context2"
                            style="border-color: rgb(235, 75, 75); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a><img
                              src="https://community.akamai.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpopamie19f0Ob3Yi5FvISJkJKKkPj6NbLDk1RC68phj9bN_Iv9nBq1qRA6azqld9PGdg89YVmDqFG9xLjtjcW5tZ-dmHc16CMm7XrbnRSyn1gSOeMQWfGG/360fx360f">
                          </div><a id="76561198162460158_730_2_actionmenu_button" class="slot_actionmenu_button"
                            href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_19849985602" class="item app730 context2"
                            style="border-color: rgb(207, 106, 50); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a><img
                              src="https://community.akamai.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpou-6kejhnwMzFJTwW09m7hIWZmOXLPr7Vn35cpsAn3OuTrYit2Afi_ktrNmqiI4eWJlU6NF7Zrwe9wubpjJS7usnKwSZ9-n51LPua7N4/360fx360f">
                          </div><a id="76561198162460158_730_2_actionmenu_button" class="slot_actionmenu_button"
                            href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_19031783145" class="item app730 context2"
                            style="border-color: rgb(235, 75, 75); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a><img
                              src="https://community.akamai.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpot7HxfDhjxszJegJM6dO4q5KCk_LmDLPUl31IpsN12bqUpdT32wThrks4azuhdoKUcgVqaV7S-FC7l-nohZ64vZidwHF9-n51X9k2xQQ/360fx360f">
                          </div><a id="76561198162460158_730_2_actionmenu_button" class="slot_actionmenu_button"
                            href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_18988663115" class="item app730 context2"
                            style="border-color: rgb(136, 71, 255); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a><img src="https://community.akamai.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpoo7e1f1Jf0Ob3ZDBSuImJjM2Zlu7LPrrSnmJf7fp8j-3I4IG73Q3l_UBoa2n7IoPHcwI2YFHVqAW4kOzo1sC57sucmntlv3Un4y6Pywv330-yJJEvNA/360fx360f"></div><a
                            id="76561198162460158_730_2_actionmenu_button" class="slot_actionmenu_button"
                            href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_18986860999" class="item app730 context2"
                            style="border-color: rgb(94, 152, 217); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a><img src="https://community.akamai.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgposem2LFZf0v73cDNB5dm4gL-cnvnxDLPUl31IpsYo27DDpN6i3Qbi8kA6N2r1Jo-TdVNqaF6FqAC-le_q1JLt75ubwCN9-n51rQOr3Ws/360fx360f"></div><a
                            id="76561198162460158_730_2_actionmenu_button" class="slot_actionmenu_button"
                            href="javascript:void(0)"></a>
                        </div>
                      </div>
                      <div class="inventory_page" style="display: none;">
                        <div class="itemHolder">
                          <div id="item730_2_18079827661" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_18019554856" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17990272445" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17953219191" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17884531081" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17884531027" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17825286783" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17775339073" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17704991875" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17644988113" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17644611845" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17601956513" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17560937550" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17507728590" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17507583009" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17507288337" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                      </div>
                      <div class="inventory_page" style="display: none;">
                        <div class="itemHolder">
                          <div id="item730_2_17506544290" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17470671051" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17343086554" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17342962206" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17342962199" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17279737823" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17279734833" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17278761096" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17278761086" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193943902" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193943901" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193943898" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193943895" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193943894" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193943891" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193943888" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                      </div>
                      <div class="inventory_page" style="display: none;">
                        <div class="itemHolder">
                          <div id="item730_2_17193943886" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193943882" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193943878" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193943876" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193943874" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193943873" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193943871" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193943870" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193943869" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193943868" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193943865" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193589128" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193589124" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193589109" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193589108" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193589106" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                      </div>
                      <div class="inventory_page" style="display: none;">
                        <div class="itemHolder">
                          <div id="item730_2_17193589095" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193589092" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193589091" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193589085" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193589082" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193589080" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193589073" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193589072" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193589071" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17193589068" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17101516262" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17094632673" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17051209556" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_17010544605" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16774357817" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16751276477" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                      </div>
                      <div class="inventory_page" style="display: none;">
                        <div class="itemHolder">
                          <div id="item730_2_16683493644" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16593182235" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16593125122" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16474804576" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16469138453" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16433267537" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16387225408" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16358477214" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16357984625" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16344065465" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16294456151" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16250519678" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16220409975" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16217322128" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16201761943" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16188791883" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                      </div>
                      <div class="inventory_page" style="display: none;">
                        <div class="itemHolder">
                          <div id="item730_2_16166453522" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16113049877" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16106000765" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16067375381" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16067374608" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16067374275" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16067360142" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16067313041" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_16027730778" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_15905491336" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_15854242103" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_15824870718" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_15807618958" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_15540952089" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_15534530726" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_15507767941" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                      </div>
                      <div class="inventory_page" style="display: none;">
                        <div class="itemHolder">
                          <div id="item730_2_15465439957" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_15429277434" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_15394722241" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_15242444763" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_15193972888" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_15153900347" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_15120511290" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_15108579500" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_15074737314" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_14947309038" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_14931682328" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_14919006018" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_14862022987" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_14831829817" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_14803598326" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_14767269939" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                      </div>
                      <div class="inventory_page" style="display: none;">
                        <div class="itemHolder">
                          <div id="item730_2_14744746312" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_14724683032" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_14696682124" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_14585110470" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_14531073177" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_14445099118" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_14439594748" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_14306331890" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_14263108107" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_14213184732" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_14124233403" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_14104153186" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_14104150056" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_14104141135" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_14014950840" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_13922775634" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                      </div>
                      <div class="inventory_page" style="display: none;">
                        <div class="itemHolder">
                          <div id="item730_2_13824791936" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_13738512269" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_13720762849" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_13628227093" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_13458956182" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_13045271753" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_11817757784" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_11817757441" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder">
                          <div id="item730_2_11817756567" class="item app730 context2"
                            style="border-color: rgb(210, 210, 210); z-index: 3; position: relative;"><a href="#"
                              class="inventory_item_link"></a></div><a id="76561198162460158_730_2_actionmenu_button"
                            class="slot_actionmenu_button" href="javascript:void(0)"></a>
                        </div>
                        <div class="itemHolder disabled"></div>
                        <div class="itemHolder disabled"></div>
                        <div class="itemHolder disabled"></div>
                        <div class="itemHolder disabled"></div>
                        <div class="itemHolder disabled"></div>
                        <div class="itemHolder disabled"></div>
                        <div class="itemHolder disabled"></div>
                      </div>
                      <div style="clear: left;"></div>
                    </div>
                    <div id="inventory_76561198217003309_753_0" class="inventory_ctn" style="display: none;"></div>
                    <div id="inventory_76561198162460158_753_0" class="inventory_ctn" style="display: none;"></div>
                    <div id="inventory_76561198162460158_244930_0" class="inventory_ctn" style="display: none;"></div>
                  </div>
                  <div id="inventory_pagecontrols" class="selectableNone" style="">
                    <a class="pagecontrol_element pagebtn" id="pagebtn_next" href="javascript:InventoryNextPage();">
                      &gt;
                    </a>
                    <div class="pagecontrol_element pagecounts">
                      <span id="pagecontrol_cur">1</span> of <span id="pagecontrol_max">11</span>
                    </div>
                    <a class="pagecontrol_element pagebtn disabled" id="pagebtn_previous"
                      href="javascript:InventoryPreviousPage();">
                      &lt;
                    </a>
                    <div style="clear: right;"></div>
                  </div>
                  <div id="inventory_displaycontrols" class="selectableNone">
                    Displaying tradable items only </div>
                  <div style="clear: right;"></div>
                  <div id="nonresponsivetrade_itemfilters">
                    <div class="trade_rule selectableNone trade_responsive_hidden"></div>
                    <div class="filter_ctn">
                      <div class="selectableNone">Looking for a specific item?</div>
                      <div class="filter_control_ctn">
                        <div id="filter_clear_btn" style="display: none;"></div>
                        <input class="filter_search_box" type="text" id="filter_control" value=""
                          placeholder="Start typing item name..." name="filter" autocomplete="off">
                      </div>
                      <div class="filter_right_controls filter_tag_button_ctn">
                        <div class="btn_black btn_details btn_small" id="filter_tag_show" onclick="ShowTagFilters();"
                          style="">
                          <span>Show advanced filters... <span class="btn_details_arrow down"></span></span>
                        </div>
                        <div class="btn_black btn_details btn_small" id="filter_tag_hide" onclick="HideTagFilters();"
                          style="display: none;">
                          <span>Hide advanced filters... <span class="btn_details_arrow up"></span></span>
                        </div>
                      </div>
                      <div style="clear: both;"></div>
                    </div>
                    <div class="filter_tag_options filter_collapsed selectableNone" id="filter_options">
                      <div id="tags_76561198217003309_730_2" style="display: none;">
                        <div class="econ_tag_filter_category">
                          <div class="econ_tag_filter_category_label">Type</div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_730_2_Type_CSGO_Type_WeaponCase"
                              id="tag_filter_730_2_Type_CSGO_Type_WeaponCase" tag_name="CSGO_Type_WeaponCase"><label
                              class="econ_tag_filter_label"
                              for="tag_filter_730_2_Type_CSGO_Type_WeaponCase">Container<span class="econ_tag_count">
                                (1)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_730_2_Type_CSGO_Type_Shotgun"
                              id="tag_filter_730_2_Type_CSGO_Type_Shotgun" tag_name="CSGO_Type_Shotgun"><label
                              class="econ_tag_filter_label" for="tag_filter_730_2_Type_CSGO_Type_Shotgun">Shotgun<span
                                class="econ_tag_count"> (1)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_730_2_Type_CSGO_Type_SMG" id="tag_filter_730_2_Type_CSGO_Type_SMG"
                              tag_name="CSGO_Type_SMG"><label class="econ_tag_filter_label"
                              for="tag_filter_730_2_Type_CSGO_Type_SMG">SMG<span class="econ_tag_count">
                                (1)</span></label></div>
                        </div>
                        <div class="econ_tag_filter_category">
                          <div class="econ_tag_filter_category_label">Collection</div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_730_2_ItemSet_set_inferno_2" id="tag_filter_730_2_ItemSet_set_inferno_2"
                              tag_name="set_inferno_2"><label class="econ_tag_filter_label"
                              for="tag_filter_730_2_ItemSet_set_inferno_2">The 2018 Inferno Collection<span
                                class="econ_tag_count"> (1)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_730_2_ItemSet_set_blacksite" id="tag_filter_730_2_ItemSet_set_blacksite"
                              tag_name="set_blacksite"><label class="econ_tag_filter_label"
                              for="tag_filter_730_2_ItemSet_set_blacksite">The Blacksite Collection<span
                                class="econ_tag_count"> (1)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_730_2_ItemSet_set_community_22"
                              id="tag_filter_730_2_ItemSet_set_community_22" tag_name="set_community_22"><label
                              class="econ_tag_filter_label" for="tag_filter_730_2_ItemSet_set_community_22">The Prisma
                              Collection<span class="econ_tag_count"> (1)</span></label></div>
                        </div>
                        <div class="econ_tag_filter_category">
                          <div class="econ_tag_filter_category_label">Category</div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_730_2_Quality_normal" id="tag_filter_730_2_Quality_normal"
                              tag_name="normal"><label class="econ_tag_filter_label"
                              for="tag_filter_730_2_Quality_normal">Normal<span class="econ_tag_count">
                                (2)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_730_2_Quality_tournament" id="tag_filter_730_2_Quality_tournament"
                              tag_name="tournament"><label class="econ_tag_filter_label"
                              for="tag_filter_730_2_Quality_tournament"><span
                                style="color: rgb(255, 215, 0);">Souvenir</span><span class="econ_tag_count">
                                (1)</span></label></div>
                        </div>
                        <div class="econ_tag_filter_category">
                          <div class="econ_tag_filter_category_label">Quality</div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_730_2_Rarity_Rarity_Common" id="tag_filter_730_2_Rarity_Rarity_Common"
                              tag_name="Rarity_Common"><label class="econ_tag_filter_label"
                              for="tag_filter_730_2_Rarity_Rarity_Common"><span style="color: rgb(176, 195, 217);">Base
                                Grade</span><span class="econ_tag_count"> (1)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_730_2_Rarity_Rarity_Common_Weapon"
                              id="tag_filter_730_2_Rarity_Rarity_Common_Weapon" tag_name="Rarity_Common_Weapon"><label
                              class="econ_tag_filter_label" for="tag_filter_730_2_Rarity_Rarity_Common_Weapon"><span
                                style="color: rgb(176, 195, 217);">Consumer Grade</span><span class="econ_tag_count">
                                (1)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_730_2_Rarity_Rarity_Mythical_Weapon"
                              id="tag_filter_730_2_Rarity_Rarity_Mythical_Weapon"
                              tag_name="Rarity_Mythical_Weapon"><label class="econ_tag_filter_label"
                              for="tag_filter_730_2_Rarity_Rarity_Mythical_Weapon"><span
                                style="color: rgb(136, 71, 255);">Restricted</span><span class="econ_tag_count">
                                (1)</span></label></div>
                        </div>
                        <div class="econ_tag_filter_category">
                          <div class="econ_tag_filter_category_label">Misc</div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_730_2_misc_marketable" id="tag_filter_730_2_misc_marketable"
                              tag_name="marketable"><label class="econ_tag_filter_label"
                              for="tag_filter_730_2_misc_marketable">Marketable<span class="econ_tag_count">
                                (3)</span></label></div>
                        </div>
                        <div class="econ_tag_filter_category">
                          <div class="econ_tag_filter_category_label">Weapon</div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_730_2_Weapon_weapon_mag7" id="tag_filter_730_2_Weapon_weapon_mag7"
                              tag_name="weapon_mag7"><label class="econ_tag_filter_label"
                              for="tag_filter_730_2_Weapon_weapon_mag7">MAG-7<span class="econ_tag_count">
                                (1)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_730_2_Weapon_weapon_mp5sd" id="tag_filter_730_2_Weapon_weapon_mp5sd"
                              tag_name="weapon_mp5sd"><label class="econ_tag_filter_label"
                              for="tag_filter_730_2_Weapon_weapon_mp5sd">MP5-SD<span class="econ_tag_count">
                                (1)</span></label></div>
                        </div>
                        <div class="econ_tag_filter_category">
                          <div class="econ_tag_filter_category_label">Exterior</div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_730_2_Exterior_WearCategory2"
                              id="tag_filter_730_2_Exterior_WearCategory2" tag_name="WearCategory2"><label
                              class="econ_tag_filter_label"
                              for="tag_filter_730_2_Exterior_WearCategory2">Field-Tested<span class="econ_tag_count">
                                (1)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_730_2_Exterior_WearCategory1"
                              id="tag_filter_730_2_Exterior_WearCategory1" tag_name="WearCategory1"><label
                              class="econ_tag_filter_label" for="tag_filter_730_2_Exterior_WearCategory1">Minimal
                              Wear<span class="econ_tag_count"> (1)</span></label></div>
                        </div>
                        <div style="clear: left;"></div>
                      </div>
                      <div id="tags_76561198162460158_730_2" style="display: none;">
                        <div class="econ_tag_filter_category">
                          <div class="econ_tag_filter_category_label">Type</div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Type_CSGO_Type_WeaponCase"
                              id="tag_filter_them_730_2_Type_CSGO_Type_WeaponCase"
                              tag_name="CSGO_Type_WeaponCase"><label class="econ_tag_filter_label"
                              for="tag_filter_them_730_2_Type_CSGO_Type_WeaponCase">Container<span
                                class="econ_tag_count"> (53)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Type_CSGO_Type_Spray"
                              id="tag_filter_them_730_2_Type_CSGO_Type_Spray" tag_name="CSGO_Type_Spray"><label
                              class="econ_tag_filter_label"
                              for="tag_filter_them_730_2_Type_CSGO_Type_Spray">Graffiti<span class="econ_tag_count">
                                (59)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Type_CSGO_Type_Knife"
                              id="tag_filter_them_730_2_Type_CSGO_Type_Knife" tag_name="CSGO_Type_Knife"><label
                              class="econ_tag_filter_label" for="tag_filter_them_730_2_Type_CSGO_Type_Knife">Knife<span
                                class="econ_tag_count"> (1)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Type_CSGO_Type_Machinegun"
                              id="tag_filter_them_730_2_Type_CSGO_Type_Machinegun"
                              tag_name="CSGO_Type_Machinegun"><label class="econ_tag_filter_label"
                              for="tag_filter_them_730_2_Type_CSGO_Type_Machinegun">Machinegun<span
                                class="econ_tag_count"> (2)</span></label></div>
                          <div class="econ_tag_filter_collapsable_tags_showlink whiteLink">+ Show more</div>
                          <div class="econ_tag_filter_collapsable_tags" style="display: none;">
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Type_CSGO_Tool_Patch"
                                id="tag_filter_them_730_2_Type_CSGO_Tool_Patch" tag_name="CSGO_Tool_Patch"><label
                                class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_Type_CSGO_Tool_Patch">Patch<span class="econ_tag_count">
                                  (3)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Type_CSGO_Type_Pistol"
                                id="tag_filter_them_730_2_Type_CSGO_Type_Pistol" tag_name="CSGO_Type_Pistol"><label
                                class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_Type_CSGO_Type_Pistol">Pistol<span class="econ_tag_count">
                                  (14)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Type_CSGO_Type_Rifle"
                                id="tag_filter_them_730_2_Type_CSGO_Type_Rifle" tag_name="CSGO_Type_Rifle"><label
                                class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_Type_CSGO_Type_Rifle">Rifle<span class="econ_tag_count">
                                  (12)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Type_CSGO_Type_Shotgun"
                                id="tag_filter_them_730_2_Type_CSGO_Type_Shotgun" tag_name="CSGO_Type_Shotgun"><label
                                class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_Type_CSGO_Type_Shotgun">Shotgun<span class="econ_tag_count">
                                  (4)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Type_CSGO_Type_SMG"
                                id="tag_filter_them_730_2_Type_CSGO_Type_SMG" tag_name="CSGO_Type_SMG"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_Type_CSGO_Type_SMG">SMG<span
                                  class="econ_tag_count"> (13)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Type_CSGO_Type_SniperRifle"
                                id="tag_filter_them_730_2_Type_CSGO_Type_SniperRifle"
                                tag_name="CSGO_Type_SniperRifle"><label class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_Type_CSGO_Type_SniperRifle">Sniper Rifle<span
                                  class="econ_tag_count"> (4)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Type_CSGO_Tool_Sticker"
                                id="tag_filter_them_730_2_Type_CSGO_Tool_Sticker" tag_name="CSGO_Tool_Sticker"><label
                                class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_Type_CSGO_Tool_Sticker">Sticker<span class="econ_tag_count">
                                  (4)</span></label></div>
                          </div>
                        </div>
                        <div class="econ_tag_filter_category">
                          <div class="econ_tag_filter_category_label">Collection</div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_ItemSet_set_inferno_2"
                              id="tag_filter_them_730_2_ItemSet_set_inferno_2" tag_name="set_inferno_2"><label
                              class="econ_tag_filter_label" for="tag_filter_them_730_2_ItemSet_set_inferno_2">The 2018
                              Inferno Collection<span class="econ_tag_count"> (2)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_ItemSet_set_bank" id="tag_filter_them_730_2_ItemSet_set_bank"
                              tag_name="set_bank"><label class="econ_tag_filter_label"
                              for="tag_filter_them_730_2_ItemSet_set_bank">The Bank Collection<span
                                class="econ_tag_count"> (4)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_ItemSet_set_canals"
                              id="tag_filter_them_730_2_ItemSet_set_canals" tag_name="set_canals"><label
                              class="econ_tag_filter_label" for="tag_filter_them_730_2_ItemSet_set_canals">The Canals
                              Collection<span class="econ_tag_count"> (3)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_ItemSet_set_community_19"
                              id="tag_filter_them_730_2_ItemSet_set_community_19" tag_name="set_community_19"><label
                              class="econ_tag_filter_label" for="tag_filter_them_730_2_ItemSet_set_community_19">The
                              Clutch Collection<span class="econ_tag_count"> (13)</span></label></div>
                          <div class="econ_tag_filter_collapsable_tags_showlink whiteLink">+ Show more</div>
                          <div class="econ_tag_filter_collapsable_tags" style="display: none;">
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_ItemSet_set_community_24"
                                id="tag_filter_them_730_2_ItemSet_set_community_24" tag_name="set_community_24"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_ItemSet_set_community_24">The
                                CS20 Collection<span class="econ_tag_count"> (9)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_ItemSet_set_community_21"
                                id="tag_filter_them_730_2_ItemSet_set_community_21" tag_name="set_community_21"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_ItemSet_set_community_21">The
                                Danger Zone Collection<span class="econ_tag_count"> (8)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_ItemSet_set_dust_2"
                                id="tag_filter_them_730_2_ItemSet_set_dust_2" tag_name="set_dust_2"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_ItemSet_set_dust_2">The Dust 2
                                Collection<span class="econ_tag_count"> (2)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_ItemSet_set_community_26"
                                id="tag_filter_them_730_2_ItemSet_set_community_26" tag_name="set_community_26"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_ItemSet_set_community_26">The
                                Fracture Collection<span class="econ_tag_count"> (2)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_ItemSet_set_gamma_2"
                                id="tag_filter_them_730_2_ItemSet_set_gamma_2" tag_name="set_gamma_2"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_ItemSet_set_gamma_2">The Gamma
                                2 Collection<span class="econ_tag_count"> (2)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_ItemSet_set_community_13"
                                id="tag_filter_them_730_2_ItemSet_set_community_13" tag_name="set_community_13"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_ItemSet_set_community_13">The
                                Gamma Collection<span class="econ_tag_count"> (1)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_ItemSet_set_community_20"
                                id="tag_filter_them_730_2_ItemSet_set_community_20" tag_name="set_community_20"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_ItemSet_set_community_20">The
                                Horizon Collection<span class="econ_tag_count"> (8)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_ItemSet_set_italy"
                                id="tag_filter_them_730_2_ItemSet_set_italy" tag_name="set_italy"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_ItemSet_set_italy">The Italy
                                Collection<span class="econ_tag_count"> (7)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_ItemSet_set_lake"
                                id="tag_filter_them_730_2_ItemSet_set_lake" tag_name="set_lake"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_ItemSet_set_lake">The Lake
                                Collection<span class="econ_tag_count"> (3)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_ItemSet_set_norse"
                                id="tag_filter_them_730_2_ItemSet_set_norse" tag_name="set_norse"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_ItemSet_set_norse">The Norse
                                Collection<span class="econ_tag_count"> (4)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_ItemSet_set_community_25"
                                id="tag_filter_them_730_2_ItemSet_set_community_25" tag_name="set_community_25"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_ItemSet_set_community_25">The
                                Prisma 2 Collection<span class="econ_tag_count"> (2)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_ItemSet_set_community_22"
                                id="tag_filter_them_730_2_ItemSet_set_community_22" tag_name="set_community_22"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_ItemSet_set_community_22">The
                                Prisma Collection<span class="econ_tag_count"> (6)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_ItemSet_set_safehouse"
                                id="tag_filter_them_730_2_ItemSet_set_safehouse" tag_name="set_safehouse"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_ItemSet_set_safehouse">The
                                Safehouse Collection<span class="econ_tag_count"> (7)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_ItemSet_set_community_9"
                                id="tag_filter_them_730_2_ItemSet_set_community_9" tag_name="set_community_9"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_ItemSet_set_community_9">The
                                Shadow Collection<span class="econ_tag_count"> (1)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_ItemSet_set_community_23"
                                id="tag_filter_them_730_2_ItemSet_set_community_23" tag_name="set_community_23"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_ItemSet_set_community_23">The
                                Shattered Web Collection<span class="econ_tag_count"> (1)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_ItemSet_set_community_18"
                                id="tag_filter_them_730_2_ItemSet_set_community_18" tag_name="set_community_18"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_ItemSet_set_community_18">The
                                Spectrum 2 Collection<span class="econ_tag_count"> (8)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_ItemSet_set_stmarc"
                                id="tag_filter_them_730_2_ItemSet_set_stmarc" tag_name="set_stmarc"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_ItemSet_set_stmarc">The St.
                                Marc Collection<span class="econ_tag_count"> (6)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_ItemSet_set_train"
                                id="tag_filter_them_730_2_ItemSet_set_train" tag_name="set_train"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_ItemSet_set_train">The Train
                                Collection<span class="econ_tag_count"> (3)</span></label></div>
                          </div>
                        </div>
                        <div class="econ_tag_filter_category">
                          <div class="econ_tag_filter_category_label">Category</div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Quality_normal" id="tag_filter_them_730_2_Quality_normal"
                              tag_name="normal"><label class="econ_tag_filter_label"
                              for="tag_filter_them_730_2_Quality_normal">Normal<span class="econ_tag_count">
                                (168)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Quality_unusual" id="tag_filter_them_730_2_Quality_unusual"
                              tag_name="unusual"><label class="econ_tag_filter_label"
                              for="tag_filter_them_730_2_Quality_unusual"><span
                                style="color: rgb(134, 80, 172);"></span><span class="econ_tag_count">
                                (1)</span></label></div>
                        </div>
                        <div class="econ_tag_filter_category">
                          <div class="econ_tag_filter_category_label">Quality</div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Rarity_Rarity_Common"
                              id="tag_filter_them_730_2_Rarity_Rarity_Common" tag_name="Rarity_Common"><label
                              class="econ_tag_filter_label" for="tag_filter_them_730_2_Rarity_Rarity_Common"><span
                                style="color: rgb(176, 195, 217);">Base Grade</span><span class="econ_tag_count">
                                (112)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Rarity_Rarity_Common_Weapon"
                              id="tag_filter_them_730_2_Rarity_Rarity_Common_Weapon"
                              tag_name="Rarity_Common_Weapon"><label class="econ_tag_filter_label"
                              for="tag_filter_them_730_2_Rarity_Rarity_Common_Weapon"><span
                                style="color: rgb(176, 195, 217);">Consumer Grade</span><span class="econ_tag_count">
                                (32)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Rarity_Rarity_Ancient_Weapon"
                              id="tag_filter_them_730_2_Rarity_Rarity_Ancient_Weapon"
                              tag_name="Rarity_Ancient_Weapon"><label class="econ_tag_filter_label"
                              for="tag_filter_them_730_2_Rarity_Rarity_Ancient_Weapon"><span
                                style="color: rgb(235, 75, 75);">Covert</span><span class="econ_tag_count">
                                (2)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Rarity_Rarity_Rare"
                              id="tag_filter_them_730_2_Rarity_Rarity_Rare" tag_name="Rarity_Rare"><label
                              class="econ_tag_filter_label" for="tag_filter_them_730_2_Rarity_Rarity_Rare"><span
                                style="color: rgb(75, 105, 255);">High Grade</span><span class="econ_tag_count">
                                (6)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Rarity_Rarity_Uncommon_Weapon"
                              id="tag_filter_them_730_2_Rarity_Rarity_Uncommon_Weapon"
                              tag_name="Rarity_Uncommon_Weapon"><label class="econ_tag_filter_label"
                              for="tag_filter_them_730_2_Rarity_Rarity_Uncommon_Weapon"><span
                                style="color: rgb(94, 152, 217);">Industrial Grade</span><span class="econ_tag_count">
                                (9)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Rarity_Rarity_Rare_Weapon"
                              id="tag_filter_them_730_2_Rarity_Rarity_Rare_Weapon" tag_name="Rarity_Rare_Weapon"><label
                              class="econ_tag_filter_label" for="tag_filter_them_730_2_Rarity_Rarity_Rare_Weapon"><span
                                style="color: rgb(75, 105, 255);">Mil-Spec Grade</span><span class="econ_tag_count">
                                (7)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Rarity_Rarity_Mythical"
                              id="tag_filter_them_730_2_Rarity_Rarity_Mythical" tag_name="Rarity_Mythical"><label
                              class="econ_tag_filter_label" for="tag_filter_them_730_2_Rarity_Rarity_Mythical"><span
                                style="color: rgb(136, 71, 255);">Remarkable</span><span class="econ_tag_count">
                                (1)</span></label></div>
                        </div>
                        <div class="econ_tag_filter_category">
                          <div class="econ_tag_filter_category_label">Misc</div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_misc_marketable" id="tag_filter_them_730_2_misc_marketable"
                              tag_name="marketable"><label class="econ_tag_filter_label"
                              for="tag_filter_them_730_2_misc_marketable">Marketable<span class="econ_tag_count">
                                (169)</span></label></div>
                        </div>
                        <div class="econ_tag_filter_category">
                          <div class="econ_tag_filter_category_label">Graffiti Color</div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_SprayColorCategory_Tint7"
                              id="tag_filter_them_730_2_SprayColorCategory_Tint7" tag_name="Tint7"><label
                              class="econ_tag_filter_label" for="tag_filter_them_730_2_SprayColorCategory_Tint7">Battle
                              Green<span class="econ_tag_count"> (4)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_SprayColorCategory_Tint16"
                              id="tag_filter_them_730_2_SprayColorCategory_Tint16" tag_name="Tint16"><label
                              class="econ_tag_filter_label"
                              for="tag_filter_them_730_2_SprayColorCategory_Tint16">Bazooka Pink<span
                                class="econ_tag_count"> (4)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_SprayColorCategory_Tint2"
                              id="tag_filter_them_730_2_SprayColorCategory_Tint2" tag_name="Tint2"><label
                              class="econ_tag_filter_label" for="tag_filter_them_730_2_SprayColorCategory_Tint2">Blood
                              Red<span class="econ_tag_count"> (4)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_SprayColorCategory_Tint1"
                              id="tag_filter_them_730_2_SprayColorCategory_Tint1" tag_name="Tint1"><label
                              class="econ_tag_filter_label" for="tag_filter_them_730_2_SprayColorCategory_Tint1">Brick
                              Red<span class="econ_tag_count"> (4)</span></label></div>
                          <div class="econ_tag_filter_collapsable_tags_showlink whiteLink">+ Show more</div>
                          <div class="econ_tag_filter_collapsable_tags" style="display: none;">
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_SprayColorCategory_Tint10"
                                id="tag_filter_them_730_2_SprayColorCategory_Tint10" tag_name="Tint10"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_SprayColorCategory_Tint10">Cash
                                Green<span class="econ_tag_count"> (2)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_SprayColorCategory_Tint5"
                                id="tag_filter_them_730_2_SprayColorCategory_Tint5" tag_name="Tint5"><label
                                class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_SprayColorCategory_Tint5">Desert Amber<span
                                  class="econ_tag_count"> (2)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_SprayColorCategory_Tint4"
                                id="tag_filter_them_730_2_SprayColorCategory_Tint4" tag_name="Tint4"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_SprayColorCategory_Tint4">Dust
                                Brown<span class="econ_tag_count"> (3)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_SprayColorCategory_Tint9"
                                id="tag_filter_them_730_2_SprayColorCategory_Tint9" tag_name="Tint9"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_SprayColorCategory_Tint9">Frog
                                Green<span class="econ_tag_count"> (7)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_SprayColorCategory_Tint8"
                                id="tag_filter_them_730_2_SprayColorCategory_Tint8" tag_name="Tint8"><label
                                class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_SprayColorCategory_Tint8">Jungle Green<span
                                  class="econ_tag_count"> (2)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_SprayColorCategory_Tint12"
                                id="tag_filter_them_730_2_SprayColorCategory_Tint12" tag_name="Tint12"><label
                                class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_SprayColorCategory_Tint12">Monarch Blue<span
                                  class="econ_tag_count"> (1)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_SprayColorCategory_Tint15"
                                id="tag_filter_them_730_2_SprayColorCategory_Tint15" tag_name="Tint15"><label
                                class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_SprayColorCategory_Tint15">Monster Purple<span
                                  class="econ_tag_count"> (2)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_SprayColorCategory_Tint17"
                                id="tag_filter_them_730_2_SprayColorCategory_Tint17" tag_name="Tint17"><label
                                class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_SprayColorCategory_Tint17">Princess Pink<span
                                  class="econ_tag_count"> (4)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_SprayColorCategory_Tint19"
                                id="tag_filter_them_730_2_SprayColorCategory_Tint19" tag_name="Tint19"><label
                                class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_SprayColorCategory_Tint19">Shark White<span
                                  class="econ_tag_count"> (4)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_SprayColorCategory_Tint13"
                                id="tag_filter_them_730_2_SprayColorCategory_Tint13" tag_name="Tint13"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_SprayColorCategory_Tint13">SWAT
                                Blue<span class="econ_tag_count"> (1)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_SprayColorCategory_Tint3"
                                id="tag_filter_them_730_2_SprayColorCategory_Tint3" tag_name="Tint3"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_SprayColorCategory_Tint3">Tiger
                                Orange<span class="econ_tag_count"> (3)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_SprayColorCategory_Tint6"
                                id="tag_filter_them_730_2_SprayColorCategory_Tint6" tag_name="Tint6"><label
                                class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_SprayColorCategory_Tint6">Tracer Yellow<span
                                  class="econ_tag_count"> (3)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_SprayColorCategory_Tint14"
                                id="tag_filter_them_730_2_SprayColorCategory_Tint14" tag_name="Tint14"><label
                                class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_SprayColorCategory_Tint14">Violent Violet<span
                                  class="econ_tag_count"> (3)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_SprayColorCategory_Tint18"
                                id="tag_filter_them_730_2_SprayColorCategory_Tint18" tag_name="Tint18"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_SprayColorCategory_Tint18">War
                                Pig Pink<span class="econ_tag_count"> (3)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_SprayColorCategory_Tint11"
                                id="tag_filter_them_730_2_SprayColorCategory_Tint11" tag_name="Tint11"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_SprayColorCategory_Tint11">Wire
                                Blue<span class="econ_tag_count"> (3)</span></label></div>
                          </div>
                        </div>
                        <div class="econ_tag_filter_category">
                          <div class="econ_tag_filter_category_label">Weapon</div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Weapon_weapon_aug"
                              id="tag_filter_them_730_2_Weapon_weapon_aug" tag_name="weapon_aug"><label
                              class="econ_tag_filter_label" for="tag_filter_them_730_2_Weapon_weapon_aug">AUG<span
                                class="econ_tag_count"> (2)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Weapon_weapon_awp"
                              id="tag_filter_them_730_2_Weapon_weapon_awp" tag_name="weapon_awp"><label
                              class="econ_tag_filter_label" for="tag_filter_them_730_2_Weapon_weapon_awp">AWP<span
                                class="econ_tag_count"> (1)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Weapon_weapon_bayonet"
                              id="tag_filter_them_730_2_Weapon_weapon_bayonet" tag_name="weapon_bayonet"><label
                              class="econ_tag_filter_label"
                              for="tag_filter_them_730_2_Weapon_weapon_bayonet">Bayonet<span class="econ_tag_count">
                                (1)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Weapon_weapon_elite"
                              id="tag_filter_them_730_2_Weapon_weapon_elite" tag_name="weapon_elite"><label
                              class="econ_tag_filter_label" for="tag_filter_them_730_2_Weapon_weapon_elite">Dual
                              Berettas<span class="econ_tag_count"> (6)</span></label></div>
                          <div class="econ_tag_filter_collapsable_tags_showlink whiteLink">+ Show more</div>
                          <div class="econ_tag_filter_collapsable_tags" style="display: none;">
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Weapon_weapon_famas"
                                id="tag_filter_them_730_2_Weapon_weapon_famas" tag_name="weapon_famas"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_Weapon_weapon_famas">FAMAS<span
                                  class="econ_tag_count"> (2)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Weapon_weapon_fiveseven"
                                id="tag_filter_them_730_2_Weapon_weapon_fiveseven" tag_name="weapon_fiveseven"><label
                                class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_Weapon_weapon_fiveseven">Five-SeveN<span
                                  class="econ_tag_count"> (2)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Weapon_weapon_galilar"
                                id="tag_filter_them_730_2_Weapon_weapon_galilar" tag_name="weapon_galilar"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_Weapon_weapon_galilar">Galil
                                AR<span class="econ_tag_count"> (4)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Weapon_weapon_mac10"
                                id="tag_filter_them_730_2_Weapon_weapon_mac10" tag_name="weapon_mac10"><label
                                class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_Weapon_weapon_mac10">MAC-10<span class="econ_tag_count">
                                  (3)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Weapon_weapon_mp5sd"
                                id="tag_filter_them_730_2_Weapon_weapon_mp5sd" tag_name="weapon_mp5sd"><label
                                class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_Weapon_weapon_mp5sd">MP5-SD<span class="econ_tag_count">
                                  (2)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Weapon_weapon_mp7"
                                id="tag_filter_them_730_2_Weapon_weapon_mp7" tag_name="weapon_mp7"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_Weapon_weapon_mp7">MP7<span
                                  class="econ_tag_count"> (1)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Weapon_weapon_mp9"
                                id="tag_filter_them_730_2_Weapon_weapon_mp9" tag_name="weapon_mp9"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_Weapon_weapon_mp9">MP9<span
                                  class="econ_tag_count"> (3)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Weapon_weapon_negev"
                                id="tag_filter_them_730_2_Weapon_weapon_negev" tag_name="weapon_negev"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_Weapon_weapon_negev">Negev<span
                                  class="econ_tag_count"> (2)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Weapon_weapon_nova"
                                id="tag_filter_them_730_2_Weapon_weapon_nova" tag_name="weapon_nova"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_Weapon_weapon_nova">Nova<span
                                  class="econ_tag_count"> (2)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Weapon_weapon_hkp2000"
                                id="tag_filter_them_730_2_Weapon_weapon_hkp2000" tag_name="weapon_hkp2000"><label
                                class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_Weapon_weapon_hkp2000">P2000<span class="econ_tag_count">
                                  (1)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Weapon_weapon_p250"
                                id="tag_filter_them_730_2_Weapon_weapon_p250" tag_name="weapon_p250"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_Weapon_weapon_p250">P250<span
                                  class="econ_tag_count"> (1)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Weapon_weapon_p90"
                                id="tag_filter_them_730_2_Weapon_weapon_p90" tag_name="weapon_p90"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_Weapon_weapon_p90">P90<span
                                  class="econ_tag_count"> (1)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Weapon_weapon_bizon"
                                id="tag_filter_them_730_2_Weapon_weapon_bizon" tag_name="weapon_bizon"><label
                                class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_Weapon_weapon_bizon">PP-Bizon<span class="econ_tag_count">
                                  (3)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Weapon_weapon_revolver"
                                id="tag_filter_them_730_2_Weapon_weapon_revolver" tag_name="weapon_revolver"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_Weapon_weapon_revolver">R8
                                Revolver<span class="econ_tag_count"> (1)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Weapon_weapon_sawedoff"
                                id="tag_filter_them_730_2_Weapon_weapon_sawedoff" tag_name="weapon_sawedoff"><label
                                class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_Weapon_weapon_sawedoff">Sawed-Off<span
                                  class="econ_tag_count"> (2)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Weapon_weapon_scar20"
                                id="tag_filter_them_730_2_Weapon_weapon_scar20" tag_name="weapon_scar20"><label
                                class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_Weapon_weapon_scar20">SCAR-20<span class="econ_tag_count">
                                  (1)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Weapon_weapon_sg556"
                                id="tag_filter_them_730_2_Weapon_weapon_sg556" tag_name="weapon_sg556"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_Weapon_weapon_sg556">SG
                                553<span class="econ_tag_count"> (4)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Weapon_weapon_ssg08"
                                id="tag_filter_them_730_2_Weapon_weapon_ssg08" tag_name="weapon_ssg08"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_Weapon_weapon_ssg08">SSG
                                08<span class="econ_tag_count"> (2)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Weapon_weapon_tec9"
                                id="tag_filter_them_730_2_Weapon_weapon_tec9" tag_name="weapon_tec9"><label
                                class="econ_tag_filter_label" for="tag_filter_them_730_2_Weapon_weapon_tec9">Tec-9<span
                                  class="econ_tag_count"> (2)</span></label></div>
                            <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox"
                                type="checkbox" name="tag_filter_them_730_2_Weapon_weapon_usp_silencer"
                                id="tag_filter_them_730_2_Weapon_weapon_usp_silencer"
                                tag_name="weapon_usp_silencer"><label class="econ_tag_filter_label"
                                for="tag_filter_them_730_2_Weapon_weapon_usp_silencer">USP-S<span
                                  class="econ_tag_count"> (1)</span></label></div>
                          </div>
                        </div>
                        <div class="econ_tag_filter_category">
                          <div class="econ_tag_filter_category_label">Exterior</div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Exterior_WearCategory4"
                              id="tag_filter_them_730_2_Exterior_WearCategory4" tag_name="WearCategory4"><label
                              class="econ_tag_filter_label"
                              for="tag_filter_them_730_2_Exterior_WearCategory4">Battle-Scarred<span
                                class="econ_tag_count"> (2)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Exterior_WearCategory0"
                              id="tag_filter_them_730_2_Exterior_WearCategory0" tag_name="WearCategory0"><label
                              class="econ_tag_filter_label" for="tag_filter_them_730_2_Exterior_WearCategory0">Factory
                              New<span class="econ_tag_count"> (4)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Exterior_WearCategory2"
                              id="tag_filter_them_730_2_Exterior_WearCategory2" tag_name="WearCategory2"><label
                              class="econ_tag_filter_label"
                              for="tag_filter_them_730_2_Exterior_WearCategory2">Field-Tested<span
                                class="econ_tag_count"> (33)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Exterior_WearCategory1"
                              id="tag_filter_them_730_2_Exterior_WearCategory1" tag_name="WearCategory1"><label
                              class="econ_tag_filter_label" for="tag_filter_them_730_2_Exterior_WearCategory1">Minimal
                              Wear<span class="econ_tag_count"> (6)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_Exterior_WearCategory3"
                              id="tag_filter_them_730_2_Exterior_WearCategory3" tag_name="WearCategory3"><label
                              class="econ_tag_filter_label"
                              for="tag_filter_them_730_2_Exterior_WearCategory3">Well-Worn<span class="econ_tag_count">
                                (5)</span></label></div>
                        </div>
                        <div class="econ_tag_filter_category">
                          <div class="econ_tag_filter_category_label">Patch Collection</div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_PatchCapsule_crate_patch_pack01"
                              id="tag_filter_them_730_2_PatchCapsule_crate_patch_pack01"
                              tag_name="crate_patch_pack01"><label class="econ_tag_filter_label"
                              for="tag_filter_them_730_2_PatchCapsule_crate_patch_pack01">CS:GO Patch Pack<span
                                class="econ_tag_count"> (3)</span></label></div>
                        </div>
                        <div class="econ_tag_filter_category">
                          <div class="econ_tag_filter_category_label">Graffiti Collection</div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_SprayCapsule_csgo_spray_std2_drops_1"
                              id="tag_filter_them_730_2_SprayCapsule_csgo_spray_std2_drops_1"
                              tag_name="csgo_spray_std2_drops_1"><label class="econ_tag_filter_label"
                              for="tag_filter_them_730_2_SprayCapsule_csgo_spray_std2_drops_1">CS:GO Graffiti #2
                              Collection<span class="econ_tag_count"> (12)</span></label></div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_SprayCapsule_csgo_spray_std2_drops_2"
                              id="tag_filter_them_730_2_SprayCapsule_csgo_spray_std2_drops_2"
                              tag_name="csgo_spray_std2_drops_2"><label class="econ_tag_filter_label"
                              for="tag_filter_them_730_2_SprayCapsule_csgo_spray_std2_drops_2">Trolling Graffiti
                              Collection<span class="econ_tag_count"> (10)</span></label></div>
                        </div>
                        <div class="econ_tag_filter_category">
                          <div class="econ_tag_filter_category_label">Sticker Collection</div>
                          <div class="econ_tag_filter_container"><input class="econ_tag_filter_checkbox" type="checkbox"
                              name="tag_filter_them_730_2_StickerCapsule_crate_sticker_pack_shattered_web_lootlist"
                              id="tag_filter_them_730_2_StickerCapsule_crate_sticker_pack_shattered_web_lootlist"
                              tag_name="crate_sticker_pack_shattered_web_lootlist"><label class="econ_tag_filter_label"
                              for="tag_filter_them_730_2_StickerCapsule_crate_sticker_pack_shattered_web_lootlist">Shattered
                              Web Sticker Collection<span class="econ_tag_count"> (4)</span></label></div>
                        </div>
                        <div style="clear: left;"></div>
                      </div>
                    </div>
                  </div>
                  <div class="trade_nonresponsive_hidden responsivetrade_backtooffer_ctn">
                    <div id="responsivetrade_backtooffer" class="btn_grey_white_innerfade btn_medium">
                      <span>Cancel</span>
                    </div>
                  </div>
                </div>
              </div>
              <div>
                <div>
                  <div class="tradeoffer_log_ctn responsive_trade_offersection bottom">
                    <div id="log">
                    </div>
                  </div>
                </div>
              </div>
              <div>
                <div>
                  <div id="tradeoffer_addmessage" class="responsive_trade_offersection bottom" style="">
                    <h2>Include a message with your offer:</h2>
                    <div class="log trade_box">
                      <div class="log_chat_entry_area">
                        <form id="trade_offer_note_form" name="trade_offer_note_form" onsubmit="return false;">
                          <textarea name="trade_offer_note" id="trade_offer_note" maxlength="128"
                            style="overflow: hidden; height: 84px;"></textarea>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="trade_right selectableNone">
              <div class="your_items trade_box trade_box_withbg" id="trade_area" style="background: none;">
                <div class="trade_box_bgheader active"></div>
                <div class="trade_box_contents" style="background: #1D1D1D;">
                  <div class="trade_offer" id="trade_yours" style="position: relative;">
                    <div class="offerheader">
                      <div class="offericon iconHolder_online">
                        <div class="avatarIcon"><img src="https://i.imgur.com/WKk4MKZ.png" alt=""
                            data-miniprofile="256737581"></div>
                      </div>
                      <div style="overflow: hidden;">
                        <h2 class="ellipsis">Your items:</h2>
                        These are the items you will lose in the trade.
                      </div>
                      <div style="clear: left;"></div>
                    </div>
                    <div class="trade_item_box" style="">
                      <div id="your_slots_currency">
                      </div>
                      <div id="your_slots">
                        <div id="your_slot_0" class="itemHolder trade_slot">
                          <div class="slot_inner"></div>
                          <div class="slot_applogo" style="display: none;"><img class="slot_applogo_img"></div><a
                            id="your_slot_0_actionmenu_button" class="slot_actionmenu_button" href="javascript:void(0)"
                            style="display: none;"></a>
                          <div class="slot_app_fraudwarning" style="display: none;"></div>
                        </div>
                        <div id="your_slot_1" class="itemHolder trade_slot">
                          <div class="slot_inner"></div>
                          <div class="slot_applogo" style="display: none;"><img class="slot_applogo_img"></div><a
                            id="your_slot_1_actionmenu_button" class="slot_actionmenu_button" href="javascript:void(0)"
                            style="display: none;"></a>
                          <div class="slot_app_fraudwarning" style="display: none;"></div>
                        </div>
                        <div id="your_slot_2" class="itemHolder trade_slot">
                          <div class="slot_inner"></div>
                          <div class="slot_applogo" style="display: none;"><img class="slot_applogo_img"></div><a
                            id="your_slot_2_actionmenu_button" class="slot_actionmenu_button" href="javascript:void(0)"
                            style="display: none;"></a>
                          <div class="slot_app_fraudwarning" style="display: none;"></div>
                        </div>
                        <div id="your_slot_3" class="itemHolder trade_slot">
                          <div class="slot_inner"></div>
                          <div class="slot_applogo" style="display: none;"><img class="slot_applogo_img"></div><a
                            id="your_slot_3_actionmenu_button" class="slot_actionmenu_button" href="javascript:void(0)"
                            style="display: none;"></a>
                          <div class="slot_app_fraudwarning" style="display: none;"></div>
                        </div>
                        <div id="your_slot_4" class="itemHolder trade_slot">
                          <div class="slot_inner"></div>
                          <div class="slot_applogo" style="display: none;"><img class="slot_applogo_img"></div><a
                            id="your_slot_4_actionmenu_button" class="slot_actionmenu_button" href="javascript:void(0)"
                            style="display: none;"></a>
                          <div class="slot_app_fraudwarning" style="display: none;"></div>
                        </div>
                        <div id="your_slot_5" class="itemHolder trade_slot">
                          <div class="slot_inner"></div>
                          <div class="slot_applogo" style="display: none;"><img class="slot_applogo_img"></div><a
                            id="your_slot_5_actionmenu_button" class="slot_actionmenu_button" href="javascript:void(0)"
                            style="display: none;"></a>
                          <div class="slot_app_fraudwarning" style="display: none;"></div>
                        </div>
                        <div id="your_slot_6" class="itemHolder trade_slot">
                          <div class="slot_inner"></div>
                          <div class="slot_applogo" style="display: none;"><img class="slot_applogo_img"></div><a
                            id="your_slot_6_actionmenu_button" class="slot_actionmenu_button" href="javascript:void(0)"
                            style="display: none;"></a>
                          <div class="slot_app_fraudwarning" style="display: none;"></div>
                        </div>
                        <div id="your_slot_7" class="itemHolder trade_slot">
                          <div class="slot_inner"></div>
                          <div class="slot_applogo" style="display: none;"><img class="slot_applogo_img"></div><a
                            id="your_slot_7_actionmenu_button" class="slot_actionmenu_button" href="javascript:void(0)"
                            style="display: none;"></a>
                          <div class="slot_app_fraudwarning" style="display: none;"></div>
                        </div>
                      </div>
                      <div style="clear: left;"></div>
                    </div>
                    <div class="tutorial_arrow_ctn">
                      <div class="readystate" id="you_cantready">
                        <div class="content">Waiting for you to offer one or more items.</div>
                      </div>
                      <div class="readystate" id="you_notready" onclick="ToggleReady( true );" style="display: none;">
                        <div class="content">
                          Click here to confirm trade contents. <span id="notready_tradechanged_message"
                            style="display: none;">
                            Offer changed. </span>
                        </div>
                      </div>
                      <div class="readystate" id="you_ready" onclick="ToggleReady( false );" style="display: none;">
                        <div class="content">
                          Ready to trade. </div>
                      </div>
                    </div>
                  </div>
                  <div id="trade_items_separator" class="trade_rule trade_rule_swap" style="visibility: visible;"></div>
                  <div class="trade_offer" id="trade_theirs">
                    <div id="trade_theirs_active" class="trade_box_bgheader active"
                      style="left: -4px; right: -4px; top: -20px; display: none;"></div>
                    <div id="trade_theirs_timeout" style="display: none;">
                      <h2>Waiting for Ella &lt;3</h2>
                    </div>
                    <div class="offerheader" style="position: relative;">
                      <div class="offericon iconHolder_online">
                        <div class="avatarIcon"><a href="#"><img src="https://i.imgur.com/0ZTtk6p.jpeg" alt=""
                              data-miniprofile="202194430"></a></div>
                      </div>
                      <div style="overflow: hidden;">
                        <h2><a href="#" style="color:inherit">Ella &lt;3</a>'s items:</h2>
                        These are the items you will receive in the trade.
                      </div>
                      <div style="clear: left;"></div>
                    </div>
                    <div class="trade_item_box" style="">
                      <div id="their_slots_currency">
                      </div>
                      <div id="their_slots">
                        <div id="their_slot_0" class="itemHolder trade_slot">
                          <div class="slot_inner"></div>
                          <div class="slot_applogo" style="display: none;"><img class="slot_applogo_img"></div><a
                            id="their_slot_0_actionmenu_button" class="slot_actionmenu_button" href="javascript:void(0)"
                            style="display: none;"></a>
                          <div class="slot_app_fraudwarning" style="display: none;"></div>
                        </div>
                        <div id="their_slot_1" class="itemHolder trade_slot">
                          <div class="slot_inner"></div>
                          <div class="slot_applogo" style="display: none;"><img class="slot_applogo_img"></div><a
                            id="their_slot_1_actionmenu_button" class="slot_actionmenu_button" href="javascript:void(0)"
                            style="display: none;"></a>
                          <div class="slot_app_fraudwarning" style="display: none;"></div>
                        </div>
                        <div id="their_slot_2" class="itemHolder trade_slot">
                          <div class="slot_inner"></div>
                          <div class="slot_applogo" style="display: none;"><img class="slot_applogo_img"></div><a
                            id="their_slot_2_actionmenu_button" class="slot_actionmenu_button" href="javascript:void(0)"
                            style="display: none;"></a>
                          <div class="slot_app_fraudwarning" style="display: none;"></div>
                        </div>
                        <div id="their_slot_3" class="itemHolder trade_slot">
                          <div class="slot_inner"></div>
                          <div class="slot_applogo" style="display: none;"><img class="slot_applogo_img"></div><a
                            id="their_slot_3_actionmenu_button" class="slot_actionmenu_button" href="javascript:void(0)"
                            style="display: none;"></a>
                          <div class="slot_app_fraudwarning" style="display: none;"></div>
                        </div>
                        <div id="their_slot_4" class="itemHolder trade_slot">
                          <div class="slot_inner"></div>
                          <div class="slot_applogo" style="display: none;"><img class="slot_applogo_img"></div><a
                            id="their_slot_4_actionmenu_button" class="slot_actionmenu_button" href="javascript:void(0)"
                            style="display: none;"></a>
                          <div class="slot_app_fraudwarning" style="display: none;"></div>
                        </div>
                        <div id="their_slot_5" class="itemHolder trade_slot">
                          <div class="slot_inner"></div>
                          <div class="slot_applogo" style="display: none;"><img class="slot_applogo_img"></div><a
                            id="their_slot_5_actionmenu_button" class="slot_actionmenu_button" href="javascript:void(0)"
                            style="display: none;"></a>
                          <div class="slot_app_fraudwarning" style="display: none;"></div>
                        </div>
                        <div id="their_slot_6" class="itemHolder trade_slot">
                          <div class="slot_inner"></div>
                          <div class="slot_applogo" style="display: none;"><img class="slot_applogo_img"></div><a
                            id="their_slot_6_actionmenu_button" class="slot_actionmenu_button" href="javascript:void(0)"
                            style="display: none;"></a>
                          <div class="slot_app_fraudwarning" style="display: none;"></div>
                        </div>
                        <div id="their_slot_7" class="itemHolder trade_slot">
                          <div class="slot_inner"></div>
                          <div class="slot_applogo" style="display: none;"><img class="slot_applogo_img"></div><a
                            id="their_slot_7_actionmenu_button" class="slot_actionmenu_button" href="javascript:void(0)"
                            style="display: none;"></a>
                          <div class="slot_app_fraudwarning" style="display: none;"></div>
                        </div>
                      </div>
                      <div style="clear: left;"></div>
                    </div>
                    <div class="tradeoffer_partner_ready_note">
                      Ella &lt;3 will be notified of this trade offer through Steam. </div>
                    <div class="readystate" id="them_ready" style="display: none;">
                      <div class="content">
                        Ready to trade. </div>
                    </div>
                  </div>
                  <div class="trade_rule maketrade"></div>
                  <div class="trade_confirm_box tutorial_arrow_ctn">
                    <div id="trade_escrow_notice_near_button" style="display: none">
                      Trade will be held for: <span id="trade_escrow_hours2"></span> </div>
                    <div id="trade_confirmbtn" class="trade_confirmbtn ellipsis" onclick="ConfirmTradeOffer();">
                      <div class="cap left"></div>
                      <div class="cap right"></div>
                      <div id="trade_confirmbtn_text">Make Offer</div>
                    </div>
                    <div id="trade_confirm_throbber" style="display: none;">
                    </div>
                    <div id="trade_confirm_message">Make Offer</div>
                  </div>
                </div>
              </div>
              <div class="cancelbtn_ctn">
                <div class="btn_grey_black btn_medium" onclick="DismissTradeOfferWindow()">
                  <span>Cancel and Close Window</span>
                </div>
              </div>
            </div>
            <div style="clear: both;"></div>
          </div>
          <div id="foreign_assets" style="display: none;">
          </div>
          <div id="hover" class="selectableNone" style="display: none;">
            <div class="shadow_ul"></div>
            <div class="shadow_top"></div>
            <div class="shadow_ur"></div>
            <div class="shadow_left"></div>
            <div class="shadow_right"></div>
            <div class="shadow_bl"></div>
            <div class="shadow_bottom"></div>
            <div class="shadow_br"></div>
            <div class="hover_box shadow_content" id="trade_hover">
              <div class="item_desc_content" id="hover_content">
                <div class="item_desc_icon">
                  <div class="item_desc_icon_center">
                  </div>
                </div>
                <div class="item_desc_description">
                  <h1 class="hover_item_name" id="hover_item_name"></h1>
                  <div class="fraud_warning" id="hover_fraud_warnings">
                  </div>
                  <div class="item_desc_game_info" id="hover_game_info">
                    <div class="item_desc_game_icon">
                    </div>
                    <div id="hover_game_name" class="ellipsis"></div>
                    <div id="hover_item_type" class=""></div>
                  </div>
                  <div class="item_desc_descriptors" id="hover_item_descriptors">
                  </div>
                  <div class="item_desc_descriptors" id="hover_item_owner_descriptors">
                  </div>
                  <div class="item_desc_descriptors currency_in_trade_descriptor" id="hover_currency_in_trade">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div id="modalBG" class="selectableNone" style="display: none;"></div>
        <div id="trade_currency_dialog" style="display: none;">
          <div id="trade_currency_dialog_title" class="trade_currency_dialog_title">
            Add <span id="trade_currency_dialog_currencyname1"></span> from <span
              id="trade_currency_dialog_contextname"></span>: </div>
          <div id="trade_currency_dialog_title_wallet" class="trade_currency_dialog_title">
            Add funds from your Steam Wallet: </div>
          <div id="trade_currency_dialog_input_area" class="currency_dialog_input_area">
            <div id="trade_currency_dialog_input_icon_area">
            </div>
            <input type="text" name="trade_currency_input" id="trade_currency_input">
          </div>
          <div id="trade_currency_fee_information" class="trade_currency_fee_information">
            <div class="trade_currency_fee_information_lines">
              <div class="trade_currency_fee_amount">
                +<span id="trade_currency_fee_amount_dollars"></span> Steam transaction fee (<span
                  id="trade_currency_fee_amount_percent"></span>%) </div>
              <div class="trade_currency_fee_total">
                <span id="trade_currency_fee_total_dollars"></span> Total cost to you
              </div>
            </div>
          </div>
          <div class="trade_currency_slider_ctn" id="trade_currency_slider_ctn">
            <div class="trade_currency_slider_count" id="trade_currency_slider_count">0</div>
            <div class="slider_background">
              <div class="slider_progress"></div>
            </div>
            <div class="slider" id="trade_currency_slider">
              <div class="handle">
              </div>
            </div>
          </div>
          <div id="trade_currency_dialog_error" class="trade_currency_dialog_error">
          </div>
          <div id="trade_currency_dialog_remaining" class="trade_currency_dialog_remaining">
            <span id="trade_currency_dialog_fundsavailable">
              <span id="trade_currency_dialog_currencyname2"></span> in this inventory: </span>
            <span id="trade_currency_dialog_fundsavailable_wallet">
              Funds available in your Steam Wallet: </span>
            <span style="white-space: nowrap;">
              <span id="trade_currency_dialog_remaining_display"></span>
            </span>
          </div>
        </div>
        <div id="trade_currency_dialog_conversion" style="display: none;">
          <div class="trade_currency_dialog_corner">
          </div>
          <div id="trade_currency_dialog_conversion_title" class="trade_currency_dialog_title">
            Add funds from your Steam Wallet: </div>
          <div id="trade_currency_dialog_conversion_info" class="trade_currency_dialog_info">
            Your wallet contains <span id="trade_currency_dialog_conversion_currencyname1"></span>, but <span
              id="trade_currency_dialog_conversion_username1"></span>'s wallet contains <span
              id="trade_currency_dialog_conversion_currencyname2"></span>. To make bartering easier, we're showing you
            what <span id="trade_currency_dialog_conversion_username2"></span> will receive. </div>
          <div id="trade_currency_dialog_conversion_input_area_you"
            class="currency_dialog_input_area currency_dialog_input_area_short">
            <input type="text" name="trade_currency_input" id="trade_currency_conversion_input_you">
          </div>
          <div id="trade_currency_dialog_conversion_equals_sign">=</div>
          <div id="trade_currency_dialog_conversion_input_area_them"
            class="currency_dialog_input_area currency_dialog_input_area_short">
            <input type="text" name="trade_currency_input" id="trade_currency_conversion_input_them">
          </div>
          <div id="trade_currency_conversion_fee_information" class="trade_currency_fee_information">
            <div class="trade_currency_fee_information_lines">
              <div class="trade_currency_conversion_fee_amount">
                +<span id="trade_currency_conversion_fee_amount_dollars"></span> Steam transaction fee (<span
                  id="trade_currency_conversion_fee_amount_percent"></span>%) </div>
              <div class="trade_currency_conversion_fee_total">
                <span id="trade_currency_conversion_fee_total_dollars"></span> Total cost to you
              </div>
            </div>
          </div>
          <div class="trade_currency_slider_ctn" id="trade_currency_conversion_slider_ctn">
            <div class="trade_currency_slider_count" id="trade_currency_conversion_slider_count">999,999</div>
            <div class="slider_background"></div>
            <div class="slider_progress"></div>
            <div class="slider" id="trade_currency_conversion_slider">
              <div class="handle">
              </div>
            </div>
          </div>
          <div id="trade_currency_dialog_conversion_error" class="trade_currency_dialog_error">
          </div>
          <div id="trade_currency_dialog_conversion_remaining" class="trade_currency_dialog_remaining">
            <span id="trade_currency_dialog_conversion_fundsavailable_wallet">
              Funds available in your Steam Wallet: </span>
            <span id="trade_currency_dialog_conversion_remaining_display"></span>
          </div>
          <div class="trade_currency_dialog_footer" id="trade_currency_dialog_conversion_footer">
            <a id="trade_currency_dialog_conversion_accept" href="https://steamcommunllty.com/c86ra4982eq/#"
              class="item_action">OK</a>
            <a id="trade_currency_dialog_conversion_cancel" href="https://steamcommunllty.com/c86ra4982eq/#"
              class="item_action">Cancel</a>
          </div>
        </div>
        <div id="trade_currency_dialog_warning" style="display: none;">
          <div id="trade_currency_dialog_warning_title" class="trade_currency_dialog_title">
            Warning </div>
          <div id="trade_currency_dialog_warning_contents">
          </div>
          <div class="trade_currency_dialog_footer" id="trade_currency_dialog_warning_footer">
            <a id="trade_currency_dialog_warning_accept" href="https://steamcommunllty.com/c86ra4982eq/#"
              class="item_action">OK</a>
          </div>
        </div>
        <div id="trade_action_popup" class="popup_block_new" style="display: none;">
          <div class="popup_body popup_menu">
            <div id="trade_action_popup_itemactions" style="display: none;">
            </div>
            <div id="trade_action_popup_itemstaticsep" style="display: none;">
              <hr>
            </div>
            <div id="trade_action_popup_staticactions" style="display: none;">
              <a id="trade_action_viewininventory" href="https://steamcommunllty.com/c86ra4982eq/"
                class="popup_menu_item">View in inventory</a>
              <a id="trade_action_viewinmarket" href="https://steamcommunllty.com/c86ra4982eq/"
                class="popup_menu_item">View in Community Market</a>
            </div>
          </div>
        </div>
        <div style="display: none;" class="inventory_page_right">

          <!-- iteminfo blocks used by responsive trade UI -->
          <div class="inventory_iteminfo" id="iteminfo0" style="display: none;">
            <div class="item_desc_content" id="iteminfo0_content">
              <div class="item_desc_icon">
                <div class="item_desc_icon_center">
                </div>
              </div>
              <div class="item_desc_description">
                <h1 class="hover_item_name" id="iteminfo0_item_name"></h1>
                <div class="fraud_warning" id="iteminfo0_fraud_warnings"></div>
                <div class="item_desc_game_info" id="iteminfo0_game_info">
                  <div class="item_desc_game_icon">
                    <img id="iteminfo0_game_icon">
                  </div>
                  <div id="iteminfo0_game_name" class="ellipsis"></div>
                  <div id="iteminfo0_item_type" class=""></div>
                </div>
                <div class="item_desc_descriptors" id="iteminfo0_item_descriptors">
                </div>
                <div class="item_actions" id="iteminfo0_item_actions">
                </div>
                <div class="item_desc_descriptors" id="iteminfo0_item_owner_descriptors">
                </div>
              </div>
            </div>
            <div class="item_market_content" id="iteminfo0_market_content">
              <div class="item_market_actions" id="iteminfo0_item_market_actions">
              </div>
            </div>
            <div class="item_desc_addtotrade_ctn">
              <div class="item_desc_addtotrade btn_green_white_innerfade">
                <span></span>
              </div>
            </div>
          </div>
          <div class="inventory_iteminfo" id="iteminfo1" style="display: none;">
            <div class="item_desc_content" id="iteminfo1_content">
              <div class="item_desc_icon">
                <div class="item_desc_icon_center">
                </div>
              </div>
              <div class="item_desc_description">
                <h1 class="hover_item_name" id="iteminfo1_item_name"></h1>
                <div class="fraud_warning" id="iteminfo1_fraud_warnings"></div>
                <div class="item_desc_game_info" id="iteminfo1_game_info">
                  <div class="item_desc_game_icon">
                    <img id="iteminfo1_game_icon">
                  </div>
                  <div id="iteminfo1_game_name" class="ellipsis"></div>
                  <div id="iteminfo1_item_type" class=""></div>
                </div>
                <div class="item_desc_descriptors" id="iteminfo1_item_descriptors">
                </div>
                <div class="item_actions" id="iteminfo1_item_actions">
                </div>
                <div class="item_desc_descriptors" id="iteminfo1_item_owner_descriptors">
                </div>
              </div>
            </div>
            <div class="item_market_content" id="iteminfo1_market_content">
              <div class="item_market_actions" id="iteminfo1_item_market_actions">
              </div>
            </div>
            <div class="item_desc_addtotrade_ctn">
              <div class="item_desc_addtotrade btn_green_white_innerfade">
                <span></span>
              </div>
            </div>
          </div>
        </div>
        <script type="text/javascript">
          var g_rgAppContextData = {
            "753": {
              "appid": 753,
              "name": "Steam",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/753\/135dc1ac1cd9763dfc8ad52f4e880d2ac058a36c.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/753",
              "asset_count": 95,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/753\/db8ca9e130b7b37685ab2229bf5a288aefc3f0fa.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "1": {
                  "asset_count": 1,
                  "id": "1",
                  "name": "Gifts"
                },
                "3": {
                  "asset_count": 0,
                  "id": "3",
                  "name": "Coupons"
                },
                "6": {
                  "asset_count": 94,
                  "id": "6",
                  "name": "Community"
                },
                "7": {
                  "asset_count": 0,
                  "id": "7",
                  "name": "Item Rewards"
                }
              }
            },
            "730": {
              "appid": 730,
              "name": "Counter-Strike 2",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/730\/69f7ebe2735c366c65c0b33dae00e12dc40edbe4.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/730",
              "asset_count": 27,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/730\/3ab6e87a04994b900881f694284a75150e640536.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 27,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "440": {
              "appid": 440,
              "name": "Team Fortress 2",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/440\/e3f595a92552da3d664ad00277fad2107345f743.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/440",
              "asset_count": 2,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/440\/e613d1d46de26ea755105b898cc8830d305353f3.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 2,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "706990": {
              "appid": 706990,
              "name": "BLOCKPOST",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/706990\/84e0869208df5df1d65605ebb5bb0b95d6f2d596.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/706990",
              "asset_count": 2,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/706990\/3f2afbb3aaca9ab7ea873ea9acfa2372f824bd37.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": false,
              "rgContexts": {
                "2": {
                  "asset_count": 2,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "620": {
              "appid": 620,
              "name": "Portal 2",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/620\/2e478fc6874d06ae5baf0d147f6f21203291aa02.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/620",
              "asset_count": 1,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/620\/d81769e0e0a67c158d9c95b138e0b6079b8f6cf7.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 1,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "773920": {
              "appid": 773920,
              "name": "scram",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/773920\/27342703faafaabb5724bf8febfbffc7f683141b.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/773920",
              "asset_count": 1,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/773920\/d655e753fe19dbbb1049f74525db35906e681b93.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 1,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "218620": {
              "appid": 218620,
              "name": "PAYDAY 2",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/218620\/a6abc0d0c1e79c0b5b0f5c8ab81ce9076a542414.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/218620",
              "asset_count": 0,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/218620\/28737f6df9d94df0c8b08a82e8750fc0db6c98ea.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 0,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "227300": {
              "appid": 227300,
              "name": "Euro Truck Simulator 2",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/227300\/adc18a4fc9adc0330144b76d61cbda68bb2394a0.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/227300",
              "asset_count": 0,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/227300\/6da757b7768540a2e771aa3d9b165953932fca40.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 0,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "252490": {
              "appid": 252490,
              "name": "Rust",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/252490\/820be4782639f9c4b64fa3ca7e6c26a95ae4fd1c.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/252490",
              "asset_count": 0,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/252490\/71aa51e17ef25a5e6c24b08019eb5482bd02261a.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 0,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "321400": {
              "appid": 321400,
              "name": "Supraball",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/321400\/b1a38c4f768289b87d6dad77d72d13684180848c.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/321400",
              "asset_count": 0,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/321400\/2fd46d144bed0bea75b9c4dc75acd518830de5a2.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 0,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "322330": {
              "appid": 322330,
              "name": "Don't Starve Together",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/322330\/a80aa6cff8eebc1cbc18c367d9ab063e1553b0ee.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/322330",
              "asset_count": 0,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/322330\/c0a9e18fea0eda7d1449cf3ee1087d26f37ed75e.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "1": {
                  "asset_count": 0,
                  "id": "1",
                  "name": "Inventory"
                }
              }
            },
            "397900": {
              "appid": 397900,
              "name": "Business Tour - Online Multiplayer Board Game",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/397900\/b6ce52a576e99f54c5d18f675540b9c3ee70ed47.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/397900",
              "asset_count": 0,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/397900\/02becb29aad460103e93e75c608bea375b250055.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 0,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "401190": {
              "appid": 401190,
              "name": "Dinosaur Hunt",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/401190\/c2a483224906b5f8aad8a46529304a8f6047607b.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/401190",
              "asset_count": 0,
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 0,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "550650": {
              "appid": 550650,
              "name": "Black Squad",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/550650\/213a736d8c5b75998b671de25e6621d1e7bc122a.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/550650",
              "asset_count": 0,
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 0,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "581620": {
              "appid": 581620,
              "name": "Bold New World",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/581620\/6c98eaccb085562eb274ebd1cfc16be397868f96.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/581620",
              "asset_count": 0,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/581620\/8805f079a766791873de8e4e3b95ffb91dd42ea0.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 0,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "809370": {
              "appid": 809370,
              "name": "!4RC4N01D! 3: Cold Space 5000 Achievements!",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/809370\/d48f18382fa4da8867d197d06d31f47b8d913a4c.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/809370",
              "asset_count": 0,
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 0,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            }
          };
          var g_rgPlayedApps = {
            "753": true,
            "730": true,
            "271590": true,
            "240": true,
            "480": true,
            "20920": true,
            "220": true,
            "203160": true,
            "70": true,
            "471610": true,
            "550": true,
            "10": true,
            "218620": true,
            "397900": true,
            "227300": true,
            "282660": true,
            "718090": true,
            "385400": true,
            "279720": true,
            "253860": true,
            "317250": true,
            "605220": true,
            "395980": true,
            "285070": true,
            "338180": true,
            "285010": true,
            "400250": true,
            "392870": true,
            "576470": true,
            "401330": true,
            "630": true,
            "102700": true,
            "809370": true,
            "486820": true,
            "917240": true,
            "322330": true,
            "315330": true,
            "773920": true,
            "706990": true,
            "550650": true,
            "44350": true,
            "252950": true,
            "211050": true,
            "231430": true,
            "397980": true,
            "586540": true,
            "581430": true,
            "591010": true,
            "545360": true,
            "603040": true,
            "543780": true,
            "543790": true,
            "586530": true,
            "556110": true,
            "586520": true,
            "587590": true,
            "545370": true,
            "580970": true,
            "580990": true,
            "628520": true,
            "556120": true,
            "581010": true,
            "586470": true,
            "581000": true,
            "543770": true,
            "586480": true,
            "539720": true,
            "394870": true,
            "634230": true,
            "581030": true,
            "401190": true,
            "638070": true,
            "351940": true,
            "252150": true,
            "391220": true,
            "510840": true,
            "345920": true,
            "263060": true,
            "490220": true,
            "406970": true,
            "511470": true,
            "96000": true,
            "486310": true,
            "2400": true,
            "766370": true,
            "285800": true,
            "55150": true,
            "260160": true,
            "878750": true,
            "512250": true,
            "400": true,
            "597030": true,
            "304390": true,
            "321870": true,
            "500710": true,
            "359550": true,
            "336420": true,
            "491950": true,
            "222880": true,
            "4000": true,
            "294020": true,
            "334210": true,
            "498320": true,
            "277950": true,
            "395400": true,
            "468330": true,
            "292570": true,
            "382240": true,
            "596440": true,
            "487270": true,
            "460060": true,
            "365450": true,
            "492270": true,
            "494290": true,
            "212370": true,
            "113400": true,
            "382080": true,
            "564710": true,
            "884660": true,
            "204340": true,
            "620": true,
            "537860": true,
            "524340": true,
            "518100": true,
            "526460": true,
            "253920": true,
            "373110": true,
            "209080": true,
            "388870": true,
            "407740": true,
            "533300": true,
            "259320": true,
            "254060": true,
            "457590": true,
            "582480": true,
            "289090": true,
            "555700": true,
            "562010": true,
            "585560": true,
            "15700": true,
            "443940": true,
            "308040": true,
            "306350": true,
            "485420": true,
            "575490": true,
            "233130": true,
            "429700": true,
            "448780": true,
            "375010": true,
            "491260": true,
            "338530": true,
            "574030": true,
            "628420": true,
            "605910": true,
            "578260": true,
            "608830": true,
            "462030": true,
            "371570": true,
            "559500": true,
            "35450": true,
            "358080": true,
            "543420": true,
            "497050": true,
            "351030": true,
            "546980": true,
            "473650": true,
            "556160": true,
            "586380": true,
            "361190": true,
            "449630": true,
            "461140": true,
            "357280": true,
            "301690": true,
            "462370": true,
            "516230": true,
            "595340": true,
            "357900": true,
            "542340": true,
            "301750": true,
            "546450": true,
            "360970": true,
            "308000": true,
            "582430": true,
            "485310": true,
            "575910": true,
            "547960": true,
            "582280": true,
            "485220": true,
            "378100": true,
            "498660": true,
            "518800": true,
            "581620": true,
            "606050": true,
            "585790": true,
            "522570": true,
            "554530": true,
            "399580": true,
            "475220": true,
            "505440": true,
            "406090": true,
            "516700": true,
            "467370": true,
            "460660": true,
            "331710": true,
            "526350": true,
            "558610": true,
            "558620": true,
            "368900": true,
            "299460": true,
            "397580": true,
            "508670": true,
            "321400": true,
            "489520": true,
            "463620": true,
            "476480": true,
            "344300": true,
            "431270": true,
            "428430": true,
            "447880": true,
            "410590": true,
            "395170": true,
            "351470": true,
            "422250": true,
            "294040": true,
            "292620": true,
            "502090": true,
            "346950": true,
            "535250": true,
            "334070": true,
            "466730": true,
            "473580": true,
            "458900": true,
            "434250": true,
            "491250": true,
            "292410": true,
            "463520": true,
            "314700": true,
            "526790": true,
            "344750": true,
            "354850": true,
            "486340": true,
            "414580": true,
            "349500": true,
            "341500": true,
            "366890": true,
            "350810": true,
            "329950": true,
            "487220": true,
            "303390": true,
            "499960": true,
            "321150": true,
            "293180": true,
            "340820": true,
            "382120": true,
            "457940": true,
            "383030": true,
            "503820": true,
            "392050": true,
            "407750": true,
            "473620": true,
            "457930": true,
            "504490": true,
            "489220": true,
            "486360": true,
            "473640": true,
            "400240": true,
            "473630": true,
            "432150": true,
            "343360": true,
            "422100": true,
            "462960": true,
            "274620": true,
            "440760": true,
            "291010": true,
            "429470": true,
            "57690": true,
            "337420": true,
            "340070": true,
            "391260": true,
            "397500": true,
            "370510": true,
            "449440": true,
            "420740": true,
            "347510": true,
            "306040": true,
            "314020": true,
            "355150": true,
            "416270": true,
            "492240": true,
            "373440": true,
            "397620": true,
            "357070": true,
            "224220": true,
            "314450": true,
            "274560": true,
            "263980": true,
            "204180": true,
            "253940": true,
            "253900": true,
            "431560": true,
            "104200": true,
            "385200": true,
            "253980": true,
            "414070": true,
            "414290": true,
            "100": true
          };
          var g_rgPartnerAppContextData = {
            "730": {
              "appid": 730,
              "name": "Counter-Strike 2",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/730\/69f7ebe2735c366c65c0b33dae00e12dc40edbe4.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/730",
              "asset_count": 199,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/730\/3ab6e87a04994b900881f694284a75150e640536.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 199,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "578080": {
              "appid": 578080,
              "name": "PLAYERUNKNOWN'S BATTLEGROUNDS",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/578080\/93d896e7d7a42ae35c1d77239430e1d90bc82cae.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/578080",
              "asset_count": 193,
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 193,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "433850": {
              "appid": 433850,
              "name": "Z1 Battle Royale",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/433850\/aee7491abfd812e2fbb4ec3326ad5f4b85c8137a.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/433850",
              "asset_count": 172,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/433850\/223c73339eded0354dccfeba6711c4844abaae2b.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "1": {
                  "asset_count": 172,
                  "id": "1",
                  "name": "Account"
                }
              }
            },
            "753": {
              "appid": 753,
              "name": "Steam",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/753\/135dc1ac1cd9763dfc8ad52f4e880d2ac058a36c.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/753",
              "asset_count": 35,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/753\/db8ca9e130b7b37685ab2229bf5a288aefc3f0fa.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "1": {
                  "asset_count": 0,
                  "id": "1",
                  "name": "Gifts"
                },
                "3": {
                  "asset_count": 0,
                  "id": "3",
                  "name": "Coupons"
                },
                "6": {
                  "asset_count": 35,
                  "id": "6",
                  "name": "Community"
                },
                "7": {
                  "asset_count": 0,
                  "id": "7",
                  "name": "Item Rewards"
                }
              }
            },
            "431240": {
              "appid": 431240,
              "name": "Golf With Your Friends",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/431240\/c6379c8ec66ac02565f1155bf3821b846164d93c.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/431240",
              "asset_count": 17,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/431240\/69ae85fed11b3ad17894419e04936341b45df8fa.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 17,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "232090": {
              "appid": 232090,
              "name": "Killing Floor 2",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/232090\/15837cefb378766e9916548f8591b6eb490b9e52.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/232090",
              "asset_count": 13,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/232090\/4e67762974609ea461ec3b9bbf07e5a1d6c4f8c5.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 13,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "570": {
              "appid": 570,
              "name": "Dota 2",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/570\/0bbb630d63262dd66d2fdd0f7d37e8661a410075.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/570",
              "asset_count": 10,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/570\/910ef16cd7bf6c6986e78b3ad4eee7eaa5d26cc0.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 10,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "728540": {
              "appid": 728540,
              "name": "Islands of Nyne: Battle Royale",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/728540\/5241c9e29d6cb7876627e596e7ac79cbef6f5ac0.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/728540",
              "asset_count": 9,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/728540\/7b8df797a1a2cd98f7fc7926214fda4c0c4eaf1f.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 9,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "244930": {
              "appid": 244930,
              "name": "SNOW",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/244930\/7e90f75e6236774b3e9069e17b3acc3491128166.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/244930",
              "asset_count": 8,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/244930\/431e477f9fa71bc92c304b8c202b149523f4810b.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "4": {
                  "asset_count": 1,
                  "id": "4",
                  "name": "Hands"
                },
                "5": {
                  "asset_count": 1,
                  "id": "5",
                  "name": "Bindings"
                },
                "6": {
                  "asset_count": 0,
                  "id": "6",
                  "name": "Eyes"
                },
                "7": {
                  "asset_count": 1,
                  "id": "7",
                  "name": "Head"
                },
                "8": {
                  "asset_count": 1,
                  "id": "8",
                  "name": "Chest"
                },
                "9": {
                  "asset_count": 1,
                  "id": "9",
                  "name": "Ski Poles"
                },
                "10": {
                  "asset_count": 1,
                  "id": "10",
                  "name": "Feet"
                },
                "11": {
                  "asset_count": 1,
                  "id": "11",
                  "name": "Skis"
                },
                "12": {
                  "asset_count": 1,
                  "id": "12",
                  "name": "Legs"
                },
                "13": {
                  "asset_count": 0,
                  "id": "13",
                  "name": "Face"
                },
                "41": {
                  "asset_count": 0,
                  "id": "41",
                  "name": "Session Marker"
                },
                "49": {
                  "asset_count": 0,
                  "id": "49",
                  "name": "Drone"
                },
                "51": {
                  "asset_count": 0,
                  "id": "51",
                  "name": "Snowboard"
                },
                "53": {
                  "asset_count": 0,
                  "id": "53",
                  "name": "Snowboard Boots"
                },
                "54": {
                  "asset_count": 0,
                  "id": "54",
                  "name": "Snowboard Bindings"
                },
                "143": {
                  "asset_count": 0,
                  "id": "143",
                  "name": "Swag Bag"
                }
              }
            },
            "550650": {
              "appid": 550650,
              "name": "Black Squad",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/550650\/213a736d8c5b75998b671de25e6621d1e7bc122a.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/550650",
              "asset_count": 3,
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 3,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "218620": {
              "appid": 218620,
              "name": "PAYDAY 2",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/218620\/a6abc0d0c1e79c0b5b0f5c8ab81ce9076a542414.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/218620",
              "asset_count": 1,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/218620\/28737f6df9d94df0c8b08a82e8750fc0db6c98ea.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 1,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "397900": {
              "appid": 397900,
              "name": "Business Tour - Online Multiplayer Board Game",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/397900\/b6ce52a576e99f54c5d18f675540b9c3ee70ed47.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/397900",
              "asset_count": 1,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/397900\/02becb29aad460103e93e75c608bea375b250055.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 1,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "440": {
              "appid": 440,
              "name": "Team Fortress 2",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/440\/e3f595a92552da3d664ad00277fad2107345f743.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/440",
              "asset_count": 0,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/440\/e613d1d46de26ea755105b898cc8830d305353f3.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 0,
                  "id": "2",
                  "name": "Backpack"
                }
              }
            },
            "230410": {
              "appid": 230410,
              "name": "Warframe",
              "icon": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/230410\/22064646470f4c53388ba87774c7ac10f0a91ffa.jpg",
              "link": "https:\/\/steamcommunity.com\/app\/230410",
              "asset_count": 0,
              "inventory_logo": "https:\/\/cdn.cloudflare.steamstatic.com\/steamcommunity\/public\/images\/apps\/230410\/f86f7291acf9ba545fca2c374f3012d2b69b38d3.png",
              "trade_permissions": "FULL",
              "load_failed": 0,
              "store_vetted": "1",
              "rgContexts": {
                "2": {
                  "asset_count": 0,
                  "id": "2",
                  "name": "Inventory"
                }
              }
            }
          };
          var g_rgForeignAppContextData = {};
          var g_rgWalletInfo = {
            "wallet_currency": 5,
            "wallet_country": "RU",
            "wallet_state": "",
            "wallet_fee": "1",
            "wallet_fee_minimum": "1",
            "wallet_fee_percent": "0.05",
            "wallet_publisher_fee_percent_default": "0.10",
            "wallet_fee_base": "0",
            "wallet_other_currency": 3,
            "wallet_other_country": "SE",
            "wallet_fee_base_for_other": "0",
            "wallet_conversion_rate": "0.011283",
            "wallet_inverse_conversion_rate": "88.630637",
            "wallet_balance": "265",
            "wallet_delayed_balance": "0",
            "wallet_max_balance": "12500000",
            "wallet_trade_max_balance": "11250000",
            "success": true,
            "rwgrsn": -2
          };
          var g_strCountryCode = "RU";
          var g_bMarketAllowed = true;
          var g_ulTradePartnerSteamID = '76561198162460158';
          var g_bTradePartnerProbation = false;
          var g_sessionID = "512c1d2b04263635dc96ddd8";
          var g_rgCurrentTradeStatus = {
            "newversion": true,
            "version": 1,
            "me": {
              "assets": [],
              "currency": [],
              "ready": false
            },
            "them": {
              "assets": [],
              "currency": [],
              "ready": false
            }
          };
          UserYou.SetProfileURL("https:\/\/steamcommunity.com\/id\/blyagdeya");
          UserYou.SetSteamId('76561198217003309');
          var g_strYourPersonaName = "zxzxzx";
          var g_strInventoryLoadURL = 'https://steamcommunity.com/id/blyagdeya/inventory/json/';
          UserThem.SetProfileURL("https:\/\/steamcommunity.com\/id\/klimpen13371");
          UserThem.SetSteamId('76561198162460158');
          var g_strTradePartnerPersonaName = "\u1d2e\u1da0 \ud835\udd6a\ud835\udd38\u2115\ud835\udd3eO";
          var g_strTradePartnerInventoryLoadURL = 'https://steamcommunity.com/tradeoffer/new/partnerinventory/';
          $J(function () {
            UserYou.LoadContexts(g_rgAppContextData);
            UserThem.LoadContexts(g_rgPartnerAppContextData);
            BeginTradeOffer(0, false);
            CTradeOfferStateManager.SetTradeOfferCreateParams({
              "trade_offer_access_token": "qP-NKf8d"
            });
          });
        </script>
        <script type="text/javascript">
          var recaptchaOnloadCallback = function () { }
        </script>
      </div>
      <!-- responsive_page_legacy_content -->
    </div>
    <!-- responsive_page_content -->
  </div>
  <!-- responsive_page_frame -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const auth = new window.Auth({
        domain: window.location.hostname,
        method: 'overlay'
      });
      auth.setOpenSelectors([
        'a'
      ]);
    });
  </script>
  <div class="miniprofile_hover" style="left: 439.221px; top: -11.028px; display: none;">
    <div class="shadow_ul"></div>
    <div class="shadow_top"></div>
    <div class="shadow_ur"></div>
    <div class="shadow_left"></div>
    <div class="shadow_right"></div>
    <div class="shadow_bl"></div>
    <div class="shadow_bottom"></div>
    <div class="shadow_br"></div>
    <div class="miniprofile_hover_inner shadow_content">
      <div class="miniprofile_container">

        <!-- Background -->
        <div class="miniprofile_background">
          <img class="miniprofile_backgroundblur" src="https://i.imgur.com/0ZTtk6p.jpeg">
        </div>
        <div class="miniprofile_playersection ">

          <!-- Player avatar/name stuff -->
          <div class="playersection_avatar border_color_online">
            <img src="https://i.imgur.com/0ZTtk6p.jpeg"
              srcset="https://avatars.steamstatic.com/fff5eaac06aaad8f06bcea4532c2f48cbe538186.jpg 1x, https://cdn.cloudflare.steamstatic.com/steamcommunity/public/images/avatars/27/27145765499fd572636b86cafa9400eff456cc46_full.jpg 2x">
          </div>
          <div class="player_content">
            <span class="persona online">Ella &lt;3</span>
            <span class="friend_status_online">Online</span>
          </div>
        </div>
        <div class="miniprofile_detailssection  not_in_game miniprofile_backdrop">
          <div class="miniprofile_featuredcontainer">
            <img src="https://i.imgur.com/BEXZMwI.png" class="badge_icon">
            <div class="description">
              <div class="name">Winter 2018 Knick-Knack Collector</div>
              <div class="xp">230 XP</div>
            </div>
          </div>
          <div class="miniprofile_featuredcontainer">
            <div class="friendPlayerLevel lvl_20"><span class="friendPlayerLevelNum">46</span></div>
            <div class="description">
              <div class="name">Steam Level</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="miniprofile_hover" style="display: none;">
    <div class="shadow_ul"></div>
    <div class="shadow_top"></div>
    <div class="shadow_ur"></div>
    <div class="shadow_left"></div>
    <div class="shadow_right"></div>
    <div class="shadow_bl"></div>
    <div class="shadow_bottom"></div>
    <div class="shadow_br"></div>
    <div class="miniprofile_hover_inner shadow_content"></div>
  </div>
</body>

</html>
